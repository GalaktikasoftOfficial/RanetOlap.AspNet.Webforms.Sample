"use strict";!function(){var w=function(){for(var e=this,t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e},e=angular.module("sampleDynamicPivotGrid.controllers",[]);e.controller("busyIndicatorController",["$scope",function(n){n.visible=!1,n.$parent&&(n.visible=!n.$parent.isShowContent),n.$on("onChangeStateLoadPanel",function(e,t){n.visible=t.visible,n.visible&&(n.message=t.message)})}]),e.controller("sampleDynamicPivotGridController",["$scope","$translate","$uibModal","$log","$rootScope","reportsStorageProvider","messageService","appConfig","exportService","pagesStorageProvider","splitWordsFilter","ranetAngularInstance","actionManager",function(c,l,u,e,d,n,o,p,m,r,t,i,a){Ranet.UserActionsTracker.track("Application initialization"),a.clearActions(),c.connection=p.defaultConnection,c.isShowContent=!0,c.isShowToolbarTop=void 0===p.showTopToolbar||p.showTopToolbar,c.isShowToolbarBottom=void 0===p.showBottomToolbar||p.showBottomToolbar,c.toolbarPositionClass=function(){return c.isShowToolbarTop?c.isShowToolbarBottom?"":"appDynamicPivotGrid_toolbarTop":c.isShowToolbarBottom?"appDynamicPivotGrid_toolbarBottom":"appDynamicPivotGrid_toolbarNone"},c.hideToolbars=function(){c.isShowToolbarTop=!1,c.isShowToolbarBottom=!1},c.setBottomToolbarVisibility=function(e){c.isShowToolbarBottom=e},c.setTopToolbarVisibility=function(e){c.isShowToolbarTop=e},c.showToolbars=function(){c.isShowToolbarTop=!0,c.isShowToolbarBottom=!0},c.autoExecuteMdxQuery=!0,c.showMetadataAndQueryDesigner=!1,c.isVisibleActiveFilters=!1,c.chartTypes=["DiagramType_Line","DiagramType_Area","DiagramType_Bar","DiagramType_StackedArea","DiagramType_StackedBar"],c.pathResource=p.resourcePath,c.pathTemplates=c.pathResource+"templates/",c.applicationUrl=p.applicationUrl,c.hiddenToolbarButtons=["exportLayoutButton","importLayoutButton","exportToExcelButton","exportToXmlButton","layoutDesignerSelectorDropdown"],c.getWords=function(e){return l.instant(e).split(" ")};var s=function(e){return e},g=function(e){return null};function f(e){c.currentPage=e,c.referenceDynamicPivotGrid.setPage(e.id)}function C(e){var t;void 0!==c.reportDescription&&c.referenceDynamicPivotGrid.destroy(),t=e,c.reportDescription=t,i.onReportChanged(t),c.referenceDynamicPivotGrid.init(e.content,c.connection),f(e.content.pages[e.content.pages.length-1])}function v(t,e){d.$broadcast("onChangeStateLoadPanel",{visible:!0,message:l.instant("LoadPanel_GetReport")}),n.getReport(t,e).success(function(e){Ranet.UserActionsTracker.track("Load the report from the repository",{caption:e.caption,id:e.id,isPublic:e.isPublic}),C(e),d.$broadcast("onChangeStateLoadPanel",{visible:!1})}).error(function(e){d.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError(w.call(l.instant("LoadReportViewer_LoadingReportError"),t.caption))})}function b(e){c.reportDescription.content.pages.push(e),f(e)}function y(e){var t=e.historyManager;c.$evalAsync(function(){c.isEnabledGoToStart=t.canGoToStart,c.isEnabledGoToBack=t.canGoToBack,c.isEnabledGoToNext=t.canGoToNext,c.isEnabledGoToEnd=t.canGoToEnd})}function h(e,t){c.$evalAsync(function(){c.hasLocalChanges=e,c.hasServerChanges=t})}function S(e,t){if(t){var n=t.view;n.onHistoryChangedCallback=y,n.onStateUpdateStorageChangedCallback=h,c.showMetadataAndQueryDesigner=n.showMetadataAndQueryDesigner,c.isVisibleActiveFilters=n.isVisibleActiveFilters,c.chartType=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings.chartOptions.defaultDiagramType,c.isVisibleChart=!!c.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeDataViewer,c.autogenerateSeries=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings.chartOptions.autogenerate,y(n)}}function P(){var e=function(){for(var e={},t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(void 0===e[o[0]])e[o[0]]=decodeURIComponent(o[1]);else if("string"==typeof e[o[0]]){var r=[e[o[0]],decodeURIComponent(o[1])];e[o[0]]=r}else e[o[0]].push(decodeURIComponent(o[1]))}return e}(),t=e.ranetreportid,n=e.ranetispublic,o=void 0===e.connectionstring?null:decodeURIComponent(e.connectionstring);void 0!==t&&void 0!==n&&(null!==o&&(c.connection=o),v({id:t,isPublic:n}))}c.toggleRotateAxes=function(){var e=c.referenceDynamicPivotGrid.descriptionCurrentPage.view;e.rotateAxes=!e.rotateAxes,Ranet.UserActionsTracker.track("ToolBar. Click a button 'RotateAxes'.",{value:c.rotateAxes})},c.toggleShowMetadataAndQueryDesigner=function(){c.showMetadataAndQueryDesigner=!c.showMetadataAndQueryDesigner,c.referenceDynamicPivotGrid.descriptionCurrentPage.view.showMetadataAndQueryDesigner=c.showMetadataAndQueryDesigner,Ranet.UserActionsTracker.track("ToolBar. Click a button 'ShowOrHideQueryDesignerPanel'.",{value:c.showMetadataAndQueryDesigner})},c.changeLayoutQueryDesigner=function(e){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ChangeLayoutQueryDesigner' (MetaDataTree, QueryDesigner, DataViewPanel).",{value:e}),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeQueryDesigner=e},c.historyReportGoTo=function(e){Ranet.UserActionsTracker.track("ToolBar. History navigation.",{value:e}),"start"!==e?"back"!==e?"next"!==e?"end"!==e||c.referenceDynamicPivotGrid.descriptionCurrentPage.view.historyManager.goToEnd():c.referenceDynamicPivotGrid.descriptionCurrentPage.view.historyManager.goToNext():c.referenceDynamicPivotGrid.descriptionCurrentPage.view.historyManager.goToBack():c.referenceDynamicPivotGrid.descriptionCurrentPage.view.historyManager.goToStart()},c.onCreateRefControl=function(e){c.referenceDynamicPivotGrid=e,c.referenceDynamicPivotGrid.onPageChangedCallback=S,i.setPivotGridRef(c.referenceDynamicPivotGrid)},c.setPage=function(e){f(e),Ranet.UserActionsTracker.track("Open another page report",{captionPage:e.caption,captionReport:c.reportDescription.caption,idReport:c.reportDescription.id})},c.editPage=function(t){var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/editPage.html",controller:"editPageController",backdrop:"static",size:"sm",windowClass:"app-modalWindow_center",resolve:{args:function(){return{page:t,windowTitle:"Edit page",otherPages:c.reportDescription.content.pages,isEnabledEditCube:!1}}}}).result.then(function(e){t.caption=e.caption},function(){})},c.deletePage=function(e,t){o.showQuestion(l.instant("Warning"),w.call(l.instant("MdxDesigner_ConfirmCloseQuery"),e.caption),function(){c.referenceDynamicPivotGrid.deletePage(e),c.referenceDynamicPivotGrid.descriptionCurrentPage?c.currentPage=c.referenceDynamicPivotGrid.descriptionCurrentPage.page:c.currentPage=void 0,t&&t(!0)},function(){t&&t(!1)})},c.addNewPageInReport=function(){var t={};t.cubeName=c.currentPage.cubeName,t.id=Ranet.Utility.Guid.newGuid(),t.caption="",t.queryDesignerSetting={},t.queryDesignerSetting.hideEmptyColumns=!0,t.queryDesignerSetting.hideEmptyRows=!0,t.queryDesignerSetting.includeAllMembers=!1,t.queryDesignerSetting.includeCustomCalculationsInDrillDown=!1,t.queryDesignerSetting.subsetCount=0,t.queryDesignerSetting.useVisualTotals=!0,t.queryDesignerSetting.generateCustomCalculated=!1;var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/editPage.html",controller:"editPageController",backdrop:"static",size:"sm",windowClass:"app-modalWindow_center",resolve:{args:function(){return{page:t,windowTitle:"Add new page",otherPages:c.reportDescription.content.pages,isEnabledEditCube:!0,connection:c.connection}}}}).result.then(function(e){t.caption=e.caption,t.cubeName=e.cubeName,b(t),Ranet.UserActionsTracker.track("Add a new page in the report",{captionPage:t.caption,idReport:c.reportDescription.id,captionReport:c.reportDescription.caption})},function(){})},c.copyCurrentPage=function(){var e=c.currentPage,t=JSON.parse(JSON.stringify(e));t.id=Ranet.Utility.Guid.newGuid(),t.caption=function(){for(var e=l.instant("Page"),t=1,n=e+" "+t;0<c.reportDescription.content.pages.filter(function(e){return e.caption===n}).length;)n=e+" "+ ++t;return n}(),delete t.$$hashKey,b(t)},c.reset=function(){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ResetState'."),o.showQuestion(l.instant("Warning"),l.instant("Reset_Question"),function(){c.referenceDynamicPivotGrid.descriptionCurrentPage.view.reset()},function(){})},c.removeAllActions=function(){Ranet.UserActionsTracker.track("ToolBar. Click a button 'RemoveAllActions'."),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.removeAllActions()},c.openReport=function(){var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/openReport.html",controller:"openEntryController",size:"lg",backdrop:"static",scope:!1,resolve:{args:function(){return{storageProvider:n,filterKey:null}}}}).result.then(function(e){v(e,c.connection)},function(){})},c.saveReport=function(){var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/saveReport.html",controller:"saveEntryController",backdrop:"static",size:"lg",resolve:{args:function(){return{entry:{},defaultCaption:c.reportDescription.caption,storageProvider:n,filterKey:null,onBeforeSavingEntryCallback:function(e){e.content=c.referenceDynamicPivotGrid.report}}}}}).result.then(function(e){c.reportDescription.id=e.id,c.reportDescription.isPublic=e.isPublic},function(){})},c.showMdxQuery=function(e){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ShowMdx'.");var t=angular.element(".dynamicPivotGrid");u.open({appendTo:t,templateUrl:p.resourcePath+"templates/queryViewer.html",controller:"showMdxQueryController",backdrop:"static",size:e,resolve:{args:function(){return{query:c.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentMdxQuery,initialQuery:c.referenceDynamicPivotGrid.descriptionCurrentPage.view.initialQuery,useQueryAsDataSource:1===c.referenceDynamicPivotGrid.descriptionCurrentPage.view.initialSourceType,updateScriptTemplate:c.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentUpdateScriptTemplate,useCustomUpdateScriptTemplate:c.referenceDynamicPivotGrid.descriptionCurrentPage.view.useCustomUpdateScriptTemplate}}}}).result.then(function(e){c.referenceDynamicPivotGrid.descriptionCurrentPage.view.useCustomUpdateScriptTemplate=e.useCustomUpdateScriptTemplate,e.useCustomUpdateScriptTemplate&&(c.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentUpdateScriptTemplate=e.updateScriptTemplate),e.useQueryAsDataSource?c.referenceDynamicPivotGrid.descriptionCurrentPage.view.setUpInitialQuery(e.query):1===c.referenceDynamicPivotGrid.descriptionCurrentPage.view.initialSourceType&&c.referenceDynamicPivotGrid.descriptionCurrentPage.view.setUpInitialCurrentState()},function(){})},c.openWindowEditSettings=function(e){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ShowSettings'.");var t=angular.element(".dynamicPivotGrid");u.open({appendTo:t,templateUrl:p.resourcePath+"templates/editQueryDesignerSettings.html",controller:"editQueryDesignerSettingsController",backdrop:"static",size:e,resolve:{queryDesignerSetting:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.queryDesignerSetting},loadStateFromHistory:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.loadStateFromHistory}}}).result.then(function(e){c.referenceDynamicPivotGrid.descriptionCurrentPage.view.queryDesignerSetting=e.setting,c.referenceDynamicPivotGrid.descriptionCurrentPage.view.loadStateFromHistory=e.loadStateFromHistory},function(){})},c.openWindowEditConnection=function(e){Ranet.UserActionsTracker.track("ToolBar. Click a button 'OpenConnectionEditor'.");var t=angular.element(".dynamicPivotGrid");u.open({appendTo:t,templateUrl:p.resourcePath+"templates/editCurrentConnection.html",controller:"editCurrentConnectionController",backdrop:"static",size:e,resolve:{currentConnection:function(){return c.connection}}}).result.then(function(e){c.connection=e},function(){})},c.createNewReport=function(){var e=angular.element(".dynamicPivotGrid");u.open({templateUrl:p.resourcePath+"templates/newReport.html",appendTo:e,controller:"createNewReportController",backdrop:"static",size:"sm",resolve:{connection:function(){return c.connection}}}).result.then(function(e){C(e),Ranet.UserActionsTracker.track("Create new report")},function(){})},c.showCustomCalculationsEditor=function(){var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/customCalculationsEditor.html",controller:"customCalculationsEditorController",backdrop:"static",size:"lg",resolve:{calculatedMembers:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCalculatedItems.calculatedMembers},calculatedNamedSets:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCalculatedItems.calculatedNamedSets},cubeMetaData:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeMetaData},connection:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.connection},cubeName:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeName}}}).result.then(function(e){c.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCalculatedItems={calculatedMembers:e.customMembers,calculatedNamedSets:e.customSet},c.referenceDynamicPivotGrid.descriptionCurrentPage.view.updateData()},function(){})},c.showCellConditionsDesigner=function(){var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/cellConditionsDesigner.html",controller:"cellConditionsDesignerController",backdrop:"static",size:"lg",resolve:{cubeExplorerOptions:function(){return{cubeMetaData:c.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeMetaData,connection:c.connection,cubeName:c.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeName}},customCellsConditions:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCellsConditions}}}).result.then(function(e){c.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCellsConditions=e.styleDescriptors},function(){})},c.export=function(e){var t=c.referenceDynamicPivotGrid.descriptionCurrentPage.page.caption,n=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.descriptionActiveFilters,o=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.headerText,r=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.footerText,i=p.applicationUrl+"api/export/download/",a=void 0,s=l.instant("Command_Export_Group");if(0===e)d.$broadcast("onChangeStateLoadPanel",{visible:!0,message:s}),a="Excel",m.toExcel(t,n,c.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentDataSource,o,r).success(function(e){var t=i+e;d.$broadcast("onChangeStateLoadPanel",{visible:!1}),window.location=t}).error(function(e){d.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Export to Excel - error. See log.")});else if(1===e)d.$broadcast("onChangeStateLoadPanel",{visible:!0,message:s}),a="Xml",m.toXml(t,n,c.referenceDynamicPivotGrid.descriptionCurrentPage.view.currentDataSource,o,r).success(function(e){var t=i+e;d.$broadcast("onChangeStateLoadPanel",{visible:!1}),window.location=t}).error(function(e){d.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Export to Xml - error. See log.")});else if(2===e){a="Url";u.open({appendTo:angular.element(".dynamicPivotGrid"),templateUrl:p.resourcePath+"templates/urlViewer.html",controller:"exportToUrlController",backdrop:"static",size:"lg",resolve:{args:{reportId:c.reportDescription.id,isPublic:c.reportDescription.isPublic}}})}Ranet.UserActionsTracker.track("Export",{type:a})},c.toggleVisibilityActiveFilters=function(){Ranet.UserActionsTracker.track("ToolBar. Click a button 'ShowOrHideActiveFilters'.",{value:!c.isVisibleActiveFilters}),c.isVisibleActiveFilters=!c.isVisibleActiveFilters,c.referenceDynamicPivotGrid.descriptionCurrentPage.view.isVisibleActiveFilters=c.isVisibleActiveFilters},c.isVisibleInToolbar=function(e){switch(e){case"":default:return-1===c.hiddenToolbarButtons.indexOf(e)}},c.editExtension=function(){var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/editExtension.html",controller:"editExtensionController",backdrop:"static",size:"lg",resolve:{refetenceDynamicPivotGrid:function(){return c.referenceDynamicPivotGrid},extensionSettings:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings},layoutMode:function(){return c.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeDataViewer}}}).result.then(function(e){var t=e.extensionSettings,n=e.layoutMode;c.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionSettings=t,c.autogenerateSeries=t.chartOptions.autogenerate,c.chartType=t.chartOptions.defaultDiagramType,c.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeDataViewer!==n&&(Ranet.UserActionsTracker.track("ToolBar. Change a layout of dataViewer.",{value:n}),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.placementLayoutModeDataViewer=n,c.isVisibleChart=!!n)},function(){})},c.openNewPage=function(){var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/openReport.html",controller:"openEntryController",size:"lg",backdrop:"static",resolve:{args:function(){return{storageProvider:r,filterKey:g(c.referenceDynamicPivotGrid.descriptionCurrentPage.page)}}}}).result.then(function(e){var t;t=e,d.$broadcast("onChangeStateLoadPanel",{visible:!0,message:l.instant("LoadPanel_GetReport")}),r.getEntry(t).success(function(e){var t=c.referenceDynamicPivotGrid.descriptionCurrentPage.page.id;c.referenceDynamicPivotGrid.deletePage(c.referenceDynamicPivotGrid.descriptionCurrentPage.page),e.content.id=t;var n=s(e.content);n||(n=e.content),b(n),d.$broadcast("onChangeStateLoadPanel",{visible:!1})}).error(function(e){d.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError(w.call(l.instant("LoadReportViewer_LoadingReportError"),t.caption))})},function(){})},c.saveCurrentPage=function(){var e=angular.element(".dynamicPivotGrid");u.open({appendTo:e,templateUrl:p.resourcePath+"templates/saveReport.html",controller:"saveEntryController",backdrop:"static",size:"lg",resolve:{args:function(){return{entry:{},defaultCaption:"",storageProvider:r,onBeforeSavingEntryCallback:function(e){var t=c.referenceDynamicPivotGrid.descriptionCurrentPage;t.page.caption=e.caption,e.content=t.page},filterKey:g(c.referenceDynamicPivotGrid.descriptionCurrentPage.page)}}}}).result.then(function(){},function(){})},c.hasLocalChanges=!1,c.hasServerChanges=!1,c.toggleIsEnabledWhatIfAnalysis=function(){var e=!c.referenceDynamicPivotGrid.descriptionCurrentPage.view.isEnabledWhatIfAnalysis;e?Ranet.UserActionsTracker.track("What if Analysis is activated."):Ranet.UserActionsTracker.track("What if Analysis is unactivated."),!1===e&&(c.referenceDynamicPivotGrid.descriptionCurrentPage.view.useChangesCache=!1),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.isEnabledWhatIfAnalysis=e},c.toggleUseChangesCache=function(){var e=!c.referenceDynamicPivotGrid.descriptionCurrentPage.view.useChangesCache;e?Ranet.UserActionsTracker.track("What if Analasis. Use changes cache."):Ranet.UserActionsTracker.track("What if Analasis. Don't use changes cache."),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.useChangesCache=e},c.recalculate=function(){Ranet.UserActionsTracker.track("What if Analasis. Recalculate."),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.recalculate()},c.save=function(){Ranet.UserActionsTracker.track("What if Analasis. Commit transaction."),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.save()},c.rollback=function(){Ranet.UserActionsTracker.track("What if Analasis. Rollback transaction."),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.rollback()},c.clearLocalChanges=function(){Ranet.UserActionsTracker.track("What if Analasis. Clear local changes."),c.referenceDynamicPivotGrid.descriptionCurrentPage.view.clearLocalChanges()},c.$on("openNewReportApiEvent",function(e,t){C(t)}),c.$on("addNewPageApiEvent",function(e,t){var n=t.page;if(0!==c.reportDescription.content.pages.filter(function(e){return e.id===n.id}).length)throw new Error("We already have this page.");b(n)}),c.$on("changeOnPageImportingApiEvent",function(e,t){if("function"!=typeof t.onPageImporting)throw new Error("onPageImporting must be a function.");s=t.onPageImporting}),c.$on("changeOnGetFilterKeyApiEvent",function(e,t){if("function"!=typeof t.onGetFilterKey)throw new Error("onGetFilterKey must be a function.");g=t.onGetFilterKey}),c.$on("deletePageApiEvent",function(e,t){var n=c.reportDescription.content.pages.filter(function(e){return e.id===t.id})[0];if(!n)throw new Error("We didn't find a page with id '"+t.id+"'.");c.deletePage(n,t.deleteCallback)}),c.$on("changeConnectionApiEvent",function(e,t){c.connection=t.connection}),c.$on("loadReport",function(e,t){C(t.report)}),a.registerActions({createNewReport:c.createNewReport,openReport:c.openReport,saveReport:c.saveReport,hideToolbars:c.hideToolbars,showToolbars:c.showToolbars,toggleRotateAxes:c.toggleRotateAxes,toggleShowMetadataAndQueryDesigner:c.toggleShowMetadataAndQueryDesigner,changeLayoutQueryDesigner:c.changeLayoutQueryDesigner,addNewPageInReport:c.addNewPageInReport,reset:c.reset,showMdxQuery:c.showMdxQuery,openWindowEditSettings:c.openWindowEditSettings,openWindowEditConnection:c.openWindowEditConnection,showCustomCalculationsEditor:c.showCustomCalculationsEditor,showCellConditionsDesigner:c.showCellConditionsDesigner,export:c.export,toggleVisibilityActiveFilters:c.toggleVisibilityActiveFilters,editExtension:c.editExtension,openNewPage:c.openNewPage,saveCurrentPage:c.saveCurrentPage,toggleIsEnabledWhatIfAnalysis:c.toggleIsEnabledWhatIfAnalysis,setBottomToolbarVisibility:c.setBottomToolbarVisibility,setTopToolbarVisibility:c.setTopToolbarVisibility,addItemToDesigner:function(e,t,n){var o=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.integrityDataManager,r=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeMetaData,i=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCalculatedItems,a=Ranet.Utility.DataItemGenerator.getDataItem(n,t,r,i);switch(e){case"rows":o.dropItem(Ranet.Controls.AreaType.Rows,a);break;case"columns":o.dropItem(Ranet.Controls.AreaType.Columns,a);break;case"data":o.dropItem(Ranet.Controls.AreaType.Data,a);break;case"filters":o.dropItem(Ranet.Controls.AreaType.Filters,a)}o.onLayoutChanged.trigger()},showExtensionPanel:function(e){c.referenceDynamicPivotGrid.descriptionCurrentPage.view.extensionPanelVisibility=e},showQueryDesignerToolbar:function(e){c.referenceDynamicPivotGrid.descriptionCurrentPage.view.showQueryDesignerToolbar=e},deleteItemFromQueryDesigner:function(e,t,n){var o=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.integrityDataManager,r=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.cubeMetaData,i=c.referenceDynamicPivotGrid.descriptionCurrentPage.view.customCalculatedItems,a=Ranet.Utility.DataItemGenerator.getDataItem(n,t,r,i);switch(e){case"rows":o.deleteDataItem(Ranet.Controls.AreaType.Rows,a);break;case"columns":o.deleteDataItem(Ranet.Controls.AreaType.Columns,a);break;case"data":o.deleteDataItem(Ranet.Controls.AreaType.Data,a);break;case"filters":o.deleteDataItem(Ranet.Controls.AreaType.Filters,a)}o.onLayoutChanged.trigger()}}),c.$on("changeToolBarOptionsApiEvent",function(e,t){t.buttons.forEach(function(e){!1===e.isVisible?c.hiddenToolbarButtons.push(e.name):!0===e.isVisible&&-1!==c.hiddenToolbarButtons.indexOf(e.name)&&c.hiddenToolbarButtons.splice(c.hiddenToolbarButtons.indexOf(e.name),1)}),c.$apply()}),c.$on("setSelectedPageApiEvent",function(e,t){var n=c.reportDescription.content.pages.filter(function(e){return e.id===t.idPage});if(0===n.length)throw new Error("We didn't find a page with id '"+t.idPage+"'.");f(n[0])}),!1===l.isReady()?(c.isShowContent=!1,d.$broadcast("onChangeStateLoadPanel",{visible:!0}),d.$on("$translateChangeSuccess",function(){Ranet.Localization.complete||o.showInformation(l.instant("Warning"),l.instant("Localization_Incomplete"),l.instant("DialogButton_Ok")),Ranet.Localization.exists||o.showInformation(l.instant("Warning"),l.instant("Localization_NotExist"),l.instant("DialogButton_Ok")),d.$broadcast("onChangeStateLoadPanel",{visible:!1}),parent.postMessage("Loaded","*"),c.isShowContent=!0,P()})):(Ranet.Localization.complete||o.showInformation(l.instant("Warning"),l.instant("Localization_Incomplete"),l.instant("DialogButton_Ok")),Ranet.Localization.exists||o.showInformation(l.instant("Warning"),l.instant("Localization_NotExist"),l.instant("DialogButton_Ok")),P(),parent.postMessage("Loaded","*"))}]),e.controller("cellConditionsDesignerController",["$scope","$uibModalInstance","$translate","cubeExplorerOptions","customCellsConditions","messageService",function(r,e,o,t,n,i){Ranet.UserActionsTracker.track("Open editor of cell conditions."),r.uniqueName="",r.isVisibleSecondTextBox=!1,r.textMemberUniqueName="",r.typeConditions=[{caption:o.instant("ComboBoxItem_None"),type:Ranet.Controls.CellConditionType.None,imageClass:""},{caption:o.instant("ValueFilter_Equal"),type:Ranet.Controls.CellConditionType.Equal,imageClass:"imageLibrary_fcopequal"},{caption:o.instant("ValueFilter_NotEqual"),type:Ranet.Controls.CellConditionType.NotEqual,imageClass:"imageLibrary_fcopnotequal"},{caption:o.instant("ValueFilter_Greater"),type:Ranet.Controls.CellConditionType.Greater,imageClass:"imageLibrary_fcopgreater"},{caption:o.instant("ValueFilter_GreaterOrEqual"),type:Ranet.Controls.CellConditionType.GreaterOrEqual,imageClass:"imageLibrary_fcopgreaterorequal"},{caption:o.instant("ValueFilter_Less"),type:Ranet.Controls.CellConditionType.Less,imageClass:"imageLibrary_fcopless"},{caption:o.instant("ValueFilter_LessOrEqual"),type:Ranet.Controls.CellConditionType.LessOrEqual,imageClass:"imageLibrary_fcoplessorequal"},{caption:o.instant("ValueFilter_Between"),type:Ranet.Controls.CellConditionType.Between,imageClass:"imageLibrary_fcopbetween"},{caption:o.instant("ValueFilter_BetweenNotIncluding"),type:Ranet.Controls.CellConditionType.BetweenNotIncluding,imageClass:"imageLibrary_fcopbetweennotincluding"},{caption:o.instant("ValueFilter_NotBetween"),type:Ranet.Controls.CellConditionType.NotBetween,imageClass:"imageLibrary_fcopnotbetween"},{caption:o.instant("ValueFilter_NotBetweenNotIncluding"),type:Ranet.Controls.CellConditionType.NotBetweenNotIncluding,imageClass:"imageLibrary_fcopnotbetweennotincluding"}],r.sparklineTypes=["Bar","Line","Area","WinLoss"],r.currentSparklineType=0,r.enableSparklineTooltip=!1,r.showMinMax=!1,r.setSparklineType=function(e){r.currentSparklineType=e,r.currentCondition.appearance.sparklines.type=e},r.setSparklineTooltip=function(e){r.currentCondition.appearance.sparklines.enableTooltip=e,r.enableSparklineTooltip=e},r.setSparklineMinMax=function(e){r.currentCondition.appearance.sparklines.showMinMax=e,r.showMinMax=e};var a,s,c=Ranet.Utility.ImageStorage.getImages(),l={caption:o.instant("Color_None"),imageClass:""};function u(e){r.currentDescriptor=e}function d(e){r.currentCondition=e}function p(){r.openGroups={options:!1,appearance:!1,imageEditor:!1}}function m(){r.sparkLineColors=r.currentCondition?{baseColor:r.currentCondition.appearance.sparklines.baseColor||r.preconfiguredColors[o.instant("Color_Neutral").toLowerCase()],maxColor:r.currentCondition.appearance.sparklines.maxColor||r.preconfiguredColors[o.instant("Color_Primary").toLowerCase()],minColor:r.currentCondition.appearance.sparklines.minColor||r.preconfiguredColors[o.instant("Color_Active").toLowerCase()],firstColor:r.currentCondition.appearance.sparklines.firstColor||r.preconfiguredColors[o.instant("Color_Secondary").toLowerCase()],lastColor:r.currentCondition.appearance.sparklines.lastColor||r.preconfiguredColors[o.instant("Color_Secondary").toLowerCase()]}:{baseColor:r.preconfiguredColors[o.instant("Color_Neutral").toLowerCase()],maxColor:r.preconfiguredColors[o.instant("Color_Primary").toLowerCase()],minColor:r.preconfiguredColors[o.instant("Color_Active").toLowerCase()],firstColor:r.preconfiguredColors[o.instant("Color_Secondary").toLowerCase()],lastColor:r.preconfiguredColors[o.instant("Color_Secondary").toLowerCase()]}}function g(){r.cellColors=r.currentCondition?{backColor:r.currentCondition.appearance.backColor||"transparent",foreColor:r.currentCondition.appearance.foreColor||"transparent"}:{backColor:"transparent",foreColor:"transparent"}}c.splice(0,0,l),r.imageDescriptions=c,r.currentTypeCondition=r.typeConditions[0],r.connection=t.connection,r.cubeName=t.cubeName,r.cubeMetaData=t.cubeMetaData,r.arrayDescriptors=(a=n,s=JSON.stringify(a),JSON.parse(s)),r.openGroups={options:!1,appearance:!1,imageEditor:!1},p(),function(){var e=Ranet.Utility.ColorHelper.getColors();r.preconfiguredColors={};for(var t=0;t<e.length;t++){var n=e[t].caption.toLowerCase(),o=e[t].webArgb;r.preconfiguredColors[n]=o}}(),m(),g(),r.$watch("currentDescriptor",function(e){r.textMemberUniqueName=e?e.memberUniqueName:"",r.currentCondition=void 0,r.currentTypeCondition=r.typeConditions[0]}),r.$watch("currentCondition",function(e){if(!e)return p(),void(r.currentTypeCondition=r.typeConditions[0]);var t=e.conditionType;r.currentTypeCondition=r.typeConditions.filter(function(e){return e.type===t})[0],e.appearance.sparklines?(r.currentSparklineType=r.currentCondition.appearance.sparklines.type||0,r.enableSparklineTooltip=r.currentCondition.appearance.sparklines.enableTooltip||!1,r.showMinMax=r.currentCondition.appearance.sparklines.showMinMax||!1):e.appearance.sparklines={},g(),m()}),r.$watch("currentTypeCondition",function(e){switch(e.type){case Ranet.Controls.CellConditionType.Equal:case Ranet.Controls.CellConditionType.NotEqual:case Ranet.Controls.CellConditionType.Greater:case Ranet.Controls.CellConditionType.GreaterOrEqual:case Ranet.Controls.CellConditionType.Less:case Ranet.Controls.CellConditionType.LessOrEqual:case Ranet.Controls.CellConditionType.None:r.isVisibleSecondTextBox=!1;break;default:r.isVisibleSecondTextBox=!0}}),r.$watch("sparkLineColors",function(e){r.currentCondition&&(r.currentCondition.appearance.sparklines.baseColor=e.baseColor,r.currentCondition.appearance.sparklines.maxColor=e.maxColor,r.currentCondition.appearance.sparklines.minColor=e.minColor,r.currentCondition.appearance.sparklines.firstColor=e.firstColor,r.currentCondition.appearance.sparklines.lastColor=e.lastColor)},!0),r.$watch("cellColors",function(e){r.currentCondition&&(r.currentCondition.appearance.backColor=e.backColor,r.currentCondition.appearance.foreColor=e.foreColor)},!0),r.getCaptionCondition=function(t){var e=r.typeConditions.filter(function(e){return e.type===t.conditionType})[0],n="";switch(e.type){case Ranet.Controls.CellConditionType.None:n=e.caption;break;case Ranet.Controls.CellConditionType.Equal:case Ranet.Controls.CellConditionType.NotEqual:case Ranet.Controls.CellConditionType.Greater:case Ranet.Controls.CellConditionType.GreaterOrEqual:case Ranet.Controls.CellConditionType.Less:case Ranet.Controls.CellConditionType.LessOrEqual:n=e.caption,n+=" ",n+=t.value1;break;default:n=e.caption,n+=" ",n+=t.value1,n+=" "+o.instant("Filter_Label_And")+" ",n+=t.value2}return n},r.onMemberUniqueChanged=function(){r.textMemberUniqueName?r.currentDescriptor.memberUniqueName=r.textMemberUniqueName:r.textMemberUniqueName=r.currentDescriptor.memberUniqueName},r.addNewStyleDescriptor=function(){var e=new Ranet.Controls.CellConditionsDescriptor(function(e,t,n){for(var o=0,r="";r=e+" "+o,o++,0<t.filter(function(e){return e[n]===this.currentName},{currentName:r}).length;);return r}(o.instant("CellConditionDescr_NewStyle"),r.arrayDescriptors,"memberUniqueName"));r.arrayDescriptors.push(e),u(e)},r.deleteSelectedDescriptor=function(){i.showQuestion(o.instant("Warning"),o.instant("DeleteCurrent_Question"),function(){r.arrayDescriptors.splice(r.arrayDescriptors.indexOf(r.currentDescriptor),1),u(void 0)},function(){})},r.deleteAllDescriptors=function(){i.showQuestion(o.instant("Warning"),o.instant("DeleteAll_Question"),function(){u(void(r.arrayDescriptors.length=0))},function(){})},r.setCurrentDescriptor=function(e){u(e)},r.addCondition=function(){var e=new Ranet.Controls.CellCondition;r.currentDescriptor.conditions.push(e),d(e)},r.deleteCurrentCondition=function(){i.showQuestion(o.instant("Warning"),o.instant("DeleteCurrent_Question"),function(){r.currentDescriptor.conditions.splice(r.currentDescriptor.conditions.indexOf(r.currentCondition),1),d(void 0)},function(){})},r.deleteAllConditions=function(){i.showQuestion(o.instant("Warning"),o.instant("DeleteAll_Question"),function(){d(void(r.currentDescriptor.conditions.length=0))},function(){})},r.setCondition=function(e){d(e)},r.setTypeCondition=function(e){r.currentTypeCondition=e,r.currentCondition.conditionType=e.type},r.getImageDescription=function(){if(!r.currentCondition)return"";var t=r.currentCondition.appearance.cssClassImage;return t?r.imageDescriptions.filter(function(e){return e.imageClass===t})[0]:r.imageDescriptions[0]},r.setImageCondition=function(e){r.currentCondition.appearance.cssClassImage=e.imageClass},r.cancel=function(){e.dismiss("cancel")},r.ok=function(){Ranet.UserActionsTracker.track("Change cell conditions."),e.close({styleDescriptors:r.arrayDescriptors})}}]),e.controller("saveEntryController",["$translate","$scope","$rootScope","$uibModalInstance","$uibModal","messageService","appConfig","args",function(e,r,n,t,i,o,a,s){var c,l=e.instant("ObjectSaveDialog_NameIsEmpty_Message"),u=e.instant("ObjectSaveDialog_AlreadyExist_Message"),d=e.instant("Warning"),p=e.instant("LoadPanel_GetReports"),m=e.instant("LoadPanel_DeleteFolder"),g=e.instant("LoadPanel_DeleteReport"),f=s.filterKey,C=s.entry,v=s.storageProvider,b=s.onBeforeSavingEntryCallback,y=[],h=[],S={};function P(e,t){for(var n=0;n<e.items.length;n++){if(e.items[n].id===t)return e.items[n];if(e.items[n].items&&0<e.items[n].items.length){var o=P(e.items[n],t);if(null!=o)return o}}return null}function w(e){var t=e.id,n=e.isPublic?r.treeFoldersLookupDataSource[0]:r.treeFoldersLookupDataSource[1];if(null!==t){var o=P(n,t);r.lookupSelected=[o]}else r.lookupSelected=[n]}function T(){if(y=x(r.datasource[0],0),h=x(r.datasource[1],0),c){var e=c.isPublic?r.datasource[0]:r.datasource[1];(null===c.id?e:P(e,c.id)).isSelected=!0}r.treeViewFacade.repaintTreeView();var t,n,o=function e(t){for(var n=[],o=0;o<t.length;o++){var r=t[o];"folder"===r.type&&(r.isOpen=!0,n.push(r),0<r.items.length&&(r.items=e(r.items)))}return n}((t=r.datasource,n=JSON.stringify(t),JSON.parse(n)));r.treeFoldersLookupDataSource=o,r.lookupSelected=[r.treeFoldersLookupDataSource[0]]}function D(){r.disableAddFolderButton=!0,r.disableDeleteButton=!0,r.disableEditButton=!0}function x(e,t){var n=[];e.levelDepth=t,n.push(e);for(var o=0;o<e.items.length;o++){var r=e.items[o];if("folder"===r.type){var i=x(r,t+1);n=n.concat(i)}}return n}function E(){D(),n.$broadcast("onChangeStateLoadPanel",{visible:!0,message:p}),v.getDescriptionStorage(f).success(function(e){r.datasource=e,T(),n.$broadcast("onChangeStateLoadPanel",{visible:!1})}).error(function(e){n.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Error loading reports. See log.")})}function k(){C.parentId=S.id,C.caption=r.caption,C.isPublic=S.isPublic,C.description=r.description,C.filterKey=f,C.index=r.index,b(C),v.saveEntry(C).error(function(e){Ranet.LogService.error(e),Ranet.UserMessageService.showError("Error save report. Please see server log for more details.")}),t.close(C)}function M(n,e,o){var t=angular.element(".dynamicPivotGrid");i.open({appendTo:t,templateUrl:a.resourcePath+"templates/editFolder.html",controller:"editFolderController",backdrop:"static",size:"sm",windowClass:"app-modalWindow_center",resolve:{args:function(){return{folder:n,otherFolders:e,storageProvider:v}}}}).result.then(function(){c={id:n.id,isPublic:n.isPublic};var e=n.isPublic?r.datasource[0]:r.datasource[1],t=null;if(null===(t=null!==n.parentId?P(e,n.parentId):e))throw new Error("InvalidOperationException");o&&t.items.push(n),t.items=function(e){function i(e,t){return e.toString()<t.toString()?-1:e.toString()>t.toString()?1:0}return e.sort(function(e,t){if("report"===e.type&&"folder"===t.type)return 1;if("report"===t.type&&"folder"===e.type)return-1;var n=e.index,o=t.index;if(null!==n&&0===n.length&&(n=null),null!==o&&0===o.length&&(o=null),null!=o&&null==n)return 1;if(null!=n&&null==o)return-1;if(null!=n&&null!=o){var r=i(n,o);return 0===r?i(e.caption,t.caption):r}return i(e.caption,t.caption)})}(t.items),T(),Ranet.UserActionsTracker.track("Update folder in reports",{id:n.id,caption:n.caption})},function(){})}r.saveReport=function(){v.convertReportToXmlFile(r.selectedItem).success(function(e){var t=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(t,r.selectedItem.caption+".xml")}).error(function(e){Ranet.LogService.error(e),Ranet.UserMessageService.showError("Some error. See log.")})},r.showLoadReportWindow=function(){var e=angular.element(".dynamicPivotGrid");i.open({appendTo:e,templateUrl:a.resourcePath+"templates/loadReportFromPC.html",controller:"loadReportFromPcController",size:"sm",backdrop:"static",scope:!1,resolve:{args:function(){return{tree:angular.copy(r.datasource)}}}}).result.then(function(e){v.convertXmlFileToReport(e.fileContent,e.folder).success(function(e){E()}).error(function(e){Ranet.LogService.error(e),Ranet.UserMessageService.showError("Some error. See log.")})},function(){})},r.lookupSelected=[],r.treeViewFacade={},r.selectedItem=void 0,r.caption=s.defaultCaption,r.index="",r.searchTreeViewOptions={isVisibleSearch:!0},r.lookupOptions={messages:{noDataMessage:e.instant("Lookup_NotFindElements"),placeholderMessage:e.instant("ComboBoxItem_None"),prefixMultiSelectionField:" "+e.instant("Lookup_PrefixSelectedItems")},iconExpr:"icon",iconExpandedExpr:"iconExpanded",expandedExpr:"isOpen",selectedExpr:"isSelected",dataSource:[],displayExpr:"caption",isVisibleSearchPanel:!1,onSelectionChanged:function(e){var t=e.selectedItems;if(0!==t.length){var n=t[0];S={id:n.id,isPublic:n.isPublic}}}},r.addFolder=function(){var e=r.selectedItem.id,t=r.selectedItem.items.filter(function(e){return"folder"===e.type});M({id:Ranet.Utility.Guid.newGuid(),caption:"",parentId:e,isPublic:r.selectedItem.isPublic,filterKey:f,icon:"folder",iconExpanded:"folderOpen",index:null,type:"folder",isOpen:!0,levelDepth:r.selectedItem.levelDepth+1,items:[]},t,!0)},r.editItem=function(){var t=r.selectedItem,e=(t.isPublic?y:h).filter(function(e){return e.id===t.parentId})[0].items.filter(function(e){return"folder"===e.type&&e.id!==t.id});M(t,e,!1)},r.deleteItem=function(){o.showQuestion(e.instant("Warning"),e.instant("DeleteCurrent_Question"),function(){var e="",t=void 0;if("folder"===r.selectedItem.type?(e=m,t=v.deleteFolder(r.selectedItem),Ranet.UserActionsTracker.track("Delete folder",{id:r.selectedItem.id,caption:r.selectedItem.caption})):(e=g,t=v.deleteEntry(r.selectedItem),Ranet.UserActionsTracker.track("Delete report",{id:r.selectedItem.id,caption:r.selectedItem.caption})),!t)throw new Error("InvalidOperationException");n.$broadcast("onChangeStateLoadPanel",{visible:!0,message:e}),t.success(function(){r.caption="",r.description="",n.$broadcast("onChangeStateLoadPanel",{visible:!1});var e=r.selectedItem.isPublic?r.datasource[0]:r.datasource[1];if(null!==r.selectedItem.parentId){var t=P(e,r.selectedItem.parentId);t.items.splice(t.items.indexOf(r.selectedItem),1)}else e.items.splice(e.items.indexOf(r.selectedItem),1);c={id:r.selectedItem.parentId,isPublic:r.selectedItem.isPublic},T()}).error(function(e){n.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Error deleting report. See log.")})},function(){})},r.onSelectedStorageItemChanged=function(e){if(r.selectedItem=e.data,r.disableAddFolderButton=!0,r.disableDeleteButton=!0,r.disableEditButton=!0,"folder"===e.data.type)r.caption="",r.description="",r.disableAddFolderButton=!1,r.index="",null!==r.selectedItem.id&&(r.disableEditButton=!1,0===r.selectedItem.items.length&&(r.disableDeleteButton=!1)),c={id:r.selectedItem.parentId,isPublic:r.selectedItem.isPublic},w(S={id:r.selectedItem.id,isPublic:r.selectedItem.isPublic});else{if("report"!==e.data.type&&"page"!==e.data.type)throw new Error("InvalidOperationException");r.disableDeleteButton=!1,r.caption=r.selectedItem.caption,r.index=r.selectedItem.index,r.description=r.selectedItem.description,w(S={id:r.selectedItem.parentId,isPublic:r.selectedItem.isPublic})}},r.save=function(){if(r.caption){var t=r.caption,e=(S.isPublic?y.filter(function(e){return e.id===S.id})[0]:h.filter(function(e){return e.id===S.id})[0]).items.filter(function(e){return"folder"!==e.type&&e.caption.toUpperCase()===t.toUpperCase()})[0];e?o.showQuestion(d,u,function(){C.id=e.id,k(),Ranet.UserActionsTracker.track("Save report",{overwrite:!0,id:C.id,caption:C.caption,isPublic:C.isPublic})},function(){}):(C.id=Ranet.Utility.Guid.newGuid(),k(),Ranet.UserActionsTracker.track("Save report",{overwrite:!1,id:C.id,caption:C.caption,isPublic:C.isPublic}))}else o.showInformation(d,l)},r.cancel=function(){t.dismiss("cancel")},E(),D()}]),e.controller("editFolderController",["$scope","$rootScope","$uibModalInstance","$translate","messageService","args",function(t,n,e,o,r,i){var a=o.instant("ObjectSaveDialog_NameIsEmpty_Message"),s=o.instant("EditFolderWindow_AlreadyExist"),c=o.instant("Warning"),l=o.instant("LoadPanel_SaveFolder"),u=i.storageProvider,d=i.folder;t.caption=d.caption,t.index=d.index,t.ok=function(){t.caption?1<=i.otherFolders.filter(function(e){return e.caption.toUpperCase()===t.caption.toUpperCase()}).length?r.showInformation(c,s):(d.caption=t.caption,d.index=t.index,n.$broadcast("onChangeStateLoadPanel",{visible:!0,message:l}),u.saveFolder(d).success(function(){n.$broadcast("onChangeStateLoadPanel",{visible:!1}),e.close(void 0)}).error(function(e){n.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Save folder - error. See log.")})):r.showInformation(c,a)},t.cancel=function(){e.dismiss("cancel")}}]),e.controller("editPageController",["$scope","$translate","$rootScope","$uibModalInstance","reportsStorageProvider","messageService","args",function(t,e,n,o,r,i,a){var s=e.instant("ObjectSaveDialog_NameIsEmpty_Message"),c=e.instant("EditPageWindow_WarningCubeNameIsEmpty"),l=e.instant("EditPageWindow_AlreadyExist"),u=e.instant("Warning"),d=a.page;t.windowTitle=a.windowTitle,t.caption=d.caption,t.cubeName=d.cubeName,t.isEnabledEditCube=a.isEnabledEditCube,a.hasOwnProperty("connection")&&(t.onCubeSelectedItemChanged=function(e){t.cubeName=e.name},t.connection=a.connection),t.ok=function(){t.caption?t.cubeName?a.otherPages.filter(function(e){return e.caption.toUpperCase()===t.caption.toUpperCase()})[0]?i.showInformation(u,l):o.close({caption:t.caption,cubeName:t.cubeName}):i.showInformation(u,c):i.showInformation(u,s)},t.cancel=function(){o.dismiss("cancel")}}]),e.controller("messageServiceController",["$scope","$uibModalInstance","args",function(e,t,n){e.message=n.message,e.caption=n.caption,e.isVisibleOkButton=n.isVisibleOkButton,e.isVisibleCancelButton=n.isVisibleCancelButton,e.contentOkButton=n.contentOkButton,e.contentCancelButton=n.contentCancelButton,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("customCalculationsEditorController",["$scope","$rootScope","$uibModalInstance","$translate","calculatedMembers","calculatedNamedSets","cubeMetaData","connection","cubeName","messageService",function(r,e,o,i,t,n,a,s,c,l){Ranet.UserActionsTracker.track("Open the editor custom calculations",{countCustomMembers:t.length,countCustomSet:n.length}),r.connection=s,r.cubeName=c;var u={color:"rgba(255,255,255,0)",caption:i.instant("Color_None")};function d(e){var t=e;return-1===e.indexOf("[")&&(t="["+t),e.lastIndexOf("]")!==e.length-1&&(t+="]"),t}function p(e){var t=JSON.stringify(e);return JSON.parse(t)}!function(){var e=Ranet.Utility.ColorHelper.getColors();e.push(u),r.preconfiguredColors={};for(var t=0;t<e.length;t++){var n=e[t].caption.toLowerCase(),o=e[t].webArgb;r.preconfiguredColors[n]=o}}();var m=p(t),g=p(n);function f(e,t){for(var n,o=0;;){if(n="["+e+" "+o+"]",0===t.filter(function(e){return e.caption===this.newCaption},{newCaption:n}).length)return n;o++}}function C(t,e){return!!t&&0===e.filter(function(e){return e.caption===t}).length}r.calculatedMembers=m,r.calculatedNamedSets=g,r.cubeMetaData=a,r.disableDeleteButton=!0,r.disableEditorCustomSetPanel=!1,r.disableEditorCustomMemberPanel=!0,r.showEditorCustomSetPanel=!1,r.showEditorCustomMemberPanel=!0;var v=function(e){var t=[];if(!e.length)return t;for(var n=0;n<e.length;n++){var o={id:Ranet.Utility.Guid.newGuid(),caption:e[n].name,expression:e[n].expression,icon:"customNamedSet",type:"customSet"};t.push(o)}return t}(r.calculatedNamedSets),b=function(e){var t=[];if(!e.length)return t;for(var n=0;n<e.length;n++){var o={id:Ranet.Utility.Guid.newGuid(),caption:e[n].name,expression:e[n].expression,icon:"customMeasure",type:"customMember",formatString:e[n].formatString};if(e[n].foreColor&&(o.foreground={a:e[n].foreColor.a,r:e[n].foreColor.r,g:e[n].foreColor.g,b:e[n].foreColor.b}),e[n].backColor&&(o.backgroundColor={a:e[n].backColor.a,r:e[n].backColor.r,g:e[n].backColor.g,b:e[n].backColor.b}),e[n].nonEmptyBehaviors){o.nonEmptyBehaviors=[];for(var r=0;r<e[n].nonEmptyBehaviors.length;r++){var i=e[n].nonEmptyBehaviors[r];o.nonEmptyBehaviors.push(i)}}t.push(o)}return t}(r.calculatedMembers),y={id:0,caption:i.instant("CalculationsListControl_CalculatedMembers_TreeNode"),iconExpanded:"folderOpen",isOpen:!0,icon:"folder",items:b},h={id:1,caption:i.instant("CalculationsListControl_NamedSets_TreeNode"),iconExpanded:"folderOpen",isOpen:!0,icon:"folder",items:v};r.datasource=[y,h];var S=[i.instant("ComboBoxItem_None"),"#","#,#","#,#.00","$#,#;-$#,#;","$#,#.00;-$#,#.00;","Standard","Short Date","Short Time","Percent","Sparkline"];function P(){r.dataCustomSetEditor={customCalculatedSetPropName:"",customCalculatedSetPropScript:""},r.dataCustomMemberEditor={customCalculatedMemberPropName:"",customCalculatedMemberPropExpression:"",customCalculatedMemberPropFormatString:i.instant("ComboBoxItem_None"),customCalculatedMemberPropBackgroundColor:angular.extend({},u),customCalculatedMemberPropForeground:angular.extend({},u),customCalculatedMemberPropNonEmptyBehaviors:[]}}r.formatStrings=S,P();var w=Ranet.Controls.CubeExplorer.getPlainData(a.treeMetadata.filter(function(e){return"measuresRootNode"===e.type}),"id"),T=[];for(var D in w)if(w.hasOwnProperty(D)){var x=w[D];if(""!==x.expression)continue;T.push(x)}var E={};function k(e){r.dataCustomMemberEditor.customCalculatedMemberPropName=e.caption,r.dataCustomMemberEditor.customCalculatedMemberPropExpression=e.expression,r.dataCustomMemberEditor.customCalculatedMemberPropFormatString=e.formatString?e.formatString:i.instant("ComboBoxItem_None"),function(e){if(null==e)r.dataCustomMemberEditor.customCalculatedMemberPropNonEmptyBehaviors.length=0;else{for(var t=[],n=0;n<T.length;n++)-1!==e.indexOf(T[n].uniqueName)&&t.push(T[n]);r.dataCustomMemberEditor.customCalculatedMemberPropNonEmptyBehaviors=t}}(e.nonEmptyBehaviors);var t={};e.backgroundColor?t.color="rgba("+e.backgroundColor.r+","+e.backgroundColor.g+","+e.backgroundColor.b+","+(e.backgroundColor.a/255).toFixed(1)+")":t=u,r.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color=t.color;var n={};e.foreground?n.color="rgba("+e.foreground.r+","+e.foreground.g+","+e.foreground.b+","+(e.foreground.a/255).toFixed(1)+")":n=u,r.dataCustomMemberEditor.customCalculatedMemberPropForeground.color=n.color}r.measureOptions={displayExpr:"caption",messages:{noDataMessage:i.instant("Lookup_NotFindElements"),placeholderMessage:i.instant("ComboBoxItem_None"),prefixMultiSelectionField:" "+i.instant("Lookup_PrefixSelectedItems")},dataSource:T,multiSelection:!0,onSelectionChanged:function(e){E.nonEmptyBehaviors=[];for(var t=0;t<e.selectedItems.length;t++){var n=e.selectedItems[t];E.nonEmptyBehaviors.push(n.uniqueName)}},itemTemplate:function(e){return"<div><div style='width:16px;display:inline-block;height:16px;' class='imageLibrary_"+e.icon+"'></div><div style='display: inline-block; margin-left:4px; vertical-align: top; overflow:hidden;'>"+e.caption+"</div></div>"},grouped:!1},r.onCustomCalculatedSetCaptionChanged=function(){for(var e,t=0;t<r.calculatedNamedSets.length;t++)r.calculatedNamedSets[t].name===E.caption&&(e=r.calculatedNamedSets[t]);C(r.dataCustomSetEditor.customCalculatedSetPropName,v)?E.caption=r.dataCustomSetEditor.customCalculatedSetPropName:r.dataCustomSetEditor.customCalculatedSetPropName=E.caption,e&&(e.name=E.caption)},r.onCustomCalculatedSetExpressionChanged=function(){E.expression=r.dataCustomSetEditor.customCalculatedSetPropScript},r.getBackgroundColorCustomMemberEditor=function(){return{background:r.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color}},r.getForegroundCustomMemberEditor=function(){return{background:r.dataCustomMemberEditor.customCalculatedMemberPropForeground.color}},r.onCustomCalculatedMemberCaptionChanged=function(){for(var e,t=0;t<r.calculatedMembers.length;t++)r.calculatedMembers[t].name===E.caption&&(e=r.calculatedMembers[t]);C(r.dataCustomMemberEditor.customCalculatedMemberPropName,b)?E.caption=r.dataCustomMemberEditor.customCalculatedMemberPropName:r.dataCustomMemberEditor.customCalculatedMemberPropName=E.caption,e&&(e.name=E.caption)},r.onCustomCalculatedMemberExpressionChanged=function(){E.expression=r.dataCustomMemberEditor.customCalculatedMemberPropExpression},r.customcalculatedmemberformatstringselected=function(e){e===i.instant("ComboBoxItem_None")?E.formatString="":E.formatString=e,r.dataCustomMemberEditor.customCalculatedMemberPropFormatString=e},r.$watch("dataCustomMemberEditor.customCalculatedMemberPropForeground.color",function(e){e||(e=u),E.foreground=Ranet.Utility.ColorHelper.argbToArgbObject(e),r.dataCustomMemberEditor.customCalculatedMemberPropForeground.caption="",r.dataCustomMemberEditor.customCalculatedMemberPropForeground.color=e}),r.$watch("dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color",function(e){e||(e=u),E.backgroundColor=Ranet.Utility.ColorHelper.argbToArgbObject(e),r.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.caption="",r.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color=e}),r.deleteSelectedItem=function(){l.showQuestion(i.instant("Warning"),i.instant("DeleteCurrent_Question"),function(){var e;if("customMember"===E.type){Ranet.UserActionsTracker.track("Delete custom member",{caption:E.caption});for(var t=0;t<r.calculatedMembers.length;t++)r.calculatedMembers[t].name===E.caption&&(e=r.calculatedMembers[t]);Ranet.Utility.ArrayUtility.removeItem(b,E),Ranet.Utility.ArrayUtility.removeItem(r.calculatedMembers,e),(E=y).isSelected=!0}else if("customSet"===E.type){Ranet.UserActionsTracker.track("Delete custom set",{caption:E.caption});for(var n=0;n<r.calculatedNamedSets.length;n++)r.calculatedNamedSets[n].name===E.caption&&(e=r.calculatedNamedSets[n]);Ranet.Utility.ArrayUtility.removeItem(v,E),Ranet.Utility.ArrayUtility.removeItem(r.calculatedNamedSets,e),(E=h).isSelected=!0}},function(){})},r.addNewCustomMember=function(){for(var e in Ranet.UserActionsTracker.track("Add new custom member"),b)b.hasOwnProperty(e)&&(b[e].isSelected=!1);for(var t in v)v.hasOwnProperty(t)&&(v[t].isSelected=!1);var n={id:Ranet.Utility.Guid.newGuid(),caption:f("Calculated Member",b),expression:"",icon:"customMeasure",type:"customMember",isSelected:!0};b.push(n),r.datasource[0].isSelected=!1,r.datasource[1].isSelected=!1,r.datasource[0].items=b,r.calculatedMembers.push({expression:"",forecolor:null,name:n.caption})},r.addNewCustomSet=function(){for(var e in Ranet.UserActionsTracker.track("Add new custom set"),b)b.hasOwnProperty(e)&&(b[e].isSelected=!1);for(var t in v)v.hasOwnProperty(t)&&(v[t].isSelected=!1);var n={id:Ranet.Utility.Guid.newGuid(),caption:f("Set",v),icon:"customNamedSet",expression:"",type:"customSet",isSelected:!0};v.push(n),r.datasource[0].isSelected=!1,r.datasource[1].isSelected=!1,r.datasource[1].items=v,r.calculatedNamedSets.push({expression:"",forecolor:null,name:n.caption})},r.getScriptForCustomMember=function(){if(!r.dataCustomMemberEditor.customCalculatedMemberPropExpression)return"";var e,t=r.dataCustomMemberEditor.customCalculatedMemberPropExpression;return r.dataCustomMemberEditor.customCalculatedMemberPropFormatString!==i.instant("ComboBoxItem_None")&&(t+=', FORMAT_STRING = "'+r.dataCustomMemberEditor.customCalculatedMemberPropFormatString+'"'),r.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color&&"rgba(255,255,255,0)"!==r.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color&&(t+=", BACK_COLOR = Rgb("+(e=Ranet.Utility.ColorHelper.argbToArgbObject(r.dataCustomMemberEditor.customCalculatedMemberPropBackgroundColor.color)).r+","+e.g+","+e.b+")"),r.dataCustomMemberEditor.customCalculatedMemberPropForeground.color&&"rgba(255,255,255,0)"!==r.dataCustomMemberEditor.customCalculatedMemberPropForeground.color&&(t+=", FORE_COLOR = Rgb("+(e=Ranet.Utility.ColorHelper.argbToArgbObject(r.dataCustomMemberEditor.customCalculatedMemberPropForeground.color)).r+","+e.g+","+e.b+")"),0<r.dataCustomMemberEditor.customCalculatedMemberPropNonEmptyBehaviors.length&&(t+=", NON_EMPTY_BEHAVIOR = {"+r.dataCustomMemberEditor.customCalculatedMemberPropNonEmptyBehaviors.map(function(e){return e.uniqueName}).join(", ")+"}"),t},r.deleteAll=function(){l.showQuestion(i.instant("Warning"),i.instant("DeleteAll_Question"),function(){v.length=0,b.length=0,r.calculatedNamedSets.length=0,r.calculatedMembers.length=0,(E=y).isSelected=!0},function(){})},r.onSelectedItemChanged=function(t){if("customSet"===t.data.type||"customMember"===t.data.type){if(r.showEditorCustomSetPanel=!1,r.showEditorCustomMemberPanel=!1,E.isSelected=!1,"customSet"===t.data.type&&(r.disableEditorCustomSetPanel=!1,r.showEditorCustomSetPanel=!0,E=v.filter(function(e){return e.id===t.data.id})[0],n=E,r.dataCustomSetEditor.customCalculatedSetPropName=n.caption,r.dataCustomSetEditor.customCalculatedSetPropScript=n.expression),"customMember"===t.data.type){r.disableEditorCustomMemberPanel=!1,r.showEditorCustomMemberPanel=!0;var e=b.filter(function(e){return e.id===t.data.id})[0];angular.equals(e,E)||k(E=e)}E.isSelected=!0,r.disableDeleteButton=!1}else r.disableEditorCustomSetPanel=!0,r.disableEditorCustomMemberPanel=!0,r.disableDeleteButton=!0,E.isSelected=!1,0===t.data.id?E=y:1===t.data.id&&(E=h),E.isSelected=!0,P();var n},r.cancel=function(){o.dismiss("cancel")},r.ok=function(){var n=[],t=[];b.forEach(function(e){var t={name:d(e.caption),expression:e.expression,formatString:e.formatString,nonEmptyBehaviors:e.nonEmptyBehaviors};e.backgroundColor&&(t.backColor={a:e.backgroundColor.a,r:e.backgroundColor.r,g:e.backgroundColor.g,b:e.backgroundColor.b}),e.foreground&&(t.foreColor={a:255*e.foreground.a,r:e.foreground.r,g:e.foreground.g,b:e.foreground.b}),n.push(t)}),v.forEach(function(e){t.push({name:d(e.caption),expression:e.expression})}),Ranet.UserActionsTracker.track("Update custom calculations",{countCustomMembers:n.length,countCustomSet:t.length}),o.close({customMembers:n,customSet:t})}}]),e.controller("showMdxQueryController",["$scope","$rootScope","$uibModalInstance","args",function(e,t,n,o){var r=o.updateScriptTemplate;e.vmUpdateScriptTemplate={useCustomUpdateScriptTemplate:o.useCustomUpdateScriptTemplate,updateScriptTemplate:r},e.initialQuery=o.initialQuery,e.vm={useQueryAsDataSource:o.useQueryAsDataSource,mdxQuery:o.query},e.ok=function(){n.close({query:e.vm.mdxQuery,useQueryAsDataSource:e.vm.useQueryAsDataSource,useCustomUpdateScriptTemplate:e.vmUpdateScriptTemplate.useCustomUpdateScriptTemplate,updateScriptTemplate:e.vmUpdateScriptTemplate.updateScriptTemplate})},e.cancel=function(){n.dismiss("cancel")}}]),e.controller("createNewReportController",["$scope","$rootScope","$uibModalInstance","connection","$translate",function(n,e,o,t,r){n.currentCaption="Report",n.connection=t,n.onCubeSelectedItemChanged=function(e){var t=e.name;n.currentCubeName=t},n.ok=function(){var e={};e.id=Ranet.Utility.Guid.newGuid(),e.content={},e.content.pages=[],e.caption=n.currentCaption;var t={};t.id=Ranet.Utility.Guid.newGuid(),t.cubeName=n.currentCubeName,t.caption=r.instant("Page")+" 1",e.content.pages.push(t),t.queryDesignerSetting={},t.queryDesignerSetting.hideEmptyColumns=!0,t.queryDesignerSetting.hideEmptyRows=!0,t.queryDesignerSetting.includeAllMembers=!1,t.queryDesignerSetting.includeCustomCalculationsInDrillDown=!1,t.queryDesignerSetting.subsetCount=0,t.queryDesignerSetting.useVisualTotals=!0,t.queryDesignerSetting.generateCustomCalculated=!1,o.close(e)},n.cancel=function(){o.dismiss("cancel")}}]),e.controller("openEntryController",["$scope","$translate","$rootScope","$uibModalInstance","args","$uibModal","appConfig",function(t,e,n,o,r,i,a){var s=r.storageProvider,c=r.filterKey;t.selectedItem=void 0,t.searchTreeViewOptions={isVisibleSearch:!0},n.$broadcast("onChangeStateLoadPanel",{visible:!0,message:e.instant("LoadPanel_GetReports")}),s.getDescriptionStorage(c).success(function(e){t.datasource=e,n.$broadcast("onChangeStateLoadPanel",{visible:!1})}).error(function(e){n.$broadcast("onChangeStateLoadPanel",{visible:!1}),Ranet.LogService.error(e),Ranet.UserMessageService.showError("Error loading reports. See log.")}),t.onSelectedItemChanged=function(e){t.selectedItem=e.data},t.ok=function(){o.close(t.selectedItem)},t.cancel=function(){o.dismiss("cancel")}}]),e.controller("loadReportFromPcController",["$scope","$translate","$rootScope","$uibModalInstance","args","$uibModal","appConfig","messageService",function(e,n,t,o,r,i,a,s){var c;e.lookupOptions={messages:{noDataMessage:n.instant("Lookup_NotFindElements"),placeholderMessage:n.instant("ComboBoxItem_None"),prefixMultiSelectionField:" "+n.instant("Lookup_PrefixSelectedItems")},iconExpr:"icon",iconExpandedExpr:"iconExpanded",expandedExpr:"isOpen",selectedExpr:"isSelected",dataSource:[],displayExpr:"caption",isVisibleSearchPanel:!1,onSelectionChanged:function(e){var t=e.selectedItems;0!==t.length&&(c=t[0])}};var l=function e(t){for(var n=[],o=0;o<t.length;o++){var r=t[o];"folder"===r.type&&(r.isOpen=!0,n.push(r),0<r.items.length&&(r.items=e(r.items)))}return n}(r.tree);e.treeFoldersLookupDataSource=l,e.selectedFolders=[l[0]],e.ok=function(){var e=document.getElementById("fileForUpload").files[0];if(e){var t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=function(e){var t=e.target.result;o.close({folder:c,fileContent:t})},t.onerror=function(e){alert("Some error.")}}else s.showInformation(n.instant("Warning"),n.instant("Warning_UserDidNotSelectedImportedFile"))},e.cancel=function(){o.dismiss("cancel")}}]),e.controller("editCurrentConnectionController",["$scope","$uibModalInstance","currentConnection","$uibModal","appConfig",function(n,e,t,o,r){n.currentConnection=t,n.isVisibleBadStatusPanel=!1,n.isVisibleGoodStatusPanel=!1,n.exceptionText="",n.onConnectionChecked=function(e){var t=e.data;1===t.status?n.isVisibleGoodStatusPanel=!0:0===t.status&&(n.isVisibleBadStatusPanel=!0,n.exceptionText=t.exception),Ranet.UserActionsTracker.track("Check connection",{status:1===t.status?"good":"bad",connection:n.currentConnection})},n.onStartChecking=function(){n.exceptionText="",n.isVisibleBadStatusPanel=!1,n.isVisibleGoodStatusPanel=!1},n.showError=function(e){var t=angular.element(".dynamicPivotGrid");o.open({appendTo:t,templateUrl:r.resourcePath+"templates/showException.html",controller:"showExceptionController",backdrop:"static",size:e,resolve:{exception:function(){return n.exceptionText}}})},n.ok=function(){e.close(n.currentConnection)},n.cancel=function(){e.dismiss("cancel")}}]),e.controller("editExtensionController",["$scope","$uibModalInstance","extensionSettings","layoutMode","$uibModal","appConfig","refetenceDynamicPivotGrid",function(r,t,n,o,i,a,e){n.chartOptions.legend.visible?r.currentLegendType=n.chartOptions.legend.position||0:r.currentLegendType=4,n.chartOptions.pie.legend.visible?r.currentPieLegendType=n.chartOptions.pie.legend.position||0:r.currentPieLegendType=4,r.activeTab=0,r.cellNumber=n.chartOptions.cellNumber||1e4,r.settingsMode="General",r.innerSettings="General",r.setInnerSettings=function(e){r.innerSettings=e},r.setSettingsMode=function(e){r.settingsMode=e,r.innerSettings="Chart"===e?"Series":"General"},r.shouldUseTable=function(){return 5===r.currentChartType&&r.autogenerateSeries||r.series.reduce(function(e,t){return 5===t.diagramType||e},!1)&&!r.autogenerateSeries},function(){var e=Ranet.Utility.ColorHelper.getColors();r.preconfiguredColors={};for(var t=0;t<e.length;t++){var n=e[t].caption.toLowerCase(),o=e[t].webARGB;r.preconfiguredColors[n]=o}}(),r.vectorMapSettings=n.vectorMapSettings,r.vectorMapSettings.mainColor=r.vectorMapSettings.mainColor?r.vectorMapSettings.mainColor:"#FFD9AD",r.labelTypes=["none","label","value","percentage","label-value1","label-value2","label-percentage1","label-percentage2","value-percentage1","value-percentage2"],r.labelNames={none:"LabelType_None",label:"LabelType_Label",value:"LabelType_Value",percentage:"LabelType_Percentage","label-value1":"LabelType_LabelValue1","label-value2":"LabelType_LabelValue2","label-percentage1":"LabelType_LabelPercentage1","label-percentage2":"LabelType_LabelPercentage2","value-percentage1":"LabelType_ValuePercentage1","value-percentage2":"LabelType_ValuePercentage2"},r.currentInnerLabelType=n.chartOptions.pie.labels.inner.format,r.changeInnerLabelType=function(e){r.currentInnerLabelType=e},r.currentOuterLabelType=n.chartOptions.pie.labels.outer.format,r.swapAxes=n.chartOptions.swapAxes||!1,r.changeOuterLabelType=function(e){r.currentOuterLabelType=e},r.chartTypes=["DiagramType_Line","DiagramType_Area","DiagramType_Bar","DiagramType_StackedArea","DiagramType_StackedBar","DiagramType_Pie"],r.currentChartType=n.chartOptions.defaultDiagramType,r.legendTypes=["ChartLegendPosition_Top","ChartLegendPosition_Bottom","ChartLegendPosition_Left","ChartLegendPosition_Right","ChartLegendPosition_None"],r.layoutModes=["DockExtension_ExtensionNo","DockExtension_ExtensionaboveGrid","DockExtension_ExtensionbelowGrid","DockExtension_ExtensiontorightofGrid","DockExtension_ExtensiontoleftofGrid","DockExtension_ExtensionOnly"],r.useMultipleCharts=n.chartOptions.useMultipleCharts||!1,r.multipleRows=n.chartOptions.multipleRows||1,r.multipleColumns=n.chartOptions.multipleColumns||1,r.currentArgumentVisibility=n.chartOptions.showArgumentLabels,r.currentTooltipVisibility=n.chartOptions.tooltip.enabled,r.autogenerateSeries=n.chartOptions.autogenerate,r.detalization=n.vectorMapSettings.mapOptions.detailedMapSettings.enable,r.series=n.chartOptions.seriesOptions,r.pieSeries=n.chartOptions.pie.pieSeries||[],r.selectedSeria=void 0,r.layout=o,r.displayedData=e.descriptionCurrentPage.view.currentDataSource,r.currentRow=e.descriptionCurrentPage.view.extensionSettings.vectorMapSettings.dataSettings.row,r.currentColumn=e.descriptionCurrentPage.view.extensionSettings.vectorMapSettings.dataSettings.col,r.rows=[],r.columns=[],r.displayLegend=!!n.chartOptions.pie.legend.visible,r.displayTooltips=!!n.chartOptions.pie.tooltips.enabled,r.palettes=[];var s=Ranet.Controls.Extensions.PaletteCollection.palettes;for(var c in s)s.hasOwnProperty(c)&&r.palettes.push({name:c,colors:s[c]});n.chartOptions.palette?r.currentPalette={name:n.chartOptions.palette,colors:s[n.chartOptions.palette]}:r.currentPalette=r.palettes[0],r.checkVectorMapCompatible=function(){return Ranet.Controls.Extensions.MapDataHelper.checkValidMapData(r.displayedData)},r.checkDisabled=function(e){Ranet.ClientInformation.isIE()&&!r.layout&&(r[e]=!r[e])},r.fixIsolateScope=function(e,t){r[e]=t},r.checkVectorMapCompatible()&&(r.rows=Ranet.Controls.Extensions.MapDataHelper.generateRowList(r.displayedData),r.columns=Ranet.Controls.Extensions.MapDataHelper.generateColumnList(r.displayedData)),-1===r.rows.indexOf(r.currentRow)&&(r.currentRow=r.rows[0]||"");var l=["Chart","VectorMap","Pie"];r.extensionType=l[n.extensionType||0],"Pie"===r.extensionType&&(r.extensionType="Chart",r.currentChartType=5,r.useMultipleCharts=!0),r.changeChartType=function(e){5===e?r.useMultipleCharts=!0:r.activeTab=0},r.setLegend=function(e){r.currentLegendType=e},r.setPieLegend=function(e){r.currentPieLegendType=e},r.setMultipleRows=function(e){r.multipleRows=e},r.setMultipleColumns=function(e){r.multipleColumns=e},r.changeRow=function(e){r.currentRow=e},r.changeColumn=function(e){r.currentColumn=e},r.addSeria=function(){var e=angular.element(".dynamicPivotGrid");i.open({appendTo:e,templateUrl:a.resourcePath+"templates/editSeria.html",controller:"editSeriaController",backdrop:"static",size:"sm",resolve:{seria:function(){return{}},editType:function(){return 1},additionalAxisSelected:function(){for(var e=0;e<r.series.length;e++)if(r.series[e].useAdditionalAxis)return!0;return!1}}}).result.then(function(e){r.series.push({columnIndex:parseInt(e.columnIndex),diagramType:parseInt(e.diagramType),useAdditionalAxis:e.useAdditionalAxis}),r.shouldUseTable()&&(r.useMultipleCharts=!0)},function(){})},r.deleteSeria=function(){r.series.splice(r.series.indexOf(r.selectedSeria),1)},r.editSeria=function(){var t=r.series.indexOf(r.selectedSeria),e=angular.element(".dynamicPivotGrid");i.open({appendTo:e,templateUrl:a.resourcePath+"templates/editSeria.html",controller:"editSeriaController",backdrop:"static",size:"sm",resolve:{seria:function(){return r.series[t]},editType:function(){return 0},additionalAxisSelected:function(){for(var e=0;e<r.series.length;e++)if(r.series[e].useAdditionalAxis)return!0;return!1}}}).result.then(function(e){r.series[t].columnIndex=parseInt(e.columnIndex),r.series[t].diagramType=parseInt(e.diagramType),r.series[t].useAdditionalAxis=e.useAdditionalAxis,r.shouldUseTable()&&(r.useMultipleCharts=!0)},function(){})},r.addPieSeria=function(){var e=angular.element(".dynamicPivotGrid");i.open({appendTo:e,templateUrl:a.resourcePath+"templates/editPieSeria.html",controller:"editPieSeriaController",backdrop:"static",size:"sm",resolve:{seria:function(){return{}},editType:function(){return 1}}}).result.then(function(e){r.pieSeries.push({index:parseInt(e.index),title:e.title})},function(){})},r.deletePieSeria=function(){r.pieSeries.splice(r.pieSeries.indexOf(r.selectedPieSeria),1)},r.editPieSeria=function(){var t=r.pieSeries.indexOf(r.selectedPieSeria),e=angular.element(".dynamicPivotGrid");i.open({appendTo:e,templateUrl:a.resourcePath+"templates/editPieSeria.html",controller:"editPieSeriaController",backdrop:"static",size:"sm",resolve:{seria:function(){return r.pieSeries[t]},editType:function(){return 0}}}).result.then(function(e){r.pieSeries[t].index=parseInt(e.index),r.pieSeries[t].title=e.title},function(){})},r.setPalette=function(e){r.currentPalette=e},r.selectSeria=function(e){r.selectedSeria=e},r.selectPieSeria=function(e){r.selectedPieSeria=e},r.seriesContainsPie=function(){return!!(!r.autogenerateSeries&&r.series.find(function(e){return 5===e.diagramType})||r.autogenerateSeries&&5===r.currentChartType)},r.seriesContainsChart=function(){return!!(!r.autogenerateSeries&&r.series.find(function(e){return 5!==e.diagramType})||r.autogenerateSeries&&5!==r.currentChartType)},r.editSeriaSettings=function(){var t=r.series.indexOf(r.selectedSeria),e=angular.element(".dynamicPivotGrid");i.open({appendTo:e,templateUrl:a.resourcePath+"templates/editSeriaSettings.html",controller:"editSeriaSettingsController",backdrop:"static",size:"md",resolve:{seria:function(){return r.series[t]}}}).result.then(function(e){r.series[t].options=e.options},function(){})},r.ok=function(){n.chartOptions.legend.position=4!==r.currentLegendType?r.currentLegendType:0,n.chartOptions.extensionType=l.indexOf(r.extensionType),n.chartOptions.showArgumentLabels=r.currentArgumentVisibility,n.chartOptions.tooltip.enabled=r.currentTooltipVisibility,n.chartOptions.autogenerate=r.autogenerateSeries,n.chartOptions.legend.visible=4!==r.currentLegendType,n.chartOptions.seriesOptions=r.series,n.chartOptions.useMultipleCharts=r.useMultipleCharts,n.chartOptions.defaultDiagramType=r.currentChartType,n.chartOptions.palette=r.currentPalette.name,n.chartOptions.multipleRows=r.multipleRows,n.chartOptions.multipleColumns=r.multipleColumns,n.chartOptions.cellNumber=r.cellNumber,n.chartOptions.swapAxes=r.swapAxes,n.chartOptions.pie.labels.inner.format=r.currentInnerLabelType,n.chartOptions.pie.labels.outer.format=r.currentOuterLabelType,n.chartOptions.pie.pieSeries=r.pieSeries,n.chartOptions.pie.legend.visible=4!==r.currentPieLegendType,n.chartOptions.pie.legend.position=r.currentPieLegendType,n.chartOptions.pie.tooltips.enabled=r.displayTooltips,o=r.layout;var e={extensionSettings:{}};e.extensionSettings.chartOptions=$.extend(!0,{},n.chartOptions),e.extensionSettings.extensionType=l.indexOf(r.extensionType),e.extensionSettings.vectorMapSettings=r.vectorMapSettings,e.extensionSettings.vectorMapSettings.dataSettings={col:r.currentColumn,row:r.currentRow},e.extensionSettings.vectorMapSettings.mapOptions.detailedMapSettings.enable=r.detalization,e.layoutMode=o,t.close(e)},r.cancel=function(){t.dismiss("cancel")}}]),e.controller("editSeriaController",["$scope","$uibModalInstance","seria","editType","additionalAxisSelected",function(t,e,n,o,r){t.chartTypes=["DiagramType_Line","DiagramType_Area","DiagramType_Bar","DiagramType_StackedArea","DiagramType_StackedBar","DiagramType_Pie"],t.disableAdditionalAxis=!1,1===o?(t.currentChartType=0,t.columnIndex=0,t.useAdditionalAxis=!1,r&&(t.disableAdditionalAxis=!0)):0===o&&(t.currentChartType=n.diagramType,t.columnIndex=n.columnIndex,t.useAdditionalAxis=n.useAdditionalAxis,r&&!t.useAdditionalAxis&&(t.disableAdditionalAxis=!0)),t.setChartType=function(e){5===e&&(t.useAdditionalAxis=!1),t.currentChartType=e},t.ok=function(){e.close({diagramType:t.currentChartType,columnIndex:t.columnIndex,useAdditionalAxis:t.useAdditionalAxis})},t.cancel=function(){e.dismiss("cancel")}}]),e.controller("showExceptionController",["$scope","$rootScope","$uibModalInstance","exception",function(e,t,n,o){e.exception=o,e.cancel=function(){n.dismiss("cancel")}}]),e.controller("editQueryDesignerSettingsController",["$scope","$uibModalInstance","queryDesignerSetting","loadStateFromHistory",function(e,t,n,o){e.hideEmptyColumns=n.hideEmptyColumns,e.hideEmptyRows=n.hideEmptyRows,e.subsetCount=n.subsetCount,e.useVisualTotals=n.useVisualTotals,e.generateCustomCalculated=n.generateCustomCalculated,e.includeAllMembers=n.includeAllMembers,e.includeCustomCalculationsInDrillDown=n.includeCustomCalculationsInDrillDown,e.loadStateFromHistory=o,e.ok=function(){t.close({setting:{hideEmptyColumns:e.hideEmptyColumns,hideEmptyRows:e.hideEmptyRows,subsetCount:e.subsetCount,useVisualTotals:e.useVisualTotals,generateCustomCalculated:e.generateCustomCalculated,includeAllMembers:e.includeAllMembers,includeCustomCalculationsInDrillDown:e.includeCustomCalculationsInDrillDown},loadStateFromHistory:e.loadStateFromHistory})},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("exportToUrlController",["$scope","$translate","$uibModalInstance","args",function(e,t,n,o){var r="?ranetreportid="+o.reportId+"&ranetispublic="+o.isPublic;void 0===o.isPublic?e.reportUrl=t.instant("UrlViewer_Warning_NewReport"):-1===window.location.href.indexOf("ranetreportid")?e.reportUrl=window.location.href+r:e.reportUrl=window.location.protocol+"//"+window.location.host+window.location.pathname+r,e.cancel=function(){n.dismiss("cancel")}}]),e.controller("editSeriaSettingsController",["$scope","$uibModalInstance","seria",function(t,e,n){null!==n.options&&void 0!==n.options||(n.options={}),t.seria=$.extend(!0,{},n),t.legendPosition=t.seria.options.legend&&t.seria.options.legend.position||1,t.useTooltips=void 0!==t.seria.options.tooltip&&t.seria.options.tooltip.enabled||!1,t.showArgumentLabels=t.seria.options.showArgumentLabels||!1,t.displayInnerLabels=void 0!==t.seria.options.labels&&(void 0!==t.seria.options.labels.inner&&"value"===t.seria.options.labels.inner.format),t.displayOuterLabels=void 0===t.seria.options.labels||(void 0===t.seria.options.labels.outer||"label"===t.seria.options.labels.outer.format),t.displayTooltips=void 0===t.seria.options.tooltips||(t.seria.options.tooltips.enabled||!1),t.pieLegendPosition=void 0!==t.seria.options.legend?t.seria.options.legend.visible||0:4,t.setLegend=function(e){t.legendPosition=e},t.setPieLegend=function(e){t.pieLegendPosition=e},t.legendTypes=["ChartLegendPosition_Top","ChartLegendPosition_Bottom","ChartLegendPosition_Left","ChartLegendPosition_Right","ChartLegendPosition_None"],t.ok=function(){5!==n.diagramType?e.close({options:{legend:{visible:4!==t.legendPosition,position:t.legendPosition},tooltip:{enabled:t.useTooltips},showArgumentLabels:t.showArgumentLabels}}):e.close({options:{legend:{visible:4!==t.pieLegendPosition,position:t.pieLegendPosition},tooltips:{enabled:t.displayTooltips},labels:{inner:{format:t.displayInnerLabels?"value":"none"},outer:{format:t.displayOuterLabels?"label":"none"}}}})},t.cancel=function(){e.dismiss("cancel")},t.restoreDefaults=function(){e.close({options:{}})}}])}(),function(){var e=angular.module("sampleDynamicPivotGrid.directives",[]);e.directive("treeView",[function(){return{restrict:"A",link:function(t,n,e){var o,r={keyExpr:"id",displayExpr:"caption",iconExpandedExpr:"iconExpanded",iconExpr:"icon",selectedExpr:"isSelected",expandedExpr:"isOpen",onItemSelected:function(e){t.$evalAsync(function(){t.onselecteditemchanged({e:e})})}};t.$watch("datasource",function(){var e=t.datasource;void 0===o?(r.dataSource=e,o=new Ranet.Controls.TreeView(n,r)):o.dataSource=e},!0)},scope:{onselecteditemchanged:"&onselectedchanged",datasource:"="}}}]),e.directive("loadPanel",function(){return{restrict:"A",link:function(e,t,n){var o={message:"Loading...",visible:!1,position:{of:window}},r=new Ranet.Controls.LoadPanel(t,o);n.$observe("message",function(e){r.message=e}),n.$observe("visible",function(e){var t="true"===e;r.visible=t})}}}),e.directive("cubeChoiceControl",["$parse",function(i){return{restrict:"A",link:function(t,e,n){var o=i(n.oncubeselectedchanged),r=new Ranet.Controls.CubeChoiceControl(e);r.selectionCubeChanged.on(function(e){t.$evalAsync(function(){o(t,{e:e})})}),n.$observe("cubeName",function(e){console.log(e),r.setCube(e)}),n.$observe("connection",function(e){r.connection=e,r.refrehCubes()})}}}]),e.directive("dragAndDropTreeMetadataToText",function(){return{restrict:"A",require:"?ngModel",scope:{deletePrevValue:"="},link:function(s,t,e,c){e.$observe("disableDragAndDrop",function(e){"true"===e?$(t).droppable("disable"):$(t).droppable("enable")}),$(t).droppable({drop:function(e,t){var n=jQuery.data(t.draggable.get(0),"data"),o="";if("namedSet"===n.type)o="["+n.name+"]";else if("customNamedSet"===n.type||"calculatedMember"===n.type||"calculatedNamedSet"===n.type)o=n.name;else if("measure"===n.type)o=n.uniqueName;else if("level"===n.type)o=n.filter?function e(t){return 0===t[0].childNodes.length&&t[0].selectedSelf?t[0]:e(t[0].childNodes)}(n.filter.membersFilter.selectionNodes).uniqueName:n.uniqueName;else if("dimension"===n.type||"hierarchy"===n.type)o=n.uniqueName;else if("kpiInfo"===n.type)for(var r=0;r<n.items.length;r++){var i=n.items[r];"goal"===i.kpiType&&(o+='KPIGoal("'+n.name+'")'),"value"===i.kpiType&&(o+='KPIValue("'+n.name+'")'),"trend"===i.kpiType&&(o+='KPITrend("'+n.name+'")'),"status"===i.kpiType&&(o+='KPIStatus("'+n.name+'")'),r+1!==n.items.length&&(o+=", ")}else"kpiItem"===n.type&&("goal"===n.kpiType&&(o='KPIGoal("'+n.parentName+'")'),"value"===n.kpiType&&(o='KPIValue("'+n.parentName+'")'),"trend"===n.kpiType&&(o='KPITrend("'+n.parentName+'")'),"status"===n.kpiType&&(o='KPIStatus("'+n.parentName+'")'));var a=c.$modelValue;a&&(a+=" "),s.deletePrevValue&&(a=""),c.$setViewValue(a+o),c.$commitViewValue(),c.$render()},scope:"textBox",hoverClass:"customCalculationsEditor-textEditor-border_orange"})}}}),e.directive("cubeExplorer",function(){return{restrict:"A",scope:{cubeMetaData:"=",cubeName:"=",connection:"=",calculatedMembers:"=",calculatedNamedSets:"="},link:function(e,t){var n=new Ranet.Controls.CubeExplorer(t,{keyExpr:"id",connection:e.connection,cubeName:e.cubeName,selectedMeasureGroupName:null,draggableOptions:{appendTo:".modal-body",scope:"textBox",$dragContainer:$(".dynamicPivotGrid")}});e.$watch("cubeMetaData",function(e){void 0!==e&&(n.dataSource=e)},!1),e.$watch("calculatedMembers",function(e){void 0!==e&&(n.currentCalculatedMembers=e)},!0),e.$watch("calculatedNamedSets",function(e){void 0!==e&&(n.currentCalculatedNamedSets=e)},!0)}}}),e.directive("checkconnectionbutton",["$parse","$translate","connectionService",function(l,u,d){return{restrict:"E",replace:!0,template:'<button class="btn btn-default"></button>',link:function(t,n,e){var o=l(e.onconnectionchecked),r=l(e.onstartchecking),i=u.instant("ButtonCheckConnection"),a=u.instant("ButtonCheckingConnection"),s="",c=angular.element("<span>"+i+"</span>");n.append(c),n.click(function(){n.hasClass("disabled")||(r&&r(t),n.empty(),n.addClass("disabled"),n.append('<i class="fa fa-spinner fa-pulse"></i>'),n.append("<span style='margin-left:3px;'>"+a+"</span>"),d.checkConnection(s).then(function(e){n.removeClass("disabled"),n.empty(),n.append(c),o(t,{e:e})}))}),e.$observe("connection",function(e){s=e})}}}]),e.directive("uibModalWindow",function(){return{restrict:"EA",link:function(e,t){t.draggable({handle:".modal-header"})}}}),e.directive("ranetdynamicpivotgridapp",["appConfig",function(e){return{restrict:"E",replace:!0,controller:"sampleDynamicPivotGridController",templateUrl:e.resourcePath+"templates/appDynamicPivotGrid2.html"}}]),e.directive("cnpdynamicpivotgridapp",["appConfig",function(e){return{restrict:"E",replace:!0,controller:"sampleDynamicPivotGridController",templateUrl:e.resourcePath+"templates/cnpDynamicPivotGrid.html"}}]),e.directive("ranetSearchTreeView",[function(){return{restrict:"EA",scope:{datasource:"=",searchtreeoptions:"=",onSelectedItemChanged:"&onselectedchanged",control:"="},link:function(t,e){var n={keyExpr:"id",displayExpr:"caption",iconExpandedExpr:"iconExpanded",iconExpr:"icon",selectedExpr:"isSelected",expandedExpr:"isOpen",onItemSelected:function(e){console.warn("No onItenSelected function has been specified in SearchTreeView directive")},dataSource:[],isVisibleSearch:!0},o=t.searchtreeoptions,r=$.extend({},n,o);r.dataSource=t.datasource,r.onItemSelected=function(e){void 0!==t.onSelectedItemChanged&&t.$evalAsync(function(){t.onSelectedItemChanged({e:{data:e[0]}})})};var i=new Ranet.Controls.SearchTreeView.SearchTreeViewContent(e,r);i.init(),t.control&&(t.control.repaintTreeView=function(){i.repaint()}),t.$watch("datasource",function(){i.dataSource=t.datasource})}}}]),e.directive("ranetListLookup",[function(){return{link:function(t,e,n){var o=e.closest(".modal");0===o.length&&(o=e.closest(".dynamicPivotGrid")),0===o.length&&(o=e.closest("body"));var r=t.lookupOptions,i=new Ranet.Controls.Lookup.ListLookupControlOptions;i.displayExpr=r.displayExpr,i.messages=r.messages,i.dataSource=r.dataSource,i.multiSelection=r.multiSelection,i.grouped=r.grouped,i.getPopupContainer=function(){return o},i.onSelectionChanged=function(e){void 0!==r.onSelectionChanged&&t.$evalAsync(function(){r.onSelectionChanged(e)})},i.getItemTemplate=r.itemTemplate;var a=new Ranet.Controls.Lookup.LookupControl(e,i);a.init(),t.$watch("lookupDataSource",function(e){void 0!==e&&(a.dataSource=e)}),t.$watch("lookupSelectedItems",function(e){void 0!==e&&(a.selectedItems=e)},!0)},scope:{lookupOptions:"=",lookupSelectedItems:"=",lookupDataSource:"="}}}]),e.directive("ranetTreeLookup",[function(){return{link:function(t,e,n){var o=e.closest(".modal");0===o.length&&(o=e.closest(".dynamicPivotGrid")),0===o.length&&(o=e.closest("body"));var r=t.lookupOptions,i=new Ranet.Controls.Lookup.TreeLookupControlOptions;i.displayExpr=r.displayExpr,i.messages=r.messages,i.dataSource=r.dataSource,i.isVisibleSearchPanel=!1,i.iconExpr=r.iconExpr,i.iconExpandedExpr=r.iconExpandedExpr,i.expandedExpr=r.expandedExpr,i.selectedExpr=r.selectedExpr,i.getPopupContainer=function(){return o},i.onSelectionChanged=function(e){void 0!==r.onSelectionChanged&&t.$evalAsync(function(){r.onSelectionChanged(e)})};var a=new Ranet.Controls.Lookup.LookupControl(e,i);a.init(),t.$watch("lookupDataSource",function(e){void 0!==e&&(a.dataSource=e)}),t.$watch("lookupSelectedItems",function(e){void 0!==e&&(a.selectedItems=e)})},scope:{lookupOptions:"=",lookupSelectedItems:"=",lookupDataSource:"="}}}]),e.directive("ranetMultiChartTable",function(){return{restrict:"E",replace:!0,template:"<div></div>",link:function(r,e,t){for(var i=0,a=0,n=function(){for(var e=1;e<=r.rowLength;e++)for(var t=1;t<=r.colLength;t++)angular.element("[data-multicharttable-colid="+t+"][data-multicharttable-rowid="+e+"]").addClass("active");for(var n=1;n<=a;n++)for(var o=1;o<=i;o++)angular.element("[data-multicharttable-colid="+n+"][data-multicharttable-rowid="+o+"]").addClass("hovered")},o=1;o<=r.maxRowNumber;o++){for(var s=angular.element("<div/>").addClass("ranetMultiChartTable-row"),c=1;c<=r.maxColNumber;c++){var l=angular.element("<div/>").addClass("ranetMultiChartTable-col").attr("data-multicharttable-colid",c).attr("data-multicharttable-rowid",o);!function(e,t,n,o){l.on("click",function(){r.$apply(function(){r.colLength=t,r.rowLength=e,angular.element(".ranetMultiChartTable-col.active").removeClass("active"),o()})})}(o,c,0,n),function(e,t,n,o){l.on("mouseenter",function(){r.$apply(function(){a=t,i=e,angular.element(".ranetMultiChartTable-col.hovered").removeClass("hovered"),o()})})}(o,c,0,n),e.on("mouseleave",function(){angular.element(".ranetMultiChartTable-col.hovered").removeClass("hovered")}),s.append(l),s.append(angular.element("<br/>"))}e.append(s),e.addClass("ranetMultiChartTable"),n()}},scope:{maxColNumber:"=",maxRowNumber:"=",colLength:"=",rowLength:"="}}}),e.directive("colorpicker",function(){return{restrict:"A",replace:!0,template:'<div class="input-group colorpicker-component"><input type="text" class="form-control" /><span class="input-group-addon"><i></i></span></div>',link:function(t,n,e){$(n).colorpicker({container:$(n),color:t.refobject[t.prop],colorSelectors:t.preconfiguredColors,format:"alias",fallbackFormat:"rgba",customClass:"colorpicker-2x",sliders:{saturation:{maxLeft:200,maxTop:200},hue:{maxTop:200},alpha:{maxTop:200}}}).on("hidePicker",function(e){t.$applyAsync(function(){t.refobject[t.prop]=e.color.toString("rgba")}),$(n).colorpicker("setValue",e.color.toString("rgba"))}),t.$watch("refobject",function(e){$(n).colorpicker("setValue",e[t.prop])},!0)},scope:{refobject:"=",prop:"@prop",preconfiguredColors:"="}}})}(),function(){var e=angular.module("sampleDynamicPivotGrid.factories",[]);e.factory("reportsStorageProvider",["$http","$translate","appConfig",function(n,t,o){var e={};return e.getDescriptionStorage=function(e){return n.post(o.applicationUrl+"api/reportsStorage/getReports",{filterKey:e}).success(function(e){e.forEach(function(e){e.isPublic?e.caption=t.instant("Storage_Global"):e.caption=t.instant("Storage_User")})})},e.getReport=function(e,t){return n.post(o.applicationUrl+"api/reportsStorage/getReport",e)},e.deleteEntry=function(e){return n.post(o.applicationUrl+"api/reportsStorage/deleteReport",e)},e.deleteFolder=function(e){return n.post(o.applicationUrl+"api/reportsStorage/deleteFolder",e)},e.saveEntry=function(e){return n.post(o.applicationUrl+"api/reportsStorage/saveReport",e)},e.saveFolder=function(e){return n.post(o.applicationUrl+"api/reportsStorage/saveFolder",e)},e.convertReportToXmlFile=function(e){return n.post(o.applicationUrl+"api/reportsStorage/convertReportToXmlFile",e)},e.convertXmlFileToReport=function(e,t){return n.post(o.applicationUrl+"api/reportsStorage/convertXmlFileToReport",{content:e,folder:t})},e}]),e.factory("pagesStorageProvider",["$http","$translate","appConfig",function(n,t,o){var e={};return e.getDescriptionStorage=function(e){return n.post(o.applicationUrl+"api/pagesStorage/getPages",{filterKey:e}).success(function(e){e.forEach(function(e){e.isPublic?e.caption=t.instant("Storage_Global"):e.caption=t.instant("Storage_User")})})},e.getEntry=function(e){return n.post(o.applicationUrl+"api/pagesStorage/getPage",e)},e.deleteEntry=function(e){return n.post(o.applicationUrl+"api/pagesStorage/deletePage",e)},e.deleteFolder=function(e){return n.post(o.applicationUrl+"api/pagesStorage/deleteFolder",e)},e.saveEntry=function(e){return n.post(o.applicationUrl+"api/pagesStorage/savePage",e)},e.saveFolder=function(e){return n.post(o.applicationUrl+"api/pagesStorage/saveFolder",e)},e.convertReportToXmlFile=function(e){return n.post(o.applicationUrl+"api/pagesStorage/convertPageOfReportToXmlFile",e)},e.convertXmlFileToReport=function(e,t){return n.post(o.applicationUrl+"api/pagesStorage/convertXmlFileToPageOfReport",{content:e,folder:t})},e}]),e.factory("connectionService",["$http","appConfig",function(t,n){var e={checkConnection:function(e){return t.post(n.applicationUrl+"api/olap/checkConnection",{connection:e})}};return e}]),e.factory("exportService",["$http","appConfig",function(i,a){var e={toExcel:function(e,t,n,o,r){return i.post(a.applicationUrl+"api/export/excel",{captionPage:e,descriptionActiveFilters:t,cellSetData:n,headerText:o,footerText:r})},toXml:function(e,t,n,o,r){return i.post(a.applicationUrl+"api/export/xml",{captionPage:e,descriptionActiveFilters:t,cellSetData:n,headerText:o,footerText:r})}};return e}]),e.factory("messageService",["$uibModal","$translate","appConfig",function(l,e,u){var o,r,i,a;e("DialogButton_Ok").then(function(e){o=e}),e("DialogButton_Cancel").then(function(e){r=e}),e("DialogButton_Yes").then(function(e){i=e}),e("DialogButton_No").then(function(e){a=e});var t={},s=function(e,t,n,o,r,i,a,s){var c=angular.element(document.getElementsByClassName("dynamicPivotGrid"));l.open({appendTo:c,templateUrl:u.resourcePath+"templates/message.html",controller:"messageServiceController",backdrop:"static",size:"sm",windowClass:"app-modalWindow_center",resolve:{args:function(){return{message:t,caption:e,isVisibleOkButton:n,isVisibleCancelButton:o,contentOkButton:r,contentCancelButton:i}}}}).result.then(function(){a&&a()},function(){s&&s()})};return t.showInformation=function(e,t,n){void 0===n&&(n=o),s(e,t,!0,!1,n,r,null,null)},t.showQuestion=function(e,t,n,o){s(e,t,!0,!0,i,a,n,o)},t}]),e.factory("customLocalizationLoader",["$http","$q","appConfig","$rootScope",function(e,n,o,t){return function(e){var t=n.defer();return Ranet.Localization.init(o.applicationUrl,o.resourcePath,e.key,e.fallbackLanguage,e.replaced).done(function(e){t.resolve(e.messages)}).fail(function(e){t.reject(e)}),t.promise}}]),e.factory("ranetAngularInstance",["$rootScope","actionManager",function(n,e){var t={},o=!0;t.config=function(e){e.hasOwnProperty("connection")&&n.$broadcast("changeConnectionApiEvent",{connection:e.connection}),e.hasOwnProperty("toolbar")&&n.$broadcast("changeToolBarOptionsApiEvent",{buttons:e.toolbar}),e.hasOwnProperty("onPageImporting")&&n.$broadcast("changeOnPageImportingApiEvent",{onPageImporting:e.onPageImporting}),e.hasOwnProperty("onGetFilterKey")&&n.$broadcast("changeOnGetFilterKeyApiEvent",{onGetFilterKey:e.onGetFilterKey})},t.setSelectedPage=function(e){n.$broadcast("setSelectedPageApiEvent",{idPage:e})},t.addNewPage=function(e){e.layout.filters||(e.layout.filters=[]),o?(n.$broadcast("openNewReportApiEvent",{content:{pages:[e]}}),o=!1):n.$broadcast("addNewPageApiEvent",{page:e})},t.deletePage=function(e,t){n.$broadcast("deletePageApiEvent",{id:e,deleteCallback:t})};var r=null,i=null;return t.setPivotGridRef=function(e){i=e},t.onReportChanged=function(e){r=e},t.getCurrentReport=function(){try{r.content=jQuery.extend({},i.report)}catch(e){}return r},t.loadReport=function(e){n.$broadcast("loadReport",{report:e})},t.actionManager=e,t}]),e.factory("actionManager",["$rootScope","$timeout",function(n,o){var e={},r={},i={};return e.addAction=function(e,t){if(void 0!==i[e])throw new Error("Such listener allready exist");i[e]=t},e.callAction=function(e,t){if(void 0===i[e])throw new Error("Such listener does not exist");o(function(){n.$apply(function(){i[e].call(r,t)})})},e.removeAction=function(e){if(void 0===i[e])throw new Error("Such listener does not exist");i[e]=void 0},e.registerActions=function(e){if(void 0===e)throw new Error("Argument can not be undefined");if(typeof e==typeof{})for(var t in e)if(e.hasOwnProperty(t)){if(void 0!==r[t])throw"Action '"+t+"' is allready registered";r[t]=e[t]}},e.clearActions=function(){i={},r={}},e.clearListeners=function(){i={}},e}])}(),angular.module("sampleDynamicPivotGrid.config",[]).constant("appConfig",{applicationUrl:window.applicationUrlSpa||"",resourcePath:window.resoursePathSpa||"assets/",defaultConnection:"Provider=MSOLAP.4; Data Source=https://bi.galaktika-soft.com/olap/2012/msmdpump.dll; Catalog=AdventureWorksDW2012 MD-EE;",placementLayoutModeQueryDesigner:0,defaultCountLoadedMembers:100,showTopToolbar:void 0===window.showTopToolbar||window.showTopToolbar,showBottomToolbar:void 0===window.showBottomToolbar||window.showBottomToolbar,showQueryDesignerToolbar:void 0===window.showQueryDesignerToolbar||window.showQueryDesignerToolbar,showExtensionPanel:void 0===window.showExtensionPanel||window.showExtensionPanel,autoExecuteMdxQuery:!0,isVisibleActiveFilters:!1,preferLanguage:window.preferLanguage||localStorage.getItem("ranet-sampleDynamicPivotGrid-preferLanguage")||null,fallbackLanguage:window.fallbackLanguage||localStorage.getItem("ranet-sampleDynamicPivotGrid-fallbackLanguage")||"en"}),angular.module("sampleDynamicPivotGrid",["ranet","ui.bootstrap","ngSanitize","sampleDynamicPivotGrid.config","sampleDynamicPivotGrid.factories","sampleDynamicPivotGrid.directives","pascalprecht.translate","sampleDynamicPivotGrid.controllers","sampleDynamicPivotGrid.filters"]).config(["$translateProvider","appConfig","$locationProvider",function(e,t){var n,o,r,i;e.useSanitizeValueStrategy(null),n=t.preferLanguage,i=!1,n?o=n:(-1!==(r=(r=window.navigator.languages?window.navigator.languages[0]:null)||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage).indexOf("-")&&(r=r.split("-")[0]),-1!==r.indexOf("_")&&(r=r.split("_")[0]),console.log(r),o=r),Ranet.Localization.availableLocalizations.indexOf(o)<0&&(console.log("replaced on client"),o=t.fallbackLanguage,i=!0),e.useLoader("customLocalizationLoader",{replaced:i,fallbackLanguage:t.fallbackLanguage}),e.preferredLanguage(o)}]),angular.module("sampleDynamicPivotGrid.filters",[]).filter("splitWords",function(){return function(e){return e.split(" ").reduce(function(e,t){return""===e?t:e+"<br/>"+t},"")}});