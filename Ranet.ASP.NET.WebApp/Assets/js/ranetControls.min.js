var a,test,Ranet,__extends=this&&this.__extends||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(s){var r;(function(F){Math.radians=function(e){return e*Math.PI/180},Math.degrees=function(e){return 180*e/Math.PI};var e=function(){function e(e,t){var i=this;this._stackedBarCount=0,this._prevStackedCoords=[],this._parsedCoords=[],this._maxBarWidth=F.ChartConf.maxBarWidth,this._htmlelement=e,this._element=d3.select(this._htmlelement);var n=this._element.node();if(this._fieldHeight=n.getBoundingClientRect().height,this._fieldWidth=n.getBoundingClientRect().width,this._content=this._element.append("svg"),this._loadPanel=new r.LoadPanel(this._htmlelement,{message:"Loading...",visible:!1,position:{of:window}}),this._element.on("mouseenter",function(){i.showExportButtons()}).on("mouseleave",function(){i.hideExportButtons()}),this._legendSize={width:0,height:0},this._element.append("xhtml:div").attr("class","popOvers"),this._element.attr("id")||this._element.attr("id","ranetChart-"+F.Chart.ChartDataHelper.createGuid()),this._countedStyles={paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0},this._options=t,this._additionalAxisType=F.DataType.Number,this._options.styling||(this._options.styling={paddingLeft:0,paddingRight:0,paddingTop:10,paddingBottom:25}),this._initialStyling=$.extend({},this._options.styling),this._options.tooltip||(this._options.tooltip={enabled:!0,customizeTooltip:function(){return"<strong>"+this.point.name.toString()+" "+this.point.displayValue+"</strong>"}}),!this._options.tooltip.customizeTooltip){var o=this;this._options.tooltip.customizeTooltip=function(){return o._argumentsHidden||!1===o._options.showArgumentLabels?"<span><font color="+this.point.color+">&#9632;</font> "+this.point.name.toString()+", "+this.point.argument.toString()+", "+this.point.displayValue+"</span>":"<span><font color="+this.point.color+">&#9632;</font> "+this.point.name.toString()+" "+this.point.displayValue+"</span>"}}this._options.legend||(this._options.legend={visible:!1}),this._options.legend.onmouseenterevent=function(e){var t=new CustomEvent("mouseEnterChartLegend",{detail:{name:e.name},bubbles:!0,cancelable:!1}),i=document.querySelectorAll(".line");if(i[0])for(var n=0;n<i.length;n++)i[n].dispatchEvent(t);var o=document.querySelectorAll(".area");if(o[0])for(n=0;n<o.length;n++)o[n].dispatchEvent(t);var r=document.querySelectorAll(".stackedArea");if(r[0])for(n=0;n<r.length;n++)r[n].dispatchEvent(t);var a=document.querySelectorAll(".bar");if(a[0])for(n=0;n<a.length;n++)a[n].dispatchEvent(t);var s=document.querySelectorAll(".stackedBar");if(s[0])for(n=0;n<s.length;n++)s[n].dispatchEvent(t)},this._options.legend.onmouseleaveevent=function(e){var t=new CustomEvent("mouseLeaveChartLegend",{detail:{name:e.name},bubbles:!0,cancelable:!1}),i=document.querySelectorAll(".line");if(i[0])for(var n=0;n<i.length;n++)i[n].dispatchEvent(t);var o=document.querySelectorAll(".area");if(o[0])for(n=0;n<o.length;n++)o[n].dispatchEvent(t);var r=document.querySelectorAll(".stackedArea");if(r[0])for(n=0;n<r.length;n++)r[n].dispatchEvent(t);var a=document.querySelectorAll(".bar");if(a[0])for(n=0;n<a.length;n++)a[n].dispatchEvent(t);var s=document.querySelectorAll(".stackedBar");if(s[0])for(n=0;n<s.length;n++)s[n].dispatchEvent(t)},this._options.legend.onclickevent=function(e,t){i._options.seriesOptions[t].hidden=!i._options.seriesOptions[t].hidden,i._notParsed=!0,i._parsedData[t].forEach(function(e){!1===e.visible?e.visible=!0:e.visible=!1}),i.redraw()},this._options.legend.visible&&(void 0===this._options.legend.position&&(this._options.legend.position=F.LegendPosition.Bottom),this._options.legend.position===F.LegendPosition.Top||this._options.legend.position===F.LegendPosition.Left?this._element.insert("xhtml:div","svg").attr("class","legend"):this._element.insert("xhtml:div",".popOvers").attr("class","legend"),this._options.legend.position!==F.LegendPosition.Top&&this._options.legend.position!==F.LegendPosition.Bottom||(this._fieldHeight-=F.ChartConf.legendHeight)),this._color=d3.scale.category10(),this._barCount=0,this._hiddenBarCount=0,this._stacked=!1,this._notParsed=!0,this._yScale=d3.scale.linear(),this._additionalScale=d3.scale.linear(),this._xScale=d3.scale.linear(),this._rawData=t.dataSource||[],this._legendItems=[],this._options.seriesOptions=t.seriesOptions||[],this._uniqueArgs=[],this._axisesOptions={useAdditional:!1,useMain:!1,swapAxes:!0},test=this.exportToPdf.bind(this),this._axisesOptions.swapAxes=this._options.swapAxes}return e.prototype.parse=function(){this.parseSeries(this._options.seriesOptions),this.parseData(this._rawData),this._notParsed=!1},e.prototype.parseSeries=function(e){this._legendItems=[],this._barCount=0,this._options.seriesOptions=e;for(var t=this._stacked=!1,i=0,n=0;n<this._options.seriesOptions.length;n++)this._rawData&&this._rawData[0]&&void 0!==this._rawData[this._options.seriesOptions[n].valueField]&&(t=!0),this._options.seriesOptions[n].useAdditionalAxis&&(this._options.seriesOptions[n].chartType===F.ChartTypes.StackedBar&&(this._options.seriesOptions[n].chartType=F.ChartTypes.Bar),this._options.seriesOptions[n].chartType===F.ChartTypes.StackedArea&&(this._options.seriesOptions[n].chartType=F.ChartTypes.Area),1<=i?this._options.seriesOptions[n].useAdditionalAxis=!1:i++),this._options.seriesOptions[n].chartType!==F.ChartTypes.Bar||this._options.seriesOptions[n].hidden||this._barCount++,this._options.seriesOptions[n].chartType!==F.ChartTypes.StackedBar&&this._options.seriesOptions[n].chartType!==F.ChartTypes.StackedArea||(this._stacked=!0),this._options.seriesOptions[n].color||(this._options.seriesOptions[n].color=this._color(n)),this._legendItems.push({name:this._options.seriesOptions[n].name,color:this._options.seriesOptions[n].color,visible:!this._options.seriesOptions[n].hidden,show:!0});return t},e.prototype.parseData=function(e){var i=this;if(this._additionalAxisType=F.DataType.Number,this._mainAxisType=F.DataType.Percentage,this._parsedData=[],this._parsedCoords=[],this._rawData[0]){var t,n,o,r=this._options;this._stackedBarCount=0,this._prevStackedCoords=[],this._uniqueArgs=[],this._parsedCoords=[],this._stackedAreaValues=[],this._stackedBarValues=[],this._numType=!0;for(var a=0;a<r.seriesOptions.length;a++)if(!r.seriesOptions[a].hidden)for(var s=0;s<this._rawData.length;s++)this._additionalAxisType===F.DataType.Number&&this._rawData[s][r.seriesOptions[a].formatField]===F.DataType.Percentage&&r.seriesOptions[a].useAdditionalAxis&&(this._additionalAxisType=F.DataType.Percentage),this._mainAxisType===F.DataType.Percentage&&this._rawData[s][r.seriesOptions[a].formatField]===F.DataType.Number&&(this._mainAxisType=F.DataType.Number),t=r.seriesOptions[a].argumentField||this._options.argumentField,"number"!=typeof this._rawData[s][t]&&(this._numType=!1),this._rawData[s][r.seriesOptions[a].valueField]&&parseFloat(this._rawData[s][r.seriesOptions[a].valueField])||(this._rawData[s][r.seriesOptions[a].valueField]=0);if(this._numType){for(var l=[],c=0;c<r.seriesOptions.length;c++){t=r.seriesOptions[c].argumentField||this._options.argumentField;for(var u=0;u<this._rawData.length;u++)l.push(this._rawData[u][t])}n=d3.max(l),o=d3.min(l),this._xScale.domain([o-5,n+5])}else t=r.seriesOptions[0].argumentField||this._options.argumentField,this._uniqueArgs=this.getUniqueValues("uniqueRowName",t,this._rawData,this._uniqueArgs),this._xScale.domain([-.5,this._uniqueArgs.length-.5]);this._parsedData=[];for(var p=0;p<this._options.seriesOptions.length;p++)if(t=r.seriesOptions[p].argumentField||this._options.argumentField,this._parsedData[p]=[],!r.seriesOptions[p].hidden)for(var h=0;h<this._rawData.length;h++)if(this._rawData[h][t]){var d={};(d=this._rawData[h]["data"+this._options.seriesOptions[p].columnIndex]||{}).seriesData=this._options.seriesOptions[p].data,this._parsedData[p].push({value:this._rawData[h][r.seriesOptions[p].valueField],name:this._options.seriesOptions[p].name,uniqueArgumentName:this._rawData[h].uniqueRowName,argument:this._rawData[h][t],displayValue:this._rawData[h][r.seriesOptions[p].displayValueField]||this._rawData[h][r.seriesOptions[p].valueField].toString(),data:d,useAdditionalAxis:r.seriesOptions[p].useAdditionalAxis})}for(a=0;a<r.seriesOptions.length;a++)if(r.seriesOptions[a].useAdditionalAxis){if(this._additionalScale.domain([0,0]),r.seriesOptions[a].hidden)continue;var m=d3.min(this._parsedData[a],function(e){return e.value}),f=d3.max(this._parsedData[a],function(e){return e.value});0<m&&(m=0),f<0&&(f=0),this._additionalScale.domain([m,f]),this._additionalScale.nice()}var g,_,y=d3.max(this._parsedData,function(e,t){return d3.max(i._parsedData[t],function(e){return e.useAdditionalAxis?0:e.value})}),C=[];if(this._stacked){for(var v,b,w,S=[],x=[],D=0,T=0,P=0;P<r.seriesOptions.length;P++){var M,I;if(r.seriesOptions[P].chartType===F.ChartTypes.StackedBar){if(M=r.seriesOptions[P].stack?r.seriesOptions[P].stack:"defaultBar",C.indexOf(M)<0&&C.push(M),S[M]||(S[M]=[]),x[M]||(x[M]=[]),this._stackedBarValues[M]||(this._stackedBarCount++,this._stackedBarValues[M]=[]),this._stackedBarValues[M][T]=[],t=r.seriesOptions[P].argumentField||this._options.argumentField,r.seriesOptions[P].hidden)continue;for(I=0;I<this._rawData.length;I++)this._stackedBarValues[M][T].push({name:r.seriesOptions[P].name,value:this._rawData[I][r.seriesOptions[P].valueField],argument:this._rawData[I][t],color:r.seriesOptions[P].color,displayValue:this._rawData[I][r.seriesOptions[P].displayValueField]||this._rawData[I][r.seriesOptions[P].valueField].toString()}),S[M][this._rawData[I][t]]?0<this._rawData[I][r.seriesOptions[P].valueField]&&(S[M][this._rawData[I][t]]+=this._rawData[I][r.seriesOptions[P].valueField]):0<this._rawData[I][r.seriesOptions[P].valueField]&&(S[M][this._rawData[I][t]]=this._rawData[I][r.seriesOptions[P].valueField]),x[M][this._rawData[I][t]]?this._rawData[I][r.seriesOptions[P].valueField]<0&&(x[M][this._rawData[I][t]]+=this._rawData[I][r.seriesOptions[P].valueField]):this._rawData[I][r.seriesOptions[P].valueField]<0&&(x[M][this._rawData[I][t]]=this._rawData[I][r.seriesOptions[P].valueField]);T++}if(r.seriesOptions[P].chartType===F.ChartTypes.StackedArea){if(M=r.seriesOptions[P].stack?r.seriesOptions[P].stack:"defaultArea",C.indexOf(M)<0&&C.push(M),S[M]||(S[M]=[]),x[M]||(x[M]=[]),this._stackedAreaValues[M]||(this._stackedAreaValues[M]=[]),this._stackedAreaValues[M][D]=[],t=r.seriesOptions[P].argumentField||this._options.argumentField,r.seriesOptions[P].hidden)continue;for(I=0;I<this._rawData.length;I++)this._stackedAreaValues[M][D].push({name:r.seriesOptions[P].name,value:this._rawData[I][r.seriesOptions[P].valueField],argument:this._rawData[I][t],color:r.seriesOptions[P].color,displayValue:this._rawData[I][r.seriesOptions[P].displayValueField]||this._rawData[I][r.seriesOptions[P].valueField].toString()}),S[M][this._rawData[I][t]]?S[M][this._rawData[I][t]]+=this._rawData[I][r.seriesOptions[P].valueField]:S[M][this._rawData[I][t]]=this._rawData[I][r.seriesOptions[P].valueField];D++}}for(w=_=0;w<C.length;w++)for(b=0;b<this._uniqueArgs.length;b++)_<(v=S[C[w]][this._uniqueArgs[b].row])&&(_=v);for(w=g=0;w<C.length;w++)for(b=0;b<this._uniqueArgs.length;b++)(v=x[C[w]][this._uniqueArgs[b].row])<g&&(g=v);_<y&&(_=y),_<0&&(_=0),0<g&&(g=0),this._yScale=d3.scale.linear().domain([g,_])}else(_=y)<0&&(_=0),0<(g=d3.min(this._parsedData,function(e,t){return d3.min(i._parsedData[t],function(e){return e.useAdditionalAxis?0:e.value})}))&&(g=0),g||(g=0),_||(_=0),this._yScale=d3.scale.linear().domain([g,_]);if(this._yScale.nice(),this._axisesOptions.swapAxes){var E=this._xScale.domain(),N=this._yScale.domain();E[0]=E[0],this._yScale.domain(E),this._xScale.domain(N)}}},e.prototype.getUniqueValues=function(n,o,e,r){return e.forEach(function(e){for(var t=!0,i=0;i<r.length;i++)e[n]?r[i].uniqueName===e[n]&&(t=!1):e[o]?r[i].row===e[o]&&(t=!1):t=!1;t&&r.push({uniqueName:e[n]||e[o],row:e[o]})}),r},e.prototype.calculateCoords=function(){this._prevStackedCoords=[];for(var e=0;e<this._parsedData.length;e++)this._parsedCoords[e]=[],this._options.seriesOptions[e]&&(this._parsedCoords[e]=this.scaleCoords(this._parsedData[e],this._options.seriesOptions[e]))},e.prototype.scaleCoords=function(e,t){var i,n,o,r=[],a=void 0,s=void 0;if(t.chartType!==F.ChartTypes.StackedBar&&t.chartType!==F.ChartTypes.StackedArea)if(t.useAdditionalAxis)for(o=0;o<e.length;o++)i=e[o],n=0,t.chartType===F.ChartTypes.Bar&&(n=this._additionalScale(0)-this._additionalScale(Math.abs(i.value)),a=i.value<0?this._additionalScale(0):void 0),this._numType?r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,x:this._xScale(i.argument),y:a||this._additionalScale(i.value||0),color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)}):r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,x:this._xScale(this.getIndexOfArg({row:i.argument,uniqueName:i.uniqueArgumentName},this._uniqueArgs)),y:a||this._additionalScale(i.value),color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)});else for(o=0;o<e.length;o++)i=e[o],n=0,t.chartType===F.ChartTypes.Bar&&(this._axisesOptions.swapAxes?(n=this._xScale(Math.abs(i.value))-this._xScale(0),s=i.value<0?this._xScale(0)-n:this._xScale(0)):(n=this._yScale(0)-this._yScale(Math.abs(i.value)),a=i.value<0?this._yScale(0):void 0)),this._numType?r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,x:this._axisesOptions.swapAxes?s:this._xScale(i.argument),y:this._axisesOptions.swapAxes?this._yScale(i.argument):a||this._yScale(i.value||0),color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)}):r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,x:this._axisesOptions.swapAxes?s||this._xScale(i.value||0):this._xScale(this.getIndexOfArg({row:i.argument,uniqueName:i.uniqueArgumentName},this._uniqueArgs)),y:this._axisesOptions.swapAxes?this._yScale(this.getIndexOfArg({row:i.argument,uniqueName:i.uniqueArgumentName},this._uniqueArgs)):a||this._yScale(i.value||0),color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)});else{if(t.chartType===F.ChartTypes.StackedBar)for(o=0;o<e.length;o++)i=e[o],this._prevStackedCoords[t.stack||"defaultBar"]=this._prevStackedCoords[t.stack||"defaultBar"]||[],this._axisesOptions.swapAxes?(i.value<0?(s=(this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"neg"]||0)+this._xScale(0),n=Math.abs(this._xScale(0)-this._xScale(i.value)),this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"neg"]=(this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"neg"]||0)+n):(s=(this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"pos"]||0)+this._xScale(0),n=Math.abs(this._xScale(0)-this._xScale(i.value)),this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"pos"]=(this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"pos"]||0)+n),this._numType?r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,stack:t.stack||"defaultBar",x:s,y:this._yScale(i.argument),color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)}):r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,stack:t.stack||"defaultBar",x:s,y:this._yScale(this.getIndexOfArg({row:i.argument,uniqueName:i.uniqueArgumentName},this._uniqueArgs)),color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)})):(i.value<0?(a=this._yScale(0)-(this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"neg"]||0),n=Math.abs(this._yScale(0)-this._yScale(i.value)),this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"neg"]=(this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"neg"]||0)+(this._yScale(0)-this._yScale(i.value))):(a=this._yScale(i.value)-(this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"pos"]||0),n=Math.abs(this._yScale(0)-this._yScale(i.value)),this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"pos"]=(this._prevStackedCoords[t.stack||"defaultBar"][i.uniqueArgumentName+"pos"]||0)+(this._yScale(0)-this._yScale(i.value))),this._numType?r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,stack:t.stack||"defaultBar",x:this._xScale(i.argument),y:a,color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)}):r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,stack:t.stack||"defaultBar",x:this._xScale(this.getIndexOfArg({row:i.argument,uniqueName:i.uniqueArgumentName},this._uniqueArgs)),y:a,color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)}));if(t.chartType===F.ChartTypes.StackedArea)for(this._prevStackedCoords[t.stack||"defaultArea"]=this._prevStackedCoords[t.stack||"defaultArea"]||[],o=0;o<e.length;o++)i=e[o],this._numType?r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,stack:t.stack||"defaultArea",x:this._xScale(i.argument)+40,y:this._yScale(i.value)-(this._prevStackedCoords[t.stack||"defaultArea"][i.argument]||0),color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)}):r.push({name:i.name,argument:i.argument,value:i.value,seriesType:t.chartType,stack:t.stack||"defaultArea",x:this._xScale(this.getIndexOfArg({row:i.argument,uniqueName:i.uniqueArgumentName},this._uniqueArgs)),y:this._yScale(i.value)-(this._prevStackedCoords[t.stack||"defaultArea"][i.uniqueArgumentName]||0),color:t.color,height:n,data:i.data,displayValue:i.displayValue,uniqueArgumentName:i.uniqueArgumentName,visible:!(!1===i.visible)}),this._prevStackedCoords[t.stack||"defaultArea"][i.uniqueArgumentName]=(this._prevStackedCoords[t.stack||"defaultArea"][i.uniqueArgumentName]||0)+(this._yScale(0)-this._yScale(i.value))}return r},e.prototype.getIndexOfArg=function(e,t){for(var i=0;i<t.length;i++)if(e.uniqueName===t[i].uniqueName)return i;return-1},e.prototype.fixDomains=function(e,t,i,n){var o,r=(0-i[0])/i[1],a=(0-n[0])/n[1];r<1&&1<a&&(i[0]=-i[1],n[1]=-n[0]),1<r&&a<1&&(i[1]=-i[0],n[0]=-n[1]),r<1&&a<1&&(o=a<r?r:a,i[0]=-i[1]*o,n[0]=-n[1]*o),1<r&&1<a&&(o=r<a?r:a,i[1]=-i[0]/o,n[1]=-n[0]/o),this._additionalScale.domain(n),this._yScale.domain(i);var s,l,c,u,p=!1,h=[],d=i[0],m=(i[1]-i[0])/10;if(0<=i[0]||i[1]<=0){for(;d.toFixed(8)/1<i[1];)Math.abs(d)>m/2||p?h.push(d):(h.push(0),p=!0),d+=m;h.push(d),p||h.push(0)}else{s=Math.abs(i[0]),l=Math.abs(i[1]),c=Math.round(s/m),u=Math.round(l/m);for(var f=d=0;f<c;f++)d-.7*m<i[0]?h.push(this.getPrettyNumber(i[0])):h.push(this.getPrettyNumber(d)),d-=m;for(d=m,f=0;f<u;f++)d+.7*m>i[1]?h.push(this.getPrettyNumber(i[1])):h.push(this.getPrettyNumber(d)),d+=m}var g=[];if(d=n[0],m=(n[1]-n[0])/10,p=!1,0<=n[0]||n[1]<=0){for(;d.toFixed(8)/1<n[1];)Math.abs(d)>m/2||p?g.push(d):(g.push(0),p=!0),d+=m;g.push(d),p||g.push(0)}else{for(s=Math.abs(n[0]),l=Math.abs(n[1]),c=Math.round(s/m),u=Math.round(l/m),f=d=0;f<c;f++)d-.7*m<i[0]?g.push(this.getPrettyNumber(n[0])):g.push(this.getPrettyNumber(d)),d-=m;for(d=m,f=0;f<u;f++)d+.7*m>n[1]?g.push(this.getPrettyNumber(n[1])):g.push(this.getPrettyNumber(d)),d+=m}t.tickValues(g),e.tickValues(h)},e.prototype.recalculateVisualProps=function(){this._temporaryText=this._content.append("text"),this.resizeSvg(),this.checkAxises(),this.calculateLeftAxisWidth(),this.calculateAdditionalAxisWidth(),this.calculateBottomAxisProps(),this._temporaryText.remove(),this._countedStyles.paddingTop=10},e.prototype.checkAxises=function(){this._axisesOptions.useAdditional=!1,this._axisesOptions.useMain=!1;for(var e=0;e<this._options.seriesOptions.length;e++)this._options.seriesOptions[e].hidden||(this._options.seriesOptions[e].useAdditionalAxis?this._axisesOptions.useAdditional=!0:this._axisesOptions.useMain=!0)},e.prototype.calculateLeftAxisWidth=function(){if(this._axisesOptions.useMain)if(!this._axisesOptions.swapAxes||this._options.showArgumentLabels){var e=this._temporaryText.node(),t=this._yScale.ticks(),i="";if(this._axisesOptions.swapAxes)for(var n=0;n<this._uniqueArgs.length;n++)(this._uniqueArgs[n].row+"").length>i.length&&(i=this._uniqueArgs[n].row+"");else{for(var o=0;o<t.length;o++)(t[o]+"").length>i.length&&(i=t[o]+"");this._mainAxisType===F.DataType.Percentage&&(i=(100*parseInt(i)).toFixed(1)+"%")}this._temporaryText.text(i);var r=e.getBoundingClientRect().width,a=(this._xScale(0),0);this._axisesOptions.swapAxes&&(a=(this._fieldWidth-this._countedStyles.paddingLeft-this._countedStyles.paddingRight)*((0-this._xScale.domain()[0])/(this._xScale.domain()[1]-0))),this._countedStyles.paddingLeft=a<r?r+15:15}else this._countedStyles.paddingLeft=10;else this._countedStyles.paddingLeft=10},e.prototype.calculateAdditionalAxisWidth=function(){if(this._axisesOptions.useAdditional){for(var e=this._temporaryText.node(),t=this._additionalScale.ticks(),i="",n=0;n<t.length;n++)(t[n]+"").length>i.length&&(i=t[n]+"");this._additionalAxisType===F.DataType.Percentage&&(i=(100*parseInt(i)).toFixed(1)+"%"),this._temporaryText.text(i);var o=e.getBoundingClientRect().width;this._countedStyles.paddingRight=o+15}else this._countedStyles.paddingRight=10},e.prototype.calculateBottomAxisProps=function(){if(this._options.showArgumentLabels||this._axisesOptions.swapAxes){var e=this._xScale.ticks(),t=(this._axisesOptions.swapAxes?(this._fieldWidth-this._countedStyles.paddingLeft-this._countedStyles.paddingRight)/e.length:(this._fieldWidth-this._countedStyles.paddingLeft-this._countedStyles.paddingRight)/this._uniqueArgs.length)/5,i=this._temporaryText.node(),n="",o="",r=!0;if(this._axisesOptions.swapAxes)for(var a=e.length-1,s=0;0<=a;a--,s++){var l=s*t,c=e[a].toLocaleString("en");c.length>n.length&&(n=c),c.length-l>o.length&&(o=0!==l?c.slice(0,-l):c.slice(0))}else{var u=this._uniqueArgs.length-1;for(s=0;0<=u;u--,s++)l=s*t,(this._uniqueArgs[u].row+"").length>n.length&&(n=this._uniqueArgs[u].row+""),(this._uniqueArgs[u].row+"").length-l>o.length&&(o=0!==l?(this._uniqueArgs[u].row+"").slice(0,-l):(this._uniqueArgs[u].row+"").slice(0))}this._temporaryText.text(n);var p=i.getBoundingClientRect().width;this._temporaryText.text(o);var h,d=i.getBoundingClientRect().width;if((h=this._axisesOptions.swapAxes?(this._fieldWidth-this._countedStyles.paddingLeft-this._countedStyles.paddingRight-p)/e.length:(this._fieldWidth-this._countedStyles.paddingLeft-this._countedStyles.paddingRight-p)/this._uniqueArgs.length)<p&&(r=!1),this._axisesOptions.swapAxes){var m=e[0].toLocaleString();this._temporaryText.text(m);var f=i.getBoundingClientRect().width/2,g=this._countedStyles.paddingLeft;this._countedStyles.paddingLeft=f<g?g:f,(h*e.length-d)/e.length>h?r=!1:this._countedStyles.paddingRight+=d}var _=i.getBoundingClientRect().height;if(r)this._xAxisAngle=0,this._countedStyles.paddingBottom=_+10;else if(this._xAxisAngle=this.floorAngle(Math.degrees(Math.asin(_/h))),this._countedStyles.paddingBottom=Math.abs(p*Math.sin(Math.radians(this._xAxisAngle)))+20,this._countedStyles.paddingRight<d*Math.cos(Math.radians(this._xAxisAngle))&&(this._countedStyles.paddingRight+=d*Math.cos(Math.radians(this._xAxisAngle))),this._countedStyles.paddingBottom>this._fieldHeight||this._fieldHeight-this._countedStyles.paddingBottom-this._countedStyles.paddingTop<70)return this._argumentsHidden=!0,void(this._countedStyles.paddingBottom=0)}else this._countedStyles.paddingBottom=0},e.prototype.floorAngle=function(e){return e<15?15:e<30?30:e<45?45:e<60?60:e<75?75:90},e.prototype.calculateAxisScales=function(){this._axisWidth=this._fieldWidth-this._countedStyles.paddingRight-this._countedStyles.paddingLeft,this._axisHeight=this._fieldHeight-this._countedStyles.paddingBottom-this._countedStyles.paddingTop,this._yScale.range([this._axisHeight,this._countedStyles.paddingTop]),this._additionalScale.range([this._axisHeight,this._countedStyles.paddingTop]),this._xScale.range([this._countedStyles.paddingLeft,this._axisWidth+this._countedStyles.paddingLeft])},e.prototype.drawAxises=function(){var t=this,e=d3.svg.axis(),i=this._axisesOptions.useMain;i||(this._yScale=this._additionalScale);var n=d3.svg.axis(),o=d3.svg.axis();this._numType?e.scale(this._xScale).orient("bottom"):(e.scale(this._xScale).orient("bottom"),this._axisesOptions.swapAxes||e.ticks(this._uniqueArgs.length).tickFormat(function(e){return t._options.showArgumentLabels&&!t._argumentsHidden&&t._uniqueArgs[e]&&t._uniqueArgs[e].row||""})),i&&(n.scale(this._yScale).orient("left"),this._axisesOptions.swapAxes?n.scale(this._yScale).orient("left").ticks(this._uniqueArgs.length).tickFormat(function(e){return t._options.showArgumentLabels&&!t._argumentsHidden&&t._uniqueArgs[e]&&t._uniqueArgs[e].row||""}):this._mainAxisType===F.DataType.Percentage&&n.tickFormat(function(e){return(100*e).toFixed(1)+"%"})),this._axisesOptions.useAdditional&&(o.scale(this._additionalScale).orient("right"),this._additionalAxisType===F.DataType.Percentage&&o.tickFormat(function(e){return(100*e).toFixed(1)+"%"}),this.fixDomains(n,o,this._yScale.domain(),this._additionalScale.domain())),this._yScale.domain(),this._content.append("g").attr("class","x-axis").attr("transform","translate(0,"+(t._axisesOptions.swapAxes?t._yScale.range()[0]||0:t._yScale(0))+")").call(e),this._axisesOptions.useAdditional&&this._content.append("g").attr("class","add-axis").attr("transform","translate("+(this._axisWidth+this._countedStyles.paddingLeft)+",0)").call(o),i&&this._content.append("g").attr("class","y-axis").call(n),this._axisesOptions.useAdditional&&this._content.selectAll("g.add-axis g.tick").append("line").classed("grid-line",!0).attr("x1",0).attr("y1",0).attr("x2",-this._axisWidth).attr("y2",0),i&&(this._content.select(".y-axis").attr("transform","translate("+(this._axisesOptions.swapAxes?this._xScale(0):this._xScale.range()[0])+", 0)"),this._axisesOptions.swapAxes?this._content.selectAll("g.x-axis g.tick").append("line").classed("grid-line",!0).attr("x1",0).attr("y1",-this._axisHeight).attr("x2",0).attr("y2",0):this._content.selectAll("g.y-axis g.tick").append("line").classed("grid-line",!0).attr("x1",0).attr("y1",0).attr("x2",this._axisWidth).attr("y2",0)),this._content.selectAll("g.x-axis g.tick text").attr("y",0).attr("transform",function(){return t._axisesOptions.swapAxes?"translate(0, "+(t._yScale(t._yScale.domain()[0])-t._yScale(-.5))+"), rotate("+(t._xAxisAngle||0)+")":"translate(0, "+(t._yScale(t._yScale.domain()[0])-t._yScale(0)+10)+"), rotate("+(t._xAxisAngle||0)+")"}).attr("style",function(){return 0!==t._xAxisAngle?"text-anchor: beggining;":"text-anchor: middle;"}),this.hideOverlappingLabels()},e.prototype.clearAxises=function(){this._content.select("g.x-axis").remove(),this._content.select("g.y-axis").remove(),this._content.select("g.add-axis").remove()},e.prototype.hideOverlappingLabels=function(){var n=this;if(this._axisesOptions.useMain){var o=$(this._htmlelement).find("g.y-axis g.tick");if(!o[1])return;var r=d3.max([Math.abs(Math.floor(o[1].getBoundingClientRect().height)/(Math.floor(o[0].getBoundingClientRect().top)-Math.floor(o[1].getBoundingClientRect().top))),Math.abs(Math.floor(o[o.length-1].getBoundingClientRect().height)/(Math.floor(o[o.length-2].getBoundingClientRect().top)-Math.floor(o[o.length-1].getBoundingClientRect().top)))]);1<=r&&o.attr("class",function(e,t){var i=d3.select(o[e]).data()[0];return 10<r?0<i&&i===n._yScale.domain()[1]?t:i<0&&i===n._yScale.domain()[0]?t:"hidden "+t:e%Math.ceil(r)==0?t:"hidden "+t})}if(this._axisesOptions.useAdditional){var e=$(this._htmlelement).find("g.add-axis g.tick");if(!e[1])return;var i=d3.max([Math.abs(Math.floor(e[1].getBoundingClientRect().height)/(Math.floor(e[0].getBoundingClientRect().top)-Math.floor(e[1].getBoundingClientRect().top))),Math.abs(Math.floor(e[e.length-1].getBoundingClientRect().height)/(Math.floor(e[e.length-2].getBoundingClientRect().top)-Math.floor(e[e.length-1].getBoundingClientRect().top)))]);1<=i&&e.attr("class",function(e,t){return e%Math.ceil(i)==0?t:"hidden "+t})}},e.prototype.getPrettyNumber=function(e){var t=1;if(0===e)return e;if(1<Math.abs(e)){for(;100<Math.abs(e);)e/=10,t*=10;return Math.round(e)*t}for(;Math.abs(e)<10;)e*=10,t/=10;return Math.round(e)*t},e.prototype.drawCharts=function(){var e,t=this;this._axisesOptions.swapAxes?this._chartArea=this._content.insert("g",".y-axis").attr("class","Charts"):this._chartArea=this._chartArea=this._content.insert("g",".x-axis").attr("class","Charts"),this._hiddenBarCount=0,this._charts=[];for(var i=new F.ChartFactory(this._chartArea,this._xScale,this._yScale,this._parsedCoords.concat([]),this._uniqueArgs,this._options.seriesOptions,this._numType,this._barCount,this._stackedBarCount,this._hiddenBarCount,this._axisesOptions.swapAxes),n=0;n<this._options.seriesOptions.length;n++)this._options.seriesOptions[n].hidden?this._hiddenBarCount++:((e=i.createChart(this._options.seriesOptions[n].chartType,this._options.seriesOptions[n].stack,this._hiddenBarCount)).onClick.on(function(e){t._options.onClickCallback&&t._options.onContextCallback(e.context,e.d,e.event)}),e.onContextMenu.on(function(e){t._options.onContextCallback&&t._options.onContextCallback(e.context,e.d,e.event)}),this._charts.push(e),e.constructor===F.BaseChart.prototype.constructor||this._options.seriesOptions[n].hidden||e.draw())},e.prototype.clearCharts=function(){this._chartArea&&this._chartArea.remove()},e.prototype.drawTooltips=function(){var t=this;this._tooltip=new F.Tooltip(this._content,this._parsedCoords,this._barCount,this._uniqueArgs,this._options.tooltip,this._axisesOptions.swapAxes),this._tooltip.onClick.on(function(e){t._options.onClickCallback&&t._options.onContextCallback(e.context,e.d,e.event)}),this._tooltip.onContextMenu.on(function(e){t._options.onContextCallback&&t._options.onContextCallback(e.context,e.d,e.event)}),this._tooltip.draw()},e.prototype.removeTooltips=function(){this._tooltip&&(this._tooltip.remove(),this._tooltip=null)},e.prototype.needToRedraw=function(){return 300<this._fieldHeight||this._fieldHeight-this._countedStyles.paddingBottom-this._countedStyles.paddingTop<150},e.prototype.hideSvg=function(){this._content.style("visibility","hidden")},e.prototype.resizeSvg=function(){this.updateLegendSize(),this._fieldHeight=this._htmlelement.getBoundingClientRect().height-(this._legendSize.height||0)-5,this._fieldWidth=this._htmlelement.getBoundingClientRect().width-(this._legendSize.width||0)-5,0<this._fieldHeight?this._content.attr("height",this._fieldHeight+"px").attr("width",this._fieldWidth+"px"):this._content.attr("height","0px").attr("width","0px")},e.prototype.showSvg=function(){this._content.style("visibility","visible")},e.prototype.clearLegend=function(){this._element.select(".legend").html("")},e.prototype.updateLegendSize=function(){var e=this._element.select(".legend").node();if(this._options.legend.position===F.LegendPosition.Left||this._options.legend.position===F.LegendPosition.Right){e.classList?e.classList.add("vertical"):e.className+=" vertical";var t=e.getBoundingClientRect().width+15;this._legendSize.width=t,this._legendSize.height=null,this._content.attr("style","display: inline-block;")}else e&&(this._legendSize.height=e.getBoundingClientRect().height+5),this._legendSize.width=null},e.prototype.drawLegend=function(){this._element.select(".legend").remove(),this._options.legend.position!==F.LegendPosition.None&&(this._options.legend.position===F.LegendPosition.Top||this._options.legend.position===F.LegendPosition.Left?this._element.insert("xhtml:div","svg").attr("class","legend"):this._element.insert("xhtml:div",".popOvers").attr("class","legend"),this._legend=new F.Legend(this._element.select(".legend"),this._options.legend,this._legendItems,this._options.styling),this._legend.create())},e.prototype.exportToPng=function(){var r=this;this._loadPanel.message=s.Localization.localize("Message_ExportingPng"),this._loadPanel.visible=!0,this._content.selectAll("g g.tick text").attr("y",5);var e=this._content.node().cloneNode(!0),t=this._legend.svgLegend,i=parseInt(d3.select(e).attr("height").slice(0,-2)),n=parseInt(t.getAttribute("height"));t.setAttribute("transform","translate(0, "+(i+10)+")"),e.appendChild(t),d3.select(e).attr("height",i+n+10+"px").style("background-color","#fff");var o=(new XMLSerializer).serializeToString(e).replace(new RegExp('"',"g"),'\\"');this._content.selectAll("g g.tick text").attr("y",0);var a=new XMLHttpRequest;a.withCredentials=!0,a.open("POST",s.PathManager.applicationUrl+"api/export/convertToPng"),a.responseType="blob",a.setRequestHeader("content-type","application/json"),a.setRequestHeader("cache-control","no-cache"),a.onload=function(){if(200===a.status){var e=a.getResponseHeader("content-disposition"),t=/"([^"]*)"/.exec(e),i=null!=t&&t[1]?t[1]:"chart.png",n=new Blob([a.response],{type:"image/png"}),o=document.createElement("a");o.href=window.URL.createObjectURL(n),o.download=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),r._loadPanel.visible=!1}},a.send('"'+o+'"')},e.prototype.exportToPdf=function(){var r=this;this._loadPanel.message=s.Localization.localize("Message_ExportingPdf"),this._loadPanel.visible=!0,this._content.selectAll("g g.tick text").attr("y",5);var e=this._content.node().cloneNode(!0),t=this._legend.svgLegend,i=parseInt(d3.select(e).attr("height").slice(0,-2)),n=parseInt(t.getAttribute("height"));t.setAttribute("transform","translate(0, "+(i+10)+")"),e.appendChild(t),d3.select(e).attr("height",i+n+10+"px");var o=(new XMLSerializer).serializeToString(e).replace(new RegExp('"',"g"),'\\"');this._content.selectAll("g g.tick text").attr("y",0);var a=new XMLHttpRequest;a.withCredentials=!0,a.open("POST",s.PathManager.applicationUrl+"api/export/convertToPdf"),a.responseType="blob",a.setRequestHeader("content-type","application/json"),a.setRequestHeader("cache-control","no-cache"),a.onload=function(){if(200===a.status){var e=a.getResponseHeader("content-disposition"),t=/"([^"]*)"/.exec(e),i=null!=t&&t[1]?t[1]:"chart.pdf",n=new Blob([a.response],{type:"application/pdf"}),o=document.createElement("a");o.href=window.URL.createObjectURL(n),o.download=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),r._loadPanel.visible=!1}},a.send('"'+o+'"')},e.prototype.showExportButtons=function(){var e=this,t=this._element.insert("xhtml:div",".legend").attr("class","exportButtonsContainer").append("xhtml:div").attr("class","exportButtons");t.append("xhtml:div").attr("class","exportButton imageLibrary_exportPNG").attr("title",s.Localization.localize("Chart_ExportPng")).on("click",function(){e.exportToPng()}),t.append("xhtml:div").attr("class","exportButton imageLibrary_exportPDF").attr("title",s.Localization.localize("Chart_ExportPdf")).on("click",function(){e.exportToPdf()})},e.prototype.hideExportButtons=function(){d3.select(".exportButtonsContainer").remove()},e.prototype.draw=function(){this.hideSvg(),this._notParsed&&this.parse(),this.clearLegend(),this.clearAxises(),this.clearCharts(),this.removeTooltips(),this._parsedData&&this._parsedData[0]&&(this.drawLegend(),this.updateLegendSize(),this.recalculateVisualProps(),this.calculateAxisScales(),this.drawAxises(),this.calculateCoords(),this.drawCharts(),this.drawTooltips(),this.applyStyles(),this.showSvg())},e.prototype.applyStyles=function(){d3.selectAll("svg .x-axis path, .x-axis line").style("fill","none").style("stroke","#333"),d3.selectAll("svg .y-axis path, .y-axis line").style("fill","none").style("stroke","#333"),d3.selectAll("svg .add-axis path, .add-axis line").style("fill","none").style("stroke","#333"),d3.selectAll("svg .x-axis .grid-line, .y-axis .grid-line, .add-axis .grid-line").style("stroke-opacity","0.2").style("stroke","#000"),d3.selectAll("svg .x-axis text, .y-axis text, .add-axis text").style("font-family","'Segoe UI',Helvetica,'Droid Sans',Tahoma,Geneva,sans-serif;").style("font-size","12px"),d3.selectAll("svg .area").style("stroke-width","0")},e.prototype.throwError=function(e){var t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert-warning"),t.classList.add("fade"),t.classList.add("in"),t.innerHTML=e,t.setAttribute("id","chartError"),this._element.node().appendChild(t)},e.prototype.clearError=function(){var e=this._htmlelement.querySelector("#chartError");e&&e.remove()},e.prototype.clear=function(){this._element.html(""),this.clearError()},e.prototype.redraw=function(){this.draw()},e.prototype.resize=function(){this.error||(this.resizeSvg(),this.clearAxises(),this.clearCharts(),this.removeTooltips(),0!==this._fieldWidth&&0!==this._fieldHeight&&(this.needToRedraw()&&(this._argumentsHidden=!1,this.recalculateVisualProps()),this._parsedData&&this._parsedData[0]&&(this.calculateAxisScales(),this.drawAxises(),this.calculateCoords(),this.drawCharts(),this.drawTooltips())))},e.prototype.hide=function(){this.hideSvg()},e.prototype.show=function(){this.showSvg()},Object.defineProperty(e.prototype,"error",{get:function(){return this._htmlelement.querySelector("#chartError")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._rawData},set:function(e){this._rawData=e,this._notParsed=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(e){this._rawData===e.dataSource&&this._options.seriesOptions===e.seriesOptions||(this._notParsed=!0),this._options=e,this._rawData=e.dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seriesOptions",{get:function(){return this._options.seriesOptions},set:function(e){this._options.seriesOptions=e,this._notParsed=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showArgumentLabels",{get:function(){return this._options.showArgumentLabels},set:function(e){e!==this._options.showArgumentLabels&&(this._notParsed=!0),this._options.showArgumentLabels=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legend",{get:function(){return this._options.legend},set:function(e){this._options.legend=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styling",{get:function(){return this._options.styling},set:function(e){this._options.styling=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tooltip",{get:function(){return this._options.tooltip},set:function(e){this._options.tooltip=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._htmlelement},enumerable:!0,configurable:!0}),e}();F.ChartCtrl=e})((r=s.Controls||(s.Controls={})).Extensions||(r.Extensions={}))}(Ranet||(Ranet={})),function(e){var t,R;t=e.Controls||(e.Controls={}),function(e){function A(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var i in e)e.hasOwnProperty(i)&&(t[i]=A(e[i]));return t}var t=function(){function e(){}return e.createGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e.getDataSource=function(e){for(var t=[],i=e.cells.values,n=e.cells.displayValues,o=e.cells.formatStrings,r=0;r<e.rows.positions.length;r++){for(var a={},s="",l=0;l<e.rows.positions[r].positions.length;l++)""!==s&&(s+=", "),s+=e.rows.members[e.rows.positions[r].positions[l].id].caption;a.row=s,a.uniqueRowName=this.createGuid();for(var c=0;c<e.columns.positions.length;c++){var u=i[r][c],p=n[r][c],h=o[r][2*c];if(null!==u){a["column"+c]=u,a["displayValue"+c]=p,a["format"+c]="Percent"===h?R.DataType.Percentage:R.DataType.Number;var d=this.getRowDescription(e,r),m=this.getColumnDescription(e,c);a["data"+c]={row:d,column:m,index:c}}}t.push(a)}return t},e.getRowDescription=function(e,t){var i={};i.column=e.rows.hierarchies.length-1;for(var n=e.rows.positions[t].positions[i.column].id,o=e.rows.members[n],r="",a=0;a<e.rows.positions[t].positions.length;a++)""!==r&&(r+=", "),r+=e.rows.members[e.rows.positions[t].positions[a].id].caption;return i.caption=r,i.hierarchy=e.rows.hierarchies[i.column],i.place="rows",i.endRow=i.startRow=t,i.ancestors=[],i.data=o,i},e.getColumnDescription=function(e,t){var i={};i.row=e.columns.hierarchies.length-1;for(var n=e.columns.positions[t].positions[i.row].id,o=e.columns.members[n],r="",a=0;a<e.columns.positions[t].positions.length;a++)""!==r&&(r+=", "),r+=e.columns.members[e.columns.positions[t].positions[a].id].caption;return i.caption=r,i.hierarchy=e.columns.hierarchies[i.row],i.place="columns",i.endColumn=i.startColumn=t,i.ancestors=[],i.data=o,i},e.getSeries=function(e,t,i,n){var o,r,a,s,l,c,u,p,h=new R.ColorGenerator(i);if(t[0]){o=[];for(var d=0;d<t.length;d++)if(a={},void 0!==(r=(f=t[d]).columnIndex)&&void 0!==e.columns&&void 0!==e.columns.members[r]&&void 0!==e.columns.positions[r]){for(a.chartType=f.diagramType,a.useAdditionalAxis=f.useAdditionalAxis,a.argumentField="row",u="column"+r,c="displayValue"+r,p="format"+r,l="",s=0;s<e.columns.positions[r].positions.length;s++)""!==l&&(l+=", "),l+=e.columns.members[e.columns.positions[r].positions[s].id].caption;a.displayValueField=c,a.valueField=u,a.name=l,a.formatField=p,a.columnIndex=r,a.color=h.getRecomendedColor(d,t.length),a.options=f.options,o.push(a)}return o}if(void 0!==n){if(t=[],void 0===e.columns)return[];if(void 0===e.columns.members)return[];if(void 0===e.columns.positions)return[];for(var m=0;m<e.columns.positions.length;m++)t.push({diagramType:n,columnIndex:m});for(o=[],d=0;d<t.length;d++){var f=t[d];if(a={},t&&t.length){if(void 0===(r=f.columnIndex))continue;a.chartType=f.diagramType,a.argumentField="row"}for(u="column"+r,c="displayValue"+r,p="format"+r,l="",s=0;s<e.columns.positions[r].positions.length;s++)""!==l&&(l+=", "),l+=e.columns.members[e.columns.positions[r].positions[s].id].caption;a.displayValueField=c,a.valueField=u,a.name=l,a.formatField=p,a.columnIndex=r,a.color=h.getRecomendedColor(d,t.length),a.options=f.options,o.push(a)}return o}return[]},e.generateOrgeredSeries=function(e,t,i,n){var o,r,a,s,l,c,u,p,h=[],d=[],m=new R.ColorGenerator(i);if(void 0!==n){t=[];for(var f=0;f<e.columns.hierarchies.length;f++){h[f]=[];for(var g=0;g<e.columns.positions.length;g++){var _=e.columns.positions[g],y=e.columns.members[_.positions[f].id].uniqueName;h[f].indexOf(y)<0&&h[f].push(y)}}for(var C=0;C<h[h.length-1].length;C++){var v=h.length-1,b={};b[v]=h[v][C],d.push(b)}for(var w=h.length-2;0<=w;w--){for(var S=[],x=0;x<d.length;x++)for(var D=d[x],T=0;T<h[w].length;T++){var P=A(D);P[w]=h[w][T],S.push(P)}d=S}for(var M=0;M<d.length;M++)for(var I=0;I<e.columns.positions.length;I++){for(var E=!0,N=0;N<e.columns.positions[I].positions.length;N++){var F=e.columns.positions[I].positions[N].id,O=d[M][N];e.columns.members[F].uniqueName!==O&&(E=!1)}E&&t.push({diagramType:n,columnIndex:I})}o=[];for(var $=0;$<t.length;$++){var L=t[$];if(a={},t&&t.length){if(void 0===(r=L.columnIndex))continue;a.chartType=L.diagramType,a.argumentField="row"}for(u="column"+r,c="displayValue"+r,p="format"+r,l="",s=0;s<e.columns.positions[r].positions.length;s++)""!==l&&(l+=", "),l+=e.columns.members[e.columns.positions[r].positions[s].id].caption;a.displayValueField=c,a.valueField=u,a.name=l,a.formatField=p,a.columnIndex=r,a.color=m.getRecomendedColor($,t.length),a.options=L.options,o.push(a)}return o}return[]},e}();e.ChartDataHelper=t}((R=t.Extensions||(t.Extensions={})).Chart||(R.Chart={}))}(Ranet||(Ranet={})),function(e){var c,t,i;c=e.Controls||(e.Controls={}),t=c.Extensions||(c.Extensions={}),i=function(){function e(e,t,i,n,o,r,a,s,l){this._onClick=new c.Events.LiteEvent,this._onContextMenu=new c.Events.LiteEvent,this._xScale=t,this._yScale=i,this._data=n,this._content=e,this._uniqueArgs=o,this._color=r,this._showLabels=!0,this._numType=s,this._prevStackedCoord=[],this._swapped=l}return e.prototype.draw=function(){throw Error("This class is abstract")},Object.defineProperty(e.prototype,"onClick",{get:function(){return this._onClick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onContextMenu",{get:function(){return this._onContextMenu},enumerable:!0,configurable:!0}),e}(),t.BaseChart=i}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(c){function e(e,t,i,n,o,r,a,s,l){c.call(this,e,t,i,n,o,r,a,s,l)}return __extends(e,c),e.prototype.drawChart=function(){var i=this;this._coords=this._data;var e=this._content,n=this;if(this._swapped)t=d3.svg.area().x0(this._xScale(0)).x1(function(e,t){return i._coords[t].x}).y(function(e,t){return i._coords[t].y});else var t=d3.svg.area().x(function(e,t){return i._coords[t].x}).y0(this._yScale(0)).y1(function(e,t){return i._coords[t].y});e.append("path").datum(this._coords).attr("class","area").attr("d",t).attr("fill",this._color).attr("fill-opacity",.65),this._content.append("g").attr("class","points").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill",function(e){return e.color}).on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()});var o=e.append("g").attr("class","area-selection");o.append("path").datum(this._coords).attr("d",t).attr("fill","black").attr("fill-opacity",1),o.append("g").attr("class","points").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill","black").on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(e){var t=e;e.target,i._coords[0].name===t.detail.name&&i.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(e){var t=e;e.target,i._coords[0].name===t.detail.name&&i.setSelectionOpacity(0)})},e.prototype.setSelectionOpacity=function(e){this._content.select(".area-selection").attr("opacity",e||0)},e.prototype.draw=function(){this.drawChart()},e}(i.BaseChart),i.AreaChart=n}(Ranet||(Ranet={})),function(e){var t,f,i;t=e.Controls||(e.Controls={}),f=t.Extensions||(t.Extensions={}),i=function(m){function e(e,t,i,n,o,r,a,s,l,c,u){m.call(this,e,t,i,n,o,r,a,s,u),this._maxBarWidth=f.ChartConf.maxBarWidth,this._barCount=l,this._index=c;var p=e.node().parentNode.parentNode,h=this._swapped?d3.select(p).select(".y-axis .domain").node():d3.select(p).select(".x-axis .domain").node();if(h){var d=this._swapped?h.getBoundingClientRect().height:h.getBoundingClientRect().width;d/((this._uniqueArgs.length+1)*this._barCount)<this._maxBarWidth&&(this._maxBarWidth=d/((this._uniqueArgs.length+1)*this._barCount),this._maxBarWidth-=1)}}return __extends(e,m),e.prototype.drawChart=function(){var i=this,t=this._maxBarWidth,n=this._maxBarWidth*this._barCount;this._coords=this._data;var e=this._content.append("g"),o=this;e.selectAll("rect").data(this._coords).enter().append("rect").attr("x",function(e){return console.log(e.value),i._swapped?e.x:e.x-n/2+t*i._index}).attr("y",function(e){return i._swapped?e.y-n/2+t*i._index:5<=e.height?e.y:e.y-(0<e.value?5-e.height:0)}).attr("width",function(e){return i._swapped?5<=e.height?e.height:0===e.height?0:5:t}).attr("height",function(e){return i._swapped?t:5<=e.height?e.height:0===e.height?0:5}).attr("fill",function(e){return e.color||i._color}).on("click",function(e,t){var i=d3.event;o._onClick.trigger({d:e,i:t,context:this,event:d3.mouse}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;o._onContextMenu.trigger({d:e,i:t,context:this,event:d3.mouse}),i.preventDefault()}),this._content.append("g").attr("class","bar-selection").selectAll("rect").data(this._coords).enter().append("rect").attr("x",function(e){return i._swapped?e.x:e.x-n/2+t*i._index}).attr("y",function(e){return i._swapped?e.y-n/2+t*i._index:5<=e.height?e.y:e.y-(0<e.value?5-e.height:0)}).attr("width",function(e){return i._swapped?5<=e.height?e.height:0===e.height?0:5:t}).attr("height",function(e){return i._swapped?t:5<=e.height?e.height:0===e.height?0:5}).attr("fill","black").on("click",function(e,t){var i=d3.event;o._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;o._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(e){var t=e;i._coords[0].name===t.detail.name&&i.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(e){var t=e;i._coords[0].name===t.detail.name&&i.setSelectionOpacity(0)})},e.prototype.setSelectionOpacity=function(e){this._content.select(".bar-selection").attr("opacity",e||0)},e.prototype.draw=function(){this.drawChart()},e}(f.BaseChart),f.BarChart=i}(Ranet||(Ranet={})),function(e){var t,a,i;t=e.Controls||(e.Controls={}),a=t.Extensions||(t.Extensions={}),i=function(){function e(e,t,i,n,o,r,a,s,l,c,u){this._xScale=t,this._yScale=i,this._data=n,this._content=e,this._uniqueArgs=o,this._numType=a,this._barIndex=0,this._barCount=s,this._index=0,this._series=r,this._color=d3.scale.category20(),this._stackedBars=l,this._stackedBarIndex=0,this._uniqueStackBars=[],this._swapped=u}return e.prototype.createChart=function(e,t,i){var n,o=this._index+i;switch(e){case a.ChartTypes.Line:return n=new a.LineChart(this._content.insert("g",".x-axis").attr("class","line"),this._xScale,this._yScale,this._data[o],this._uniqueArgs,this._series[o].color||this._color(o),this._series[o].label,this._numType),this._index++,n;case a.ChartTypes.Area:return n=new a.AreaChart(this._content.insert("g",".x-axis").attr("class","area"),this._xScale,this._yScale,this._data[o],this._uniqueArgs,this._series[o].color||this._color(o),this._series[o].label,this._numType,this._swapped),this._index++,n;case a.ChartTypes.Bar:return n=new a.BarChart(this._content.insert("g",".x-axis").attr("class","bar"),this._xScale,this._yScale,this._data[o],this._uniqueArgs,this._series[o].color||this._color(o),this._series[o].label,this._numType,this._barCount,this._barIndex++,this._swapped),this._index++,n;case a.ChartTypes.StackedBar:var r=t||"defaultBar";return this._uniqueStackBars.indexOf(r)<0?(this._stackedBarIndex=this._uniqueStackBars.length,this._uniqueStackBars.push(r)):this._stackedBarIndex=this._uniqueStackBars.indexOf(r),n=new a.StackedBarChart(this._content.insert("g",".x-axis").attr("class","stackedBar"),this._xScale,this._yScale,this._data[o],this._uniqueArgs,this._series[o].color||this._color(o),this._series[o].label,this._numType,this._stackedBars,this._stackedBarIndex,this._swapped),this._index++,n;case a.ChartTypes.StackedArea:return n=new a.StackedAreaChart(this._content.insert("g",".Stack"+(t||"defaultArea")).attr("class","Stack"+(t||"defaultArea")),this._xScale,this._yScale,this._data[o],this._uniqueArgs,this._series[o].color||this._color(o),this._series[o].label,this._numType),this._index++,n;default:throw Error("Wrong parameters")}},e}(),a.ChartFactory=i}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(l){function e(e,t,i,n,o,r,a,s){l.call(this,e,t,i,n,o,r,a,s)}return __extends(e,l),e.prototype.drawChart=function(){var i=this;this._coords=this._data;var n=this,e=d3.svg.line().x(function(e,t){return i._coords[t].x}).y(function(e,t){return i._coords[t].y});this._content.append("g").attr("class","line").append("path").datum(this._coords).attr("d",e).attr("stroke",this._color).attr("fill","none").attr("stroke-width","2"),this._content.append("g").attr("class","points").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill",function(e){return e.color}).on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()});var t=this._content.append("g").attr("class","line-selection");t.append("path").datum(this._coords).attr("d",e).attr("stroke","black").attr("fill","none").attr("stroke-width","2"),t.append("g").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill","black").on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(e){var t=e;i._coords[0].name===t.detail.name&&i.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(e){var t=e;i._coords[0].name===t.detail.name&&i.setSelectionOpacity(0)})},e.prototype.setSelectionOpacity=function(e){this._content.select(".line-selection").attr("opacity",e||0)},e.prototype.draw=function(){this.drawChart()},e}(i.BaseChart),i.LineChart=n}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(l){function e(e,t,i,n,o,r,a,s){l.call(this,e,t,i,n,o,r,a,s)}return __extends(e,l),e.prototype.draw=function(){var e,i=this,n=this;this._coords=this._data;var t=this._content.node();t.classList?t.classList.add("stackedArea"):t.className+=" stackedArea",e=document.querySelector(".stackedLine")?this._content.insert("g",".stackedLine").attr("class","stackedLine"):this._content.append("g").attr("class","stackedLine");var o=d3.svg.area().x(function(e,t){return i._coords[t].x}).y0(this._yScale(0)).y1(function(e,t){return i._coords[t].y});e.append("path").datum(this._coords).attr("d",o).attr("fill",this._coords[0].color),this._content.append("g").attr("class","points").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill",function(e){return e.color}).on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()});var r=this._content.append("g").attr("class","stackedArea-selection");r.append("path").datum(this._coords).attr("d",o).attr("fill","black"),r.append("g").selectAll("point").data(this._coords).enter().append("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",3).attr("fill","black").on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(e){var t=e;i._coords[0].name===t.detail.name&&i.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(e){var t=e;i._coords[0].name===t.detail.name&&i.setSelectionOpacity(0)})},e.prototype.setSelectionOpacity=function(e){this._content.select(".stackedArea-selection").attr("opacity",e||0)},e}(i.BaseChart),i.StackedAreaChart=n}(Ranet||(Ranet={})),function(e){var t,m,i;t=e.Controls||(e.Controls={}),m=t.Extensions||(t.Extensions={}),i=function(d){function e(e,t,i,n,o,r,a,s,l,c,u){d.call(this,e,t,i,n,o,r,a,s,u);var p=e.node().parentNode.parentNode,h=this._swapped?d3.select(p).select(".y-axis .domain").node():d3.select(p).select(".x-axis .domain").node();h&&(this._chartWidth=this._swapped?h.getBoundingClientRect().height:h.getBoundingClientRect().width),this._maxBarWidth=m.ChartConf.maxBarWidth,this._count=l,this._index=c,this._chartWidth/((o.length+1)*this._count)<this._maxBarWidth&&(this._maxBarWidth=this._chartWidth/((o.length+1)*this._count))}return __extends(e,d),e.prototype.drawChart=function(){var i=this,n=this,t=this._maxBarWidth;this._coords=this._data;var o=this._count*t;this._content.append("g").attr("class","bars").selectAll("rect").data(this._coords).enter().append("rect").attr("x",function(e){return i._swapped?e.x:e.x-o/2+t*i._index}).attr("y",function(e){return i._swapped?e.y-o/2+t*i._index:e.y}).attr("width",function(e){return i._swapped?e.height:t}).attr("height",function(e){return i._swapped?t:e.height}).attr("fill",function(e){return e.color}).on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}),this._content.append("g").attr("class","stackedBar-selection").selectAll("rect").data(this._coords).enter().append("rect").attr("x",function(e){return i._swapped?e.x:e.x-o/2+t*i._index}).attr("y",function(e){return i._swapped?e.y-o/2+t*i._index:e.y}).attr("width",function(e){return i._swapped?e.height:t}).attr("height",function(e){return i._swapped?t:e.height}).attr("fill","black").on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}),this.setSelectionOpacity(0),this._content.node().addEventListener("mouseEnterChartLegend",function(e){var t=e;i._coords[0].name===t.detail.name&&i.setSelectionOpacity(.4)}),this._content.node().addEventListener("mouseLeaveChartLegend",function(e){var t=e;i._coords[0].name===t.detail.name&&i.setSelectionOpacity(0)})},e.prototype.setSelectionOpacity=function(e){this._content.select(".stackedBar-selection").attr("opacity",e||0)},e.prototype.draw=function(){this.drawChart()},e}(m.BaseChart),m.StackedBarChart=i}(Ranet||(Ranet={})),function(e){var t,i,n,o,r;r=e.Controls||(e.Controls={}),t=r.Extensions||(r.Extensions={}),(i=t.ChartTypes||(t.ChartTypes={}))[i.Line=0]="Line",i[i.Area=1]="Area",i[i.Bar=2]="Bar",i[i.StackedArea=3]="StackedArea",i[i.StackedBar=4]="StackedBar",t.ChartTypes,(n=t.LegendPosition||(t.LegendPosition={}))[n.Top=0]="Top",n[n.Bottom=1]="Bottom",n[n.Left=2]="Left",n[n.Right=3]="Right",n[n.None=4]="None",t.LegendPosition,(o=t.DataType||(t.DataType={}))[o.Number=0]="Number",o[o.Percentage=1]="Percentage",t.DataType}(Ranet||(Ranet={})),function(h){var s,l,c={header:{title:{text:"",fontSize:24,font:"open sans"}},size:{canvasHeight:400,canvasWidth:400,pieInnerRadius:"0%",pieOuterRadius:"70%"},data:{content:[]},labels:{outer:{format:"value-percentage1",pieDistance:32},inner:{format:"value",hideWhenLessThanPercentage:3},mainLabel:{color:"#fff",fontSize:11},percentage:{color:"#fff",fontSize:9,decimalPlaces:0},value:{color:"#fff",fontSize:11},lines:{enabled:!0},truncation:{enabled:!0}},tooltips:{enabled:!0,type:"placeholder",string:"{label}: {value}",styles:{backgroundColor:"#ffffff",backgroundOpacity:1,color:"#000000",fontSize:13,padding:5}},effects:{load:{effect:"none"},pullOutSegmentOnClick:{effect:"linear",speed:400,size:8}},legend:{visible:!0,position:Ranet.Controls.Extensions.LegendPosition.Top},dataSource:[],minHeight:200};h.ranetPie=function(i,t){var n,e,o=this,r=c,a=this;a.settings=h.extend(!0,{},r),this.redraw=function(){n&&n.redraw()},this.resize=function(){clearTimeout(e),n&&(e=setTimeout(function(){n.redraw()},50))},this.error=function(e){},this.clearError=function(){},this.options=function(e){if(!e)return o.settings;if(e.extensionType===Ranet.Controls.Extensions.ExtensionTypes.Chart)n&&n.clear(),s=e.useMultipleCharts?new h.ranetMultipleControl(l,e):new h.ranetChart(i,e),h(l).css("overflow-y","hidden"),h(l).data("ranetChart",s),s.visible=!0,s.redraw();else{e.pie&&(e=e.pie);var t=h.extend({},o.settings,e);n.options=t,o.settings=n.options}},this.option=function(e,t){switch(e){case"dataSource":if(!t)return o.settings.dataSource;o.settings.dataSource=t[0],n.clear(),a.settings.specifiedSeries&&(o.settings.specifiedSeria=a.settings.specifiedSeries[0]),n=new Ranet.Controls.Extensions.Pie(l,o.settings),o.settings=n.options;break;case"seriesOptions":if(!t)return o.settings.specifiedSeries;o.settings.specifiedSeries=t}};this.destroy=function(){},this.visibility=function(e){e},this.isDrawn=function(){return!!n&&!h(n.element).is(":empty")},this.element=function(){return n?n.element:i},this._type=Ranet.Controls.Extensions.ExtensionTypes.Pie,function(){h(l).css("overflow-y","auto");var e=h.extend(!0,a.settings,t);a.settings.specifiedSeries&&(e.specifiedSeria=a.settings.specifiedSeries[0]),void 0!==e.specifiedSeria.index&&(e.dataSource=e.dataSource[e.specifiedSeria.index]||[]),n=new Ranet.Controls.Extensions.Pie(i,e)}()},h.ranetChart=function(i,e){var n,o=this,r={options:null,control:null},t={dataSource:[],seriesOptions:[],legend:{visible:!0,position:Ranet.Controls.Extensions.LegendPosition.Top},tooltip:{enabled:!0,font:{family:"Courier New"}},styling:{paddingLeft:10,paddingRight:0,paddingTop:10,paddingBottom:25},showArgumentLabels:!0,swapAxes:!1};r.options=h.extend(!0,{},t),this.redraw=this.resize=function(){r.control&&(n?r.control.redraw():r.control.clear())},this.option=function(e,t){if(void 0===t)return r.options[e];"object"==typeof t?"dataSource"===e||"seriesOptions"===e||"showArgumentLabels"===e?r.options[e]=t:h.extend(!0,t,r.options[e]):r.options[e]=t,"dataSource"===e&&t[0]&&(r.control?r.control.options=r.options:r.control=new Ranet.Controls.Extensions.ChartCtrl(i,r.options))},this.error=function(e){r.control||(r.control=new Ranet.Controls.Extensions.ChartCtrl(i,r.options),r.options=r.control.options),r.control.clear(),r.control.throwError(e)},this.clearError=function(){r.control&&r.control.clearError()},this.options=function(e){if(!e){if(r.control){var t=r.options.seriesOptions;r.options=r.control.options,r.options.seriesOptions=t}return r.options}var i;e.extensionType===Ranet.Controls.Extensions.ExtensionTypes.Pie&&(e.useMultipleCharts=!0),e.useMultipleCharts?(n=!1,o.redraw(),s=new h.ranetMultipleControl(l,e),h(l).data("ranetChart",s),s.redraw()):((i=r.control?r.control.options:r.options).tooltip=h.extend(i.tooltip,e.tooltip),i.legend=h.extend(i.legend,e.legend),i.styling=h.extend(i.styling,e.styling),i.dataSource=e.dataSource,i.seriesOptions=e.seriesOptions,i.showArgumentLabels=e.showArgumentLabels,i.onContextCallback=e.onContextCallback,r.control?r.control.options=i:r.options=i)};this.destroy=function(){},this._type=Ranet.Controls.Extensions.ExtensionTypes.Chart,this.visibility=function(e){n=e,o.redraw()},this.isDrawn=function(){return!!r.control&&!h(r.control.element).is(":empty")},this.element=function(){return r.control?r.control.element:i},h(l).css("overflow-y","hidden"),r.options.useMultipleCharts&&console.error("Multiple charts!"),r.options=h.extend(!0,r.options,e),r.options.dataSource&&r.options.dataSource[0]&&(r.control=new Ranet.Controls.Extensions.ChartCtrl(i,r.options)),n=!0},h.ranetMultipleControl=function(c,e){var u=this,p={chartOptions:null,chartDataSource:[],pieOptions:null,pieDataSource:[],series:[],controls:[]},t=function(){p.controls=[],h(c).empty()};this.error=function(e){t(),u._error=h("<div class='alert alert-warning fade in'/>").text(e),h(c).append(u._error)},this.clearError=function(){u._error&&u._error.remove()};var i=function(){if(p.chartOptions&&p.pieOptions){var e=h.extend(!0,{},p.chartOptions),t=h.extend(!0,{},p.pieOptions);if(p.chartOptions.useMultipleCharts){for(var i=0;i<p.series.length;i++){var n=Math.floor(100/(e.multipleColumns||1))+"%",o="calc("+Math.floor(100/(e.multipleRows||1))+"% - 1px)",r=h("<div />").addClass("Chart_Container").css("width",n).css("height",o);if(h(c).append(r),5!==p.series[i].chartType){var a=h.extend(!0,{},e);(a=h.extend(!0,a,p.series[i].options)).seriesOptions=[p.series[i]],a.useMultipleCharts=!1,a.dataSource=p.chartDataSource;var s=new h.ranetChart(r.get(0),a)}else{var l=h.extend(!0,{},t);(l=h.extend(!0,l,p.series[i].options)).dataSource=h.extend(!0,[],p.pieDataSource),l.specifiedSeria={index:p.series[i].columnIndex,title:p.series[i].name};s=new h.ranetPie(r.get(0),l)}p.controls[i]=s}u.redrawCharts()}else{e.dataSource=p.chartDataSource,e.seriesOptions=p.series;r=h("<div />").addClass("Chart_Container").css("width","100%").css("height","100%");h(c).append(r),new h.ranetChart(r.get(0),e).redraw()}}};this.options=function(e){if(!e){var t=h.extend(!0,{},p.chartOptions);return t.pie=h.extend(!0,{},p.pieOptions),t.dataSource=h.extend(!0,{},p.chartDataSource),t.pie.dataSource=h.extend(!0,{},p.pieDataSource),p}e.extensionType===Ranet.Controls.Extensions.ExtensionTypes.Pie&&(e.useMultipleCharts=!0),e.pieDataSource&&(p.pieDataSource=h.extend(!0,[],e.pieDataSource)),e.chartDataSource&&(p.chartDataSource=h.extend(!0,[],e.chartDataSource)),e.pieOptions.legend.legendItems&&p.pieOptions.legend&&(p.pieOptions.legend.legendItems=null),p.chartOptions=h.extend(!0,p.chartOptions,e.chartOptions),p.pieOptions=h.extend(!0,p.pieOptions,e.pieOptions),p.series=h.extend(!0,[],e.series)},this.option=function(e,t){if(!t)return p[e]},this.redraw=function(){t(),i(),h(l).css("overflow-y","auto")},this.resize=function(){console.log("resize");for(var e=0;e<p.controls.length;e++)p.controls[e].resize()},this.redrawCharts=function(){for(var e=0;e<p.controls.length;e++)p.controls[e].redraw()};this.destroy=function(){},h(l).css("overflow-y","auto"),e.multipleColumns||(e.multipleColumns=1),e.multipleRows||(e.multipleRows=1),p.chartOptions=h.extend(!0,p.chartOptions,e.chartOptions),p.pieOptions=h.extend(!0,p.pieOptions,e.pieOptions),p.series=h.extend(!0,p.series,e.series),p.chartDataSource=h.extend(!0,p.chartDataSource,e.chartDataSource),p.pieDataSource=h.extend(!0,p.pieDataSource,e.pieDataSource),p.series&&i()},h.fn.ranetChart=function(e){return this.each(function(){null==h(this).data("ranetChart")&&(s=new h.ranetMultipleControl(this,e),h(this).data("ranetChart",s),l=this)})}}(jQuery),function(){var e=window;if("function"==typeof e.CustomEvent)return;function t(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}t.prototype=e.Event.prototype,e.CustomEvent=t}(),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(){function e(e,t,i,n){this._content=e,this._legendConf=t,this._legendItems=i,this._chartStyling=n,this._maxLegendItemLength=d3.max(this._legendItems,function(e){return e.name.length})}return e.prototype.create=function(){if(this._legendConf.visible){var i=this;this._content.selectAll("items").data(this._legendItems).enter().append("xhtml:span").html(function(e){if(e.show){var t="<span style='color:"+e.color+";font-size:18px;'>&#9632;</span> ";return t+=e.name}}).attr("class","legendItem").style("opacity",function(e){return e.visible?"1":"0.5"}).on("mouseenter",this._legendConf.onmouseenterevent||function(){}).on("mouseleave",this._legendConf.onmouseleaveevent||function(){}).on("click",function(e,t){i._legendConf.onclickevent(e,t),e.visible=!e.visible,d3.select(this).style("opacity",function(){return e.visible?"1":"0.5"})}),1===this._legendItems.length?this._content.style("overflow","hidden").style("text-overflow","ellipsis"):this._content.style("overflow-x","auto").style("text-overflow","initial")}},e.prototype.clear=function(){this._content.html("")},Object.defineProperty(e.prototype,"legendItems",{set:function(e){this._legendItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{set:function(e){this._legendConf.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"svgLegend",{get:function(){var e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.setAttribute("height",(15*(this._legendItems.length+1)).toString()),d3.select(e).selectAll("legendItems").data(this._legendItems).enter().append("g").html(function(e){return'<rect width="10" height="10" fill="'+e.color+'" x="0" y="10"></rect><text x="15" y="20" style="font-size: 12px;">'+e.name+"</text>"}).attr("transform",function(e,t){return"translate(10, "+15*t+")"}),e},enumerable:!0,configurable:!0}),e}(),i.Legend=n}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(){function e(){}return e.maxBarWidth=50,e.legendHeight=39,e}(),i.ChartConf=n}(Ranet||(Ranet={})),function(e){var u,h,t;u=e.Controls||(e.Controls={}),h=u.Extensions||(u.Extensions={}),t=function(){function e(e,t,i,n,o,r){this._onClick=new u.Events.LiteEvent,this._onContextMenu=new u.Events.LiteEvent,this._points=[];var a,s=0;for(this._stackedBars=[],this._uniqueStacks=[],this._swapped=r,a=0;a<t.length;a++)for(var l=0;l<t[a].length;l++)this._points.push(t[a][l]),void 0===this._stackedBars[t[a][l].stack]?(this._stackedBars[t[a][l].stack]=0,this._uniqueStacks.push(t[a][l].stack)):(this._stackedBars[t[a][l].stack]=s,s++);for(var c=this._stackedBarCount=0;c<this._uniqueStacks.length;c++)this._stackedBarCount+=this._stackedBars[this._uniqueStacks[c]];for(this._barCount=i,this._content=e,this._uniqueArgs=n,this._argPointMap=[],a=0;a<this._uniqueArgs.length;a++)this._argPointMap[this._uniqueArgs[a].uniqueName]=this.getSameArgumentPoints(this._uniqueArgs[a].uniqueName);this._conf=o}return Object.defineProperty(e.prototype,"onClick",{get:function(){return this._onClick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onContextMenu",{get:function(){return this._onContextMenu},enumerable:!0,configurable:!0}),e.prototype.draw=function(){var i=this;if(this._conf.enabled){var n=this,e=this._content.node(),t=this._swapped?d3.select(e).select(".y-axis .domain").node():d3.select(e).select(".x-axis .domain").node(),o=h.ChartConf.maxBarWidth,r=h.ChartConf.maxBarWidth;if(t){var a=this._swapped?t.getBoundingClientRect().height:t.getBoundingClientRect().width;a/((this._uniqueArgs.length+1)*this._barCount)<o&&(o=a/((this._uniqueArgs.length+1)*this._barCount),o-=1),a/(this._uniqueArgs.length+1)<r&&(r=(a-40)/((this._uniqueArgs.length+1)*this._uniqueStacks.length))}var s=o*this._barCount,l=this._content.append("g"),c=this,u=this._conf.font||{family:"Courier New"};if(!this._content.node().parentNode)return;var p=d3.select(this._content.node().parentNode).attr("id");this._tooltips=l.attr("class","dots").selectAll(".dot").data(this._points).enter().append("rect").attr("class","dotarea").attr("x",function(e){var t=this;if(t.points=c._argPointMap[e.uniqueArgumentName],t.point=e,t.backgroundColor="white",$(t).popover({container:"#"+p+" .popOvers",trigger:"hover",content:function(){return c._conf.point=t.point,c._conf.points=t.points,c._conf.customizeTooltip.call(t)||e.value.toString()},html:!0,placement:"auto top",template:'<div class="popover chartPopover" role="tooltip" style="; font-family: '+u.family+'"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.seriesType===h.ChartTypes.Bar){var i=c.getBarIndex(c._argPointMap[e.uniqueArgumentName],e);return c._swapped?e.x:e.x-s/2+o*i}return e.seriesType===h.ChartTypes.StackedBar?e.x-r/2:e.x-5}).attr("y",function(e){if(e.seriesType===h.ChartTypes.Bar||e.seriesType===h.ChartTypes.StackedBar){var t=c.getBarIndex(c._argPointMap[e.uniqueArgumentName],e);return i._swapped?e.y-s/2+o*t:5<=e.height?e.y:e.y-(0<e.value?5-e.height:0)}return e.y-5}).attr("height",function(e){return e.seriesType===h.ChartTypes.StackedBar||e.seriesType===h.ChartTypes.Bar?i._swapped?o:5<=e.height?e.height:0===e.height?0:5:10}).attr("width",function(e){return e.seriesType===h.ChartTypes.Bar?i._swapped?5<=e.height?e.height:0===e.height?0:5:o:e.seriesType===h.ChartTypes.StackedBar?r:10}).style("display",function(e){return!1===e.visible?"none":"initial"}).attr("opacity",0).attr("fill","black").on("mouseover",function(e){if(e.seriesType===h.ChartTypes.Bar||e.seriesType===h.ChartTypes.StackedBar)d3.select(this).attr("opacity",.3);else{var t=new CustomEvent("mouseEnterChartDot",{detail:{name:e.name,value:e.value},bubbles:!0,cancelable:!1}),i=document.querySelectorAll(".line");if(i[0])for(var n=0;n<i.length;n++)i[n].dispatchEvent(t);var o=document.querySelectorAll(".area");if(o[0])for(n=0;n<o.length;n++)o[n].dispatchEvent(t);var r=document.querySelectorAll(".stackedArea");if(r[0])for(n=0;n<r.length;n++)r[n].dispatchEvent(t)}}).on("mouseleave",function(e){e.seriesType!==h.ChartTypes.Bar&&e.seriesType!==h.ChartTypes.StackedBar||d3.select(this).attr("opacity",0)}).on("click",function(e,t){var i=d3.event;n._onClick.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()}).on("contextmenu",function(e,t){var i=d3.event;n._onContextMenu.trigger({d:e,i:t,context:this,event:i}),i.preventDefault()})}},e.prototype.remove=function(){d3.selectAll(".chartPopover").remove(),this._tooltips&&this._tooltips[0]&&d3.select(this._tooltips[0].parentNode).remove()},e.prototype.getSameArgumentPoints=function(e){for(var t=[],i=0;i<this._points.length;i++)this._points[i].uniqueArgumentName===e&&t.push(this._points[i]);return t},e.prototype.getBarIndex=function(e,t){var i=0,n=0;if(t.seriesType===h.ChartTypes.StackedBar)i=this._stackedBars[t.stack];else for(;e[n]!==t;)e[n].seriesType===t.seriesType&&i++,n++;return i},e}(),h.Tooltip=t}(Ranet||(Ranet={})),function(e){var t=function(){function e(){}return e.isMobileBrowser=function(){var e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)},e.isIE=function(){var e=navigator.userAgent.toLowerCase();return/msie/.test(e)||/trident/.test(e)||/edge/.test(e)},e.isTouchDevice=function(){return"ontouchstart"in document.documentElement},e}();e.ClientInformation=t}(Ranet||(Ranet={})),function(e){var t,c,i;t=e.Controls||(e.Controls={}),c=t.ContextMenu||(t.ContextMenu={}),i=function(){function l(e){this._currentSubMenu=null,this._parentContextMenuControl=null,this._options=e,this._options.$parentMenuItem&&(this._parentContextMenuControl=this._options.parentContextMenu),this._$container=void 0===this._options.$container?$("body"):this._options.$container}return Object.defineProperty(l.prototype,"parentContextMenuControl",{get:function(){return this._parentContextMenuControl},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"$parentMenuItem",{get:function(){return this._options.$parentMenuItem},enumerable:!0,configurable:!0}),l.prototype.show=function(){this._$contextMenuLayout=this.createContextMenu(this._options),this._$container.append(this._$contextMenuLayout);var e=this._$contextMenuLayout.find("ul"),t=this.getPositionMenu(this._options.position,e.height(),e.width());this._$contextMenuLayout.css("left",t.left+"px"),this._$contextMenuLayout.css("top",t.top+"px");var i=this;$("body").mousedown(function(e){0<$(e.target).closest(".ranetContextMenu").length||i.hide()})},l.prototype.getPositionMenu=function(e,t,i){for(var n=e.left,o=e.top;$(window).width()<n+i;)n-=20;for(;$(window).height()<=o+t;)o-=20;return{top:o-5,left:n-5}},l.prototype.createContextMenu=function(r){for(var a=this,e=$("<div class='ranetContextMenu'/>"),s=$('<ul class="dropdown-menu" role="menu" style=\'display:block;\'/>'),t=function(e){var t=r.dataSource[e],o=$("<li/>");if(void 0===t.children||0===t.children.length){var i=$("<a style='cursor:default'>"+t.text+"</a>");o.on("mousedown",t,function(e){var t=e.data;t.disabled&&e.preventDefault(),t.onMenuItemClick&&t.onMenuItemClick({}),a.hide(),a.hideParents()}),t.checked&&o.addClass("active"),o.append(i)}else{var n=$("<div class='ranetContextMenu-menuItemWithChildren'/>");n.append('<span style="cursor:default">'+t.text+"</span>"),n.append('<i class="fa fa-caret-right" style="float: right; margin-top:2px;"></i>'),o.append(n),o.mouseenter({items:t.children},function(e){if(null===a._currentSubMenu||a._currentSubMenu.$parentMenuItem!==o){var t=o.offset(),i=o.width(),n=new c.ContextMenuOptions;n.parentContextMenu=a,n.$parentMenuItem=o,n.dataSource=e.data.items,n.$container=a._$container,n.position=new c.PositionDescription,n.position.top=t.top,n.position.left=t.left+i,(a._currentSubMenu=new l(n)).show()}})}o.mouseenter(function(){null!==a._currentSubMenu&&a._currentSubMenu.$parentMenuItem!==o&&(a._currentSubMenu.hide(),a._currentSubMenu=null)}),t.disabled&&o.addClass("disabled"),s.append(o),t.afterInsertSeparator&&s.append('<li class="divider ranetContextMenu-divider"></li>')},i=0;i<r.dataSource.length;i++)t(i);return e.append(s),e},l.prototype.hide=function(){this._$contextMenuLayout.remove(),null!==this._currentSubMenu&&this._currentSubMenu.hide()},l.prototype.hideParents=function(){this.parentContextMenuControl&&(this.parentContextMenuControl.hide(),this.parentContextMenuControl.hideParents())},l}(),c.ContextMenuControl=i}(Ranet||(Ranet={})),function(i){i.ranetContextMenu=function(e,t){var i,n=this;n.settings={},n.init=function(){i=new Ranet.Controls.ContextMenu.ContextMenuControl(t)},n.destroy=function(){},n.show=function(){i.show()},n.option=function(e){e.hasOwnProperty("visible"),e.hasOwnProperty("message")},n.init()},i.fn.ranetContextMenu=function(t){return this.each(function(){var e=new i.ranetContextMenu(this,t);i(this).data("ranetContextMenu",e)})}}(jQuery),function(e){var t;(function(e){var t=function(){this.afterInsertSeparator=!1,this.checked=!1,this.children=new Array};e.ContextMenuItemOptions=t;var i=function(){};e.PositionDescription=i;var n=function(){this.dataSource=new Array,this.position=new i};e.ContextMenuOptions=n})((t=e.Controls||(e.Controls={})).ContextMenu||(t.ContextMenu={}))}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Events||(t.Events={}),n=function(){function e(){this._handlers=[]}return e.prototype.on=function(e){this._handlers.push(e)},e.prototype.off=function(t){this._handlers=this._handlers.filter(function(e){return e!==t})},e.prototype.trigger=function(t){this._handlers.slice(0).forEach(function(e){return e(t)})},e}(),i.LiteEvent=n}(Ranet||(Ranet={})),function(t){var e,i;e=t.Controls||(t.Controls={}),i=function(){function e(){this._onSelectionChanged=new t.Controls.Events.LiteEvent}return Object.defineProperty(e.prototype,"itemSource",{get:function(){return this._itemSource},set:function(e){this._itemSource=e,this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayPropertyExpr",{get:function(){return this._displayPropertyExpr},set:function(e){this._displayPropertyExpr=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageCssClassExp",{get:function(){return this._imageCssClassExpr},set:function(e){this._imageCssClassExpr=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedExpr",{get:function(){return this._selectedExpr},set:function(e){this._selectedExpr=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItem",{get:function(){var t=this;if(!this.selectedExpr||!this.itemSource)return null;var e=this.itemSource.filter(function(e){return!0===e[t.selectedExpr]});if(0===e.length)return null;if(1<e.length)throw new Error("InvalidOperationException");return e[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._$view||(this._$view=this.getView(),this.itemSource&&this.updateData()),this._$view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionChanged",{get:function(){return this._onSelectionChanged},enumerable:!0,configurable:!0}),e.prototype.getView=function(){var e=$("<div/>");e.addClass("dropdown btn-group dropDownControl default-dropdown");var t=this.getSelectedItemButton();return this._$imagePanelSelectedButton=t.$imagePanel,this._$textPanelSelectedButton=t.$textPanel,e.append(t.$button),e.append('<button type="button" class="btn btn-default dropdown-toggle caret-btn dropDownControl-caretButton" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></button>'),this._$listControl=this.getItems(),e.append(this._$listControl),e},e.prototype.getItems=function(){return $('<ul class="dropdown-menu"/>')},e.prototype.updateData=function(){if(this._$view){var t=this;this._$textPanelSelectedButton.empty(),this._$listControl.empty(),this._$imagePanelSelectedButton.removeClass(),this.imageCssClassExp&&this.selectedItem&&(this._$imagePanelSelectedButton.addClass("dropDownControl-imagePanel"),this._$imagePanelSelectedButton.addClass(this.selectedItem[this.imageCssClassExp])),this.displayPropertyExpr&&this.selectedItem&&this._$textPanelSelectedButton.append(this.selectedItem[this.displayPropertyExpr]);for(var e=0;e<this.itemSource.length;e++){var i=this.itemSource[e],n=$("<li/>"),o=$("<a/>");i===this.selectedItem&&(n.addClass("active"),this._$selectedElement=n);var r=$("<div/>");this.imageCssClassExp&&(r.addClass("dropDownControl-imagePanel"),r.addClass(i[this.imageCssClassExp]),o.append(r));var a=$("<span/>");a.append(i[this.displayPropertyExpr]),o.append(a),n.append(o),n.click({data:i,$visualElement:n},function(e){t.changeSelectedItem(e.data.$visualElement,e.data.data)}),this._$listControl.append(n)}this.selectedItem&&this.changeSelectedItem(this._$selectedElement,this.selectedItem)}},e.prototype.changeSelectedItem=function(e,t){this._$selectedElement&&this._$selectedElement.removeClass("active"),e.addClass("active"),this._$selectedElement=e,this._$textPanelSelectedButton.text(t[this.displayPropertyExpr]),this.imageCssClassExp&&this.updateImageClass(t[this.imageCssClassExp]),this.selectedExpr&&(this.selectedItem&&delete this.selectedItem[this.selectedExpr],t[this.selectedExpr]=!0),this._onSelectionChanged.trigger(t)},e.prototype.updateImageClass=function(e){var t=this._$imagePanelSelectedButton.attr("class");if(!t)return this._$imagePanelSelectedButton.addClass("dropDownControl-imagePanel"),void this._$imagePanelSelectedButton.addClass(e);for(var i=t.split(/\s+/),n=0;n<i.length;n++)"dropDownControl-imagePanel"!==i[n]&&(this._$imagePanelSelectedButton.removeClass(i[n]),this._$imagePanelSelectedButton.addClass(e))},e.prototype.getSelectedItemButton=function(){var e=$('<button class="btn btn-default dropdown-toggle btn-toggle-withcarret dropDownControl-contentButton" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"></button>'),t=$("<div/>");e.append(t);var i=$("<span/>");return i.append("&nbsp;"),e.append(i),{$button:e,$imagePanel:t,$textPanel:i}},e}(),e.DropDownControl=i}(Ranet||(Ranet={})),function(s){var e,i,t;e=s.Controls||(s.Controls={}),i=e.Windows||(e.Windows={}),t=function(){function t(e){this._isInit=!1,this._options=e,this._taskGetTemplateWindow=t.getTemplateWindow(s.PathManager.templatesPath),this._isEnabledOkButton=e.isEnabledOkButton}return Object.defineProperty(t.prototype,"isEnabledOkButton",{get:function(){return this._isEnabledOkButton},set:function(e){this._isEnabledOkButton=e,this._templateDescription&&(this._templateDescription.$okButton.removeClass("disabled"),!1===this.isEnabledOkButton&&this._templateDescription.$okButton.addClass("disabled"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisibleCancelButton",{get:function(){return this._options.isVisibleCancelButton},enumerable:!0,configurable:!0}),t.prototype.show=function(){var t=this;!1===this._isInit?this._taskGetTemplateWindow.done(function(e){t._templateDescription=e,t.init(),t.showWindow()}).fail(function(e){s.LogService.error(e),s.UserMessageService.showServerError(e)}):this.showWindow()},t.prototype.showWindow=function(){var e=this,t=this;this._templateDescription.$window.modal("show").appendTo(this._options.container),this._options.draggableWindow&&this._templateDescription.$window.on("shown.bs.modal",function(){t._templateDescription.$window.find(".modal-dialog").draggable({handle:".modal-header"})}),this._templateDescription.$window.on("hidden.bs.modal",function(){e._options.draggableWindow&&e._templateDescription.$window.find(".modal-dialog").draggable("destroy"),e._templateDescription.$window.remove()}),this._options.resizable&&this.enableResizable()},t.prototype.enableResizable=function(){this._templateDescription.$window.find(".modal-content").resizable({minWidth:550,minHeight:300}),this._templateDescription.$window.find(".modal-body").addClass("modal-body-resizable")},t.prototype.init=function(){this._templateDescription.$title.append(this._options.title),this._templateDescription.$content.append(this._options.content);var e=this._templateDescription.$window.find(".modal-dialog");this._options.size===i.WindowSize.Large?e.addClass("modal-lg"):this._options.size===i.WindowSize.Small&&e.addClass("modal-sm"),!1===this.isEnabledOkButton&&this._templateDescription.$okButton.addClass("disabled"),!1===this.isVisibleCancelButton&&this._templateDescription.$cancelButton.hide();var t=this;this._templateDescription.$okButton.on("click",function(e){t._options.onClosed&&t._options.onClosed(t,new i.DialogResultArgs(!0))}),this._templateDescription.$cancelButton.on("click",function(e){t._options.onClosed&&t._options.onClosed(t,new i.DialogResultArgs(!1))}),this._templateDescription.$cancelButton.on("click",function(e){})},t.getTemplateWindow=function(e){var a=$.Deferred();return $.ajax({url:e+"floatingWindow.html"}).done(function(e){var t=$(s.Localization.localizeTemplate(e)),i=t.find(".windowTitle"),n=t.find(".modal-body"),o=t.find("#btnOk"),r=t.find("#btnCancel");a.resolve({$window:t,$okButton:o,$cancelButton:r,$title:i,$content:n})}).fail(function(e){a.reject(e)}),a},t}(),i.FloatingWindow=t}(Ranet||(Ranet={})),function(e){var t;(function(e){var t;(t=e.WindowSize||(e.WindowSize={}))[t.Large=0]="Large",t[t.Small=1]="Small",t[t.Medium=2]="Medium";var i=e.WindowSize,n=function(){function e(e){this._dialogResult=null,this._dialogResult=e}return Object.defineProperty(e.prototype,"dialogResult",{get:function(){return this._dialogResult},enumerable:!0,configurable:!0}),e}();e.DialogResultArgs=n;var o=function(){this.draggableWindow=!0,this.size=i.Medium,this.isEnabledOkButton=!0,this.isVisibleCancelButton=!0};e.FloatingWindowOptions=o})((t=e.Controls||(e.Controls={})).Windows||(t.Windows={}))}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){function e(e,t){this._options=t,this.init(e)}return Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){this._message=e,this._$messageElement.empty(),this._$messageElement.append(this._message),this.updateState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._visible?(this._$loadPanel.removeClass("loadPanel-state-invisible"),this.updateState()):this._$loadPanel.addClass("loadPanel-state-invisible"))},enumerable:!0,configurable:!0}),e.prototype.updateState=function(){this._$frontEndPanel.removeClass("loadPanel_frontEndWithText"),this._$frontEndPanel.removeClass("loadPanel_frontEndWithoutText"),this.message?this._$frontEndPanel.addClass("loadPanel_frontEndWithText"):this._$frontEndPanel.addClass("loadPanel_frontEndWithoutText");var e=this.getOffsetFrontEnd(this._$frontEndPanel,this._options.position),t=this.getOffsetControl(this._options.position),i=this.getSize(this._options.position);this._$frontEndPanel.css("transform","translate("+e.left+","+e.top+")"),this._$loadPanel.css("transform","translate("+t.left+","+t.top+")"),this._$loadPanel.css("height",i.height),this._$loadPanel.css("width",i.width)},e.prototype.init=function(e){this._$loadPanel=$("<div/>"),this._$loadPanel.addClass("loadPanel_backstage"),this._$frontEndPanel=$("<div/>"),this._$frontEndPanel.addClass("loadPanel_frontEnd");var t=$("<div/>");t.addClass("loadPanel_frontEnd_content");var i=$("<i/>");i.addClass("fa fa-circle-o-notch fa-spin loadPanel_frontEnd_content_indicator");var n=$("<div/>");(this._$messageElement=n).addClass("loadPanel_frontEnd_content_text"),this._message=this._options.message,void 0!==this._options.message?n.append(this._options.message):n.append(""),t.append(i),t.append(n),this._$frontEndPanel.append(t),this._$loadPanel.append(this._$frontEndPanel),$(e).append(this._$loadPanel),void 0!==this._options.visible?this.visible=this._options.visible:this.visible=!1,$(window).resize(this,this.resizeWindow)},e.prototype.resizeWindow=function(e){var t=e.data,i=t.getOffsetFrontEnd(t._$frontEndPanel,t._options.position),n=t.getOffsetControl(t._options.position),o=t.getSize(t._options.position);t._$frontEndPanel.css("transform","translate("+i.left+","+i.top+")"),t._$loadPanel.css("transform","translate("+n.left+","+n.top+")"),t._$loadPanel.css("height",o.height),t._$loadPanel.css("width",o.width)},e.prototype.destroy=function(){$(window).off("resize",this.resizeWindow)},e.prototype.getSize=function(e){if(e.of===window)return{height:"100%",width:"100%"};if(e.of instanceof jQuery)return{height:e.of.outerHeight(),width:e.of.outerWidth()};throw new Error("NotImplementationException")},e.prototype.getOffsetControl=function(e){if(e.of===window)return{left:"0px",top:"0px"};if(e.of instanceof jQuery)return{left:e.of.offset().left+"px",top:e.of.offset().top+"px"};throw new Error("NotImplementationException")},e.prototype.getOffsetFrontEnd=function(e,t){var i=0,n=0;return t.of===window?(i=$(window).height(),n=$(window).width()):t.of instanceof jQuery&&(i=t.of.height(),n=t.of.width()),{left:n/2-e.outerWidth()/2+"px",top:i/2-e.outerHeight()/2+"px"}},e}(),t.LoadPanel=i}(Ranet||(Ranet={})),function(a){a.ranetLoadPanel=function(e,t){var i,n=this,o={message:"Loading...",visible:!1,position:{of:window}},r=this;r.settings={},r.init=function(){n.settings=a.extend({},o,t),i=new Ranet.Controls.LoadPanel(e,n.settings)},r.destroy=function(){i.destroy()},r.option=function(e){e.hasOwnProperty("visible")&&(i.visible=e.visible),e.hasOwnProperty("message")&&(i.message=e.message)},r.init()},a.fn.ranetLoadPanel=function(t){return this.each(function(){var e=new a.ranetLoadPanel(this,t);a(this).data("ranetLoadPanel",e)})}}(jQuery),function(n){var e=function(){function c(){}return Object.defineProperty(c,"isInit",{get:function(){return c._isInit},enumerable:!0,configurable:!0}),Object.defineProperty(c,"availableLocalizations",{get:function(){return this._availableLocalizations},enumerable:!0,configurable:!0}),Object.defineProperty(c,"complete",{get:function(){return this._complete},enumerable:!0,configurable:!0}),Object.defineProperty(c,"exists",{get:function(){return this._exists},enumerable:!0,configurable:!0}),c.init=function(e,t,r,i,a){var s=this;if(void 0===i&&(i="en"),void 0===a&&(a=!1),c._isInit)throw new Error("InvalidOperationException");var l=$.Deferred();return $.when($.ajax({url:e+"api/localization/getDictionary/"+("zh"===r?"zh-CN":"cs"===r?"cs-CZ":r)+"?fallbackLanguage="+i}),$.ajax({url:t+"vendors/cldrData/main/"+r+"/ca-gregorian.json"}),$.ajax({url:t+"vendors/cldrData/main/"+r+"/numbers.json"}),$.ajax({url:t+"vendors/cldrData/supplemental/likelySubtags.json"})).done(function(e,t,i,n){if(Globalize.load(t[0],n[0],i[0]),"False"===e[2].getResponseHeader("Localization-complete")&&(s._complete=!1),("False"===e[2].getResponseHeader("Localization-exists")||a)&&(s._exists=!1),0<=s.availableLocalizations.indexOf(r)){var o={};o[r]=e[0],Globalize.loadMessages(o)}c._locale=r,c._isInit=!0,l.resolve({messages:e})}).fail(function(e){n.LogService.error(e),l.reject(e)}),l},c.localizeTemplate=function(e){var t=e,i=Globalize(c._locale).cldr.get("globalize-messages")[c._locale],n=[];for(var o in i)i.hasOwnProperty(o)&&n.push(o);return n.sort(function(e,t){return t.length-e.length}),n.forEach(function(e){t=c.replaceAll(t,"@"+e,i[e])}),t},c.replaceAll=function(e,t,i){return e.replace(new RegExp(t,"g"),i)},c.localize=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return Globalize(c._locale).formatMessage(e,t)},c._isInit=!1,c._availableLocalizations=["en","ru","zh","be","de","es","fr","it","pl","pt","uk","cs"],c._complete=!0,c._exists=!0,c}();n.Localization=e}(Ranet||(Ranet={})),function(e){var t=function(){function e(){}return e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];e.forEach(function(e){console.log(e)})},e}();e.LogService=t}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Lookup||(t.Lookup={}),n=function(){function e(){}return e.prototype.filterTree=function(e,t,i){return e},e.prototype.filterList=function(e,t,i){if(0===i.length)return e;for(var n=new Array,o=0;o<e.length;o++){var r=e[o];-1!==r[t].toLowerCase().indexOf(i.toLowerCase())&&n.push(r)}return n},e}(),i.ContainsFilterController=n}(Ranet||(Ranet={})),function(e){var i;(function(o){var l,e;(e=l||(l={}))[e.Selected=0]="Selected",e[e.UnSelected=1]="UnSelected";var t=function(){function e(e){this._filterController=new o.ContainsFilterController,this._grouped=!1,this._multiSelection=!1,this._onSelectionChanged=new i.Events.LiteEvent,this.dataSource=e.dataSource,this._selectedItems=e.selectedItems,this._itemTemplate=e.getItemTemplate,this._headerGroupTemplate=e.headerGroupTemplate,this._messages=e.messages,this._displayExpr=e.displayExpr,this._grouped=e.grouped,this._groupExpr=e.groupExpr,this._multiSelection=e.multiSelection}return Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=e,this._onSelectionChanged.trigger(this._selectedItems)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSelectionChanged",{get:function(){return this._onSelectionChanged},enumerable:!0,configurable:!0}),e.prototype.getView=function(e){var t=new Array;t=void 0!==e?this._filterController.filterList(this._dataSource,this._displayExpr,e):this._dataSource;var i=$("<div/>");if(i.addClass("ranet-itemsPresenter"),t&&0<t.length){var n=void 0;n=!1===this._grouped?this.getPlainViewItems(t):this.getGroupsViewItems(t),i.append(n)}else{var o=$("<span>"+this._messages.noDataMessage+"</span>");o.addClass("ranet-noDataLabel"),i.append(o)}return i},e.prototype.onClickedItem=function(e,t){if(this._multiSelection)if(t===l.Selected)this._selectedItems.push(e);else{if(t!==l.UnSelected)throw new Error("InvalidOperationException");this._selectedItems.splice(this._selectedItems.indexOf(e),1)}else this._selectedItems=[e];this._onSelectionChanged.trigger(this._selectedItems)},e.prototype.getGroupsViewItems=function(e){for(var t=new Array,i={},n=0;n<e.length;n++){var o=e[n],r=o[this._groupExpr],a=this.getListItem(o,-1!==this._selectedItems.indexOf(o));i[r]?i[r].push(a):i[r]=new Array(a)}for(var s in i)if(i.hasOwnProperty(s)){var l=$("<div/>"),c=i[s],u=$("<div/>");u.append(c),l.append(this.getViewHeaderGroup(s,c)),l.append(u),t.push(l)}return t},e.prototype.getViewHeaderGroup=function(e,t){var i=$("<div/>"),n=void 0;return this._headerGroupTemplate&&(n=this._headerGroupTemplate(new o.HeaderGroupTemplateArgs(t,e))),i.addClass("ranet-headerGroup"),void 0!==n?i.append(n):i.append(e),i},e.prototype.getPlainViewItems=function(e){for(var t=new Array,i=0;i<e.length;i++){var n=e[i],o=this.getListItem(n,-1!==this._selectedItems.indexOf(n));t.push(o)}return t},e.prototype.getListItem=function(e,t){var i=this,n=$("<div/>");n.addClass("ranet-listItem");var o,r=$("<div/>");if(r.addClass("ranet-listItemContent"),this._multiSelection){var a=$("<div/>");a.addClass("ranet-checkBoxColumn"),(o=$("<div/>")).addClass("imageLibrary_check"),!1===t&&o.hide(),a.append(o),n.append(a),r.addClass("ranet-listItemContent_multiSelection")}var s=void 0;return void 0!==this._itemTemplate&&(s=this._itemTemplate(e)),s||(s=e[this._displayExpr]),r.append(s),n.append(r),n.on("click",e,function(e){var t=-1!==i._selectedItems.indexOf(e.data);i._multiSelection&&(t?(n.removeClass("ranet-listItem_selected"),o.hide()):(n.addClass("ranet-listItem_selected"),o.show())),i.onClickedItem(e.data,t?l.UnSelected:l.Selected)}),t&&n.addClass("ranet-listItem_selected"),n},e}();o.ListControl=t})((i=e.Controls||(e.Controls={})).Lookup||(i.Lookup={}))}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Lookup||(t.Lookup={}),n=function(){function e(e,t){this._control=e,this._isVisibleSearchPanel=t}return e.prototype.setFocus=function(){this._$searchBox&&this._$searchBox.focus()},e.prototype.getView=function(){var t=this,e=$("<div/>");e.addClass("ranet-lookupContent");var i=this.getContainer();if(this._isVisibleSearchPanel){var n=$("<div/>");n.addClass("ranet-lookupContent-searchPanel"),e.append(n);var o=this._$searchBox=$("<input/>");o.attr("spellcheck","false"),o.attr("autocomplete","off"),o.keyup(function(e){i.empty(),i.append(t._control.getView(o.val()))}),o.addClass("ranet-lookupContent-searchTextBox"),n.append(o)}return i.append(this._control.getView()),e.append(i),e},e.prototype.getContainer=function(){var e=$("<div/>");return e.addClass("ranet-listContainer"),this._isVisibleSearchPanel?e.addClass("ranet-listContainer_withSearchPanel"):e.addClass("ranet-listContainer_withoutSearchPanel"),e},e}(),i.PopupContentControl=n}(Ranet||(Ranet={})),function(e){var t,l,i;t=e.Controls||(e.Controls={}),l=t.Lookup||(t.Lookup={}),i=function(){function e(e,t){if(this._isInit=!1,this._dataSource=new Array,this._selectedItems=new Array,"undefined"==typeof jQuery)throw new Error("Lookup requires jQuery");this._$panel=$(e),this._options=t;var i=this;this._options.dataSource&&(this._dataSource=this._options.dataSource),this._options.selectedItems&&(this._selectedItems=this._options.selectedItems);var n=null;if(t instanceof l.ListLookupControlOptions)n=l.LookupType.List;else{if(!(t instanceof l.TreeLookupControlOptions))throw new Error("InvalidOperationException");n=l.LookupType.TreeView}if(n===l.LookupType.List){var o=t,r=this._currentControl=new l.ListControl(o);r.onSelectionChanged.on(function(e){i.onSelectionChanged(e)}),this._popupContent=new l.PopupContentControl(r,t.isVisibleSearchPanel),this._popup=new l.PopupControl(this._popupContent)}else{if(n!==l.LookupType.TreeView)throw new Error("InvalidOperationException");var a=t,s=this._currentControl=new l.TreeControl(a);s.onSelectionChanged.on(function(e){i.onSelectionChanged(e)}),this._popupContent=new l.PopupContentControl(s,t.isVisibleSearchPanel),this._popup=new l.PopupControl(this._popupContent)}this._popup.onClosedPopup.on(this.onClosedPopup.bind(this)),this._popup.onOpenedPopup.on(this.onOpenedPopup.bind(this))}return Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){if(!1===this._isInit)throw new Error("The lookup is not initialized");this._dataSource=e,this._currentControl.dataSource=this._dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){if(!1===this._isInit)throw new Error("The lookup is not initialized");this._selectedItems=e,this._currentControl.selectedItems=this._selectedItems,this.drawField(this._selectedItems)},enumerable:!0,configurable:!0}),e.prototype.onOpenedPopup=function(){this._options.onOpenedPopup&&this._options.onOpenedPopup()},e.prototype.onClosedPopup=function(){this._options.onClosedPopup&&this._options.onClosedPopup()},e.prototype.onSelectionChanged=function(e){this._selectedItems=e,this.drawField(e),this._options.onSelectionChanged&&this._options.onSelectionChanged(new l.SelectedItemsArgs(e)),this._popup.isVisible&&!1===this._options.multiSelection&&this._popup.close()},e.prototype.init=function(){if(this._isInit)throw new Error("Lookup has already been initialized");this._isInit=!0;var t=this;$(window).resize(function(){t._popup.isVisible&&t._popup.close()}),this.createLayout(),this._$rootLayout.on("click",function(e){t.onClickRootLayout(e)}),this._options.onInitialized&&this._options.onInitialized(),void 0!==this._options.selectedItems&&this.onSelectionChanged(this._options.selectedItems),this._$panel.append(this._$rootLayout)},e.prototype.drawField=function(e){if(this._$fieldLayout.empty(),this._$fieldLayout.removeClass("ranet-fieldLayoutLookup_noSelectedItems"),this._$fieldLayout.removeClass("ranet-customContentFieldLayoutLookup"),0<e.length){var t=void 0;this._options.fieldTemplate&&(t=this._options.fieldTemplate(new l.SelectedItemsArgs(e))),void 0===t?t=!1===this._options.multiSelection||this._options.multiSelection&&1===e.length?e[0][this._options.displayExpr]:e.length+this._options.messages.prefixMultiSelectionField:this._$fieldLayout.addClass("ranet-customContentFieldLayoutLookup"),this._$fieldLayout.append(t)}else{var i=$("<span>"+this._options.messages.placeholderMessage+"</span>");this._$fieldLayout.addClass("ranet-fieldLayoutLookup_noSelectedItems"),this._$fieldLayout.append(i)}},e.prototype.onClickRootLayout=function(e){var c=this;if(this._popup.isVisible)e.stopPropagation();else{var u=this;setTimeout(function(){var e=u._$rootLayout.offset(),t=c._options.getPopupContainer().offset(),i={left:e.left-t.left,top:e.top-t.top},n=u._$rootLayout.height(),o=u._$rootLayout.outerWidth(),r=u._options.widthPopup?u._options.widthPopup:u._$rootLayout.outerWidth()+"px",a=u._options.heightPopup?u._options.heightPopup:"200px",s=i.left,l=i.top+n+5;"left"===u._options.startPositionPopup?s=i.left:"right"===u._options.startPositionPopup&&(s=i.left+o-Number(r.replace("px",""))),u._popup.show(c._options.getPopupContainer(),s,l,r,a)},1)}},e.prototype.createLayout=function(){this._$rootLayout=$("<div/>"),this._$rootLayout.addClass("ranet-lookup-rootLayout"),this._$fieldLayout=$("<div/>"),this._$fieldLayout.addClass("ranet-fieldLayoutLookup"),this._$rootLayout.append(this._$fieldLayout);var e=$("<div/>");e.addClass("ranet-lookup-arrow");var t=$("<div/>");t.addClass("imageLibrary_downArrow"),e.append(t),this._$rootLayout.append(e)},e}(),l.LookupControl=i}(Ranet||(Ranet={})),function(e){var t;(function(e){var t;(t=e.LookupType||(e.LookupType={}))[t.List=0]="List",t[t.TreeView=1]="TreeView",e.LookupType;var i=function(){this.noDataMessage="No data to display",this.placeholderMessage="Select a value",this.prefixMultiSelectionField=" selected"};e.Messages=i;var n=function(e){this.selectedItems=e};e.SelectedItemsArgs=n;var o=function(e,t){this.itemsGroup=e,this.captionGroup=t};e.HeaderGroupTemplateArgs=o;var r=function(){this.messages=new i,this.isVisibleSearchPanel=!0,this.multiSelection=!1},a=function(e){function t(){e.apply(this,arguments),this.grouped=!1}return __extends(t,e),t}(e.LookupControlOptions=r);e.ListLookupControlOptions=a;var s=function(e){function t(){e.apply(this,arguments),this.hoverStateEnabled=!0}return __extends(t,e),t}(r);e.TreeLookupControlOptions=s})((t=e.Controls||(e.Controls={})).Lookup||(t.Lookup={}))}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Lookup||(t.Lookup={}),n=function(){function e(e){this._isVisible=!1,this._onOpenedPopup=new t.Events.LiteEvent,this._onClosedPopup=new t.Events.LiteEvent,this._popupContent=e}return Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._isVisible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onOpenedPopup",{get:function(){return this._onOpenedPopup},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onClosedPopup",{get:function(){return this._onClosedPopup},enumerable:!0,configurable:!0}),e.prototype.show=function(e,t,i,n,o){var r=this._$popupWindow=$("<div/>");r.addClass("ranet-lookup-popup"),r.append(this._popupContent.getView()),r.css("transform","translate("+t+"px,"+i+"px)"),r.css("width",n),r.css("height",o),r.on("click",function(e){e.stopPropagation()}),this._callbackClosePopup=this.close.bind(this),$("html").one("click",this._callbackClosePopup),null!=e?e.append(r):$("body").append(r),this._isVisible=!0,this._onOpenedPopup.trigger()},e.prototype.close=function(){this._isVisible=!1,$("html").off("click",this._callbackClosePopup),this._$popupWindow.off("click"),this._callbackClosePopup=null,this._$popupWindow.remove(),this._onClosedPopup.trigger()},e}(),i.PopupControl=n}(Ranet||(Ranet={})),function(e){var n,o,t;n=e.Controls||(e.Controls={}),o=n.Lookup||(n.Lookup={}),t=function(){function r(e){this._onSelectionChanged=new n.Events.LiteEvent,this._isRenderedNow=!1,this._filterController=new o.ContainsFilterController,this._options=e,this._$treePanel=$("<div style='height:100%;width:100%;'/>");var t=this,i=new n.TreeViewOptions;i.displayExpr=e.displayExpr,i.iconExpr=e.iconExpr,i.iconExpandedExpr=e.iconExpandedExpr,i.expandedExpr=e.expandedExpr,i.hasChildrenExpr=e.hasChildrenExpr,i.keyExpr=e.keyExpr,i.hoverStateEnabled=e.hoverStateEnabled,i.selectedExpr=e.selectedExpr,i.dataSource=e.dataSource,i.onItemSelected=function(e){t._isRenderedNow||(t.selectedItems=[e.data])},this._treeView=new n.TreeView(this._$treePanel.get(0),i)}return Object.defineProperty(r.prototype,"onSelectionChanged",{get:function(){return this._onSelectionChanged},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=e,this._onSelectionChanged.trigger(this._selectedItems)},enumerable:!0,configurable:!0}),r.prototype.getView=function(e){this._isRenderedNow=!0;var t=new Array;t=void 0!==e?this._filterController.filterTree(this._dataSource,this._options.displayExpr,e):this._dataSource,r.setSelectedItemInDataSource(t,this.selectedItems[0],this._options.selectedExpr),this._treeView.dataSource=t;var i=$("<div/>");if(i.addClass("ranet-itemsPresenter"),t&&0<t.length)i.append(this._$treePanel);else{var n=$("<span>"+this._options.messages.noDataMessage+"</span>");n.addClass("ranet-noDataLabel"),i.append(n)}var o=i.find(".treeView");return o&&o.css("border-width",0),this._isRenderedNow=!1,i},r.setSelectedItemInDataSource=function(e,t,i){for(var n=0;n<e.length;n++){var o=e[n];o[i]=!1,o===t&&(o[i]=!0),0<o.items.length&&r.setSelectedItemInDataSource(o.items,t,i)}},r}(),o.TreeControl=t}(Ranet||(Ranet={})),function(a){a.ranetActiveFilters=function(e,t){var i,n=this,o={},r=this;r.settings={},r.init=function(){n.settings=a.extend({},o,t),i=new Ranet.Controls.ActiveFilters.ActiveFiltersPanel(e,n.settings)},Object.defineProperty(r,"isEnabled",{get:function(){return i.isEnabled},set:function(e){i.isEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r,"isVisible",{get:function(){return i.isVisible},set:function(e){i.isVisible=e},enumerable:!0,configurable:!0}),Object.defineProperty(r,"descriptionActiveFilters",{get:function(){return i.descriptionActiveFilters},enumerable:!0,configurable:!0}),this.setLayout=function(e){i.layout=e},this.setCubeMetaData=function(e){i.mapIdToMetadataItem=e},r.option=function(e){},r.init()},a.fn.ranetActiveFilters=function(t){return this.each(function(){if(null==a(this).data("ranetActiveFilters")){var e=new a.ranetActiveFilters(this,t);a(this).data("ranetActiveFilters",e)}})}}(jQuery),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){this.isEnabled=!0},(t.ActiveFilters||(t.ActiveFilters={})).ActiveFiltersOptions=i}(Ranet||(Ranet={})),function(f){var g,a,e;g=f.Controls||(f.Controls={}),a=g.ActiveFilters||(g.ActiveFilters={}),e=function(){function r(e,t){this._isVisible=!1,this._isEnabled=!0,this._$parentPanel=$(e),this._listControl=r.createContentPanel(),this._options=t;var i=this._$activeFiltersPanel=$("<div/>");i.addClass("activeFiltersPanel-layout");var n=$('<div class="activeFiltersPanel-header"/>');n.append('<div class="imageLibrary_headerIcon activeFiltersPanel-icon"/>'),n.append('<span class="activeFiltersPanel-textHeader">'+f.Localization.localize("MdxDesigner_ActiveFilters")+"</span>"),this._dataManager=new a.DataManager(this._options.connection,this._options.cubeName),i.append(n);var o=$("<div/>");o.addClass("activeFiltersPanel-filtersContainer"),this._loadPanel=new g.LoadPanel(e,{visible:!1,position:{of:window},message:f.Localization.localize("LoadPanel_UpdateActiveFilters")}),o.append(this._listControl),i.append(o),this.isEnabled=this._options.isEnabled}return Object.defineProperty(r.prototype,"layout",{get:function(){return this._layout},set:function(e){this._layout=e,this.drawItems(),$.contains(this._$parentPanel.get(0),this._$activeFiltersPanel.get(0))||this._$parentPanel.append(this._$activeFiltersPanel)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible=e,this._isVisible?$.contains(this._$parentPanel.get(0),this._$activeFiltersPanel.get(0))?this._$parentPanel.show():this._$parentPanel.append(this._$activeFiltersPanel):this._$parentPanel.hide()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,this._isEnabled?this._$activeFiltersPanel.removeClass("activeFiltersPanel-disabledPanel"):this._$activeFiltersPanel.addClass("activeFiltersPanel-disabledPanel")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mapIdToMetadataItem",{get:function(){return this._mapIdToMetadataItem},set:function(e){this._mapIdToMetadataItem=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptionActiveFilters",{get:function(){return this._descriptionActiveFilters},enumerable:!0,configurable:!0}),r.createContentPanel=function(){return $("<ul class='activeFiltersPanel-filtersList'/>")},r.getFilterDescription=function(e,t){for(var i=new Array,n=0;n<e.length;n++){var o=e[n];if(o.filter&&o.filter.isUsed){var r=a.FilterParser.parse(o,t);i.push(r)}}return i},r.prototype.drawItems=function(){var t=this,i=new Array,n=new Array,o=new Array;this.layout.rows&&(i=r.getFilterDescription(this.layout.rows,this.mapIdToMetadataItem)),this.layout.columns&&(n=r.getFilterDescription(this.layout.columns,this.mapIdToMetadataItem)),this.layout.filters&&(o=r.getFilterDescription(this.layout.filters,this.mapIdToMetadataItem)),this._loadPanel.visible=!0,this._dataManager.getCaptions(i,n,o).done(function(e){t._listControl.empty(),t._descriptionActiveFilters=new Array,o&&t.drawDescriptionFilters(g.AreaType.Filters,o,e),i&&t.drawDescriptionFilters(g.AreaType.Rows,i,e),n&&t.drawDescriptionFilters(g.AreaType.Columns,n,e)}).then(function(){t._loadPanel.visible=!1})},r.prototype.onClickDeleteFilter=function(e,t){this._options.onDeleteFilter&&this._options.onDeleteFilter(e,t)},r.prototype.onClickShowFilterEdiror=function(e,t){this._options.onShowFilterEditor&&this._options.onShowFilterEditor(e,t)},r.prototype.drawDescriptionFilters=function(t,e,i){for(var n=this,o=0;o<e.length;o++){var r=e[o],a=r.template;for(var s in i)i.hasOwnProperty(s)&&(a=a.replace(s,i[s]));this._descriptionActiveFilters.push({key:r.caption,value:a});var l=void 0;switch(t){case g.AreaType.Filters:l="imageLibrary_filtersArea";break;case g.AreaType.Rows:l="imageLibrary_rowsArea";break;case g.AreaType.Columns:l="imageLibrary_columnsArea";break;default:throw new Error("InvalidOperationException")}var c=$('<li class="activeFiltersPanel-filterItem"/>'),u=$('<button type="button" class="btn btn-default btn-xs activeFiltersPanel-deleteFilterButton"><div class="imageLibrary_cancelFilter activeFiltersPanel-icon"/></button>'),p=$('<i class="'+l+' activeFiltersPanel-icon activeFiltersPanel-typeAreaIconFilterItem"/>'),h=$('<a class="activeFiltersPanel-contentFilterItem">'+r.caption+"</a>"),d=$('<span class="activeFiltersPanel-contentFilterItem">:&nbsp;</span>'),m=$('<a class="activeFiltersPanel-contentFilterItem">'+a+"</a>");m.attr("title",a),h.attr("title",a),u.attr("title",f.Localization.localize("MdxDesigner_ContextMenu_CancelFilter")),u.click({layoutItem:r.layoutItem},function(e){n.onClickDeleteFilter(t,e.data.layoutItem)}),h.click({layoutItem:r.layoutItem},function(e){n.onClickShowFilterEdiror(t,e.data.layoutItem)}),m.click({layoutItem:r.layoutItem},function(e){n.onClickShowFilterEdiror(t,e.data.layoutItem)}),c.append(u),c.append(p),c.append(h),c.append(d),c.append(m),this._listControl.append(c)}},r}(),a.ActiveFiltersPanel=e}(Ranet||(Ranet={})),function(s){var e,t,i;e=s.Controls||(s.Controls={}),t=e.ActiveFilters||(e.ActiveFilters={}),i=function(){function a(e,t){this._cache={},this._cubeName=t,this._connection=e}return a.prototype.getCaptions=function(e,t,i){var n=this,o=$.Deferred(),r=a.getQueryGettingUniqueNames(this._cubeName,e,t,i,this._cache);return r?$.ajax({type:"POST",url:s.PathManager.applicationUrl+"api/olap/getCaptionsActiveFilters",data:{connection:this._connection,mdxQuery:r},success:function(e){for(var t=0;t<e.length;t++)n._cache[e[t].Key]=e[t].Value;n._cache=a.sortCacheByLengthProp(n._cache),o.resolve(n._cache)},error:function(e){o.resolve(n._cache),s.LogService.error(e),s.UserMessageService.showError("Error. Getting caption for active filters. Please see log.")}}):o.resolve(n._cache),o},a.sortCacheByLengthProp=function(e){var t,i={},n=new Array;for(t in e)e.hasOwnProperty(t)&&n.push(t);n.sort(function(e,t){return t.length-e.length});for(var o=0;o<n.length;o++)i[t=n[o]]=e[t];return i},a.getQueryGettingUniqueNames=function(e,t,i,n,l){var o="SELECT {} ON 0, {} ON 1 ",r=2,c=new Array,u=!1,p={},a=function(e){for(var t=0;t<e.length;t++){for(var i=e[t],n=new Array,o=0;o<i.uniqueNames.length;o++){var r=i.uniqueNames[o];l[r]||n.push(r)}if(0<n.length&&(!1===p.hasOwnProperty(i.hierarchyUniqueName)?p[i.hierarchyUniqueName]=n.join(", "):p[i.hierarchyUniqueName]=p[i.hierarchyUniqueName]+", "+n.join(", "),u=!0),0<i.measureUniqueNames.length)for(var a=0;a<i.measureUniqueNames.length;a++){var s=i.measureUniqueNames[a];l[s]||(c.push(i.measureUniqueNames[a]),u=!0)}}};for(var s in a(t),a(i),a(n),p)p.hasOwnProperty(s)&&(o+=", {"+p[s]+"} ON "+r++);if(0<c.length&&(o+=", {"+c.join(", ")+"} ON "+r++),!1!==u)return o+=" FROM "+e},a}(),t.DataManager=i}(Ranet||(Ranet={})),function(C){var v;(function(e){var y=function(){function e(e){this.uniqueNames=new Array,this.measureUniqueNames=new Array,this._layoutItem=e}return Object.defineProperty(e.prototype,"caption",{get:function(){var e=this.layoutItem.caption;return void 0!==this.captionPrefixes&&(e=this.captionPrefixes.join(" - ")+" - "+e),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutItem",{get:function(){return this._layoutItem},enumerable:!0,configurable:!0}),e}();e.FilterDescription=y;var t=function(){function _(){}return _.parse=function(e,t){var i=null,n=null,o=null,r=e.filter;r.customFilter.isUsed&&(i=r.customFilter),r.membersFilter.isUsed&&(n=r.membersFilter.selectionNodes),r.smartCustomFilterDescription&&r.smartCustomFilterDescription.isUsed&&(o=v.SmartFilter.Options.SmartCustomFilterDescription.parse(JSON.stringify(r.smartCustomFilterDescription)));var a=_.parseFilters(e,i,o,n),s=_.getPrefixesCaption(e,t);return a.captionPrefixes=s,"hierarchy"===e.type&&(a.hierarchyUniqueName=e.uniqueName),"level"===e.type&&(a.hierarchyUniqueName=e.parentHierarchyId),a},_.getPrefixesCaption=function(e,t){var i=new Array,n=null,o=null;for(var r in t)if(t.hasOwnProperty(r)){var a=t[r];if("dimension"!==a.type){if("hierarchy"===a.type&&("hierarchy"===e.type&&a.uniqueName===e.uniqueName||"level"===e.type&&a.uniqueName===e.parentHierarchyId)&&(o=a,"hierarchy"===e.type))break;if("level"===a.type&&"level"===e.type&&e.uniqueName===a.uniqueName)break}else n=a}if("hierarchy"===e.type){if(null===n)throw new Error("InvalidOperationException");i.push(n.caption)}else{if("level"!==e.type)throw new Error("InvalidOperationException");if(null===n||null===o)throw new Error("InvalidOperationException");i.push(n.caption),i.push(o.caption)}return i},_.parseFilters=function(e,t,i,n){var o=new y(e);o.template=C.Localization.localize("All");var r=new Array,a=new Array,s=null;null!=n&&(s=_.parseMembers(n,r,!1));var l=null;if(null!==t)switch(t.currentDataFilter){case v.DataFilterType.LabelFilter:l=_.parseLabelFilter(t.labelFilter);break;case v.DataFilterType.TopFilter:l=_.parseTopFilter(t.topFilter),a.push(t.topFilter.measureUniqueName);break;case v.DataFilterType.ValueFilter:l=_.parseValueFilter(t.valueFilter),a.push(t.valueFilter.measureUniqueName);break;default:throw new Error("NotImplementedException")}if(null!==i&&i.isUsed)for(var c=0;c<i.filterTreeDescription.length;c++){var u=i.filterTreeDescription[c],p="",h="";p=null===u.level?C.Localization.localize("Filter_Label_HierarchyHasFilter"):C.Localization.localize("Filter_Label_LevelHasFilter",u.level.caption);var d=u.filters.filter(function(e){return e instanceof v.SmartFilter.Options.FilterGroupDescription}),m=u.filters.filter(function(e){return e instanceof v.SmartFilter.Options.TopDataFilter});if(0<m.length){var f=m[0];a.push(f.measureUniqueName),h+=""+_.parseSmartTopFilter(f),0<d.length&&(h+=" "+C.Localization.localize("Filter_Label_fromFilterGroupLabel"))}if(0<d.length){var g=d[0];h+=_.parseSmartGroup(g,a)}null!==l?l+=" "+C.Localization.localize("Filter_Label_And")+" ":l="",l+=p+" ("+h+")"}return null!==l&&null!==s?o.template=l+" "+C.Localization.localize("Filter_Label_And")+" "+s:null!==l?o.template=l:s&&(o.template=s),o.uniqueNames=r,o.measureUniqueNames=a,o},_.parseSmartGroup=function(e,t){for(var i="",n=0;n<e.filters.length;n++){var o=e.filters[n];if(o instanceof v.SmartFilter.Options.LabelDataFilter)0<i.length&&(i+=_.getSmartGroupTextOperation(e.operation)),i+=" "+_.parseSmartLabelFilter(o)+" ";else if(o instanceof v.SmartFilter.Options.ValueDataFilter){0<i.length&&(i+=_.getSmartGroupTextOperation(e.operation));var r=o;t.push(r.measureUniqueName),i+=" "+_.parseSmartValueFilter(r)+" "}else o instanceof v.SmartFilter.Options.FilterGroupDescription&&(0<i.length&&(i+=_.getSmartGroupTextOperation(e.operation)),i+=" ("+_.parseSmartGroup(o,t)+") ")}return i},_.getSmartGroupTextOperation=function(e){switch(e){case v.SmartFilter.Options.GroupOperation.And:return C.Localization.localize("OperationType_And");case v.SmartFilter.Options.GroupOperation.Or:return C.Localization.localize("OperationType_Or");case v.SmartFilter.Options.GroupOperation.NotAnd:return C.Localization.localize("OperationType_NotAnd");case v.SmartFilter.Options.GroupOperation.NotOr:return C.Localization.localize("OperationType_NotOr");default:throw new Error("NotImplementationException")}},_.parseSmartValueFilter=function(e){var t,i=e.measureUniqueName;switch(e.filterType){case v.SmartFilter.Options.ValueDataFilterType.Equal:t=C.Localization.localize("ValueFilter_Equal");break;case v.SmartFilter.Options.ValueDataFilterType.NotEqual:t=C.Localization.localize("ValueFilter_NotEqual");break;case v.SmartFilter.Options.ValueDataFilterType.Greater:t=C.Localization.localize("ValueFilter_Greater");break;case v.SmartFilter.Options.ValueDataFilterType.GreaterOrEqual:t=C.Localization.localize("ValueFilter_GreaterOrEqual");break;case v.SmartFilter.Options.ValueDataFilterType.Less:t=C.Localization.localize("ValueFilter_Less");break;case v.SmartFilter.Options.ValueDataFilterType.LessOrEqual:t=C.Localization.localize("ValueFilter_LessOrEqual");break;case v.SmartFilter.Options.ValueDataFilterType.Between:t=C.Localization.localize("ValueFilter_Between");break;case v.SmartFilter.Options.ValueDataFilterType.BetweenNotIncluding:t=C.Localization.localize("ValueFilter_BetweenNotIncluding");break;case v.SmartFilter.Options.ValueDataFilterType.NotBetween:t=C.Localization.localize("ValueFilter_NotBetween");break;case v.SmartFilter.Options.ValueDataFilterType.NotBetweenNotIncluding:t=C.Localization.localize("ValueFilter_NotBetweenNotIncluding");break;default:throw new Error("NotImplementedExcepion")}switch(i+=" "+t.toLowerCase(),e.filterType){case v.SmartFilter.Options.ValueDataFilterType.Between:case v.SmartFilter.Options.ValueDataFilterType.BetweenNotIncluding:case v.SmartFilter.Options.ValueDataFilterType.NotBetween:case v.SmartFilter.Options.ValueDataFilterType.NotBetweenNotIncluding:i+=" '"+e.num1+"' "+C.Localization.localize("Filter_Label_And")+" '"+e.num2+"'";break;default:i+=" '"+e.num1+"'"}return i},_.parseSmartLabelFilter=function(e){var t="";e.levelPropertyName.toUpperCase()==="Caption".toUpperCase()?t=C.Localization.localize("Olap_Caption"):"Name".toUpperCase()===e.levelPropertyName.toUpperCase()?t=C.Localization.localize("Olap_Name"):"UNIQUE_NAME".toUpperCase()===e.levelPropertyName.toUpperCase()&&(t=C.Localization.localize("Olap_UniqueName")),t="'"+t+"'";var i="";switch(e.filterType){case v.SmartFilter.Options.LabelDataFilterType.Equal:i=C.Localization.localize("ValueFilter_Equal");break;case v.SmartFilter.Options.LabelDataFilterType.NotEqual:i=C.Localization.localize("ValueFilter_NotEqual");break;case v.SmartFilter.Options.LabelDataFilterType.Greater:i=C.Localization.localize("ValueFilter_Greater");break;case v.SmartFilter.Options.LabelDataFilterType.GreaterOrEqual:i=C.Localization.localize("ValueFilter_GreaterOrEqual");break;case v.SmartFilter.Options.LabelDataFilterType.Less:i=C.Localization.localize("ValueFilter_Less");break;case v.SmartFilter.Options.LabelDataFilterType.LessOrEqual:i=C.Localization.localize("ValueFilter_LessOrEqual");break;case v.SmartFilter.Options.LabelDataFilterType.Between:i=C.Localization.localize("ValueFilter_Between");break;case v.SmartFilter.Options.LabelDataFilterType.BetweenNotIncluding:i=C.Localization.localize("ValueFilter_BetweenNotIncluding");break;case v.SmartFilter.Options.LabelDataFilterType.NotBetween:i=C.Localization.localize("ValueFilter_NotBetween");break;case v.SmartFilter.Options.LabelDataFilterType.NotBetweenNotIncluding:i=C.Localization.localize("ValueFilter_NotBetweenNotIncluding");break;case v.SmartFilter.Options.LabelDataFilterType.BeginWith:i=C.Localization.localize("LabelFilter_BeginWith");break;case v.SmartFilter.Options.LabelDataFilterType.NotBeginWith:i=C.Localization.localize("LabelFilter_NotBeginWith");break;case v.SmartFilter.Options.LabelDataFilterType.EndWith:i=C.Localization.localize("LabelFilter_EndWith");break;case v.SmartFilter.Options.LabelDataFilterType.NotEndWith:i=C.Localization.localize("LabelFilter_NotEndWith");break;case v.SmartFilter.Options.LabelDataFilterType.Contain:i=C.Localization.localize("LabelFilter_Contain");break;case v.SmartFilter.Options.LabelDataFilterType.NotContain:i=C.Localization.localize("LabelFilter_NotContain");break;default:throw new Error("NotImplementedException")}switch(t+=" "+i.toLowerCase(),e.filterType){case v.SmartFilter.Options.LabelDataFilterType.Between:case v.SmartFilter.Options.LabelDataFilterType.BetweenNotIncluding:case v.SmartFilter.Options.LabelDataFilterType.NotBetween:case v.SmartFilter.Options.LabelDataFilterType.NotBetweenNotIncluding:t+=" '"+e.text1+"' "+C.Localization.localize("Filter_Label_And")+" '"+e.text2+"'";break;default:t+=" '"+e.text1+"'"}return t},_.parseSmartTopFilter=function(e){var t,i;if(e.filterType===v.SmartFilter.Options.TopDataFilterType.Top)t=C.Localization.localize("Filter_Type_Top");else{if(e.filterType!==v.SmartFilter.Options.TopDataFilterType.Bottom)throw new Error("NotImplementedException");t=C.Localization.localize("Filter_Type_Bottom")}switch(t+=" "+e.count,e.filterTarget){case v.SmartFilter.Options.TopDataFilterTargetType.Items:i=C.Localization.localize("Filter_Target_Items");break;case v.SmartFilter.Options.TopDataFilterTargetType.Percent:i=C.Localization.localize("Filter_Target_Percent");break;case v.SmartFilter.Options.TopDataFilterTargetType.Sum:i=C.Localization.localize("Filter_Target_Sum");break;default:throw new Error("NotImplementedException")}return t+=" "+i.toLowerCase(),t+=" "+C.Localization.localize("Filter_Label_By")+" "+e.measureUniqueName},_.parseLabelFilter=function(e){var t="";e.levelPropertyName.toUpperCase()==="Caption".toUpperCase()?t=C.Localization.localize("Olap_Caption"):"Name".toUpperCase()===e.levelPropertyName.toUpperCase()?t=C.Localization.localize("Olap_Name"):"UNIQUE_NAME".toUpperCase()===e.levelPropertyName.toUpperCase()&&(t=C.Localization.localize("Olap_UniqueName")),t="'"+t+"'";var i="";switch(e.filterType){case v.LabelDataFilterType.Equal:i=C.Localization.localize("ValueFilter_Equal");break;case v.LabelDataFilterType.NotEqual:i=C.Localization.localize("ValueFilter_NotEqual");break;case v.LabelDataFilterType.Greater:i=C.Localization.localize("ValueFilter_Greater");break;case v.LabelDataFilterType.GreaterOrEqual:i=C.Localization.localize("ValueFilter_GreaterOrEqual");break;case v.LabelDataFilterType.Less:i=C.Localization.localize("ValueFilter_Less");break;case v.LabelDataFilterType.LessOrEqual:i=C.Localization.localize("ValueFilter_LessOrEqual");break;case v.LabelDataFilterType.Between:i=C.Localization.localize("ValueFilter_Between");break;case v.LabelDataFilterType.BetweenNotIncluding:i=C.Localization.localize("ValueFilter_BetweenNotIncluding");break;case v.LabelDataFilterType.NotBetween:i=C.Localization.localize("ValueFilter_NotBetween");break;case v.LabelDataFilterType.NotBetweenNotIncluding:i=C.Localization.localize("ValueFilter_NotBetweenNotIncluding");break;case v.LabelDataFilterType.BeginWith:i=C.Localization.localize("LabelFilter_BeginWith");break;case v.LabelDataFilterType.NotBeginWith:i=C.Localization.localize("LabelFilter_NotBeginWith");break;case v.LabelDataFilterType.EndWith:i=C.Localization.localize("LabelFilter_EndWith");break;case v.LabelDataFilterType.NotEndWith:i=C.Localization.localize("LabelFilter_NotEndWith");break;case v.LabelDataFilterType.Contain:i=C.Localization.localize("LabelFilter_Contain");break;case v.LabelDataFilterType.NotContain:i=C.Localization.localize("LabelFilter_NotContain");break;default:throw new Error("NotImplementedException")}switch(t+=" "+i.toLowerCase(),e.filterType){case v.LabelDataFilterType.Between:case v.LabelDataFilterType.BetweenNotIncluding:case v.LabelDataFilterType.NotBetween:case v.LabelDataFilterType.NotBetweenNotIncluding:t+=" '"+e.text1+"' "+C.Localization.localize("Filter_Label_And")+" '"+e.text2+"'";break;default:t+=" '"+e.text1+"'"}return t},_.parseTopFilter=function(e){var t,i;if(e.filterType===v.TopDataFilterType.Top)t=C.Localization.localize("Filter_Type_Top");else{if(e.filterType!==v.TopDataFilterType.Bottom)throw new Error("NotImplementedException");t=C.Localization.localize("Filter_Type_Bottom")}switch(t+=" "+e.count,e.filterTarget){case v.TopDataFilterTargetType.Items:i=C.Localization.localize("Filter_Target_Items");break;case v.TopDataFilterTargetType.Percent:i=C.Localization.localize("Filter_Target_Percent");break;case v.TopDataFilterTargetType.Sum:i=C.Localization.localize("Filter_Target_Sum");break;default:throw new Error("NotImplementedException")}return t+=" "+i.toLowerCase(),t+=" "+C.Localization.localize("Filter_Label_By")+" "+e.measureUniqueName},_.parseValueFilter=function(e){var t,i=e.measureUniqueName;switch(e.filterType){case v.ValueDataFilterType.Equal:t=C.Localization.localize("ValueFilter_Equal");break;case v.ValueDataFilterType.NotEqual:t=C.Localization.localize("ValueFilter_NotEqual");break;case v.ValueDataFilterType.Greater:t=C.Localization.localize("ValueFilter_Greater");break;case v.ValueDataFilterType.GreaterOrEqual:t=C.Localization.localize("ValueFilter_GreaterOrEqual");break;case v.ValueDataFilterType.Less:t=C.Localization.localize("ValueFilter_Less");break;case v.ValueDataFilterType.LessOrEqual:t=C.Localization.localize("ValueFilter_LessOrEqual");break;case v.ValueDataFilterType.Between:t=C.Localization.localize("ValueFilter_Between");break;case v.ValueDataFilterType.BetweenNotIncluding:t=C.Localization.localize("ValueFilter_BetweenNotIncluding");break;case v.ValueDataFilterType.NotBetween:t=C.Localization.localize("ValueFilter_NotBetween");break;case v.ValueDataFilterType.NotBetweenNotIncluding:t=C.Localization.localize("ValueFilter_NotBetweenNotIncluding");break;default:throw new Error("NotImplementedExcepion")}switch(i+=" "+t.toLowerCase(),e.filterType){case v.ValueDataFilterType.Between:case v.ValueDataFilterType.BetweenNotIncluding:case v.ValueDataFilterType.NotBetween:case v.ValueDataFilterType.NotBetweenNotIncluding:i+=" '"+e.num1+"' "+C.Localization.localize("Filter_Label_And")+" '"+e.num2+"'";break;default:i+=" '"+e.num1+"'"}return i},_.parseMembers=function(e,t,i){for(var n="",o=0;o<e.length;o++){var r=e[o],a="";if(r.selectedSelf?(a=r.uniqueName,i&&(a=" "+C.Localization.localize("ActiveFiltersPanel_include")+" "+a)):i&&!1===r.selectedSelf&&(a=" "+C.Localization.localize("ActiveFiltersPanel_exclude")+" "+r.uniqueName),r.selectedChildren?(a=r.selectedSelf?r.uniqueName+" "+C.Localization.localize("ActiveFiltersPanel_andItsChildren"):C.Localization.localize("ActiveFiltersPanel_children")+" "+r.uniqueName,i&&(a=" "+C.Localization.localize("ActiveFiltersPanel_include")+" "+a)):i&&!1===r.selectedChildren&&(a=!1===r.selectedSelf?" "+C.Localization.localize("ActiveFiltersPanel_exclude")+" "+r.uniqueName+" "+C.Localization.localize("ActiveFiltersPanel_andItsChildren"):" "+C.Localization.localize("ActiveFiltersPanel_exclude")+" "+C.Localization.localize("ActiveFiltersPanel_children")+" "+r.uniqueName),r.selectedDescendants?(a=r.selectedSelf?r.uniqueName+" "+C.Localization.localize("ActiveFiltersPanel_andItsDescendants"):C.Localization.localize("ActiveFiltersPanel_descendants")+" "+r.uniqueName,i&&(a=" "+C.Localization.localize("ActiveFiltersPanel_include")+" "+a)):i&&!1===r.selectedDescendants&&(a=!1===r.selectedSelf?" "+C.Localization.localize("ActiveFiltersPanel_exclude")+" "+r.uniqueName+" "+C.Localization.localize("ActiveFiltersPanel_andItsDescendants"):" "+C.Localization.localize("ActiveFiltersPanel_exclude")+" "+C.Localization.localize("ActiveFiltersPanel_descendants")+" "+r.uniqueName),""!==a&&t.push(r.uniqueName),0<r.childNodes.length){var s=r.selectedDescendants||r.selectedChildren||i,l=_.parseMembers(r.childNodes,t,s);""!==l&&(a+=""!==a?" ("+l+") ":l)}""!==n&&""!==a&&(n+=", "),n+=a}return n},_}();e.FilterParser=t})((v=C.Controls||(C.Controls={})).ActiveFilters||(v.ActiveFilters={}))}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){this.options=new t.CellAppearanceOptions},t.CellAppearanceObject=i}(Ranet||(Ranet={})),function(e){var t;t=function(){this.showValue=!0,this.useBackColor=!1,this.useForeColor=!1,this.useImage=!1},(e.Controls||(e.Controls={})).CellAppearanceOptions=t}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){this.conditionType=t.CellConditionType.None,this.value1=0,this.value2=0,this.appearance=new t.CellAppearanceObject},t.CellCondition=i}(Ranet||(Ranet={})),function(e){var t;t=function(e){this.conditions=new Array,this.memberUniqueName=e},(e.Controls||(e.Controls={})).CellConditionsDescriptor=t}(Ranet||(Ranet={})),function(e){!function(e){var t;(t=e.CellConditionType||(e.CellConditionType={}))[t.None=0]="None",t[t.Equal=1]="Equal",t[t.NotEqual=2]="NotEqual",t[t.Between=3]="Between",t[t.NotBetween=4]="NotBetween",t[t.Less=5]="Less",t[t.Greater=6]="Greater",t[t.GreaterOrEqual=7]="GreaterOrEqual",t[t.LessOrEqual=8]="LessOrEqual",t[t.BetweenNotIncluding=9]="BetweenNotIncluding",t[t.NotBetweenNotIncluding=10]="NotBetweenNotIncluding";e.CellConditionType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){function e(e,t){this._tupleString=null,this.tuples=e,this.newValue=t}return Object.defineProperty(e.prototype,"tupleString",{get:function(){return null===this._tupleString&&(this._tupleString=this.getTuples()),this._tupleString},enumerable:!0,configurable:!0}),e.prototype.getTuples=function(){var e="",t=this.tuples;for(var i in t)t.hasOwnProperty(i)&&(e+=t[i]);return e},e}(),t.UpdateEntry=i}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){function e(e){this._items=new Array,this._cacheUpdatedCells={},this._sessionItems=new Array,this._onStateUpdateStorageChangedCallback=e}return Object.defineProperty(e.prototype,"entries",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasLocalChanges",{get:function(){return 0!==this.entries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasServerChanges",{get:function(){return 0!==this._sessionItems.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasAnyChanges",{get:function(){return this.hasLocalChanges||this.hasServerChanges},enumerable:!0,configurable:!0}),e.prototype.inform=function(){this._onStateUpdateStorageChangedCallback(this.hasLocalChanges,this.hasServerChanges)},e.prototype.add=function(e){this._cacheUpdatedCells.hasOwnProperty(e.tupleString)?this._cacheUpdatedCells[e.tupleString]=e:(this._cacheUpdatedCells[e.tupleString]=e,this._items.push(e),this.inform())},e.prototype.remove=function(e){if(!1===this._cacheUpdatedCells.hasOwnProperty(e.tupleString))throw new Error("InvalidOperationException");var t=this._cacheUpdatedCells[e.tupleString];delete this._cacheUpdatedCells[e.tupleString],this._items.splice(this._items.indexOf(t),1),this.inform()},e.prototype.setStateAfterRecalculate=function(){this._sessionItems=this._sessionItems.concat(this._items),this._items.length=0,this._cacheUpdatedCells={},this.inform()},e.prototype.setStateAfterSave=function(){this._sessionItems.length=0,this.inform()},e.prototype.clearAllChanges=function(){this._sessionItems.length=0,this._items.length=0,this._cacheUpdatedCells={},this.inform()},e.prototype.setStateAfterRollback=function(){this._sessionItems.length=0,this._items.length=0,this._cacheUpdatedCells={},this.inform()},e.prototype.clearLocalChanges=function(){this._items.length=0,this._cacheUpdatedCells={},this.inform()},e}(),t.UpdatedCellsStorage=i}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){function e(){}return e.build=function(e,t,i,n){for(var o=new Array,r=0;r<i.length;r++){var a,s,l,c=t,u=i[r].tuples;for(a in u)u.hasOwnProperty(a)&&(s="<%"+a+"%>",l=u[a],s=s.replace(new RegExp("\\[","g"),"\\[").replace(new RegExp("\\]","g"),"\\]"),c=c.replace(new RegExp(s,"g"),l));for(a in n)n.hasOwnProperty(a)&&(s="<%"+a+"%>",l=n[a],s=s.replace(new RegExp("\\[","g"),"\\[").replace(new RegExp("\\]","g"),"\\]"),c=c.replace(new RegExp(s,"g"),l));c=c.replace(new RegExp("<%newValue%>","g"),i[r].newValue),o.push(c)}var p="UPDATE CUBE "+e+" \nSET\n";return p+=o.join(", ")},e.getDefaultUpdateScriptTemplate=function(e){for(var t="(\n",i=0;i<e.length;i++)t+="<%"+e[i]+"%>",i+1!==e.length&&(t+=","),t+="\n";return t+=")",t+="=<%newValue%>"},e}(),t.UpdateScriptBuilder=i}(Ranet||(Ranet={})),function(r){var e,t,i;e=r.Controls||(r.Controls={}),t=e.CellPropertiesViewer||(e.CellPropertiesViewer={}),i=function(){function o(e){this._options=e,this._$textArea=$("<textarea class='form-control cellPropertiesViewerControl-textViewer' rows='15' readonly></textarea>"),this._$textArea.val(this.content)}return Object.defineProperty(o.prototype,"content",{get:function(){var e={};e.FORMATTED_VALUE=this._options.cellDescription.cellData.displayValue,e.VALUE=this._options.cellDescription.cellData.value,e.BACK_COLOR=this._options.cellDescription.cellData.backColor,e.FORE_COLOR=this._options.cellDescription.cellData.foreColor,e.FORMAT_STRING=this._options.cellDescription.cellData.formatString;var t,i=this.getString(e);for(i+="\n",(e={})[""+r.Localization.localize("Tuple")]="",t=0;t<this._options.cellDescription.rows.length;t++){var n=this._options.cellDescription.rows[t];e[n.hierarchyCaption]=n.memberCaption+" ("+n.memberUniqueName+")"}for(t=0;t<this._options.cellDescription.columns.length;t++){var o=this._options.cellDescription.columns[t];e[o.hierarchyCaption]=o.memberCaption+" ("+o.memberUniqueName+")"}return i+=this.getString(e)},enumerable:!0,configurable:!0}),o.prototype.getString=function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&t.length>i&&(i=t.length);i+=1;var n="";for(t in e)e.hasOwnProperty(t)&&(n+=o.addSpace(t,i)+": "+e[t]+"\n");return n},o.addSpace=function(e,t){for(var i=e,n=0;n<t-e.length;n++)i+=" ";return i},Object.defineProperty(o.prototype,"view",{get:function(){return this._$textArea},enumerable:!0,configurable:!0}),o}(),t.CellPropertiesViewerControl=i}(Ranet||(Ranet={})),function(e){var t;(function(e){var t=function(){};e.CellDescription=t;var i=function(e){this.cellDescription=e};e.CellPropertiesViewerOptions=i})((t=e.Controls||(e.Controls={})).CellPropertiesViewer||(t.CellPropertiesViewer={}))}(Ranet||(Ranet={})),function(n){var o,t,e;o=n.Controls||(n.Controls={}),t=n.Controls.Events.LiteEvent,e=function(){function e(e){this._onSelectionCubeChanged=new t,this._isEnabled=!1,this._isEnabledDropDownControl=!0,e&&$(e).append(this.view)}return Object.defineProperty(e.prototype,"view",{get:function(){return this._$view||(this._$view=this.getView(),this.isEnabled=!1),this._$view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedCube",{get:function(){return this._selectedCube},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionCubeChanged",{get:function(){return this._onSelectionCubeChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,this._$view.removeClass("cubeChoiceControl_disabled"),this._isEnabled||this._$view.addClass("cubeChoiceControl_disabled")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabledDropDownControl",{get:function(){return this._isEnabledDropDownControl},set:function(e){this._isEnabledDropDownControl=e,this._dropDownControl.view.removeClass("cubeChoiceControl_disabled"),this._isEnabledDropDownControl||this._dropDownControl.view.addClass("cubeChoiceControl_disabled")},enumerable:!0,configurable:!0}),e.prototype.setCube=function(e){console.log(e),this._extSelectedCubeName=e,this._isEnabled&&this.refrehCubes()},e.prototype.getCubes=function(){var t=$.Deferred();return $.ajax({type:"POST",url:n.PathManager.applicationUrl+"api/olap/getCubes",data:{connection:this.connection},success:function(e){t.resolve(e)},error:function(e){t.reject(e)}}),t},e.prototype.refrehCubes=function(){if(!this.connection)throw new Error("invalidOperationException");var e=$('<div class="cubeChoiceControl-statusPanel"><i class="fa fa-spinner fa-pulse"></i><span class="cubeChoiceControl-loadCubesLabelStatus">'+n.Localization.localize("CubeChoiceControl_LoadingCubesMessage")+"</span></div>");this._$view.append(e);var t=this;this.getCubes().done(function(e){0===e.length&&t.showError(),t.isEnabled=!0,t.updateControls(e)}).fail(function(e){n.LogService.error(e),t.showError()}).always(function(){e.remove()})},e.prototype.showError=function(){var e=this;this.isEnabled=!0,this.isEnabledDropDownControl=!1;var t=$('<div class="cubeChoiceControl-statusPanel"></div>');t.append('<div class="cubeChoiceControl-imageContainer imageLibrary_error"></div>'),t.append('<span class="cubeChoiceControl-errorLabel">'+n.Localization.localize("CubeChoiceControl_ErrorLoadingCubes")+"</span>");var i=$('<button type="button" class="btn btn-default btn-xs cubeChoiceControl-buttonRefreshCubes">'+n.Localization.localize("CubeChoiceControl_ButtonRefreshCubes")+"</button>");t.append(i),i.click(function(){e.isEnabledDropDownControl=!0,e.isEnabled=!1,t.remove(),e.refrehCubes()}),this._$view.append(t)},e.prototype.updateControls=function(e){var i=0;if(this._extSelectedCubeName)for(var t=0;t<e.length;t++)e[t].name===this._extSelectedCubeName&&(i=t);e.forEach(function(e,t){e.imageClass="imageLibrary_cube",t===i&&(e.isSelected=!0)}),this._dropDownControl.itemSource=e,this.changeCube(e[i])},e.prototype.changeCube=function(e){this._selectedCube=e,this._onSelectionCubeChanged.trigger(this._selectedCube)},e.prototype.getView=function(){var t=this,e=$("<div/>");e.addClass("cubeChoiceControl");var i=new o.DropDownControl;return i.displayPropertyExpr="caption",i.imageCssClassExp="imageClass",i.selectedExpr="isSelected",i.selectionChanged.on(function(e){t.changeCube(e)}),e.append(i.view),this._dropDownControl=i,e},e}(),o.CubeChoiceControl=e}(Ranet||(Ranet={})),function(g){var _,e;_=g.Controls||(g.Controls={}),e=function(){function e(e,n){var o=this;this._panel=$(e),this._options=n,this._selectedUniqueNames=[];var r=this,t=$("<div/>");t.addClass("cubeExplorer_measureGroupSelector");var i=$("<div/>");i.addClass("cubeExplorer_treeMetadata"),this._currentCalculatedMembers=this._options.calculatedMembers,this._currentCalculatedNamedSets=this._options.calculatedNamedSets;var a=new _.TreeViewOptions;a.hasChildrenExpr="hasChildren",a.virtualModeEnabled=!0;var s=new _.MemberChoice.QueryManager(this._options.cubeName,null),l=new _.MemberChoice.DataService(this._options.connection);a.countLoadedItems=_.MemberChoice.QueryManager.step;var c=new _.VirtualConnectionProvider;c.getPromiseLoadChildren=function(e){var t=e.uniqueName,i="";if("level"===e.type)s.hierarchyUniqueName=e.parentHierarchyId,i=s.getQueryMembers(t,0);else{if("memberData"!==e.type)throw new Error("NotImplementedException");s.hierarchyUniqueName=e.hierarchyUniqueName,i=s.getQueryLoadChildren(t,0)}return l.getMembers(i).promise()},c.getPromiseLoadNeighbors=function(e,t){var i="";return"level"===e.type?(s.hierarchyUniqueName=e.parentHierarchyId,i=s.getQueryMembers(e.uniqueName,t)):"memberData"===e.type&&(s.hierarchyUniqueName=e.hierarchyUniqueName,i=s.getQueryLoadChildren(e.uniqueName,t)),l.getMembers(i).promise()},a.connectionProvider=c,a.keyExpr="id",a.displayExpr="caption",a.expandedExpr="isOpen",a.iconExpandedExpr="iconExpanded",a.iconExpr="icon";var u=n.draggableOptions;u||(u=new _.TreeViewDraggableOptions),u.draggableNodeExp="isDraggable",u.onStartDraggable=function(e,t){var i=o.getLevelForMemberData(e);jQuery.data(t.$treeViewItem.get(0),"data",i)},a.onRenderedTreeViewItem=function(e,t){t.$treeViewItem.attr("data-"+a.keyExpr,e.dataItem[a.keyExpr])},a.draggableOptions=u,a.onItemSelected=function(e){},a.onItemChoosed=function(e){o.addItemToQueryDesigner(e)},a.isHighligtedItem=function(e){return!!o._integrityDataManager&&o.isSelectedChild(e.dataItem)},this._onDataSourceChanged=function(e,t){n.onDataSourceChanged&&n.onDataSourceChanged(e,t)};var p=!0,h=$('<div class="cubeExplorer-searchPanel"/>'),d=new _.Editors.TextBoxControlOptions;d.icon=g.Controls.Editors.IconTextBox.Search,d.onTextChanged=function(e,t){if(!1!==p){var i=t;setTimeout(function(){r.searchText(i)},250)}};var m=new g.Controls.Editors.TextBoxControl(d),f={dataSource:null,selectedMeasureGroupName:n.selectedMeasureGroupName,onMeasureGroupSelectedChanged:function(e){g.UserActionsTracker.track("Change the group of measures"),r._currentSelectedMeasureGroup=e,p=!1,m.text="",p=!0,r._tree.selectedText=null;var t=jQuery.extend(!0,[],r._currentDataSource.treeMetadata),i=g.Utility.TreeMetadataHelper.filterMeasureGroupMetadata(t,e);r._tree.dataSource=i,n.onMeasureGroupSelectedChanged&&n.onMeasureGroupSelectedChanged(r,new _.FilteredMetadataDescriptionArgs(e,i))}};this._tree=new _.TreeView(i[0],a),this._measureGroupSelector=new _.MeasureGroupSelector(t[0],f),this._layoutDropDownItems=n.layoutDropdownItems||[],this._layoutButton=this.initLayoutButton().hide(),this._panel.append(this._layoutButton),this._panel.append(t),h.append(m.view()),this._panel.append(h),this._panel.append(i),this._options.dataSource&&(this.dataSource=this._options.dataSource),this._isVisibleLayoutButton=!1}return Object.defineProperty(e.prototype,"currentCalculatedMembers",{get:function(){return this._currentCalculatedMembers},set:function(e){this._currentCalculatedMembers=e,this.repaintTreeView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentCalculatedNamedSets",{get:function(){return this._currentCalculatedNamedSets},set:function(e){this._currentCalculatedNamedSets=e,this.repaintTreeView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._currentDataSource},set:function(e){this._originalDataSource=e;var t=jQuery.extend(!0,{},e);this._currentDataSource=t,this.renderTreeView(),this._measureGroupSelector.dataSource=t.measureGroups,this._onDataSourceChanged(this,new _.MetadataDescriptionArgs(e))},enumerable:!0,configurable:!0}),e.prototype.getMapIdToMetadata=function(){return e.getPlainData(this._currentDataSource.treeMetadata,this._options.keyExpr)},e.getPlainData=function(e,t){var i={};if(void 0===t)return i;for(var n=0;n<e.length;n+=1){var o=e[n];if(void 0!==o[t]&&(i[o[t]]=o),void 0!==o.items){var r=this.getPlainData(o.items,t);for(var a in r)if(r.hasOwnProperty(a)){var s=r[a];i[a]=s}}}return i},e.prototype.getCopyOriginalDataSource=function(){return jQuery.extend(!0,{},this._originalDataSource)},e.prototype.renderTreeView=function(){e.extendMetadataTreeCustomCalculations(this._currentDataSource.treeMetadata,this.currentCalculatedMembers,this.currentCalculatedNamedSets),this._tree.dataSource=this._currentDataSource.treeMetadata},e.prototype.repaintTreeView=function(){e.extendMetadataTreeCustomCalculations(this._currentDataSource.treeMetadata,this.currentCalculatedMembers,this.currentCalculatedNamedSets),e.extendMetadataTreeCustomCalculations(this._tree.dataSource,this.currentCalculatedMembers,this.currentCalculatedNamedSets),this._tree.repaint()},e.prototype.searchText=function(e){var t=jQuery.extend(!0,[],this._currentDataSource.treeMetadata),i=g.Utility.TreeMetadataHelper.filterMeasureGroupMetadata(t,this._currentSelectedMeasureGroup);if(0!==e.length){this._tree.selectedText=e;var n=g.Utility.TreeMetadataHelper.filterByText(i,e);this._tree.dataSource=n}else this._tree.selectedText=null,this._tree.dataSource=i},e.prototype.getMembersFilter=function(e){var t=null,i=null,n=e.dataItem.parents;if(n)for(var o=0;o<n.length;o++){var r=n[o],a=new _.MemberChoice.MemberChoiceTreeNode(r.uniqueName,!1,!1,!1);if(null===t)t=i=a;else{if(null===i)throw new Error("InvalidOperationException");i.childNodes.push(a),i=a}}var s=new _.MemberChoice.MemberChoiceTreeNode(e.dataItem.uniqueName,!0,!1,!1);return null===i?t=s:i.childNodes.push(s),t},e.extendMetadataTreeCustomCalculations=function(e,t,i){if(!e)throw new Error("ArgumentException");for(var n=[],o=0,r=0,a=void 0,s=0;s<e.length;s++){var l=e[s];if(l.id&&"rootCalculations"===l.id){(a=l).items=n;break}if("dimension"===l.type){r=s;break}}void 0===a&&(a={id:"rootCalculations",caption:g.Localization.localize("MdxDesigner_Calculations"),icon:"cubeExplorerCustomCalculations",type:"customCalculations",isDraggable:!1,items:n},e.splice(r,0,a)),void 0===t&&void 0===i||t&&0===t.length&&i&&0===i.length?g.Utility.ArrayUtility.removeItem(e,a):(t&&0!==t.length&&t.forEach(function(e){n.push({id:"customCalculation"+o++,caption:e.name,name:e.name,icon:"customMeasure",uniqueName:e.name,isDraggable:!0,type:"calculatedMember"})}),i&&0!==i.length&&i.forEach(function(e){n.push({id:"customCalculation"+o++,caption:e.name,name:e.name,icon:"customNamedSet",isDraggable:!0,type:"calculatedNamedSet"})}))},Object.defineProperty(e.prototype,"isVisibleLayoutButton",{get:function(){return this._isVisibleLayoutButton},set:function(e){e?this.showLayoutButton():this.hideLayoutButton()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutDropdownItems",{get:function(){return this._layoutDropDownItems},set:function(e){this._layoutDropDownItems=e;for(var t=this._panel.find(".dropdown-menu").empty(),i=0;i<this._layoutDropDownItems.length;i++){var n=$("<li />").on("click",this._layoutDropDownItems[i].onSelected),o=$("<a />").text(this._layoutDropDownItems[i].title);n.append(o),t.append(n)}},enumerable:!0,configurable:!0}),e.prototype.initLayoutButton=function(){for(var e=$("<div />").addClass("btn-group default-dropdown layout-button"),t=$("<button />").addClass("btn btn-default dropdown-toggle").attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false").attr("title",g.Localization.localize("LayoutsOfDesignerButton_ToolTip")),i=$("<ul />").addClass("dropdown-menu"),n=0;n<this._layoutDropDownItems.length;n++){var o=$("<li />").on("click",this._layoutDropDownItems[n].onSelected),r=$("<a />"),a=$("<div class='"+this._layoutDropDownItems[n].icon+" cubeExplorer-dropDownImage'></div>"),s=$("<span>"+this._layoutDropDownItems[n].title+"</span>");r.append(a),r.append(s),o.append(r),i.append(o)}var l=$("<div />").addClass("button-contentImage imageLibrary_designPanel");return e.append(t),t.append(l),e.append(i),e},e.prototype.showLayoutButton=function(){this._layoutButton&&this._layoutButton.show(),this._panel.find(".cubeExplorer_measureGroupSelector").addClass("visible-layout-button"),this._isVisibleLayoutButton=!0},e.prototype.hideLayoutButton=function(){this._layoutButton&&this._layoutButton.hide(),this._panel.find(".cubeExplorer_measureGroupSelector").removeClass("visible-layout-button"),this._isVisibleLayoutButton=!1},e.prototype.getLevelForMemberData=function(e){for(var t=jQuery.extend(!0,{},e.dataItem),i=e.parents.length-1;0<=i;i--){var n=e.parents[i].dataItem;if("level"===n.type){t=jQuery.extend(!0,{},n);var o=this.getMembersFilter(e),r=o.buildMdx(),a=new _.CustomFilterOptions;t.filter={isUsed:!0,membersFilter:{isUsed:!0,selectionNodes:new Array(o),set:r},customFilter:a};break}}return t},e.prototype.addItemToQueryDesigner=function(e){var t,i,n=e.dataItem.type;if("time"===e.dataItem.dimensionType)return t=e.dataItem,i=_.AreaType.Columns,this._integrityDataManager.dropItem(i,t),void this._integrityDataManager.onLayoutChanged.trigger();switch(n){case"kpiItem":i=_.AreaType.Data,t=e.dataItem;break;case"measure":case"calculatedMember":i=_.AreaType.Data,t=e.dataItem;break;case"memberData":i=_.AreaType.Rows,"time"===(t=this.getLevelForMemberData(e)).dimensionType&&(i=_.AreaType.Columns);break;case"dimension":case"hierarchy":case"level":case"namedSet":case"calculatedNamedSet":i=_.AreaType.Rows,t=e.dataItem;break;case"setsRootNode":case"kpiRootNode":case"measuresRootNode":case"measures":case"measureFolder":case"kpi":case"kpiInfo":default:return}this._integrityDataManager.dropItem(i,t),this._integrityDataManager.onLayoutChanged.trigger()},e.prototype.injectIntegrityDataManager=function(e){var t=this;this._integrityDataManager=e,this._integrityDataManager.onLayoutChanged.on(function(){t._tree.repaint()}),this._integrityDataManager.onFiltersChanged.on(function(){t._tree.repaint()}),this._tree.repaint()},e.prototype.isSelectedChild=function(e){var t=e.uniqueName?0<=this._integrityDataManager.layoutItems.indexOf(e.uniqueName):0<=this._integrityDataManager.layoutItems.indexOf(e.name);if(e.items)for(var i=0;i<e.items.length;i++)t=t||this.isSelectedChild(e.items[i]);return t},e}(),_.CubeExplorer=e}(Ranet||(Ranet={})),function(a){a.ranetCubeExplorer=function(e,t){var i,n=this,o={},r=this;r.settings={},this.getCopyOriginalDataSource=function(){return i.getCopyOriginalDataSource()},this.getMapIdToMetadata=function(){return i.getMapIdToMetadata()},this.injectIntegrityDataManager=function(e){i.injectIntegrityDataManager(e)},r.init=function(){n.settings=a.extend({},o,t),i=new Ranet.Controls.CubeExplorer(e,t)},r.option=function(e){e.hasOwnProperty("dataSource")&&(i.dataSource=e.dataSource),e.hasOwnProperty("calculatedMembers")&&(i.currentCalculatedMembers=e.calculatedMembers),e.hasOwnProperty("calculatedNamedSets")&&(i.currentCalculatedNamedSets=e.calculatedNamedSets)},r.isVisibleLayoutButton=function(e){if(void 0===e)return i.isVisibleLayoutButton;i.isVisibleLayoutButton=e},r.init()},a.fn.ranetCubeExplorer=function(t){return this.each(function(){if(null==a(this).data("ranetQueryDesigner")){var e=new a.ranetCubeExplorer(this,t);a(this).data("ranetCubeExplorer",e)}})}}(jQuery),function(e){!function(e){var t=function(e,t){this.treeMetadata=t,this.measureGroup=e};e.FilteredMetadataDescriptionArgs=t;var i=function(e){this.metadataDescription=e};e.MetadataDescriptionArgs=i;var n=function(){this.selectedMeasureGroupName=null};e.CubeExplorerOptions=n}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(a){var e,t,i;e=a.Controls||(a.Controls={}),t=e.CustomPropertiesSelector||(e.CustomPropertiesSelector={}),i=function(){function e(e){this._options=e,this._selectedProps=e.selectedProperties}return Object.defineProperty(e.prototype,"selectedProperties",{get:function(){return this._selectedProps},enumerable:!0,configurable:!0}),e.prototype.getLayout=function(){var u=this,e=$("<div/>"),t=$("<div class='customPropertiesSelector-toolbar'/>"),i=$("<a class='customPropertiesSelector-selectAllBtn'>"+a.Localization.localize("ContextCmd_SelectAll")+"</a>"),n=$("<a class='customPropertiesSelector-unselectAllBtn'>"+a.Localization.localize("ContextCmd_UnSelectAll")+"</a>"),p=new Array;i.on("click",function(){for(var e=0,t=p;e<t.length;e++){var i=t[e];i.checkBox.prop("checked",!0),u.onChangeState(!0,i.levelDescription)}}),n.on("click",function(){for(var e=0,t=p;e<t.length;e++){var i=t[e];i.checkBox.prop("checked",!1),u.onChangeState(!1,i.levelDescription)}}),t.append(i),t.append(n),e.append(t);var h=$("<div/>");h.addClass("customPropertiesSelector-list"),e.append(h);for(var d,m={},o=function(e){var t=f._options.hierarchyDescription.levelProperties[e],i=$("<div/>");i.addClass("customPropertiesSelector-itemList");var n=$("<input type='checkbox'>");p.push({checkBox:n,levelDescription:t}),-1!==f._options.selectedProperties.indexOf(t.name)&&n.prop("checked",!0),n.click({checkBox:n,levelDescription:t},function(e){u.onChangeState(e.data.checkBox.is(":checked"),e.data.levelDescription)});var o=$("<span/>");o.addClass("customPropertiesSelector-levelCaptionLabel"),o.append(t.caption),o.click({checkBox:n,levelDescription:t},function(e){var t=!e.data.checkBox.is(":checked");e.data.checkBox.prop("checked",t),u.onChangeState(t,e.data.levelDescription)}),i.append(n),i.append(o);var r=null;if(m[t.levelName])r=m[t.levelName];else{var a=$("<div/>");a.addClass("customPropertiesSelector-levelsPanel");var s=$("<div class='customPropertiesSelector-headerPanel'/>"),l=$('<i class="fa fa-caret-down customPropertiesSelector-treeMark"></i>');s.append(l),d=$("<div class='customPropertiesSelector-levelIcon imageLibrary_li"+t.levelNumber+"'/>"),s.append(d);var c=$("<div/>");c.addClass("customPropertiesSelector-levelsContainer"),l.on("click",function(){if(l.hasClass("fa-caret-right"))l.removeClass("fa-caret-right"),l.addClass("fa-caret-down"),c.show();else{if(!l.hasClass("fa-caret-down"))throw new Error("NotImplementedException");l.removeClass("fa-caret-down"),l.addClass("fa-caret-right"),c.hide()}}),s.append(t.levelName),a.append(s),a.append(c),h.append(a),r=m[t.levelName]=c}r.append(i)},f=this,r=0;r<this._options.hierarchyDescription.levelProperties.length;r++)o(r);return e},e.prototype.onChangeState=function(e,t){e?this.selectedProperties.push(t.name):this.selectedProperties.splice(this.selectedProperties.indexOf(t.name),1)},Object.defineProperty(e.prototype,"view",{get:function(){return this.getLayout()},enumerable:!0,configurable:!0}),e}(),t.CustomPropertiesSelectorControl=i}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.CustomPropertiesSelector||(t.CustomPropertiesSelector={}),n=function(){function e(e,t){this._hierarchyDescription=e,this._selectedProps=t}return Object.defineProperty(e.prototype,"hierarchyDescription",{get:function(){return this._hierarchyDescription},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedProperties",{get:function(){return this._selectedProps},enumerable:!0,configurable:!0}),e}(),i.CustomPropertiesSelectorOptions=n}(Ranet||(Ranet={})),function(n){var t,e,i;t=n.Controls||(n.Controls={}),e=t.DrillThrough||(t.DrillThrough={}),i=function(){function e(l){var c=this;this._$rootLayout=$("<div class='drillThrough-rootLayout'/>"),this._options=l,this._loadPanel=new t.LoadPanel(l.$container.get(0),{visible:!1,position:{of:window},message:n.Localization.localize("Command_Export_Group")}),e._directoryTemplate=n.PathManager.templatesPath,e.getLayout().done(function(s){var e,t;for((c._viewDescription=s).$cellDataText.text(l.cellData.displayValue),t=0;t<l.rows.length;t++)e=$("<tr><td>"+l.rows[t].hierarchyCaption+"</td><td>"+l.rows[t].memberCaption+"</td></tr>"),s.$tableContent.append(e);for(t=0;t<l.columns.length;t++)e=$("<tr><td>"+l.columns[t].hierarchyCaption+"</td><td>"+l.columns[t].memberCaption+"</td></tr>"),s.$tableContent.append(e);s.$exportToExcelButton.click(function(){c.exportDataToExcel()}),setTimeout(function(){for(var e=new Array,t=new Array,i=0;i<c._options.dataSource.columns.length;i++)e.push({data:c._options.dataSource.columns[i].columnName}),t.push('<span title="'+c._options.dataSource.columns[i].caption+'">'+c._options.dataSource.columns[i].caption+"</span>");for(var n=new Array,o=0;o<l.dataSource.rows.length;o++){for(var r={},a=0;a<l.dataSource.rows[o].cells.length;a++)r[l.dataSource.rows[o].cells[a].name]=l.dataSource.rows[o].cells[a].value;n.push(r)}new Handsontable(s.$dataPanel.get(0),{manualColumnResize:!0,data:n,rowHeaders:!1,columns:e,colWidths:80,rowHeights:23,readOnly:!0,headerTooltips:!0,wordWrap:!1,autoRowSize:!1,autoColumnSize:!1,colHeaders:t,columnSorting:!0})},250),c._$rootLayout.append(s.$view)})}return e.prototype.exportDataToExcel=function(){var e,i=this,t=new Array;for(e=0;e<this._options.rows.length;e++)t.push({hierarchyCaption:this._options.rows[e].hierarchyCaption,memberCaption:this._options.rows[e].memberCaption});for(e=0;e<this._options.columns.length;e++)t.push({hierarchyCaption:this._options.columns[e].hierarchyCaption,memberCaption:this._options.columns[e].memberCaption});this._loadPanel.visible=!0,$.ajax({type:"POST",url:n.PathManager.applicationUrl+"api/export/exportDrillthroughData",data:{dataString:JSON.stringify(this._options.dataSource),cellValue:this._options.cellData.displayValue,tuples:t}}).done(function(e){var t=n.PathManager.applicationUrl+"api/export/download/"+e;window.location.href=t,i._loadPanel.visible=!1}).fail(function(e){i._loadPanel.visible=!1,n.LogService.error(e),n.UserMessageService.showServerError(e)})},Object.defineProperty(e.prototype,"view",{get:function(){return this._$rootLayout},enumerable:!0,configurable:!0}),e.prototype.showData=function(){},e.prototype.countString=function(){return" ( "+this._options.dataSource.rows.length+" "+n.Localization.localize("DrillThrough_Count")+" ) "},e.getLayout=function(){var i=$.Deferred();return $.ajax({url:e._directoryTemplate+"drillthrough-view.html"}).done(function(e){var t=$(n.Localization.localizeTemplate(e));i.resolve({$view:t,$cellDataText:t.find(".drillThrough-cellValue"),$tableContent:t.find(".drillThrough-tuplesData tbody"),$dataPanel:t.find(".drillThrough-data"),$exportToExcelButton:t.find(".drillThrough-exportToExcelButton")})}).fail(function(e){n.LogService.error(e),i.reject(e)}),i},e}(),e.DrillThroughControl=i}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){},(t.DrillThrough||(t.DrillThrough={})).DrillThroughControlOptions=i}(Ranet||(Ranet={})),function(o){var i,e,t;i=o.Controls||(o.Controls={}),e=i.HierarchySelector||(i.HierarchySelector={}),t=function(){function a(e){this._options=e}return Object.defineProperty(a.prototype,"selectedHierarchy",{get:function(){return this._selectedHierarchy},enumerable:!0,configurable:!0}),a.prototype.createLayout=function(){var e=$("<div class='hierarchySelectorControl-rootLayout'/>"),t=$("<div class='hierarchySelectorControl-treeMetadata'/>"),i=this.getTreeViewOptions();i.isVisibleSearch=!0,new o.Controls.SearchTreeView.SearchTreeViewContent(t[0],i).init(),e.append(t);var n=$('<div class="hierarchySelectorControl-selectedHierarchyPanel"/>');return n.append('<div class="hierarchySelectorControl-labelSelectedHierarchy">'+o.Localization.localize("WindowSelectorHierarchy_LabelSelectedHierarchy")+"</div>"),this._$selectedHierarchyInput=$('<input type="text" class="form-control disabled" readonly/>'),n.append(this._$selectedHierarchyInput),e.append(n),e},a.prepareDataSource=function(e,t){e.splice(e.indexOf(e.filter(function(e){return"kpiRootNode"===e.type})[0]),1),e.splice(e.indexOf(e.filter(function(e){return"measuresRootNode"===e.type})[0]),1),e.splice(e.indexOf(e.filter(function(e){return"setsRootNode"===e.type})[0]),1);for(var i=new Array,n=0;n<e.length;n++){var o=e[n];a.updateNodes(o.items,t),0===o.items.length&&i.push(o)}if(0<i.length)for(var r=0;r<i.length;r++)e.splice(e.indexOf(i[r]),1);return e},a.updateNodes=function(e,t){for(var i=new Array,n=0;n<e.length;n++){var o=e[n];"hierarchy"===o.type?(-1!==t.indexOf(o.uniqueName)&&i.push(o),delete o.items):"folder"===o.type&&a.updateNodes(o.items,t)}if(0<i.length)for(var r=0;r<i.length;r++)e.splice(e.indexOf(i[r]),1)},a.findHierarchyInFolder=function(e){var t,i=void 0;for(t=0;t<e.items.length;t++)if("hierarchy"===e.items[t].type){i=e.items[t];break}if(i)return i;for(t=0;t<e.items.length;t++)if("folder"===e.items[t].type){var n=a.findHierarchyInFolder(e.items[t]);if(n){i=n;break}}return i},a.findHierarchyInDimension=function(e){var t,i=void 0;for(t=0;t<e.items.length;t++)if("hierarchy"===e.items[t].type){i=e.items[t];break}if(i)return i;for(t=0;t<e.items.length;t++)if("folder"===e.items[t].type){var n=a.findHierarchyInFolder(e.items[t]);if(n){i=n;break}}return i},a.prototype.onSelectNode=function(e){var t=void 0,i=e[0];if("hierarchy"===i.type?t=i:"folder"===i.type?t=a.findHierarchyInFolder(i):"dimension"===i.type&&(t=a.findHierarchyInDimension(i)),!t)throw new Error("InvalidOperationException");this._selectedHierarchy=t,this._$selectedHierarchyInput.val(t.caption),this._options.onSelectedItem&&this._options.onSelectedItem(t)},a.prototype.getTreeViewOptions=function(){var t=this,e=new i.TreeViewOptions;return e.dataSource=a.prepareDataSource(this._options.dataSource,this._options.exludedHierarchies),e.keyExpr="id",e.displayExpr="caption",e.expandedExpr="isOpen",e.iconExpandedExpr="iconExpanded",e.iconExpr="icon",e.onItemSelected=function(e){t.onSelectNode(e)},e},Object.defineProperty(a.prototype,"view",{get:function(){return this.createLayout()},enumerable:!0,configurable:!0}),a}(),e.HierarchySelectorControl=t}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){},(t.HierarchySelector||(t.HierarchySelector={})).HierarchySelectorOptions=i}(Ranet||(Ranet={})),function(e){var i,t;i=e.Controls||(e.Controls={}),t=function(){function e(e,t){this._$rootPanel=e,this._options=t}return Object.defineProperty(e.prototype,"selectedMeasures",{get:function(){return this._selectedMeasures},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.initSelectedMeasures();var t=this,e=new i.TreeViewOptions;e.keyExpr="id",e.selectedExpr="isSelected",e.dataSource=this.prepareTree(this._options.treeMeasures,this._options.selectedUniqueNames),e.displayExpr="caption",e.expandedExpr="isOpen",e.iconExpandedExpr="iconExpanded",e.iconExpr="icon",e.draggableOptions=new i.TreeViewDraggableOptions,e.draggableOptions.$dragContainer=$(this._$rootPanel),e.onItemSelected=function(e){"measure"===e.data.type&&(t._selectedMeasures=new Array,t._selectedMeasures.push(e.data)),t.onSelectedChanged(e.data)};new i.TreeView(this._$rootPanel,e)},e.prototype.initSelectedMeasures=function(){var t=this,i=e.getMapUniqueNameToDataItem(this._options.treeMeasures);this._selectedMeasures=new Array,this._options.selectedUniqueNames.forEach(function(e){t._selectedMeasures.push(i[e])})},e.getMapUniqueNameToDataItem=function(e){var t={};return e.items.forEach(function(e){if("folder"===e.type)e.items.forEach(function(e){t[e.uniqueName]=e});else{if("measure"!==e.type)throw new Error("NotImplementedException");t[e.uniqueName]=e}}),t},e.prototype.onSelectedChanged=function(e){if(this._options.onSelectedMeasuresChanged){var t=new Array;t.push(e),this._options.onSelectedMeasuresChanged(t)}},e.prototype.prepareTree=function(e,i){var t=new Array;return e.isOpen=!0,e.items.forEach(function(e){e.items.forEach(function(t){0<i.filter(function(e){return e===t.uniqueName&&(t.isSelected=!0)}).length&&(e.isOpen=!0)})}),t.push(e),t},e}(),i.MeasureChoiceControl=t}(Ranet||(Ranet={})),function(i){var a,e;a=i.Controls||(i.Controls={}),e=function(){function r(e,t){r._directoryTemplate=i.PathManager.templatesPath,this._$rootPanel=$(e),this._options=t,this._selectedUniqueNames=t.selectedUniqueNames}return Object.defineProperty(r.prototype,"selectedUniqueNames",{get:function(){return this._selectedUniqueNames},enumerable:!0,configurable:!0}),r.prototype.init=function(){var i=this;this.getTemplate().done(function(e){$(i._$rootPanel).append(e.button.$view),i._$imageContentButton=e.button.$imageContentButton,i._$textContentButton=e.button.$textContentButton,i._$measureChoicePanel=e.control.$view,i.initButtonState();var t=function(){e.control.$view.empty(),i.showWindow()};e.button.$showDialogButton0.click(function(){return t()}),e.button.$showDialogButton1.click(function(){return t()})})},r.prototype.initButtonState=function(){var t=a.MeasureChoiceControl.getMapUniqueNameToDataItem(this._options.treeMeasures),i=new Array;this._options.selectedUniqueNames.forEach(function(e){i.push(t[e])}),this.updateButtonState(i)},r.prototype.showWindow=function(){var t=this,i=null,e=this._options.getPopupContainer(),n=new a.MeasureChoiceSelectorWindow(e,function(e){t.onOkClosedWindow(i)});n.isEnabledOkButton=!1,n.show(this._$measureChoicePanel);var o=jQuery.extend(!0,{},t._options.treeMeasures),r=new a.MeasureChoiceOptions(o,t._options.isMultiSelect);r.selectedUniqueNames=this._selectedUniqueNames,r.onSelectedMeasuresChanged=function(e){!1===t._options.isMultiSelect&&("measure"!==e[0].type?n.isEnabledOkButton=!1:n.isEnabledOkButton=!0)},(i=new a.MeasureChoiceControl(this._$measureChoicePanel[0],r)).init()},r.prototype.onOkClosedWindow=function(e){var t=e.selectedMeasures;this.updateButtonState(t),this.onSelectedMeasuresChanged(t)},r.prototype.updateButtonState=function(e){var t="",i="",n=null;0<e.length&&!1===this._options.isMultiSelect&&(t=e[0].icon,i=n=e[0].caption),null===n?this._$rootPanel.removeAttr("title"):this._$rootPanel.attr("title",n),this.updateImage(t),this._$textContentButton.text(i)},r.prototype.updateImage=function(e){var i=this,t=r._imageLibraryPrefix+""+e,n=this._$imageContentButton.attr("class").split(/\s+/);$.each(n,function(e,t){0===t.indexOf(r._imageLibraryPrefix)&&i._$imageContentButton.removeClass(t)}),this._$imageContentButton.addClass(t)},r.prototype.onSelectedMeasuresChanged=function(e){var t=this;this._selectedUniqueNames=new Array,e.forEach(function(e){return t._selectedUniqueNames.push(e.uniqueName)}),this._options.onSelectedMeasuresChanged&&this._options.onSelectedMeasuresChanged(e)},r.prototype.getTemplate=function(){var o=$.Deferred();return $.when($.ajax({url:r._directoryTemplate+"measureChoiceSelector-button.html"}),$.ajax({url:r._directoryTemplate+"measureChoiceSelector-control.html"})).done(function(e,t){var i=$(e[0]),n=$(t[0]);o.resolve({button:{$view:i,$imageContentButton:i.find("#imageContentButton"),$textContentButton:i.find("#textContentButton"),$showDialogButton0:i.find("#showDialogButton0"),$showDialogButton1:i.find("#showDialogButton1")},control:{$view:n}})}).fail(function(e){i.LogService.error(e),o.reject(e)}),o},r._imageLibraryPrefix="imageLibrary_",r}(),a.MeasureChoiceSelector=e}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){function e(e,t){this._selectedUniqueName=new Array,this._isMultiSelect=t,this._treeMeasures=e}return Object.defineProperty(e.prototype,"treeMeasures",{get:function(){return this._treeMeasures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMultiSelect",{get:function(){return this._isMultiSelect},set:function(e){this._isMultiSelect=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedUniqueNames",{get:function(){return this._selectedUniqueName},set:function(e){this._selectedUniqueName=e},enumerable:!0,configurable:!0}),e}(),t.MeasureChoiceOptions=i}(Ranet||(Ranet={})),function(s){var e,t;e=s.Controls||(s.Controls={}),t=function(){function n(e,t,i){n._directoryTemplate=s.PathManager.templatesPath,this._onOkClosed=t,this._onCancelClosed=i,this._container=e}return Object.defineProperty(n.prototype,"isEnabledOkButton",{get:function(){return this._isEnabledOkButton},set:function(e){this._isEnabledOkButton=e,this.setStateButton(e)},enumerable:!0,configurable:!0}),n.prototype.setStateButton=function(e){this._$okButton&&(e?this._$okButton.removeClass("disabled"):this._$okButton.addClass("disabled"))},n.prototype.show=function(t){var i=this;this.getWindow().done(function(e){e.$contentPanel.append(t),i.initWindow(e.$window,e.$cancelButton,e.$okButton,e.$xButton)})},n.prototype.initWindow=function(e,t,i,n){var o=this;this._$okButton=i,this.setStateButton(this.isEnabledOkButton),t.click(function(){o.clickCancelButton()}),n.click(function(){o.clickCancelButton()}),i.click(function(){o.clickOkButton()}),e.appendTo(this._container),e.modal({backdrop:!1}),e.on("hidden.bs.modal",function(){return e.remove()})},n.prototype.clickOkButton=function(){this._onOkClosed&&this._onOkClosed(this)},n.prototype.clickCancelButton=function(){this._onCancelClosed&&this._onCancelClosed(this)},n.prototype.getWindow=function(){var a=$.Deferred();return $.ajax({url:n._directoryTemplate+"measureChoiceSelector-window.html"}).done(function(e){var t=$(s.Localization.localizeTemplate(e)),i=t.find("#contentPanel"),n=t.find("#btnOk"),o=t.find("#btnCancel"),r=t.find("#btnX");a.resolve({$window:t,$okButton:n,$cancelButton:o,$xButton:r,$contentPanel:i})}).fail(function(e){s.LogService.error(e),a.reject(e)}),a},n}(),e.MeasureChoiceSelectorWindow=t}(Ranet||(Ranet={})),function(e){var t;(function(e){var t=function(){this.events=new i,this.isVisibleSlicerButton=!1};e.MemberChoiceOptions=t;var i=function(){};e.EventMemberChoice=i})((t=e.Controls||(e.Controls={})).MemberChoice||(t.MemberChoice={}))}(Ranet||(Ranet={})),function(e){!function(e){var t=function(){function e(e){this._$treeViewItem=e}return Object.defineProperty(e.prototype,"$treeViewItem",{get:function(){return this._$treeViewItem},enumerable:!0,configurable:!0}),e}();e.TreeViewItemArgs=t;var i=function(){};e.TreeViewDraggableOptions=i;var n=function(){this.hoverStateEnabled=!1,this.connectionProvider=new o,this.draggableOptions=new i};e.TreeViewOptions=n;var o=function(){};e.VirtualConnectionProvider=o}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){var n;(function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(n.VirtualConnectionProvider);e.VirtualConnectionProviderMemberChoice=t;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(n.TreeViewOptions);e.TreeViewMemberChoiceOptions=i})((n=e.Controls||(e.Controls={})).MemberChoice||(n.MemberChoice={}))}(Ranet||(Ranet={})),function(h){var d;(function(e){var s,t,i;(t=s||(s={}))[t.Caption=0]="Caption",t[t.Name=1]="Name",t[t.UniqueName=2]="UniqueName",t[t.Key0=3]="Key0",(i=e.SearchOlapSearchType||(e.SearchOlapSearchType={}))[i.Contain=0]="Contain",i[i.Equal=1]="Equal",i[i.BeginWith=2]="BeginWith";var l=e.SearchOlapSearchType,c=function(e,t,i){this.text=e,this.property=t,this.searchType=i};e.SearchDescription=c;var u=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.propertyType=i,this.isSelected=n},p=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.searchType=i,this.isSelected=n},n=function(){function n(e,t,i){this._onSearch=t,this._onCancelSearch=i,this._searchPropertyType=s.Caption,this._searchType=l.Contain,this._$panel=e,n._directoryTemplate=h.PathManager.templatesPath}return Object.defineProperty(n.prototype,"isLoadingMembersNow",{get:function(){return this._isLoadingMembersNow},set:function(e){this._isLoadingMembersNow=e,this._layoutDescription.$searchButton.empty(),this._layoutDescription.$searchButton.removeClass("disabled"),this._isLoadingMembersNow?(this._layoutDescription.$searchButton.addClass("disabled"),this._layoutDescription.$searchButton.append('<div class="fa fa-spinner fa-spin"></div>')):this._layoutDescription.$searchButton.append('<div class="glyphicon glyphicon-search"></div>')},enumerable:!0,configurable:!0}),n.prototype.init=function(){var a=this;this.getLayout().done(function(e){a._layoutDescription=e,a._$panel.append(e.$rootLayout);var t=new d.DropDownControl;t.displayPropertyExpr="caption",t.imageCssClassExp="imageCssClass",t.selectedExpr="isSelected",t.itemSource=[new u(h.Localization.localize("Olap_Caption"),"imageLibrary_memberProperty",s.Caption,!0),new u(h.Localization.localize("Olap_Name"),"imageLibrary_memberProperty",s.Name),new u(h.Localization.localize("Olap_UniqueName"),"imageLibrary_memberProperty",s.UniqueName),new u("KEY0","imageLibrary_levelProperty",s.Key0)],t.selectionChanged.on(function(e){a._searchPropertyType=e.propertyType}),e.$dropDownPanel.append(t.view);var i=new d.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=[new p(h.Localization.localize("LabelFilter_Contain"),"imageLibrary_fcopcontain",l.Contain,!0),new p(h.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",l.Equal),new p(h.Localization.localize("LabelFilter_BeginWith"),"imageLibrary_fcopbegin",l.BeginWith)],i.selectionChanged.on(function(e){a._searchType=e.searchType}),e.$searchTypeDropDownPanel.append(i.view);var n=new h.Controls.Editors.TextBoxControlOptions,o=new h.Controls.Editors.TextBoxControl(n),r=function(){var e="";switch(a._searchPropertyType){case s.Caption:e="Caption";break;case s.Key0:e="KEY0";break;case s.Name:e="Name";break;case s.UniqueName:e="UNIQUE_NAME"}a._onSearch(new c(o.text,e,a._searchType))};e.$searchButton.click(r),e.$searchTextBoxContainer.append(o.view()),n.onKeyPressed=function(e,t){13===t.which&&r()},e.$cancelSearchButton.click(function(){o.text="",a._onCancelSearch&&a._onCancelSearch()})})},n.prototype.getLayout=function(){var s=$.Deferred();return $.ajax({url:n._directoryTemplate+"searchPanel-memberChoice-view.html"}).done(function(e){var t=$(h.Localization.localizeTemplate(e)),i=t.find(".memberChoice-searchPanel-searchButton"),n=t.find(".membersChoice-searchPanel-cancelSearchButton"),o=t.find(".memberChoice-searchPanel-propertiesDropDown"),r=t.find(".memberChoice-searchPanel-searchText"),a=t.find(".memberChoice-searchPanel-comparisonDropDown");s.resolve({$rootLayout:t,$cancelSearchButton:n,$searchButton:i,$dropDownPanel:o,$searchTextBoxContainer:r,$searchTypeDropDownPanel:a})}).fail(function(e){h.LogService.error(e),s.reject(e)}),s},n}();e.SearchMembersControl=n})((d=h.Controls||(h.Controls={})).MemberChoice||(d.MemberChoice={}))}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.MemberPropertiesViewer||(t.MemberPropertiesViewer={}),n=function(){function a(e){this._options=e,this._$textArea=$("<textarea class='form-control memberPropsViewerControl-textViewer' rows='15' readonly></textarea>"),this._$textArea.val(this.content)}return Object.defineProperty(a.prototype,"content",{get:function(){var e={};e.UniqueName=this._options.memberData.uniqueName,e.Caption=this._options.memberData.caption,e.ParentUniqueName=this._options.memberData.parentUniqueName,e.LevelDepth=this._options.memberData.levelDepth,e.ChildCount=this._options.memberData.childCount,e.Name=this._options.memberData.name,e.Description=this._options.memberData.description,e.LevelName=this._options.memberData.levelName;var t,i,n,o=0;for(t in e)e.hasOwnProperty(t)&&t.length>o&&(o=t.length);if(this._options.memberData.memberProperties)for(i=0;i<this._options.memberData.memberProperties.length;i++)(n=this._options.memberData.memberProperties[i]).name.length>o&&(o=n.name.length);o+=1;var r="";for(t in e)e.hasOwnProperty(t)&&(r+=a.addSpace(t,o)+": "+e[t]+"\n");if(!this._options.memberData.memberProperties)return r;for(r+="\n",i=0;i<this._options.memberData.memberProperties.length;i++)n=this._options.memberData.memberProperties[i],r+=a.addSpace(n.name,o)+": "+n.value+"\n";return r},enumerable:!0,configurable:!0}),a.addSpace=function(e,t){for(var i=e,n=0;n<t-e.length;n++)i+=" ";return i},Object.defineProperty(a.prototype,"view",{get:function(){return this._$textArea},enumerable:!0,configurable:!0}),a}(),i.MemberPropertiesViewerControl=n}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(e){this.memberData=e},(t.MemberPropertiesViewer||(t.MemberPropertiesViewer={})).MemberPropertiesViewerOptions=i}(Ranet||(Ranet={})),function(l){var c,o,e;c=l.Controls||(l.Controls={}),o=function(e,t,i,n){this.caption=e,this.filterType=i,this.imageCssClass=t,this.isSelected=n},e=function(){function s(t,i,n,e){var o=this;s._directoryTemplate=l.PathManager.templatesPath;var r=s.getLayout(),a=this;null===i&&(i=this.getDefaultValueForCustomFilter()),this._customFilterOptions=i,this._newCustomFilterOptions=jQuery.extend(!0,{},this._customFilterOptions),this._$measureChoiceContainer=e,r.done(function(e){a._layoutDescription=e,a.initFilterTypeSelector(),a._labelFilterControl=new c.LabelFilterControl(a._layoutDescription.customFilterPanels.$labelFilterPanel,i.labelFilter),a._labelFilterControl.init(),a._valueFilterControl=new c.ValueFilterControl(a._layoutDescription.customFilterPanels.$valueFilterPanel,i.valueFilter,n,o._$measureChoiceContainer),a._valueFilterControl.init(),a._topFilterControl=new c.TopFilterControl(a._layoutDescription.customFilterPanels.$topFilterPanel,i.topFilter,n,o._$measureChoiceContainer),a._topFilterControl.init(),$(t).append(a._layoutDescription.$rootLayout)})}return Object.defineProperty(s.prototype,"actualCustomFilterOptions",{get:function(){switch(this._newCustomFilterOptions.labelFilter=new c.LabelDataFilter,this._newCustomFilterOptions.topFilter=new c.TopDataFilter,this._newCustomFilterOptions.valueFilter=new c.ValueDataFilter,this._newCustomFilterOptions.currentDataFilter){case c.DataFilterType.LabelFilter:this._newCustomFilterOptions.labelFilter=this._labelFilterControl.actualOptions;break;case c.DataFilterType.TopFilter:this._newCustomFilterOptions.topFilter=this._topFilterControl.actualOptions;break;case c.DataFilterType.ValueFilter:this._newCustomFilterOptions.valueFilter=this._valueFilterControl.actualOptions;break;default:throw new Error("NotImplemetationException")}return this._newCustomFilterOptions},enumerable:!0,configurable:!0}),s.prototype.getDefaultValueForCustomFilter=function(){var e=new c.CustomFilterOptions;return e.currentDataFilter=c.DataFilterType.LabelFilter,e.labelFilter=new c.LabelDataFilter,e.topFilter=new c.TopDataFilter,e.valueFilter=new c.ValueDataFilter,e},s.prototype.initFilterTypeSelector=function(){var t=this,e=this._customFilterOptions.currentDataFilter;this.updateFilterPanel(e);var i=[new o(l.Localization.localize("LabelFilter_Name"),"imageLibrary_labelFilter",c.DataFilterType.LabelFilter,e===c.DataFilterType.LabelFilter),new o(l.Localization.localize("ValueFilter_Name"),"imageLibrary_valueFilter",c.DataFilterType.ValueFilter,e===c.DataFilterType.ValueFilter),new o(l.Localization.localize("TopFilter_Name"),"imageLibrary_topFilter",c.DataFilterType.TopFilter,e===c.DataFilterType.TopFilter)],n=new c.DropDownControl;n.displayPropertyExpr="caption",n.imageCssClassExp="imageCssClass",n.selectedExpr="isSelected",n.itemSource=i,n.selectionChanged.on(function(e){t._newCustomFilterOptions.currentDataFilter=e.filterType,t.updateFilterPanel(e.filterType)}),this._layoutDescription.$filterTypeDropDownPanel.append(n.view)},s.prototype.updateFilterPanel=function(e){switch(this._layoutDescription.customFilterPanels.$labelFilterPanel.hide(),this._layoutDescription.customFilterPanels.$topFilterPanel.hide(),this._layoutDescription.customFilterPanels.$valueFilterPanel.hide(),e){case c.DataFilterType.LabelFilter:this._layoutDescription.customFilterPanels.$labelFilterPanel.show();break;case c.DataFilterType.TopFilter:this._layoutDescription.customFilterPanels.$topFilterPanel.show();break;case c.DataFilterType.ValueFilter:this._layoutDescription.customFilterPanels.$valueFilterPanel.show();break;default:throw new Error("NotImplementationException")}},s.getLayout=function(){var i=$.Deferred();return $.ajax({url:s._directoryTemplate+"customFilter-view.html"}).done(function(e){var t=$(l.Localization.localizeTemplate(e));i.resolve({$rootLayout:t,customFilterPanels:{$labelFilterPanel:t.find("#labelFilterPanel"),$topFilterPanel:t.find("#topFilterPanel"),$valueFilterPanel:t.find("#valueFilterPanel")},$filterTypeDropDownPanel:t.find(".filterEditorWindow-filterTypeDropDown")})}).fail(function(e){i.reject(e),l.LogService.error(e)}),i},s}(),c.CustomFilterControl=e}(Ranet||(Ranet={})),function(n){var o,r,a,e;o=n.Controls||(n.Controls={}),r=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.levelPropertyName=i,this.isSelected=n},a=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n},e=function(){function e(e,t){this._$view=e,this._options=t,this._newOptions=jQuery.extend(!0,{},this._options)}return Object.defineProperty(e.prototype,"actualOptions",{get:function(){return this._newOptions.text1=this._$textBox1.val(),this._newOptions.text2=this._$textBox2.val(),this._newOptions},enumerable:!0,configurable:!0}),e.prototype.parseView=function(e){this._$levelPropertyDropDownPanel=e.find(".filterEditorWindow-levelPropertyDropDownPanel"),this._$labelFilterTypeDropDownPanel=e.find(".filterEditorWindow-labelFilterTypeDropDownPanel"),this._$textBox1=e.find("#textBox1LabelFilterControl"),this._$textBox2=e.find("#textBox2LabelFilterControl"),this._$textBox1Panel=e.find("#textBox1LabelFilterControlPanel"),this._$textBox2Panel=e.find("#textBox2LabelFilterControlPanel"),this._$labelAndPanel=e.find("#andLabelFilterControlPanel")},e.prototype.init=function(){this.parseView(this._$view),this.initLevelPropName(),this.initFilterType(),this.initTextBoxes()},e.prototype.initTextBoxes=function(){this._$textBox1.val(this._options.text1),this._$textBox2.val(this._options.text2)},e.prototype.initLevelPropName=function(){var t=this,e=[new r(n.Localization.localize("Olap_Caption"),"imageLibrary_levelProperty","Caption","Caption".toUpperCase()===this._options.levelPropertyName.toUpperCase()),new r(n.Localization.localize("Olap_Name"),"imageLibrary_levelProperty","Name","Name".toUpperCase()===this._options.levelPropertyName.toUpperCase()),new r(n.Localization.localize("Olap_UniqueName"),"imageLibrary_levelProperty","UNIQUE_NAME","UNIQUE_NAME".toUpperCase()===this._options.levelPropertyName.toUpperCase())],i=new o.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=e,i.selectionChanged.on(function(e){t._newOptions.levelPropertyName=e.levelPropertyName}),this._$levelPropertyDropDownPanel.append(i.view)},e.prototype.initFilterType=function(){var t=this;this.updateStateFilterType(this._options.filterType);var e=new Array;e.push(new a(n.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",o.LabelDataFilterType.Equal,o.LabelDataFilterType.Equal===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_NotEqual"),"imageLibrary_fcopnotequal",o.LabelDataFilterType.NotEqual,o.LabelDataFilterType.NotEqual===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_Greater"),"imageLibrary_fcopgreater",o.LabelDataFilterType.Greater,o.LabelDataFilterType.Greater===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_GreaterOrEqual"),"imageLibrary_fcopgreaterorequal",o.LabelDataFilterType.GreaterOrEqual,o.LabelDataFilterType.GreaterOrEqual===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_Less"),"imageLibrary_fcopless",o.LabelDataFilterType.Less,o.LabelDataFilterType.Less===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_LessOrEqual"),"imageLibrary_fcoplessorequal",o.LabelDataFilterType.LessOrEqual,o.LabelDataFilterType.LessOrEqual===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_Between"),"imageLibrary_fcopbetween",o.LabelDataFilterType.Between,o.LabelDataFilterType.Between===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_BetweenNotIncluding"),"imageLibrary_fcopbetweennotincluding",o.LabelDataFilterType.BetweenNotIncluding,o.LabelDataFilterType.BetweenNotIncluding===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_NotBetween"),"imageLibrary_fcopnotbetween",o.LabelDataFilterType.NotBetween,o.LabelDataFilterType.NotBetween===this._options.filterType)),e.push(new a(n.Localization.localize("ValueFilter_NotBetweenNotIncluding"),"imageLibrary_fcopnotbetweennotincluding",o.LabelDataFilterType.NotBetweenNotIncluding,o.LabelDataFilterType.NotBetweenNotIncluding===this._options.filterType)),e.push(new a(n.Localization.localize("LabelFilter_BeginWith"),"imageLibrary_fcopbegin",o.LabelDataFilterType.BeginWith,o.LabelDataFilterType.BeginWith===this._options.filterType)),e.push(new a(n.Localization.localize("LabelFilter_NotBeginWith"),"imageLibrary_fcopbeginnot",o.LabelDataFilterType.NotBeginWith,o.LabelDataFilterType.NotBeginWith===this._options.filterType)),e.push(new a(n.Localization.localize("LabelFilter_EndWith"),"imageLibrary_fcopend",o.LabelDataFilterType.EndWith,o.LabelDataFilterType.EndWith===this._options.filterType)),e.push(new a(n.Localization.localize("LabelFilter_NotEndWith"),"imageLibrary_fcopendnot",o.LabelDataFilterType.NotEndWith,o.LabelDataFilterType.NotEndWith===this._options.filterType)),e.push(new a(n.Localization.localize("LabelFilter_Contain"),"imageLibrary_fcopcontain",o.LabelDataFilterType.Contain,o.LabelDataFilterType.Contain===this._options.filterType)),e.push(new a(n.Localization.localize("LabelFilter_NotContain"),"imageLibrary_fcopnotcontain",o.LabelDataFilterType.NotContain,o.LabelDataFilterType.NotContain===this._options.filterType));var i=new o.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=e,i.selectionChanged.on(function(e){t.updateStateFilterType(e.filterType)}),this._$labelFilterTypeDropDownPanel.append(i.view)},e.prototype.updateStateFilterType=function(e){switch(this._newOptions.filterType=e){case o.LabelDataFilterType.Between:case o.LabelDataFilterType.BetweenNotIncluding:case o.LabelDataFilterType.NotBetween:case o.LabelDataFilterType.NotBetweenNotIncluding:this.updateStateTextEditor(!0);break;default:this.updateStateTextEditor(!1)}},e.prototype.updateStateTextEditor=function(e){e?(this._$textBox1Panel.removeClass("filterEditorWindow-contentTextEditorPanel_width100percent"),this._$textBox1Panel.addClass("filterEditorWindow-contentTextEditorPanel_width40percent"),this._$textBox2Panel.removeClass("filterEditorWindow-visibility_collapsed"),this._$labelAndPanel.removeClass("filterEditorWindow-visibility_collapsed")):(this._$textBox1Panel.removeClass("filterEditorWindow-contentTextEditorPanel_width40percent"),this._$textBox1Panel.addClass("filterEditorWindow-contentTextEditorPanel_width100percent"),this._$textBox2Panel.addClass("filterEditorWindow-visibility_collapsed"),this._$labelAndPanel.addClass("filterEditorWindow-visibility_collapsed"))},e}(),o.LabelFilterControl=e}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){this.isUsed=!1,this.currentDataFilter=t.DataFilterType.LabelFilter,this.labelFilter=new t.LabelDataFilter,this.topFilter=new t.TopDataFilter,this.valueFilter=new t.ValueDataFilter},t.CustomFilterOptions=i}(Ranet||(Ranet={})),function(e){!function(e){var t;(t=e.DataFilterType||(e.DataFilterType={}))[t.LabelFilter=0]="LabelFilter",t[t.ValueFilter=1]="ValueFilter",t[t.TopFilter=2]="TopFilter";e.DataFilterType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(e){e?(this.text1=e.text1,this.text2=e.text2,this.levelPropertyName=e.levelPropertyName,this.filterType=e.filterType):(this.text1="",this.text2="",this.levelPropertyName="Caption",this.filterType=t.LabelDataFilterType.Equal)},t.LabelDataFilter=i}(Ranet||(Ranet={})),function(e){!function(e){var t;(t=e.LabelDataFilterType||(e.LabelDataFilterType={}))[t.Equal=0]="Equal",t[t.NotEqual=1]="NotEqual",t[t.Greater=2]="Greater",t[t.GreaterOrEqual=3]="GreaterOrEqual",t[t.Less=4]="Less",t[t.LessOrEqual=5]="LessOrEqual",t[t.Between=6]="Between",t[t.BetweenNotIncluding=7]="BetweenNotIncluding",t[t.NotBetween=8]="NotBetween",t[t.NotBetweenNotIncluding=9]="NotBetweenNotIncluding",t[t.BeginWith=10]="BeginWith",t[t.NotBeginWith=11]="NotBeginWith",t[t.EndWith=12]="EndWith",t[t.NotEndWith=13]="NotEndWith",t[t.Contain=14]="Contain",t[t.NotContain=15]="NotContain";e.LabelDataFilterType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(e){e?(this.filterType=e.filterType,this.count=e.count,this.filterTarget=e.filterTarget,this.measureUniqueName=e.measureUniqueName):(this.filterType=t.TopDataFilterType.Top,this.count=0,this.filterTarget=t.TopDataFilterTargetType.Items,this.measureUniqueName="")},t.TopDataFilter=i}(Ranet||(Ranet={})),function(e){!function(e){var t;(t=e.TopDataFilterTargetType||(e.TopDataFilterTargetType={}))[t.Items=0]="Items",t[t.Percent=1]="Percent",t[t.Sum=2]="Sum";e.TopDataFilterTargetType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){!function(e){var t;(t=e.TopDataFilterType||(e.TopDataFilterType={}))[t.Top=0]="Top",t[t.Bottom=1]="Bottom";e.TopDataFilterType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(e){e?(this.num1=e.num1,this.num2=e.num2,this.measureUniqueName=e.measureUniqueName,this.filterType=e.filterType):(this.num1=0,this.num2=0,this.measureUniqueName="",this.filterType=t.ValueDataFilterType.Equal)},t.ValueDataFilter=i}(Ranet||(Ranet={})),function(e){!function(e){var t;(t=e.ValueDataFilterType||(e.ValueDataFilterType={}))[t.Equal=0]="Equal",t[t.NotEqual=1]="NotEqual",t[t.Greater=2]="Greater",t[t.GreaterOrEqual=3]="GreaterOrEqual",t[t.Less=4]="Less",t[t.LessOrEqual=5]="LessOrEqual",t[t.Between=6]="Between",t[t.BetweenNotIncluding=7]="BetweenNotIncluding",t[t.NotBetween=8]="NotBetween",t[t.NotBetweenNotIncluding=9]="NotBetweenNotIncluding";e.ValueDataFilterType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(n){var o,r,a,e;o=n.Controls||(n.Controls={}),r=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n},a=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterTargetType=i,this.isSelected=n},e=function(){function e(e,t,i,n){this._$view=e,this._options=t,this._newOptions=jQuery.extend(!0,{},this._options),this._treeMeasures=i,this._$measureChoiceContainer=n}return Object.defineProperty(e.prototype,"actualOptions",{get:function(){return this._newOptions.count=parseInt(this._$countNumericDown.val()),isNaN(this._newOptions.count)&&(this._newOptions.count=0),this._newOptions},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.parseView(this._$view),this.initFilterType(),this.initFilterTargetType(),this.initCountTextBox(),this.initMeasureChoiceControl()},e.prototype.initCountTextBox=function(){this._$countNumericDown.val(this._options.count.toString())},e.prototype.initFilterTargetType=function(){var e=new Array;e.push(new a(n.Localization.localize("Filter_Target_Items"),"imageLibrary_items",o.TopDataFilterTargetType.Items,o.TopDataFilterTargetType.Items===this.actualOptions.filterTarget)),e.push(new a(n.Localization.localize("Filter_Target_Percent"),"imageLibrary_percent",o.TopDataFilterTargetType.Percent,o.TopDataFilterTargetType.Percent===this.actualOptions.filterTarget)),e.push(new a(n.Localization.localize("Filter_Target_Sum"),"imageLibrary_sum",o.TopDataFilterTargetType.Sum,o.TopDataFilterTargetType.Sum===this.actualOptions.filterTarget));var t=this,i=new o.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=e,i.selectionChanged.on(function(e){t._newOptions.filterTarget=e.filterTargetType}),this._$filterTargetTypeDropDownPanel.append(i.view)},e.prototype.initMeasureChoiceControl=function(){var t=this,e=new o.MeasureChoiceOptions(this._treeMeasures,!1),i=this;e.getPopupContainer=function(){return i._$measureChoiceContainer},e.isMultiSelect=!1,this._newOptions.measureUniqueName&&(e.selectedUniqueNames=[this._newOptions.measureUniqueName]),e.onSelectedMeasuresChanged=function(e){t._newOptions.measureUniqueName=e[0].uniqueName},new o.MeasureChoiceSelector(this._$measureChoicePanel[0],e).init()},e.prototype.initFilterType=function(){var t=this,e=new Array;e.push(new r(n.Localization.localize("Filter_Type_Top"),"imageLibrary_top",o.TopDataFilterType.Top,o.TopDataFilterType.Top===this._options.filterType)),e.push(new r(n.Localization.localize("Filter_Type_Bottom"),"imageLibrary_bottom",o.TopDataFilterType.Bottom,o.TopDataFilterType.Bottom===this._options.filterType));var i=new o.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=e,i.selectionChanged.on(function(e){t._newOptions.filterType=e.filterType}),this._$topFilterDataTypeDropDownPanel.append(i.view)},e.prototype.parseView=function(e){this._$topFilterDataTypeDropDownPanel=e.find(".filterEditorWindow-topFilterPanel-filterTypeDropDownPanel"),this._$filterTargetTypeDropDownPanel=e.find(".filterEditorWindow-topFilterPanel-targetTypeDropDownPanel"),this._$measureChoicePanel=e.find("#measureChoicePanelTopFilter"),this._$countNumericDown=e.find("#countNumericDownFilterTargetType")},e}(),o.TopFilterControl=e}(Ranet||(Ranet={})),function(n){var o,r,e;o=n.Controls||(n.Controls={}),r=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n},e=function(){function e(e,t,i,n){this._$view=e,this._options=t,this._treeMeasures=i,this._$measureChoiceContainer=n,this._newOptions=jQuery.extend(!0,{},this._options)}return Object.defineProperty(e.prototype,"actualOptions",{get:function(){return this._newOptions.num1=Number(this._$numericBox1.val()),this._newOptions.num2=Number(this._$numericBox2.val()),isNaN(this._newOptions.num1)&&(this._newOptions.num1=0),isNaN(this._newOptions.num2)&&(this._newOptions.num2=0),this._newOptions},enumerable:!0,configurable:!0}),e.prototype.parseView=function(e){this._$valueFilterTypeDropDownPanel=e.find(".filterEditorWindow-valueFilterTypeDropDownPanel"),this._$numericBox1=e.find("#numericBox1ValueFilter"),this._$numericBox2=e.find("#numericBox2ValueFilter"),this._$numericBox1Panel=e.find("#numericBox1ValueFilterControlPanel"),this._$numericBox2Panel=e.find("#numericBox2ValueFilterControlPanel"),this._$labelAndPanel=e.find("#andValueFilterControlPanel"),this._$measureChoicePanel=e.find("#measureChoicePanelValueFilter")},e.prototype.init=function(){this.parseView(this._$view),this.initFilterType(),this.initNumeriUpDowns(),this.initMeasureChoiceControl()},e.prototype.initMeasureChoiceControl=function(){var t=this,e=new o.MeasureChoiceOptions(this._treeMeasures,!1);e.getPopupContainer=function(){return t._$measureChoiceContainer},e.isMultiSelect=!1,this._newOptions.measureUniqueName&&(e.selectedUniqueNames=[this._newOptions.measureUniqueName]),e.onSelectedMeasuresChanged=function(e){t._newOptions.measureUniqueName=e[0].uniqueName},new o.MeasureChoiceSelector(this._$measureChoicePanel[0],e).init()},e.prototype.initNumeriUpDowns=function(){this._$numericBox1.val(this._options.num1.toString()),this._$numericBox2.val(this._options.num2.toString())},e.prototype.initFilterType=function(){var t=this,e=new Array;e.push(new r(n.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",o.ValueDataFilterType.Equal,o.ValueDataFilterType.Equal===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_NotEqual"),"imageLibrary_fcopnotequal",o.ValueDataFilterType.NotEqual,o.ValueDataFilterType.NotEqual===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_Greater"),"imageLibrary_fcopgreater",o.ValueDataFilterType.Greater,o.ValueDataFilterType.Greater===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_GreaterOrEqual"),"imageLibrary_fcopgreaterorequal",o.ValueDataFilterType.GreaterOrEqual,o.ValueDataFilterType.GreaterOrEqual===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_Less"),"imageLibrary_fcopless",o.ValueDataFilterType.Less,o.ValueDataFilterType.Less===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_LessOrEqual"),"imageLibrary_fcoplessorequal",o.ValueDataFilterType.LessOrEqual,o.ValueDataFilterType.LessOrEqual===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_Between"),"imageLibrary_fcopbetween",o.ValueDataFilterType.Between,o.ValueDataFilterType.Between===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_BetweenNotIncluding"),"imageLibrary_fcopbetweennotincluding",o.ValueDataFilterType.BetweenNotIncluding,o.ValueDataFilterType.BetweenNotIncluding===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_NotBetween"),"imageLibrary_fcopnotbetween",o.ValueDataFilterType.NotBetween,o.ValueDataFilterType.NotBetween===this._options.filterType)),e.push(new r(n.Localization.localize("ValueFilter_NotBetweenNotIncluding"),"imageLibrary_fcopnotbetweennotincluding",o.ValueDataFilterType.NotBetweenNotIncluding,o.ValueDataFilterType.NotBetweenNotIncluding===this._options.filterType)),this.updateStateFilterType(this._options.filterType);var i=new o.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=e,i.selectionChanged.on(function(e){t.updateStateFilterType(e.filterType)}),this._$valueFilterTypeDropDownPanel.append(i.view)},e.prototype.updateStateFilterType=function(e){switch(this._newOptions.filterType=e){case o.ValueDataFilterType.Between:case o.ValueDataFilterType.BetweenNotIncluding:case o.ValueDataFilterType.NotBetween:case o.ValueDataFilterType.NotBetweenNotIncluding:this.updateStateTextEditor(!0);break;default:this.updateStateTextEditor(!1)}},e.prototype.updateStateTextEditor=function(e){e?(this._$numericBox1Panel.removeClass("filterEditorWindow-contentTextEditorPanel_width100percent"),this._$numericBox1Panel.addClass("filterEditorWindow-contentTextEditorPanel_width40percent"),this._$numericBox2Panel.removeClass("filterEditorWindow-visibility_collapsed"),this._$labelAndPanel.removeClass("filterEditorWindow-visibility_collapsed")):(this._$numericBox1Panel.removeClass("filterEditorWindow-contentTextEditorPanel_width40percent"),this._$numericBox1Panel.addClass("filterEditorWindow-contentTextEditorPanel_width100percent"),this._$numericBox2Panel.addClass("filterEditorWindow-visibility_collapsed"),this._$labelAndPanel.addClass("filterEditorWindow-visibility_collapsed"))},e}(),o.ValueFilterControl=e}(Ranet||(Ranet={})),function(f){var a,e;a=f.Controls||(f.Controls={}),e=function(){function s(e,t,i,n,o,r,a){this._customFilterControl=null,this._smartCustomFilterControl=null,this._useSimpleCustomFilter=!1,this._useSmartCustomFiter=!1,this._currentHierarchy=n,this._container=o,this._isVisibleCustomFilterPanel=i,this._filterOptions=e,this._newFilterOptionsArgs=jQuery.extend(!0,{},this._filterOptions),s._directoryTemplate=f.PathManager.templatesPath,this._treeMeasures=t,this._onOkClosed=r,this._onCancelClosed=a}return s.prototype.show=function(){f.UserActionsTracker.track("Open the 'Filter Editor'");var t=this;if(this._$filterWindow)throw Error("InvalidOperationException");this.getWindow().done(function(e){t.initWindow(e,t._filterOptions)})},s.prototype.initWindow=function(t,e){var r=this,i=this;this._$filterWindow=t.$window,this._isVisibleCustomFilterPanel||(t.$useSimpleCustomFilterPanel.hide(),t.$useSmartCustomFilterPanel.hide(),t.$panelCustomFilterControl.hide(),t.$customFilterTab.hide());var n=e.customFilterOptions.isUsed||e.smartCustomFilterDescription.isUsed;if(this.setStatePanel(t.$panelCustomFilterControl,n),this.setStatePanel(t.$panelMemberChoiceControl,e.useMembersChoiceFilter),e.useMembersChoiceFilter&&t.$checkBoxUseMemberChoiceFilter.attr("checked",""),e.customFilterOptions.isUsed?(t.$useSmartCustomFilterPanel.hide(),this._useSimpleCustomFilter=!0,t.$useSimpleCustomFilterCheckBox.attr("checked","")):t.$useSimpleCustomFilterPanel.hide(),e.smartCustomFilterDescription.isUsed&&(this._useSmartCustomFiter=!0,t.$useSmartCustomFilterCheckBox.attr("checked","")),t.$useSimpleCustomFilterCheckBox.click(function(){var e=t.$useSimpleCustomFilterCheckBox.is(":checked");i._useSimpleCustomFilter=e,i.setStatePanel(t.$panelCustomFilterControl,e)}),t.$useSmartCustomFilterCheckBox.click(function(){var e=t.$useSmartCustomFilterCheckBox.is(":checked");i._useSmartCustomFiter=e,i.setStatePanel(t.$panelCustomFilterControl,e)}),t.$checkBoxUseMemberChoiceFilter.click(function(){var e=t.$checkBoxUseMemberChoiceFilter.is(":checked");i._newFilterOptionsArgs.useMembersChoiceFilter=e,i.setStatePanel(t.$panelMemberChoiceControl,e)}),t.$cancelButton.click(function(){i.clickCancelButton()}),t.$xButton.click(function(){i.clickCancelButton()}),t.$okButton.click(function(){f.UserActionsTracker.track("Apply filters from the 'Filter Editor'"),r._smartCustomFilterControl?(r._smartCustomFilterControl.isValid?(t.$validIndicator.addClass("validation-indicator-hidden"),i.clickOkButton(),$(t.$window).modal("hide")):t.$validIndicator.removeClass("validation-indicator-hidden"),!0):(i.clickOkButton(),$(t.$window).modal("hide"))}),this._memberChoiceControl=new a.MemberChoice.MemberChoiceControl(t.$panelMemberChoiceControl[0],e.membersChoiceFilterOptions),this._useSimpleCustomFilter)this._customFilterControl=new a.CustomFilterControl(t.$panelCustomFilterControl[0],e.customFilterOptions,this._treeMeasures,this._container);else{var o=new a.SmartFilter.CustomFilterOptions;o.hierarchyUniqueName=e.membersChoiceFilterOptions.hierarchyUniqueName,o.measureChoiceContainer=this._container,o.treeMeasures=this._treeMeasures,o.filterTreeDescription=e.smartCustomFilterDescription.filterTreeDescription,this._smartCustomFilterControl=new a.SmartFilter.CustomFilterControl(t.$panelCustomFilterControl[0],o),this._smartCustomFilterControl.onValueChanged.on(function(){t.$validIndicator.addClass("validation-indicator-hidden")}),this._memberChoiceControl.onLevelsChanged.on(function(e){var t=new Array,i=new a.SmartFilter.Options.LevelDescription;i.uniqueName=null,i.levelNumber=-1,i.caption=r._currentHierarchy.caption,i.imageClass="imageLibrary_"+r._currentHierarchy.icon.replace("_filter",""),i.order=0,t.push(i);for(var n=0;n<e.length;n++){var o=new a.SmartFilter.Options.LevelDescription;o.uniqueName=e[n].uniqueName,o.imageClass="imageLibrary_"+e[n].icon,o.caption=e[n].caption,o.levelNumber=e[n].levelNumber,o.order=n+1,t.push(o)}r._smartCustomFilterControl.levels=t})}this._$filterWindow.modal("show").appendTo(this._container),this._$filterWindow.on("shown.bs.modal",function(){i._$filterWindow.draggable({handle:".modal-header"})}),this._$filterWindow.on("hidden.bs.modal",function(){i._$filterWindow.draggable("destroy"),i._$filterWindow.remove()})},s.prototype.clickOkButton=function(){if(this._newFilterOptionsArgs.membersChoiceFilterOptions.selectionRootNodes=this._memberChoiceControl.selectionRootNodes,null!=this._customFilterControl&&(this._newFilterOptionsArgs.customFilterOptions=this._customFilterControl.actualCustomFilterOptions,this._newFilterOptionsArgs.customFilterOptions.isUsed=this._useSimpleCustomFilter),null!=this._smartCustomFilterControl){var e=this._smartCustomFilterControl.filterTreeDescription;this._newFilterOptionsArgs.smartCustomFilterDescription.isUsed=this._useSmartCustomFiter,this._newFilterOptionsArgs.smartCustomFilterDescription.filterTreeDescription=e}this._onOkClosed&&this._onOkClosed(this,this._newFilterOptionsArgs)},s.prototype.clickCancelButton=function(){this._onCancelClosed&&this._onCancelClosed(this)},s.prototype.setStatePanel=function(e,t){t?e.removeClass("memberChoice_disabled"):e.addClass("memberChoice_disabled")},s.prototype.getWindow=function(){var m=$.Deferred();return $.ajax({url:s._directoryTemplate+"filter-window.html"}).done(function(e){var t=$(f.Localization.localizeTemplate(e)),i=t.find(".filterEditorWindow-okButton"),n=t.find(".filterEditorWindow-cancelButton"),o=t.find(".filterEditorWindow-memberChoicePanel"),r=t.find(".filterEditorWindow-useMemberChoiceCheckbox input"),a=t.find(".close"),s=t.find("#customFilterTab"),l=t.find(".filterEditorWindow-customFilterPanel"),c=t.find(".filterEditorWindow-useSimpleCustomFilterCheckbox"),u=c.find("input"),p=t.find(".filterEditorWindow-useSmartCustomFilterCheckbox"),h=p.find("input"),d=t.find(".filterEditorWindow-validationIndicator");m.resolve({$window:t,$okButton:i,$cancelButton:n,$checkBoxUseMemberChoiceFilter:r,$panelMemberChoiceControl:o,$xButton:a,$panelCustomFilterControl:l,$customFilterTab:s,$useSimpleCustomFilterCheckBox:u,$useSimpleCustomFilterPanel:c,$useSmartCustomFilterCheckBox:h,$useSmartCustomFilterPanel:p,$validIndicator:d})}).fail(function(e){f.LogService.error(e),m.reject(e)}),m},s}(),a.FilterEditorWindow=e}(Ranet||(Ranet={})),function(o){o.ranetMeasureGroupSelector=function(e,t){var i=this,n={};this.settings={},this.init=function(){i.settings=o.extend({},n,t),new Ranet.Controls.MeasureGroupSelector(e,t)},this.option=function(e){},this.init()},o.fn.ranetMeasureGroupSelector=function(t){return this.each(function(){var e=new o.ranetMeasureGroupSelector(this,t);o(this).data("ranetMeasureGroupSelector",e)})}}(jQuery),function(i){var n,e;n=i.Controls||(i.Controls={}),e=function(){function e(e,t){if(void 0===t.selectedMeasureGroupName||void 0===t.dataSource)throw new Error("ArgumentException");this._dropDownControl=this.getDropDownControl(function(e){t.onMeasureGroupSelectedChanged&&t.onMeasureGroupSelectedChanged(e)}),this._selectedMeasureGroupName=t.selectedMeasureGroupName,null!==t.dataSource&&(this.dataSource=t.dataSource),$(e).append(this._dropDownControl.view)}return Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){var t=this;this._dataSource=e,this._dataSource.splice(0,0,{caption:i.Localization.localize("MeasureGroup_All"),isSelected:null===this._selectedMeasureGroupName,isAll:!0}),null!==this._selectedMeasureGroupName&&this.dataSource.forEach(function(e){e.name===t._selectedMeasureGroupName&&(e.isSelected=!0)}),this._dropDownControl.itemSource=this._dataSource},enumerable:!0,configurable:!0}),e.prototype.getDropDownControl=function(t){var e=new n.DropDownControl;return e.selectionChanged.on(function(e){e.hasOwnProperty("isAll")?t(null):t(e)}),e.displayPropertyExpr="caption",e.selectedExpr="isSelected",e},e}(),n.MeasureGroupSelector=e}(Ranet||(Ranet={})),function(o){var e,t,i;e=o.Controls||(o.Controls={}),t=e.MemberChoice||(e.MemberChoice={}),i=function(){function e(e){this._connection=e}return e.prototype.getLevels=function(e,t){var i=$.Deferred();return $.ajax({type:"POST",url:o.PathManager.applicationUrl+"api/olap/memberchoice/getLevels",data:{connection:this._connection,cubeName:e,hierarchyUniqueName:t},success:function(e){i.resolve(e)},error:function(e){o.LogService.error(e),o.UserMessageService.showServerError(e),i.reject(e)}}),i},e.prototype.getMembers=function(t){var i=$.Deferred();return $.ajax({type:"POST",url:o.PathManager.applicationUrl+"api/olap/memberchoice/getMembers",data:{connection:this._connection,query:t},success:function(e){i.resolve(e)},error:function(e){o.LogService.error(e,t),o.UserMessageService.showServerError(e),console.log(e),i.reject(e)}}),i},e.prototype.actualizeSelectionTree=function(e,t,i){var n=$.Deferred();return $.ajax({type:"POST",url:o.PathManager.applicationUrl+"api/olap/memberchoice/actualizeSelectionTree",data:{connection:this._connection,hierarchyUniqueName:t,selectionTree:JSON.stringify(i),cubeName:e},success:function(e){n.resolve(e)},error:function(e){o.LogService.error(e,t,i),o.UserMessageService.showServerError(e),n.reject(e)}}),n},e}(),t.DataService=i}(Ranet||(Ranet={})),function(u){var e,t,i;e=u.Controls||(u.Controls={}),t=e.Slicer||(e.Slicer={}),i=function(){function e(e){this._options=e,this._defaultColumnCount=1,this._defaultButtonWidth=70,this._defaultMaxHeight=300,void 0!==this._options&&(this._defaultColumnCount=this._options.defaultColumnCount,this._defaultButtonWidth=this._options.defaultButtonWidth,this._defaultMaxHeight=this._options.defaultMaxHeight)}return Object.defineProperty(e.prototype,"columnCount",{get:function(){return Number(this._$columnCountInput.val())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buttonWidth",{get:function(){return Number(this._$buttonWidthInput.val())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxHeight",{get:function(){return Number(this._$maxHeightInput.val())},enumerable:!0,configurable:!0}),e.prototype.createView=function(){var e=$("<div/>"),t=$("<div/>"),i=$("<span>"+u.Localization.localize("CountColumnsLabel")+"</label>"),n=$('<input class="form-control" type="number" step="1" value="'+this._defaultColumnCount+'">');this._$columnCountInput=n,t.append(i),t.append(n);var o=$("<div/>"),r=$("<span>"+u.Localization.localize("ColumnWidthLabel")+"</label>"),a=$('<input class="form-control" type="number" step="1" value="'+this._defaultButtonWidth+'">');this._$buttonWidthInput=a,o.append(r),o.append(a);var s=$("<div/>"),l=$("<span>"+u.Localization.localize("MaxHeightPanel")+"</label>"),c=$('<input class="form-control" type="number" step="1" value="'+this._defaultMaxHeight+'">');return this._$maxHeightInput=c,s.append(l),s.append(c),e.append(t),e.append(o),e.append(s),e},Object.defineProperty(e.prototype,"view",{get:function(){return this._$view||(this._$view=this.createView()),this._$view},enumerable:!0,configurable:!0}),e}(),t.SlicerSettingsControl=i}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){},(t.Slicer||(t.Slicer={})).SlicerControlOptions=i}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.MemberChoice||(t.MemberChoice={}),n=function(){function h(e,t,i,n){this.childNodes=new Array,this.selectedDescendants=n,this.selectedChildren=i,this.selectedSelf=t,this.uniqueName=e}return h.prototype.buildMdx=function(){if(this instanceof h!=0){var e=this.buildMdx1();return void 0===e.includeSet?"{}":e.includeSet}},h.prototype.buildMdx1=function(e,t){if(this instanceof h!=0){for(var i=new Array,n=new Array,o=0;o<this.childNodes.length;o++){var r=this.childNodes[o].buildMdx1(this.selectedChildren,void 0===this.selectedDescendants?t:this.selectedDescendants);void 0!==r.includeSet&&i.push(r.includeSet),void 0!==r.excludeSet&&n.push(r.excludeSet)}var a,s,l=this.combineToSet(i),c=this.combineToSet(n),u=new Array,p=new Array;return void 0!==this.selectedDescendants?this.buildDescendants(u,p,e,t):(this.buildChildren(u,p,e,t),this.buildSelf(u,p,e,t)),0<u.length?(u=u.concat(i),a=this.combineToSet(u),void 0!==c&&(a=this.buildExceptMdx(a,c))):a=l,0<p.length?(p=p.concat(n),s=this.combineToSet(p),void 0!==l&&(s=this.buildExceptMdx(s,l))):s=c,{includeSet:a,excludeSet:s}}},h.prototype.buildSelf=function(e,t,i,n){var o=void 0===i?n:i;if(void 0===this.selectedSelf||void 0===o||this.selectedSelf!==o)switch(this.selectedSelf){case!0:e.push(this.buildSelfMdx(this.uniqueName));break;case!1:t.push(this.buildSelfMdx(this.uniqueName));break;default:return}},h.prototype.buildChildren=function(e,t,i,n){if(void 0===this.selectedChildren||void 0===n||n!==this.selectedChildren)switch(this.selectedChildren){case!0:e.push(this.buildChildrenMdx(this.uniqueName));break;case!1:t.push(this.buildChildrenMdx(this.uniqueName));break;default:return}},h.prototype.buildDescendants=function(e,t,i,n){if(void 0!==this.selectedDescendants&&void 0!==n&&this.selectedDescendants===n)return this.buildChildren(e,t,i,n),void this.buildSelf(e,t,i,n);switch(this.selectedDescendants){case!0:e.push(this.buildDescendantsMdx(this.uniqueName,this.selectedSelf,this.selectedChildren)),!1===this.selectedSelf&&t.push(this.buildSelfMdx(this.uniqueName)),!1===this.selectedChildren&&t.push(this.buildChildrenMdx(this.uniqueName));break;case!1:t.push(this.buildDescendantsMdx(this.uniqueName,h.invertBooleanValue(this.selectedSelf),h.invertBooleanValue(this.selectedChildren))),this.selectedSelf&&e.push(this.buildSelfMdx(this.uniqueName)),this.selectedChildren&&e.push(this.buildChildrenMdx(this.uniqueName))}},h.invertBooleanValue=function(e){return void 0===e?e:!e},h.prototype.buildSelfMdx=function(e){return e},h.prototype.buildChildrenMdx=function(e){return e+".Children"},h.prototype.buildDescendantsMdx=function(e,t,i){return void 0===t&&void 0===i?"Descendants("+e+", 0, AFTER)":void 0===t?i?"Descendants("+e+", 0, AFTER)":"Descendants("+e+", 1, AFTER)":void 0===i?t?"Descendants("+e+")":"Descendants("+e+", 0, AFTER)":t&&i?"Descendants("+e+")":t&&!1===i?"Descendants("+e+", 1, BEFORE_AND_AFTER)":!1===t&&i?"Descendants("+e+", 0, AFTER)":!1===t&&!1===i?"Descendants("+e+", 1, AFTER)":null},h.prototype.combineToSet=function(e){if(this instanceof h!=0&&0!==e.length){if(1===e.length){var t=e[0];if("{"===t[0]&&"}"===t[t.length-1])return t}return"{"+e.join(", ")+"}"}},h.prototype.buildExceptMdx=function(e,t){return"Except("+e+", "+t+")"},h.parse=function(e){var t=JSON.parse(e);return h.convertJsObject(t)},h.convertJsObject=function(e){for(var t=new Array,i=0;i<e.length;i++){var n=e[i],o=new h(n.uniqueName,n.selectedSelf,n.selectedChildren,n.selectedDescendants);0<n.childNodes.length&&(o.childNodes=h.convertJsObject(n.childNodes)),t.push(o)}return t},h.clearSelection=function(e){if(e.selectedChildren=e.selectedDescendants=e.selectedSelf=void 0,0<e.childNodes.length)for(var t=0;t<e.childNodes.length;t++)h.clearSelection(e.childNodes[t])},h.selectedCount=function(e){var t=0;if(!0===e.selectedSelf&&t++,void 0!==e.childNodes)for(var i=0;i<e.childNodes.length;i++)t+=this.selectedCount(e.childNodes[i]);return t},h.selectionList=function(e){var t=[];if(!0===e.selectedSelf&&t.push(e),void 0!==e.childNodes)for(var i=0;i<e.childNodes.length;i++)t=t.concat(this.selectionList(e.childNodes[i]));return t},h}(),i.MemberChoiceTreeNode=n}(Ranet||(Ranet={})),function(s){var c,u,i,r,a,e;c=s.Controls||(s.Controls={}),u=c.Slicer||(c.Slicer={}),i=c.Windows.FloatingWindowOptions,r=c.Windows.WindowSize,a=c.Windows.FloatingWindow,e=function(){function l(e){var t=this;this._options=e,this._maxHeight=300,this._columnCount=1,this._buttonWidth=70,this._dataSource=null,this._items=new Array,this._onStateChanged=new c.Events.LiteEvent,this._onSlicerDeleted=new c.Events.LiteEvent,this._onSettingsChanged=new c.Events.LiteEvent,this._onSlicerMinimized=new c.Events.LiteEvent,this._isVisibleLoadingPanel=!1;var i=new Array;this._options.startSelectionTree&&(i=c.MemberChoice.MemberChoiceTreeNode.parse(JSON.stringify(this._options.startSelectionTree))),this.setActualSelectionTree(i),this._columnCount=this._options.columnCount,this._buttonWidth=this._options.buttonWidth,this._maxHeight=this._options.maxHeight;var n=new u.DataManager(this._options.connection,this._options.cubeName,this._options.hierarchyUniqueName,this._options.levelUniqueName),o=n.getMemberCount();this._view=this.getNewView(),this.isVisibleLoadingPanel=!0,o.done(function(e){n.getMembers(e).done(function(e){t.isVisibleLoadingPanel=!1,t._dataSource=e,t._$headerTitle.text(t._options.header),t.refreshView()})})}return Object.defineProperty(l.prototype,"onStateChanged",{get:function(){return this._onStateChanged},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onSlicerDeleted",{get:function(){return this._onSlicerDeleted},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onSettingsChanged",{get:function(){return this._onSettingsChanged},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onSlicerMinimized",{get:function(){return this._onSlicerMinimized},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"levelUniqueName",{get:function(){return this._options.levelUniqueName},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hierarchyUniqueName",{get:function(){return this._options.hierarchyUniqueName},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isVisibleLoadingPanel",{get:function(){return this._isVisibleLoadingPanel},set:function(e){this._isVisibleLoadingPanel=e,this._isVisibleLoadingPanel?(this.view.css("min-width",150),this.view.css("min-height",100),this._$loadingPanel=$('<div class="slicerControl-spinnerPanel"><i class="fa fa-spinner fa-pulse fa-fw"></i>'+s.Localization.localize("Loading")+"</div>"),this._contentView.append(this._$loadingPanel)):this._$loadingPanel.remove()},enumerable:!0,configurable:!0}),l.transformTreeToMap=function(e){for(var t={},i=0;i<e.length;i++){var n=e[i];if(0<(t[n.uniqueName]=n).childNodes.length){var o=l.transformTreeToMap(n.childNodes);for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])}}return t},l.prototype.setActualSelectionTree=function(e){this._currentSelectionTree=e;var t=l.transformTreeToMap(e);this._someMap=t},l.prototype.getNewView=function(){var e=this,t=$('<div class="slicerControl" style="position:absolute;"/>'),i=$('<div class="slicerControl-header" ></div>'),n=$("<span class='slicerControl-headerTitle'>"+this._options.header+"</span>"),o=$('<i class="fa fa-trash-o slicerControl-removeButton" title="'+s.Localization.localize("Slicer_RemoveSlicerTooltip")+'" aria-hidden="true" ></i>'),r=$('<i class="fa fa-cog slicerControl-settingsButton" title="'+s.Localization.localize("Slicer_OpenSettingsTooltip")+'" aria-hidden="true"></i>'),a=$('<i class="fa fa-window-minimize slicerControl-minimizeButton"  aria-hidden="true"></i>');return r.on("click",function(){e.openSlicerSettings()}),o.on("click",function(){e.remove()}),a.on("click",function(){e._view.remove(),e._onSlicerMinimized.trigger({sender:e})}),i.append(n),i.append(o),i.append(r),i.append(a),t.draggable({handle:".slicerControl-header"}),this._contentView=this.getContent(),this._$headerTitle=n,t.append(i),t.append(this._contentView),t},l.prototype.getContent=function(){var t=this,e=$("<div class='slicerControl-contentContainer'></div>");if(e.css("width",this._columnCount*(this._buttonWidth+28)+40),e.css("max-height",this._maxHeight),!1==(0!==this._items.length)){if(this._items.length=0,null!==this._dataSource)for(var i=0;i<this._dataSource.length;i++){0!==i&&i%this._columnCount==0&&e.append("<br/>");var n=this._dataSource[i],o=new u.SlicerItem(n);o.onStateChanged.on(function(e){t.changeMembersTreeState(e.e)}),o.isChecked=this.isSelectedMember(n),this._items.push(o),e.append(o.getView(this._buttonWidth))}}else for(var r=0;r<this._items.length;r++){var a=this._items[r];0!==r&&r%this._columnCount==0&&e.append("<br/>"),a.isChecked=this.isSelectedMember(a.memberData),e.append(a.getView(this._buttonWidth))}return e},l.prototype.isSelectedMember=function(e){var t=this._someMap[e.uniqueName];if(t&&void 0!==t.selectedSelf)return t.selectedSelf;if(null==e.parents)return!1;var i=e.parents[0];if(i){var n=this._someMap[i.uniqueName];if(n&&void 0!==n.selectedChildren)return n.selectedChildren;if(n&&void 0!==n.selectedDescendants)return n.selectedDescendants}if(1<e.parents.length)for(var o=e.parents.length-1;0<o;o--){var r=e.parents[o],a=this._someMap[r.uniqueName];if(a&&void 0!==a.selectedDescendants)return a.selectedDescendants}return!1},l.prototype.changeMembersTreeState=function(e){var t=new u.SlicerStateChangedArgs;t.hierarchyUniqueName=e.memberData.hierarchyUniqueName;var i=this._someMap[e.memberData.uniqueName];if(!i){var n=null;if(null!==e.memberData.parents)for(var o=0;o<e.memberData.parents.length;o++){var r=e.memberData.parents[o],a=this._someMap[r.uniqueName];if(a)n=a;else{var s=new c.MemberChoice.MemberChoiceTreeNode(r.uniqueName);null!==n?n.childNodes.push(s):this._currentSelectionTree.push(s),n=s}}i=new c.MemberChoice.MemberChoiceTreeNode(e.memberData.uniqueName),null!==n?n.childNodes.push(i):this._currentSelectionTree.push(i)}i.selectedSelf=this.getNewState(i,e.newState),t.selectionMembersTree=this._currentSelectionTree,this._someMap=l.transformTreeToMap(this._currentSelectionTree),this._onStateChanged.trigger({sender:this,e:t})},l.prototype.getNewState=function(e,t){if(t)return!0;if(!e.selectedSelf){if(void 0===e.selectedSelf)return!1;throw new Error("NotImplementedException")}},l.prototype.openSlicerSettings=function(){var n=this,e=new u.SlicerSettingsControlOptions;e.defaultButtonWidth=this._buttonWidth,e.defaultColumnCount=this._columnCount,e.defaultMaxHeight=this._maxHeight;var o=new u.SlicerSettingsControl(e),t=new i;t.content=o.view,t.title=s.Localization.localize("WindowTitleSlicerSettings"),t.size=r.Small,t.container=this._options.container,t.onClosed=function(e,t){if(!1!==t.dialogResult){n._buttonWidth=o.buttonWidth,n._columnCount=o.columnCount,n._maxHeight=o.maxHeight;var i=new u.SlicerSettingsControlOptions;i.defaultButtonWidth=n._buttonWidth,i.defaultColumnCount=n._columnCount,i.defaultMaxHeight=n._maxHeight,n._onSettingsChanged.trigger({sender:n,newSettings:i}),n.refreshView()}},new a(t).show()},l.prototype.refreshView=function(){this._view.css("height",""),this._view.css("width",""),this.view.css("min-width",""),this.view.css("min-height",""),this._contentView.remove(),this._contentView=this.getContent(),this._view.append(this._contentView)},Object.defineProperty(l.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),l.prototype.remove=function(){this._view.remove(),this._onSlicerDeleted.trigger({sender:this})},l}(),u.SlicerControl=e}(Ranet||(Ranet={})),function(y){var l,p,e;l=y.Controls||(y.Controls={}),p=l.MemberChoice||(l.MemberChoice={}),e=function(){function u(e,t){this._showOnlySelectedItems=!1,this._isVisibleProperties=!1,this._onLevelsChanged=new l.Events.LiteEvent;var i=this;u._directoryTemplate=y.PathManager.templatesPath;var n=u.getLayout();this._$panel=$(e),this._options=t;var o=function(e){i._$panel.empty(),i._$panel.removeClass("filterEditorWindow-isLoading"),!1===t.isVisibleSlicerButton&&i._layoutDescription.$addSlicerButton.hide(),i._selectionRootNodes=e,i.initControl()};n.done(function(e){i._layoutDescription=e,void 0!==i._options.selectionRootNodes?new p.DataService(i._options.connection).actualizeSelectionTree(i._options.cubeName,i._options.hierarchyUniqueName,i._options.selectionRootNodes).done(function(e){var t=p.MemberChoiceTreeNode.parse(JSON.stringify(e));o(t)}).fail(function(){i._$panel.empty()}):o(i._options.selectionRootNodes)})}return Object.defineProperty(u.prototype,"onLevelsChanged",{get:function(){return this._onLevelsChanged},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isVisibleSearchPanel",{get:function(){return this._isVisibleSearchPanel},set:function(e){this._isVisibleSearchPanel=e,this._layoutDescription.$membersPanel.removeClass("memberChoice-membersPanel_visibleSearchPanel"),this._layoutDescription.$membersPanel.removeClass("memberChoice-membersPanel_collapsedSearchPanel"),this._layoutDescription.$btnShowHideSearchPanel.removeClass("active"),!1===this._isVisibleSearchPanel?(this._layoutDescription.$btnShowOnlySelectedItems.removeClass("disabled"),this._layoutDescription.$searchPanel.hide(),this._layoutDescription.$membersPanel.addClass("memberChoice-membersPanel_collapsedSearchPanel")):(this._layoutDescription.$btnShowOnlySelectedItems.addClass("disabled"),this._layoutDescription.$searchPanel.show(),this._layoutDescription.$membersPanel.addClass("memberChoice-membersPanel_visibleSearchPanel"),this._layoutDescription.$btnShowHideSearchPanel.addClass("active"))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showOnlySelectedItems",{get:function(){return this._showOnlySelectedItems},set:function(e){e?this._layoutDescription.$btnShowOnlySelectedItems.addClass("active"):this._layoutDescription.$btnShowOnlySelectedItems.removeClass("active"),this._memberChoiceTreeView.showItemTextStatus=e,this._showOnlySelectedItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"selectionRootNodes",{get:function(){return this._selectionRootNodes},enumerable:!0,configurable:!0}),u.getLevelChoiceControl=function(e,o,t,i){var r=new l.DropDownControl;return r.displayPropertyExpr="caption",r.selectedExpr="isSelected",r.selectionChanged.on(function(e){i(e)}),e.done(function(e){for(var t=e.levels,i=void 0,n=0;n<t.length;n++)if(t[n].uniqueName===o){t[n].isSelected=!0,i=t[n];break}i||(t[0].isSelected=!0,i=t[0]),r.itemSource=t}),r},u.getMemberChoiceTreeView=function(e,t,i,n,o,r,a){var s=new p.TreeViewMemberChoiceOptions;return s.displayExpr="caption",s.hasChildrenExpr="hasChildren",s.virtualModeEnabled=!0,s.countLoadedItems=15,s.childCountExpr="childCount",s.connectionProvider.getPromiseLoadChildren=function(e){var t=e.uniqueName,i=n.getQueryLoadChildren(t,0);return o.getMembers(i).promise()},s.connectionProvider.getPromiseLoadNeighbors=function(e,t){var i="";if("level"===e.type)i=n.getQueryMembers(e.uniqueName,t);else{if("memberData"!==e.type)throw new Error("NotImplementedException");i=n.getQueryLoadChildren(e.uniqueName,t)}return o.getMembers(i)},s.connectionProvider.getPromiseLoadNeighborsSearchMode=function(e,t){var i=n.getQuerySearchMembers(e.text,t,e.property,e.searchType);return o.getMembers(i).done(function(e){for(var t=0;t<e.length;t++)e[t].hasChildren=!1}).promise()},s.onTreeStateChanged=function(e){i(e)},s.selectionRootNodes=t,s.draggableOptions=new l.TreeViewDraggableOptions,s.draggableOptions.$dragContainer=r,s.textStatusVisible=!1,s.onItemSelected=a,new p.MemberChoiceTreeView(e,s)},u.prototype.initControl=function(){var i=this,n=this;this.isVisibleSearchPanel=!1,this._properties=[];var o=this._dataService=new p.DataService(this._options.connection),r=this._queryManager=new p.QueryManager(this._options.cubeName,this._options.hierarchyUniqueName);this._$panel.append(this._layoutDescription.$rootLayout);var a=this._memberChoiceTreeView=u.getMemberChoiceTreeView(this._layoutDescription.$treeView[0],this._selectionRootNodes,function(e){void 0!==i._options.events.onChangedSelection&&i._options.events.onChangedSelection(e),n._selectionRootNodes=e,n.updateShowSelectedBtn()},r,o,this._options.container,function(e){i._selectedTreeItem=e.data,i.updatePropertyList()}),e=function(t){n.showOnlySelectedItems=!1;var e=r.getQueryMembers(t.uniqueName);o.getMembers(e).done(function(e){a.initTreeView(e,t)}),n.updateShowSelectedBtn()},t=o.getLevels(this._options.cubeName,this._options.hierarchyUniqueName);t.done(function(e){var t=e.levels;r.properties=i._properties=e.properties,i._onLevelsChanged.trigger(t)});var s=this._levelChoiceControl=u.getLevelChoiceControl(t,this._options.startLevelUniqueName,o,e);this._layoutDescription.$toolBar.append(s.view);var l=!1,c=new p.SearchMembersControl(this._layoutDescription.$searchPanel,function(i){c.isLoadingMembersNow=!0,l=!0,a.selectedText=i.text;var e=r.getQuerySearchMembers(i.text,0,i.property,i.searchType);o.getMembers(e).done(function(e){for(var t=0;t<e.length;t++)e[t].hasChildren=!1;a.initTreeView(e,i)}).always(function(){c.isLoadingMembersNow=!1})},function(){a.selectedText=null,l&&(e(s.selectedItem),l=!1)});c.init(),this._layoutDescription.$btnShowHideSearchPanel.click(function(){n.showOnlySelectedItems&&(n.showOnlySelectedItems=!1,n.syncStateOfTree()),n.isVisibleSearchPanel=!n.isVisibleSearchPanel,l&&!1===n.isVisibleSearchPanel&&(l=!1,e(s.selectedItem)),!1===l&&(a.selectedText=null)}),this._layoutDescription.$buttonRefreshData.click(function(){n.showOnlySelectedItems=!1;var e=r.getQueryMembers(s.selectedItem.uniqueName);o.getMembers(e).done(function(e){a.dataSource=e}),i.updateShowSelectedBtn()}),this._layoutDescription.$buttonClearSelection.click(function(){a.clearSelectionDataTree()}),this._layoutDescription.$btnShowOnlySelectedItems.click(function(){n.showOnlySelectedItems=!n.showOnlySelectedItems,n.syncStateOfTree()}),this._layoutDescription.$btnToggleProperties.click(function(){n.toggleProperties()}),this._layoutDescription.$addSlicerButton.on("click",function(){i._options.events.onCreateSlicer&&i._options.events.onCreateSlicer({caption:i._levelChoiceControl.selectedItem.caption,uniqueName:i._levelChoiceControl.selectedItem.uniqueName,hierarchyUniqueName:i._options.hierarchyUniqueName,selectionTree:i.selectionRootNodes})})},u.prototype.syncStateOfTree=function(){var i=this;if(this.showOnlySelectedItems){var e=u.getSelectedUniqueNames(this.selectionRootNodes),t=this._queryManager.getAllSelectedItemsQuery(e);this._dataService.getMembers(t).done(function(e){for(var t=0;t<e.length;t++)e[t].hasChildren=!1;i._memberChoiceTreeView.initTreeView(e,null)})}else t=this._queryManager.getQueryMembers(this._levelChoiceControl.selectedItem.uniqueName),this._dataService.getMembers(t).done(function(e){i._memberChoiceTreeView.dataSource=e});this.updateShowSelectedBtn()},u.getSelectedUniqueNames=function(e){var t=new Array;if(void 0===e)return t;for(var i=0;i<e.length;i++){var n=e[i];if((n.selectedChildren||n.selectedDescendants||n.selectedSelf)&&t.push(n.uniqueName),0<n.childNodes.length){var o=this.getSelectedUniqueNames(n.childNodes);0<o.length&&(t=t.concat(o))}}return t},u.prototype.toggleProperties=function(){this._isVisibleProperties=!this._isVisibleProperties,this._layoutDescription.$btnToggleProperties.toggleClass("active"),this._layoutDescription.$propertiesPanel.toggleClass("memberChoise-propertiesPanel_collapsed"),this._layoutDescription.$propertiesPanel.toggleClass("memberChoise-propertiesPanel_displayed"),this._layoutDescription.$treeView.toggleClass("membersChoice-membersPanel-treeView_collapsedPropertiesPanel"),this._layoutDescription.$treeView.toggleClass("membersChoice-membersPanel-treeView_displayedPropertiesPanel"),this.updatePropertyList()},u.prototype.updatePropertyList=function(){var e=this;this._layoutDescription.$propertyPanelAlert.text(y.Localization.localize("MemberChoise_NoProperties")).hide(),this._layoutDescription.$propertyPanelTable.empty().hide();var t,i=this._layoutDescription.$membersPanel.width();if(this._isVisibleProperties?(this._layoutDescription.$treeView.width(i-6-this._layoutDescription.$propertiesPanel.width()),t={handles:"e",minWidth:170,maxWidth:i-150,resize:function(){e._layoutDescription.$propertiesPanel.width(i-6-e._layoutDescription.$treeView.width())},disabled:!1}):(t={handles:"e",disabled:!0},this._layoutDescription.$treeView.width(i)),this._layoutDescription.$treeView.resizable(t),this._selectedTreeItem){var n=this._selectedTreeItem.memberProperties;if(this._layoutDescription.$propertyPanelTitle.text(this._selectedTreeItem.caption).show(),n)for(var o=0;o<n.length;o++){var r=$("<tr/>"),a=$("<td/>").text(n[o].name),s=$("<td/>").text(n[o].value);r.append(a).append(s),this._layoutDescription.$propertyPanelTable.append(r).show()}else this._layoutDescription.$propertyPanelAlert.text(y.Localization.localize("MemberChoise_NoProperties")).show()}else this._layoutDescription.$propertyPanelTitle.hide()},u.prototype.getSelectedUniqueNames=function(e){var t=new Array;if(void 0===e)return t;for(var i=0;i<e.length;i++){var n=e[i];if((n.selectedChildren||n.selectedDescendants||n.selectedSelf)&&t.push(n.uniqueName),0<n.childNodes.length){var o=this.getSelectedUniqueNames(n.childNodes);0<o.length&&(t=t.concat(o))}}return t},u.prototype.updateShowSelectedBtn=function(){0===this.getSelectedUniqueNames(this.selectionRootNodes).length?this._layoutDescription.$btnShowOnlySelectedItems.addClass("disabled"):this._layoutDescription.$btnShowOnlySelectedItems.removeClass("disabled")},u.getLayout=function(){var _=$.Deferred();return $.ajax({url:u._directoryTemplate+"memberChoice-view.html"}).done(function(e){var t=$(y.Localization.localizeTemplate(e)),i=t.find(".memberChoice-toolBar"),n=t.find(".membersChoice-membersPanel-treeView"),o=t.find(".memberChoice-searchPanel"),r=t.find(".memberChoice-membersPanel"),a=t.find(".memberChoice-statusSearchPanel"),s=t.find(".membersChoice-refreshButton"),l=t.find(".membersChoice-clearSelectionButton"),c=t.find(".membersChoice-showHideSearchPanelButton"),u=t.find(".membersChoice-showOnlySelectedItems"),p=t.find(".membersChoice-showPropertiesButton"),h=t.find(".memberChoise-propertiesPanel"),d=t.find(".memberChoise-propertiesPanel-table"),m=t.find(".memberChoise-propertiesPanel-alert"),f=t.find(".memberChoise-propertiesPanel-title"),g=t.find(".membersChoice-addSlicerButton");_.resolve({$rootLayout:t,$toolBar:i,$searchPanel:o,$treeView:n,$statusSearchPanel:a,$membersPanel:r,$buttonRefreshData:s,$buttonClearSelection:l,$btnShowHideSearchPanel:c,$btnShowOnlySelectedItems:u,$btnToggleProperties:p,$propertiesPanel:h,$propertyPanelTable:d,$propertyPanelAlert:m,$propertyPanelTitle:f,$addSlicerButton:g})}).fail(function(e){y.LogService.error(e),_.reject(e)}),_},u}(),p.MemberChoiceControl=e}(Ranet||(Ranet={})),function(o){o.ranetMemberChoice=function(e,t){var i=this,n={};this.settings={},this.init=function(){i.settings=o.extend({},n,t),new Ranet.Controls.MemberChoice.MemberChoiceControl(e,t)},this.option=function(e){},this.init()},o.fn.ranetMemberChoice=function(t){return this.each(function(){var e=new o.ranetMemberChoice(this,t);o(this).data("ranetMemberChoice",e)})}}(jQuery),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.MemberChoice||(t.MemberChoice={}),n=function(){function r(e,t,i){this._dataItem=e,this._selectionTree=i,this._itemMemberChoiceTreeNode=t;var n=new Array;if(!1===r.getArrayParents(this._selectionTree,this._itemMemberChoiceTreeNode,n))throw new Error("invalidOperationException.StateMemberChoiceTreeViewItem");this._parents=n.reverse()}return Object.defineProperty(r.prototype,"selectedSelf",{get:function(){if(void 0===this._itemMemberChoiceTreeNode)throw new Error("invalidOperationException.MemberChoice.StateMemberChoiceTreeViewItem.selectedSelf");return this._itemMemberChoiceTreeNode.selectedSelf},set:function(e){this._itemMemberChoiceTreeNode.selectedSelf=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inheritedSelectedSelf",{get:function(){if(0===this._parents.length)return!1;var e=this._parents[this._parents.length-1];return!!e.selectedChildren||!1!==e.selectedChildren&&this.hasParentWithSelectedDescendants},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inheritedSelectedDescendants",{get:function(){return 0!==this._parents.length&&this.hasParentWithSelectedDescendants},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasParentWithSelectedDescendants",{get:function(){for(var e=!1,t=0;t<this._parents.length;t++)this._parents[t].selectedDescendants?e=!0:void 0!==this._parents[t].selectedDescendants&&(e=!1);return e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"selectedChildren",{get:function(){if(void 0===this._itemMemberChoiceTreeNode)throw new Error("invalidOperationException.MemberChoice.StateMemberChoiceTreeViewItem.selectedChildren");return this._itemMemberChoiceTreeNode.selectedChildren},set:function(e){this._itemMemberChoiceTreeNode.selectedChildren=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"selectedDescendants",{get:function(){if(void 0===this._itemMemberChoiceTreeNode)throw new Error("invalidOperationException.MemberChoice.StateMemberChoiceTreeViewItem.selectedDescendants");return this._itemMemberChoiceTreeNode.selectedDescendants},set:function(e){this._itemMemberChoiceTreeNode.selectedDescendants=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasSelectedDescedant",{get:function(){if(void 0===this._itemMemberChoiceTreeNode)throw new Error("invalidOperationException.MemberChoice.StateMemberChoiceTreeViewItem.hasSelectedChildren");return this.getValuePropHasSelectedChildren(this._itemMemberChoiceTreeNode.childNodes)},enumerable:!0,configurable:!0}),r.prototype.getValuePropHasSelectedChildren=function(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.selectedChildren||i.selectedDescendants||i.selectedSelf)return!0;if(0<i.childNodes.length&&this.getValuePropHasSelectedChildren(i.childNodes))return!0}return!1},r.getArrayParents=function(e,t,i){if(e===t)return!0;for(var n=0;n<e.childNodes.length;n++){var o=e.childNodes[n];if(o===t)return i.push(e),!0;if(0<o.childNodes.length&&r.getArrayParents(o,t,i))return i.push(e),!0}return!1},r.prototype.updatePropertySelectedDescendantsForParent=function(){var e=this._dataItem.parents[this._dataItem.parents.length-1].childCount,t=this._parents[this._parents.length-1];if(t.childNodes.length===e&&t.selectedDescendants){var i,n=0;for(i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];!1!==o.selectedDescendants||o.selectedSelf||n++}if(n===e)for(t.selectedDescendants=void 0,i=0;i<t.childNodes.length;i++)t.childNodes[i].selectedDescendants=void 0}},r.prototype.updatePropertySelectedChildrenForParent=function(){var e=this._dataItem.parents[this._dataItem.parents.length-1].childCount,t=this._parents[this._parents.length-1];if(t.childNodes.length===e&&t.selectedChildren){var i,n=0;for(i=0;i<t.childNodes.length;i++)!1===t.childNodes[i].selectedSelf&&n++;if(n===e)for(t.selectedChildren=void 0,i=0;i<t.childNodes.length;i++)t.childNodes[i].selectedSelf=void 0}},r.prototype.childrenClearSelectionSelectedSelf=function(){for(var e=this._itemMemberChoiceTreeNode.childNodes,t=0;t<e.length;t++)e[t].selectedSelf=void 0},r.prototype.descendantsClearSelection=function(){r.descendantsClearSelection(this._itemMemberChoiceTreeNode.childNodes)},r.descendantsClearSelection=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.selectedSelf=void 0,i.selectedChildren=void 0,i.selectedDescendants=void 0,0<i.childNodes.length&&r.descendantsClearSelection(i.childNodes)}},r}(),i.StateMemberChoiceTreeViewItem=n}(Ranet||(Ranet={})),function(e){var t,a,i;t=e.Controls||(e.Controls={}),a=t.MemberChoice||(t.MemberChoice={}),i=function(){function r(e,t,i){this._cubeName=e,this.hierarchyUniqueName=t,this._propeties=i||[]}return Object.defineProperty(r.prototype,"properties",{get:function(){return this._propeties},set:function(e){this._propeties=e},enumerable:!0,configurable:!0}),Object.defineProperty(r,"step",{get:function(){return r._step},set:function(e){r._step=e},enumerable:!0,configurable:!0}),r.prototype.getQueryMembers=function(e,t){return void 0===t&&(t=0),"WITH \nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\' \n'+this.generatePropertiesWith()+"\nSELECT \nHierarchize(Subset(AddCalculatedMembers({"+e+".Members}), "+t+", "+r._step+")) \nDimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"} on 1 \nFROM "+this._cubeName+"\n"},r.prototype.getQueryLoadChildren=function(e,t){return"WITH \nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\'\n'+this.generatePropertiesWith()+"\nSELECT \nHierarchize(Subset(AddCalculatedMembers({"+e+".Children}), "+t+", "+r._step+")) \nDimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"}on 1 \nFROM "+this._cubeName+"\n"},r.prototype.getQuerySearchMembers=function(e,t,i,n){var o;switch(n){case a.SearchOlapSearchType.Contain:o="(InStr("+this.hierarchyUniqueName+'.Properties("'+i+"\"),'"+e+"') <> 0))})";break;case a.SearchOlapSearchType.BeginWith:o="(InStr("+this.hierarchyUniqueName+'.Properties("'+i+"\"),'"+e+"') = 1))})";break;case a.SearchOlapSearchType.Equal:o="("+this.hierarchyUniqueName+'.Properties("'+i+"\") = '"+e+"'))})";break;default:throw new Error("InvalidOperationException")}return"WITH \nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\'\n'+this.generatePropertiesWith()+" \nSELECT \nHierarchize(Subset(AddCalculatedMembers({FILTER("+this.hierarchyUniqueName+".ALLMEMBERS, "+o+", "+t+", "+r._step+")) \nDimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"} on 1 \nFROM "+this._cubeName},r.prototype.getQueryMemberWithParents=function(e){return"WITH\nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\' \n'+this.generatePropertiesWith()+"\nSELECT {"+e.join(", ")+"} Dimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"} on 1 \nFROM "+this._cubeName},r.prototype.getAllSelectedItemsQuery=function(e){return"WITH \nMEMBER [Measures].[-KEY0-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"KEY0\", TYPED)' \nMEMBER [Measures].[-HIERARCHY_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+".CurrentMember.Properties(\"HIERARCHY_UNIQUE_NAME\", TYPED)' \nMEMBER [Measures].[-PARENT_UNIQUE_NAME-] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("PARENT_UNIQUE_NAME", TYPED)\' \n'+this.generatePropertiesWith()+"\nSELECT \n{"+e.join(", ")+"}\nDimension Properties KEY0, HIERARCHY_UNIQUE_NAME, PARENT_UNIQUE_NAME"+this.generatePropertiesOn0()+" on 0, \n{[Measures].[-KEY0-],[Measures].[-HIERARCHY_UNIQUE_NAME-],[Measures].[-PARENT_UNIQUE_NAME-]"+this.generatePropertiesOn1()+"} on 1 \nFROM "+this._cubeName+"\n"},r.prototype.generatePropertiesWith=function(){var e=this._propeties;if(0===e.length)return"";for(var t="",i=0;i<e.length;i++)i!==e.length-1?t+="MEMBER [Measures].["+e[i].Name+"] AS '"+this.hierarchyUniqueName+'.CurrentMember.Properties("'+e[i].Name+"\")'\n":t+="MEMBER [Measures].["+e[i].Name+"] AS "+this.hierarchyUniqueName+'.CurrentMember.Properties("'+e[i].Name+'")';return t},r.prototype.generatePropertiesOn1=function(){var e=this._propeties;if(0===e.length)return"";for(var t=",",i=0;i<e.length;i++)i!==e.length-1?t+="[Measures].["+e[i].Name+"],":t+="[Measures].["+e[i].Name+"]";return t},r.prototype.generatePropertiesOn0=function(){var e=this._propeties;if(0===e.length)return"";for(var t=", ",i=0;i<e.length;i++)i!==e.length-1?t+=this.hierarchyUniqueName+".["+e[i].Name+"], ":t+=this.hierarchyUniqueName+".["+e[i].Name+"]";return t},r._step=15,r}(),a.QueryManager=i}(Ranet||(Ranet={})),function(i){var p,e;p=i.Controls||(i.Controls={}),e=function(){function c(e,t,i,n,o){if(this._parents=new Array,this._children=new Array,this._options=t,this._onClick=i,this._onDoubleClick=n,!e)throw new Error("InvalidOperationException");this.dataItem=e,this._factoryVisualElements=o}return Object.defineProperty(c.prototype,"$treeViewItem",{get:function(){return this._$treeViewItem},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"dataItem",{get:function(){return this._dataItem},set:function(e){this._dataItem=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"children",{get:function(){return this._children},set:function(e){this._children=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"parents",{get:function(){return this._parents},set:function(e){this._parents=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isSelected",{get:function(){return this._isSelected},set:function(e){this._isSelected=e,this._isSelected?this.$header.addClass("treeView_treeViewItem_header_state_selected"):this.$header.removeClass("treeView_treeViewItem_header_state_selected")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isLoadingChildrenNow",{get:function(){return this._isLoadingChildrenNow},set:function(e){this._isLoadingChildrenNow=e,this._isLoadingChildrenNow&&this.loadChildrenNow()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isOpenNow",{get:function(){return this._isOpenNow},set:function(e){this._isOpenNow=!e,this.changeState()},enumerable:!0,configurable:!0}),c.prototype.getLoadMoreTreeViewItem=function(){var i=this;return this._factoryVisualElements.getLoadMoreItemsTreeViewItem(this.dataItem,this.dataItem.items.length,this._options.connectionProvider.getPromiseLoadNeighbors,function(e,t){i.loadMoreChildren(e,t)})},c.prototype.onSuccessLoadedChildren=function(e){this.dataItem.items=e;var t=this.createTreeViewItems(e);if(this.children=t,this._options.countLoadedItems&&this._options.countLoadedItems<=e.length){var i=this.getLoadMoreTreeViewItem();t.push(i)}this._$panelAfterTreeViewItem=this.createChildrenPanel(t),this._$nodeStatus.addClass("fa-caret-down"),this._$nodeStatus.empty(),this._isLoadingChildrenNow=!1},c.prototype.onFailLoadedChildren=function(){this._$nodeStatus.addClass("fa-caret-right"),this._$nodeStatus.empty(),this._isOpenNow=!1,this._isLoadingChildrenNow=!1},c.prototype.loadChildrenNow=function(){var t=this;this._$nodeStatus.removeClass("fa-caret-down"),this._$nodeStatus.append('<i class="fa fa-spinner fa-spin"></i>'),this._options.connectionProvider.getPromiseLoadChildren(this.dataItem).done(function(e){t.onSuccessLoadedChildren(e)}).fail(function(e){i.LogService.error(e),t.onFailLoadedChildren()})},c.prototype.loadMoreChildren=function(e,t){var i=this.createTreeViewItems(t),n=this.children.indexOf(e);if(-1===n)throw new Error("InvalidOperationException.indexBtnLoadNextTreeViewItem");if(this.children.splice(n,1),this.dataItem.items=this.dataItem.items.concat(t),this._options.countLoadedItems&&this._options.countLoadedItems<=t.length){var o=this.getLoadMoreTreeViewItem();i.push(o)}this.children=this.children.concat(i),this.paintChildrenNodes(i,this._$childrenLayout)},c.prototype.onClickTreeViewItem=function(){this._onClick&&this._onClick(this)},c.prototype.onDblClickTreViewItems=function(){this._onDoubleClick&&this._onDoubleClick(this)},c.prototype.changeIcon=function(){void 0!==this._options.iconExpr&&null!=this.dataItem[this._options.iconExpr]&&void 0!==this._options.iconExpandedExpr&&null!=this.dataItem[this._options.iconExpandedExpr]&&(this._isOpenNow?(this._$icon.removeClass(c.prefiximageLibrary+this.dataItem[this._options.iconExpr]),this._$icon.addClass(c.prefiximageLibrary+this.dataItem[this._options.iconExpandedExpr])):(this._$icon.addClass(c.prefiximageLibrary+this.dataItem[this._options.iconExpr]),this._$icon.removeClass(c.prefiximageLibrary+this.dataItem[this._options.iconExpandedExpr])))},c.prototype.changeState=function(){if(!this.isLoadingChildrenNow)if(this._isOpenNow=!this._isOpenNow,this.dataItem[this._options.expandedExpr]=this._isOpenNow,this.changeIcon(),this._isOpenNow?(this._$nodeStatus.removeClass("fa-caret-right"),this._$nodeStatus.addClass("fa-caret-down")):(this._$nodeStatus.removeClass("fa-caret-down"),this._$nodeStatus.addClass("fa-caret-right")),this._isOpenNow)if(void 0!==this.dataItem.items&&0<this.dataItem.items.length){if(void 0!==this._$panelAfterTreeViewItem)return void this._$panelAfterTreeViewItem.removeClass("treeView_treeViewItem_visibilty-colapsed");var e=this.createTreeViewItems(this.dataItem.items);this.children=e,this._$panelAfterTreeViewItem=this.createChildrenPanel(e)}else this._options.virtualModeEnabled&&(this.isLoadingChildrenNow=!0);else this._$panelAfterTreeViewItem.addClass("treeView_treeViewItem_visibilty-colapsed")},c.prototype.createChildrenPanel=function(e){var t=$("<tr/>"),i=$("<td/>");t.append(i);var n=$('<td colspan="3"/>');t.append(n);var o=$("<table/>");n.append(o),o.addClass("treeView_treeViewItem_contentTable");var r=$("<tbody/>");return o.append(r),this._$childrenLayout=r,this.paintChildrenNodes(e,this._$childrenLayout),this._$treeViewItem.after(t),t},c.prototype.paintChildrenNodes=function(e,t){for(var i in e){if(e.hasOwnProperty(i))e[i].render(t)}},c.prototype.createTreeViewItems=function(e){for(var t=this._factoryVisualElements.getNewTreeViewItems(e),i=0;i<t.length;i++){var n=t[i],o=c.copyArrayTreeViewItems(this.parents);o.push(this),n.parents=o}return t},c.prototype.initNodeStatusVisualElement=function(){this._isOpenNow=!1,void 0!==this._options.expandedExpr&&void 0!==this.dataItem[this._options.expandedExpr]&&(this._isOpenNow=this.dataItem[this._options.expandedExpr])},c.prototype.getNodeStatusVisualElement=function(){var e=this;this.initNodeStatusVisualElement();var t=$("<td/>");t.addClass("treeView_treeViewItem_nodeStatus");var i=$("<div/>");return i.addClass("treeView_treeViewItem_fixContent-nodeStatus"),(void 0!==this.dataItem.items&&0<this.dataItem.items.length||this._options.virtualModeEnabled&&void 0!==this._options.hasChildrenExpr&&!0===this.dataItem[this._options.hasChildrenExpr])&&(this._isOpenNow?i.addClass("fa fa-caret-down"):i.addClass("fa fa-caret-right"),t.mousedown(function(){e.changeState()}),this._$nodeStatus=i),t.append(i),t},c.prototype.getNodeIconVisualElement=function(){var e=$("<td/>");e.addClass("treeView_treeViewItem_imageArea");var t=$("<div/>");return t.addClass("treeView_treeViewItem_fixContent-icon"),this._isOpenNow&&null!=this.dataItem[this._options.iconExpandedExpr]?t.addClass(c.prefiximageLibrary+this.dataItem[this._options.iconExpandedExpr]):null!=this.dataItem[this._options.iconExpr]&&t.addClass(c.prefiximageLibrary+this.dataItem[this._options.iconExpr]),e.append(t),this._$icon=t,e},c.prototype.render=function(e){var t=this,i=$("<tr />"),n=this.getNodeStatusVisualElement();i.append(n);var o=function(){t.onClickTreeViewItem()};if(void 0!==this._options.iconExpr){var r=this.getNodeIconVisualElement();i.append(r),r.click(function(){o()})}var a=$("<td/>");a.addClass("treeView_treeViewItem_header treeView_treeViewItem_header_state-nowrap"),this._options.hoverStateEnabled&&a.addClass("treeView-treeViewItem_hoverState"),a.click(function(){o()}),a.dblclick(function(){t.onDblClickTreViewItems()});var s=this.dataItem[this._options.displayExpr];if(this._options.selectedText){var l=s.toLowerCase().indexOf(this._options.selectedText.toLowerCase());if(-1!==l)s=s.substring(0,l)+'<span style="background-color:bisque;">'+s.substring(l,l+this._options.selectedText.length)+"</span>"+s.substring(l+this._options.selectedText.length)}var c=$("<span/>");if(c.append(s),a.append(c),i.append(a),e.append(i),this._$treeViewItem=i,this.$header=a,this._isOpenNow&&void 0!==this.dataItem.items&&0<this.dataItem.items.length){var u=this.createTreeViewItems(this.dataItem.items);this._children=u,this._$panelAfterTreeViewItem=this.createChildrenPanel(u)}void 0!==this._options.draggableOptions.draggableNodeExp&&void 0!==this.dataItem[this._options.draggableOptions.draggableNodeExp]&&this.initDraggableTreeViewItem(i,this.dataItem,this._options.iconExpr,this._options.displayExpr,this._options.draggableOptions),this._options.onRenderedTreeViewItem&&this._options.onRenderedTreeViewItem(this,new p.TreeViewItemArgs(this._$treeViewItem)),this.afterRender(i),this._options.selectedExpr&&this.dataItem[this._options.selectedExpr]&&o(),this._options.isHighligtedItem&&this._options.isHighligtedItem(this)&&a.addClass("treeView_treeViewItem_header_state_highlighted")},c.prototype.afterRender=function(e){},c.prototype.initDraggableTreeViewItem=function(e,n,o,r,t){var i=t.$dragContainer,a="default";t&&(t.appendTo&&(i=t.appendTo),t.scope&&(a=t.scope));var s=this,l={helper:function(){var e=$("<div/>");e.addClass("treeView_treeViewItem_dragAndDrop_draggableContent");var t=$("<div/>");t.addClass("treeView_treeViewItem_dragAndDrop_draggableContent_image"),null!=o&&null!=n[o]&&t.addClass(c.prefiximageLibrary+n[o]),e.append(t);var i=$("<span/>");return i.addClass("treeView_treeViewItem_dragAndDrop_draggableContent_text"),i.append(n[r]),e.append(i),e},start:function(){t.onStartDraggable&&t.onStartDraggable(s,new p.TreeViewItemArgs(s.$treeViewItem))},delay:150,scroll:!1,containment:"parent",appendTo:i,scope:a};$(e).draggable(l)},c.copyArrayTreeViewItems=function(e){for(var t=new Array,i=0;i<e.length;i++){var n=e[i];t.push(n)}return t},c.prefiximageLibrary="imageLibrary_",c}(),p.TreeViewItem=e}(Ranet||(Ranet={})),function(e){var r,t;r=e.Controls||(e.Controls={}),t=function(){function e(e,t){void 0===t.draggableOptions&&(t.draggableOptions=new r.TreeViewDraggableOptions),this._treeViewOptions=t;var i=$("<div/>"),n=$("<div/>");i.append(n),i.addClass("treeView"),n.addClass("treeView_rootPanel"),this.$rootLayout=n,this.dataSource=t.dataSource,$(e).append(i)}return Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e,this.repaint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedText",{get:function(){return this._selectedText},set:function(e){this._selectedText=e,this._treeViewOptions.selectedText=this._selectedText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"factoryVisualElements",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.onClickTreeViewItem=function(e){void 0!==this._selectedTreeViewItem&&(this._selectedTreeViewItem.isSelected=!1),e.isSelected=!0,this._selectedTreeViewItem=e,void 0!==this._treeViewOptions.onItemSelected&&this._treeViewOptions.onItemSelected({data:e.dataItem})},e.prototype.onDblClickTreeViewItem=function(e){this._treeViewOptions.onItemChoosed&&this._treeViewOptions.onItemChoosed(e)},e.prototype.repaint=function(){this.$rootLayout.empty();var e=this.items=this.factoryVisualElements.getNewTreeViewItems(this.dataSource);this.renderTree(e)},e.prototype.renderTree=function(e){var t=$("<table/>");t.addClass("treeView_treeViewItem_contentTable"),this.$rootLayout.append(t);var i=$("<tbody/>");t.append(i),this._$childrenLayout=i,this.paintChildrenNodes(e)},e.prototype.paintChildrenNodes=function(e){for(var t in e){if(e.hasOwnProperty(t))e[t].render(this._$childrenLayout)}},e.prototype.getNewTreeViewItems=function(e){var t=this,i=this;return this.createTreeViewItems(e,this,function(e){i.onClickTreeViewItem(e)},function(e){t.onDblClickTreeViewItem(e)})},e.prototype.createTreeViewItems=function(e,t,i,n){var o=new Array;for(var r in e)if(e.hasOwnProperty(r)){var a=e[r],s=this.getNewTreeViewItem(a,this._treeViewOptions,i,n,t);o.push(s)}return o},e.prototype.getNewTreeViewItem=function(e,t,i,n,o){return new r.TreeViewItem(e,t,i,n,o)},e.prototype.getLoadMoreItemsTreeViewItem=function(e,t,i,n){return new r.LoadNextTreeViewItem(e,t,i,n)},e}(),r.TreeView=t}(Ranet||(Ranet={})),function(d){var c,e,t;c=d.Controls||(d.Controls={}),e=c.MemberChoice||(c.MemberChoice={}),t=function(l){function r(e,t,i,n,o,r,a,s){if(l.call(this,e,i,n,o,t),this._optionsChoices=i,this._onMemberChoiceTreeViewItemStateChanged=a,this._view=r,this.stateTreeNode=s,this._selectedSelf=this.stateTreeNode.selectedSelf,this._selectedChildren=this.stateTreeNode.selectedChildren,this._selectedDescendants=this.stateTreeNode.selectedDescendants,!i.draggableOptions.$dragContainer.attr("class"))throw Error("Error creating popover. Unique class must be specified for root panel");this._containerClass=i.draggableOptions.$dragContainer.attr("class")}return __extends(r,l),Object.defineProperty(r.prototype,"stateTreeNode",{get:function(){return this._stateTreeNode},set:function(e){this._stateTreeNode=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"selectedSelf",{get:function(){return this._selectedSelf},set:function(e){this._selectedSelf=e,this.updateSelectionStatus(),this.updateTextSelectionStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"selectedChildren",{get:function(){return this._selectedChildren},set:function(e){0!==this.dataItem[this._optionsChoices.childCountExpr]&&(this._selectedChildren=e,this.updateSelectionStatus(),this.updateTextSelectionStatus())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"selectedDescendants",{get:function(){return this._selectedDescendants},set:function(e){0!==this.dataItem[this._optionsChoices.childCountExpr]&&(this._selectedDescendants=e,this.updateSelectionStatus(),this.updateTextSelectionStatus())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasSelectedDescedant",{get:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];if(t.selectedSelf||t.hasSelectedDescedant)return!0}return!(!this.selectedChildren&&!this.selectedDescendants&&!this.stateTreeNode.hasSelectedDescedant)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dataChildCount",{get:function(){return this.dataItem[this._optionsChoices.childCountExpr]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"countMemberChoiceItemsInChildren",{get:function(){return this.children.filter(function(e){return e instanceof r}).length},enumerable:!0,configurable:!0}),r.prototype.onMemberChoiceTreeViewItemStateChanged=function(){this._onMemberChoiceTreeViewItemStateChanged&&this._onMemberChoiceTreeViewItemStateChanged()},r.prototype.updateSelectionStatus=function(){this._$panelSelectionStatus.removeClass("imageLibrary_treeNode_selectedTreeNode"),this._$panelSelectionStatus.removeClass("imageLibrary_treeNode_hasSelectedChildren"),this._$panelSelectionStatus.removeClass("imageLibrary_treeNode_selfSelectedAndChildSelected"),!this.hasSelectedDescedant||!1!==this.selectedSelf&&void 0!==this.selectedSelf?this.hasSelectedDescedant&&this.selectedSelf?this._$panelSelectionStatus.addClass("imageLibrary_treeNode_selfSelectedAndChildSelected"):this.selectedSelf&&this._$panelSelectionStatus.addClass("imageLibrary_treeNode_selectedTreeNode"):this._$panelSelectionStatus.addClass("imageLibrary_treeNode_hasSelectedChildren")},r.prototype.updateTextSelectionStatus=function(){if(this._optionsChoices.textStatusVisible){var e=this.getTextSelectionStatus();if(""!==e)return void this._$panelTextSelectionStatus.text("("+e+")")}this._$panelTextSelectionStatus.text("")},r.prototype.afterRender=function(e){var t=this,i=$('<td class="memberChoice_td_status"/>');this._$panelSelectionStatus=$("<div/>"),this._$panelSelectionStatus.addClass("memberChoice_selectionState_panel imageLibrary_treeNode_notSelectedTreeNode"),i.append(this._$panelSelectionStatus),this._$panelTextSelectionStatus=$("<span/>"),this._$panelTextSelectionStatus.addClass("memberChoise_selectionStateText");var n=$("<td class='memberChoice_td_menuButton' />");n.append(' <span class="glyphicon glyphicon-flash memberChoice_td_menuButton_image" aria-hidden="true"></span>'),this.initPopover(n),this._$panelSelectionStatus.click(function(){t.setNewValueSelectedSelf(!t.selectedSelf)}),e.find(".treeView_treeViewItem_nodeStatus").after(i),d.ClientInformation.isTouchDevice()&&e.find(".treeView_treeViewItem_header").before(n),e.find(".treeView_treeViewItem_header").append(this._$panelTextSelectionStatus),this.initStartState(),this.initContextMenu(e)},r.prototype.initContextMenu=function(e){var a=this,s=this;e.contextmenu(function(e){s.onClickTreeViewItem();var t=new c.ContextMenu.ContextMenuOptions;t.$container=$("."+a._containerClass);var i=new c.ContextMenu.PositionDescription;i.left=e.clientX,i.top=e.clientY,t.position=i;var n=new c.ContextMenu.ContextMenuItemOptions;n.text=d.Localization.localize("MemberChoice_ContextMenu_SelectSelf"),n.checked=s.selectedSelf,n.onMenuItemClick=function(){s.setNewValueSelectedSelf(!s.selectedSelf)};var o=new c.ContextMenu.ContextMenuItemOptions;o.text=d.Localization.localize("MemberChoice_ContextMenu_SelectChildren"),o.checked=s.selectedChildren,o.onMenuItemClick=function(){s.setNewValueSelectedChildren(!s.selectedChildren)};var r=new c.ContextMenu.ContextMenuItemOptions;return r.text=d.Localization.localize("MemberChoice_ContextMenu_SelectDescendants"),r.checked=s.selectedDescendants,r.onMenuItemClick=function(){s.setNewValueSelectedDescendants(!s.selectedDescendants)},t.dataSource.push(n),t.dataSource.push(o),t.dataSource.push(r),new c.ContextMenu.ContextMenuControl(t).show(),!1})},r.prototype.initStartState=function(){this.initStartStateSelectedSelf(),this.initStartStateSetectedChildren(),this.initStartStateSelectedDescendants(),this.updateSelectionStatus(),this.updateTextSelectionStatus()},r.prototype.initStartStateSelectedSelf=function(){void 0===this.stateTreeNode.selectedSelf?this.selectedSelf=this.stateTreeNode.inheritedSelectedSelf:this.selectedSelf=this.stateTreeNode.selectedSelf},r.prototype.initStartStateSetectedChildren=function(){void 0===this.stateTreeNode.selectedChildren?this.selectedChildren=this.stateTreeNode.inheritedSelectedDescendants:this.selectedChildren=this.stateTreeNode.selectedChildren},r.prototype.initStartStateSelectedDescendants=function(){void 0===this.stateTreeNode.selectedDescendants?this.selectedDescendants=this.stateTreeNode.inheritedSelectedDescendants:this.selectedDescendants=this.stateTreeNode.selectedDescendants},r.prototype.initPopover=function(e){var t=this,i=this,n=$("<div/>"),o=$('<button type="button" class="btn btn-default btn-sm memberChoice-treeView-actionButton">'+d.Localization.localize("MemberChoice_ContextMenu_SelectSelf")+"</button>"),r=$('<button type="button" class="btn btn-default btn-sm memberChoice-treeView-actionButton">'+d.Localization.localize("MemberChoice_ContextMenu_SelectChildren")+"</button>"),a=$('<button type="button" class="btn btn-default btn-sm memberChoice-treeView-actionButton">'+d.Localization.localize("MemberChoice_ContextMenu_SelectDescendants")+"</button>");n.append(o),0!==this.dataItem.childCount&&(n.append(r),n.append(a));var s={content:n,placement:"bottom",container:"."+this._containerClass,html:!0,trigger:"manual"},l=e.popover(s),c=function(){l.popover("hide"),i.setNewValueSelectedSelf(!i.selectedSelf)},u=function(){l.popover("hide"),i.setNewValueSelectedChildren(!i.selectedChildren)},p=function(){l.popover("hide"),i.setNewValueSelectedDescendants(!i.selectedDescendants)},h=function(e){$(e.target).closest(".popover").length||$(".popover").each(function(){l.popover("hide")})};l.on("show.bs.popover",function(){o.one("click",c),0!==t.dataItem.childCount&&(r.one("click",u),a.one("click",p)),$("html").on("mousedown",h),i.selectedSelf?o.addClass("active"):o.removeClass("active"),i.selectedChildren?r.addClass("active"):r.removeClass("active"),i.selectedDescendants?a.addClass("active"):a.removeClass("active")}),l.on("hidden.bs.popover",function(){o.off("click",c),r.off("click",u),a.off("click",p),$("html").off("mousedown",h)}),$(this._view.$rootLayout).scroll(function(){l.popover("hide")}),e.click(function(){l.popover("show")})},r.prototype.setNewValueSelectedSelf=function(e){r.updateDataStatusTreeAfterUserActionSelectedSelf(e,this),r.updateVisualStatusTreeAfterUserActionSelectedSelf(e,this),this.updateStatusMemberChoiceTreeViewItems(),this.onMemberChoiceTreeViewItemStateChanged()},r.prototype.setNewValueSelectedChildren=function(e){r.updateDataStatusTreeAfterUserActionSelectedChildren(e,this),r.updateVisualStatusTreeAfterUserActionSelectedChildren(e,this),this.updateStatusMemberChoiceTreeViewItems(),this.onMemberChoiceTreeViewItemStateChanged()},r.prototype.setNewValueSelectedDescendants=function(e){r.updateDataStatusTreeAfterUserActionSelectedDescendants(e,this),r.updateVisualStatusTreeAfterUserActionSelectedDescendants(e,this),this.updateStatusMemberChoiceTreeViewItems(),this.onMemberChoiceTreeViewItemStateChanged()},r.updateDataStatusTreeAfterUserActionSelectedSelf=function(e,t){t.stateTreeNode.inheritedSelectedSelf?e?t.stateTreeNode.selectedSelf=void 0:(t.stateTreeNode.selectedSelf=!1,t.stateTreeNode.updatePropertySelectedChildrenForParent()):t.stateTreeNode.selectedSelf=!!e||void 0},r.updateDataStatusTreeAfterUserActionSelectedDescendants=function(e,t){t.stateTreeNode.inheritedSelectedDescendants?t.stateTreeNode.selectedDescendants=!!e&&void 0:t.stateTreeNode.selectedDescendants=!!e||void 0},r.updateDataStatusTreeAfterUserActionSelectedChildren=function(e,t){t.stateTreeNode.inheritedSelectedDescendants?t.stateTreeNode.selectedDescendants?t.stateTreeNode.selectedChildren=!!e&&void 0:t.stateTreeNode.selectedChildren=e:!1===e?t.stateTreeNode.selectedDescendants?t.stateTreeNode.selectedChildren=!1:t.stateTreeNode.selectedChildren=void 0:t.stateTreeNode.selectedChildren=!0,t.stateTreeNode.childrenClearSelectionSelectedSelf()},r.updateVisualStatusTreeAfterUserActionSelectedDescendants=function(e,t){t.selectedDescendants=e,t.selectedChildren=e,r.recursiveUpdateStatusChildrenAfterUserActionSelectedDescendants(t)},r.recursiveUpdateStatusChildrenAfterUserActionSelectedDescendants=function(e){var t;for(t=0;t<e.children.length;t++)if(e.children[t]instanceof r!=0){var i=e.children[t];i.selectedSelf=e.selectedChildren||e.selectedDescendants,i.selectedDescendants=e.selectedDescendants,i.selectedChildren=e.selectedDescendants,0<i.children.length&&r.recursiveUpdateStatusChildrenAfterUserActionSelectedDescendants(i)}},r.updateVisualStatusTreeAfterUserActionSelectedChildren=function(e,t){var i;for(t.selectedChildren=e,i=0;i<t.children.length;i++)t.children[i]instanceof r!=0&&(t.children[i].selectedSelf=t.selectedChildren)},r.updateVisualStatusTreeAfterUserActionSelectedSelf=function(e,t){var i;t.selectedSelf=e;var n=t.parents[t.parents.length-1];if(n){var o=0;for(i=0;i<n.children.length;i++)n.children[i].selectedSelf&&o++;o!==n.dataItem[t._optionsChoices.childCountExpr]||!1!==n.selectedChildren&&void 0!==n.selectedChildren||(n.selectedChildren=!0),0===o&&n.selectedChildren&&n.dataItem[t._optionsChoices.childCountExpr]===n.children.filter(function(e){return e instanceof r}).length&&(n.selectedChildren=!1)}},r.prototype.updateStatusMemberChoiceTreeViewItems=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];if(i instanceof r!=0){var n=i;n.updateSelectionStatus(),0<n.children.length&&this.updateStatusMemberChoiceTreeViewItems(n.children)}}else{var o=this._view.children;this.updateStatusMemberChoiceTreeViewItems(o)}},r.prototype.getTextSelectionStatus=function(){var e="";return!this.stateTreeNode.selectedSelf||this.stateTreeNode.selectedDescendants||this.stateTreeNode.selectedChildren?this.stateTreeNode.selectedSelf||this.stateTreeNode.selectedDescendants||!this.stateTreeNode.selectedChildren?this.stateTreeNode.selectedSelf&&!this.stateTreeNode.selectedDescendants&&this.stateTreeNode.selectedChildren?e=d.Localization.localize("MemberChoice_State_Selected_With_Children"):!this.stateTreeNode.selectedSelf&&this.stateTreeNode.selectedDescendants?e=d.Localization.localize("MemberChoice_State_Selected_By_Parent_With_Descendants"):this.stateTreeNode.selectedSelf&&this.stateTreeNode.selectedDescendants?e=d.Localization.localize("MemberChoice_State_Selected_With_Descendants"):!this.stateTreeNode.selectedSelf&&this.stateTreeNode.hasSelectedDescedant?e=d.Localization.localize("MemberChoice_State_Selected_Selected_By_Parent_With_Descendants_Has_Excluded"):this.stateTreeNode.selectedSelf&&this.stateTreeNode.hasSelectedDescedant?e=d.Localization.localize("MemberChoice_State_Selected_With_Descendants_Has_Exclude"):e:e=d.Localization.localize("MemberChoice_State_Selected_Selected_Children"):e=d.Localization.localize("MemberChoice_State_Selected_Self")},r.prototype.clearSelection=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];if(i instanceof r!=0){var n=i;n.selectedChildren=void 0,n.selectedDescendants=void 0,n.selectedSelf=void 0,0<n.children.length&&this.clearSelection(n.children)}}else{var o=this._view.children;this.clearSelection(o),this.updateStatusMemberChoiceTreeViewItems()}},r}(c.TreeViewItem),e.MemberChoiceTreeViewItem=t}(Ranet||(Ranet={})),function(e){var t,c,i;t=e.Controls||(e.Controls={}),c=t.MemberChoice||(t.MemberChoice={}),i=function(i){function e(e,t){i.call(this,e,t),this._onTreeStateChanged=t.onTreeStateChanged,(this._options=t).selectionRootNodes?this._selectionManager=new c.SelectionManager(t.selectionRootNodes):this._selectionManager=new c.SelectionManager}return __extends(e,i),Object.defineProperty(e.prototype,"children",{get:function(){return this.items},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showItemTextStatus",{get:function(){return this._options.textStatusVisible},set:function(e){this._options.textStatusVisible=e},enumerable:!0,configurable:!0}),e.prototype.initTreeView=function(e,i){this.$rootLayout.empty();var n=this,t=this.items=this.getNewTreeViewItems(e);if(this._options.countLoadedItems&&this._options.countLoadedItems<=e.length&&i){var o=void 0;o=i instanceof c.SearchDescription?this._options.connectionProvider.getPromiseLoadNeighborsSearchMode:this._options.connectionProvider.getPromiseLoadNeighbors;var r=this.factoryVisualElements.getLoadMoreItemsTreeViewItem(i,e.length,o,function(e,t){n.onLoadedNewChildren(e,t,i)});t.push(r)}this.renderTree(t)},e.prototype.onLoadedNewChildren=function(e,t,i){var n=this,o=this.getNewTreeViewItems(t),r=this.items.indexOf(e);if(-1===r)throw new Error("InvalidOperationException.indexBtnLoadNextTreeViewItem");this.items.splice(r,1);var a=this.items.length+o.length;if(this._options.countLoadedItems&&this._options.countLoadedItems<=t.length){var s;s=i instanceof c.SearchDescription?this._options.connectionProvider.getPromiseLoadNeighborsSearchMode:this._options.connectionProvider.getPromiseLoadNeighbors;var l=this.factoryVisualElements.getLoadMoreItemsTreeViewItem(i,a,s,function(e,t){n.onLoadedNewChildren(e,t,i)});o.push(l)}this.items=this.items.concat(o),this.paintChildrenNodes(o)},e.prototype.onTreeStateChanged=function(){void 0!==this._onTreeStateChanged&&this._onTreeStateChanged(this._selectionManager.currentSelectionTree)},e.prototype.getNewTreeViewItem=function(e,t,i,n,o){var r=this,a=this._selectionManager.getStateMemberChoiceTreeViewItem(e);return new c.MemberChoiceTreeViewItem(e,o,t,i,n,this,function(){r.onTreeStateChanged()},a)},e.prototype.clearSelectionDataTree=function(){this._selectionManager.clearSelection();for(var e=0;e<this.children.length;e++)this.children[e]instanceof c.MemberChoiceTreeViewItem!=0&&this.children[e].clearSelection();this.onTreeStateChanged()},e}(t.TreeView),c.MemberChoiceTreeView=i}(Ranet||(Ranet={})),function(e){var t,h,i;t=e.Controls||(e.Controls={}),h=t.MemberChoice||(t.MemberChoice={}),i=function(){function p(e){this._currentSelectionRootNodes=new Array,void 0!==e&&(this._currentSelectionRootNodes=e)}return Object.defineProperty(p.prototype,"currentSelectionTree",{get:function(){return p.optimizeSelectionTree(this._currentSelectionRootNodes)},enumerable:!0,configurable:!0}),p.prototype.clearSelection=function(){for(var e=0;e<this._currentSelectionRootNodes.length;e++)h.MemberChoiceTreeNode.clearSelection(this._currentSelectionRootNodes[e])},p.prototype.getStateMemberChoiceTreeViewItem=function(e){if(null===e.parents){if(0!==this._currentSelectionRootNodes.length)for(var t=0;t<this._currentSelectionRootNodes.length;t++)if(this._currentSelectionRootNodes[t].uniqueName===e.uniqueName)return new h.StateMemberChoiceTreeViewItem(e,this._currentSelectionRootNodes[t],this._currentSelectionRootNodes[t]);var i=new h.MemberChoiceTreeNode(e.uniqueName);return this._currentSelectionRootNodes.push(i),new h.StateMemberChoiceTreeViewItem(e,i,i)}var n,o;if(0===this._currentSelectionRootNodes.length)return n=new h.MemberChoiceTreeNode(e.uniqueName),o=p.getBuiltTree(e.parents,0,n),this._currentSelectionRootNodes.push(o),new h.StateMemberChoiceTreeViewItem(e,n,o);for(var r=0;r<this._currentSelectionRootNodes.length;r++){var a=this._currentSelectionRootNodes[r],s=p.findTreeNode(e.uniqueName,a);if(void 0!==s)return new h.StateMemberChoiceTreeViewItem(e,s,a);for(var l=e.parents.length-1;0<=l;l--){var c=e.parents[l].uniqueName,u=p.findTreeNode(c,a);if(void 0!==u)return n=new h.MemberChoiceTreeNode(e.uniqueName),p.extendSelectionTree(u,e.parents.splice(l+1,e.parents.length),n),new h.StateMemberChoiceTreeViewItem(e,n,a)}}return n=new h.MemberChoiceTreeNode(e.uniqueName),o=p.getBuiltTree(e.parents,0,n),this._currentSelectionRootNodes.push(o),new h.StateMemberChoiceTreeViewItem(e,n,o)},p.getBuiltTree=function(e,t,i){var n=new h.MemberChoiceTreeNode(e[t].uniqueName,void 0,void 0,void 0),o=t+1;return o<e.length?n.childNodes.push(p.getBuiltTree(e,o,i)):n.childNodes.push(i),n},p.findTreeNode=function(e,t){if(t.uniqueName===e)return t;for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(0===n.childNodes.length&&n.uniqueName===e)return n;var o=p.findTreeNode(e,n);if(void 0!==o)return o}},p.extendSelectionTree=function(e,t,i){p.addNewParents(e,t,0,i)},p.addNewParents=function(e,t,i,n){if(0!==t.length){var o=new h.MemberChoiceTreeNode(t[i].uniqueName);e.childNodes.push(o);var r=i+1;r<t.length?p.addNewParents(o,t,r,n):o.childNodes.push(n)}else e.childNodes.push(n)},p.optimizeSelectionTree=function(e){for(var t=Array(),i=0;i<e.length;i++){var n=e[i];if(p.canIncludeNodeInSelectionTree(n)){var o=new h.MemberChoiceTreeNode(n.uniqueName,n.selectedSelf,n.selectedChildren,n.selectedDescendants);0<n.childNodes.length&&(o.childNodes=p.optimizeSelectionTree(n.childNodes)),t.push(o)}}return t},p.canIncludeNodeInSelectionTree=function(e){if(void 0!==e.selectedChildren||void 0!==e.selectedSelf||void 0!==e.selectedDescendants)return!0;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(p.canIncludeNodeInSelectionTree(i))return!0}return!1},p}(),h.SelectionManager=i}(Ranet||(Ranet={})),function(l){var o,a,e;o=l.Controls||(l.Controls={}),a=o.SmartFilter||(o.SmartFilter={}),e=function(){function n(e,t){var i=this;this._onValueChanged=new o.Events.LiteEvent,this._levelSelectors=new Array,n._directoryTemplate=l.PathManager.templatesPath,this._$parentElement=$(e),this._options=t,this._promiseDownloadTemplates=this.downloadTemplate().done(function(e){i._filterTemplates=e,i.init1()})}return Object.defineProperty(n.prototype,"isValid",{get:function(){for(var e=!0,t=0;t<this._levelSelectors.length;t++)this._levelSelectors[t].isValid||(e=!1);return e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._levels},set:function(e){var t=this;this._levels=e,this._promiseDownloadTemplates.done(function(){t.init2()})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"filterTreeDescription",{get:function(){for(var e=new Array,t=0;t<this._levelSelectors.length;t++){var i=this._levelSelectors[t].actualFilterDescription;e.push(i)}return e},enumerable:!0,configurable:!0}),n.prototype.init1=function(){var e=this,t=this;this._filterTemplates.customFilterTemplate.$btnAddFilterToLevel.on("click",function(){e.addNewLevelFilter(null),t._levels.length===t._levelSelectors.length&&t._filterTemplates.customFilterTemplate.$btnAddFilterToLevel.attr("disabled","true")}),this._$parentElement.append(this._filterTemplates.customFilterTemplate.$layout)},n.prototype.init2=function(){for(var e=0;e<this._options.filterTreeDescription.length;e++){var t=this._options.filterTreeDescription[e];this.addNewLevelFilter(t)}this._levels.length===this._levelSelectors.length&&this._filterTemplates.customFilterTemplate.$btnAddFilterToLevel.attr("disabled","true")},n.prototype.addNewLevelFilter=function(e){var t=this,i=this._filterTemplates.$levelSelectorTemplate.clone(),n=this,o=new a.LevelSelectorOptions;o.initialFilterDescription=e,o.levels=this.getCopyAvailableLevels(),o.measuresTree=this._options.treeMeasures,o.$container=this._options.measureChoiceContainer,o.$groupFiltersTemplate=this._filterTemplates.$groupFiltersTemplate,o.$topFilterTemplate=this._filterTemplates.filterTemplates.$topFilterTemplate,o.$labelFilterTemplate=this._filterTemplates.filterTemplates.$labelFilterTemplate,o.$valueFilterTemplate=this._filterTemplates.filterTemplates.$valueFilterTemplate;var r=new a.LevelSelectorControl(i,o);r.onLevelSelectorRemoved.on(function(e){t._levelSelectors.splice(t._levelSelectors.indexOf(e),1),t._filterTemplates.customFilterTemplate.$btnAddFilterToLevel.removeAttr("disabled"),n.updateAvailableLevels(),t._onValueChanged.trigger()}),r.onValueChanged.on(function(){t._onValueChanged.trigger()}),r.onSelectedLevelChanged.on(function(e){n.updateAvailableLevels()}),this._levelSelectors.push(r),r.init(),this._filterTemplates.customFilterTemplate.$treeLevelsLayout.append(i),this._onValueChanged.trigger()},n.prototype.updateAvailableLevels=function(){var i=this.getCopyAvailableLevels();this._levelSelectors.forEach(function(e){var t=JSON.parse(JSON.stringify(i));e.updateAvailableLevels(t)})},n.prototype.getCopyAvailableLevels=function(){for(var e=JSON.parse(JSON.stringify(this._levels)),t=0;t<this._levelSelectors.length;t++){var i=this._levelSelectors[t],n=e.filter(function(e){return i.selectedLevel.uniqueName===e.uniqueName})[0];e.splice(e.indexOf(n),1)}return e},n.prototype.downloadTemplate=function(){var s=$.Deferred();return $.when($.ajax({url:n._directoryTemplate+"label-filter-row-template.html"}),$.ajax({url:n._directoryTemplate+"top-filter-row-template.html"}),$.ajax({url:n._directoryTemplate+"value-filter-row-template.html"}),$.ajax({url:n._directoryTemplate+"custom-filter-template.html"}),$.ajax({url:n._directoryTemplate+"level-selector-row-template.html"}),$.ajax({url:n._directoryTemplate+"group-filter-row-template.html"})).done(function(e,t,i,n,o,r){var a=$(l.Localization.localizeTemplate(n[0]));s.resolve({customFilterTemplate:{$layout:a,$btnAddFilterToLevel:a.find(".smartFilter-addFilterToLevelButton"),$treeLevelsLayout:a.find(".smartFilter-levelsTreePanel")},filterTemplates:{$labelFilterTemplate:$(l.Localization.localizeTemplate(e[0])),$topFilterTemplate:$(l.Localization.localizeTemplate(t[0])),$valueFilterTemplate:$(l.Localization.localizeTemplate(i[0]))},$levelSelectorTemplate:$(l.Localization.localizeTemplate(o[0])),$groupFiltersTemplate:$(l.Localization.localizeTemplate(r[0]))})}).fail(function(e){s.reject(e),l.LogService.error(e)}),s},n}(),a.CustomFilterControl=e}(Ranet||(Ranet={})),function(e){var t,i,n,o,r;t=e.Controls||(e.Controls={}),i=t.SmartFilter||(t.SmartFilter={}),n=i.Options||(i.Options={}),o=function(){},r=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(n.DropDownItem=o),n.LevelDescription=r}(Ranet||(Ranet={})),function(e){var t,i,c,n;t=e.Controls||(e.Controls={}),i=t.SmartFilter||(t.SmartFilter={}),c=i.Options||(i.Options={}),n=function(){function l(){this.filterTreeDescription=new Array,this.isUsed=!1}return l.parse=function(e){var t=JSON.parse(e),i=new l;i.isUsed=t.isUsed;for(var n=0;n<t.filterTreeDescription.length;n++){var o=t.filterTreeDescription[n],r=new c.LevelFilterDescription;r.level=o.level;for(var a=0;a<o.filters.length;a++){var s=o.filters[a];if(s.typeName===c.FilterGroupDescription.typeName)r.filters.push(l.parseFilterGroup(s));else{if(s.typeName!==c.TopDataFilter.typeName)throw new Error("InvalidOperationException");r.filters.push(new c.TopDataFilter(s))}}i.filterTreeDescription.push(r)}return i},l.parseFilterGroup=function(e){var t=new c.FilterGroupDescription;t.operation=e.operation;for(var i=0;i<e.filters.length;i++){var n=e.filters[i];if(n.typeName===c.ValueDataFilter.typeName){var o=new c.ValueDataFilter(n);t.filters.push(o)}else if(n.typeName===c.LabelDataFilter.typeName){var r=new c.LabelDataFilter(n);t.filters.push(r)}else{if(n.typeName!==c.FilterGroupDescription.typeName)throw new Error("InvalidOperationException");var a=this.parseFilterGroup(n);t.filters.push(a)}}return t},l}(),c.SmartCustomFilterDescription=n}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),o=t.SmartFilter||(t.SmartFilter={}),i=o.Options||(o.Options={}),(n=i.DataFilterType||(i.DataFilterType={}))[n.LabelFilter=0]="LabelFilter",n[n.ValueFilter=1]="ValueFilter",n[n.TopFilter=2]="TopFilter",i.DataFilterType}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),i=t.SmartFilter||(t.SmartFilter={}),n=i.Options||(i.Options={}),o=function(){function e(){this.typeName=e.typeName,this.operation=n.GroupOperation.And,this.filters=new Array}return e.typeName="filterGroup",e}(),n.FilterGroupDescription=o}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),o=t.SmartFilter||(t.SmartFilter={}),i=o.Options||(o.Options={}),(n=i.GroupOperation||(i.GroupOperation={}))[n.And=0]="And",n[n.Or=1]="Or",n[n.NotAnd=2]="NotAnd",n[n.NotOr=3]="NotOr",i.GroupOperation}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),i=t.SmartFilter||(t.SmartFilter={}),n=i.Options||(i.Options={}),o=function(){function e(e){e?(this.text1=e.text1,this.text2=e.text2,this.levelPropertyName=e.levelPropertyName,this.filterType=e.filterType):(this.text1="",this.text2="",this.levelPropertyName="Caption",this.filterType=n.LabelDataFilterType.Equal)}return Object.defineProperty(e.prototype,"typeName",{get:function(){return e.typeName},enumerable:!0,configurable:!0}),e.typeName="labelFilter",e}(),n.LabelDataFilter=o}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),o=t.SmartFilter||(t.SmartFilter={}),i=o.Options||(o.Options={}),(n=i.LabelDataFilterType||(i.LabelDataFilterType={}))[n.Equal=0]="Equal",n[n.NotEqual=1]="NotEqual",n[n.Greater=2]="Greater",n[n.GreaterOrEqual=3]="GreaterOrEqual",n[n.Less=4]="Less",n[n.LessOrEqual=5]="LessOrEqual",n[n.Between=6]="Between",n[n.BetweenNotIncluding=7]="BetweenNotIncluding",n[n.NotBetween=8]="NotBetween",n[n.NotBetweenNotIncluding=9]="NotBetweenNotIncluding",n[n.BeginWith=10]="BeginWith",n[n.NotBeginWith=11]="NotBeginWith",n[n.EndWith=12]="EndWith",n[n.NotEndWith=13]="NotEndWith",n[n.Contain=14]="Contain",n[n.NotContain=15]="NotContain",i.LabelDataFilterType}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.SmartFilter||(t.SmartFilter={}),n=function(){this.level=null,this.filters=new Array},(i.Options||(i.Options={})).LevelFilterDescription=n}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),i=t.SmartFilter||(t.SmartFilter={}),n=i.Options||(i.Options={}),o=function(){function e(e){e?(this.filterType=e.filterType,this.count=e.count,this.filterTarget=e.filterTarget,this.measureUniqueName=e.measureUniqueName):(this.filterType=n.TopDataFilterType.Top,this.count=0,this.filterTarget=n.TopDataFilterTargetType.Items,this.measureUniqueName="")}return Object.defineProperty(e.prototype,"typeName",{get:function(){return e.typeName},enumerable:!0,configurable:!0}),e.typeName="topFilter",e}(),n.TopDataFilter=o}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),o=t.SmartFilter||(t.SmartFilter={}),i=o.Options||(o.Options={}),(n=i.TopDataFilterTargetType||(i.TopDataFilterTargetType={}))[n.Items=0]="Items",n[n.Percent=1]="Percent",n[n.Sum=2]="Sum",i.TopDataFilterTargetType}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),o=t.SmartFilter||(t.SmartFilter={}),i=o.Options||(o.Options={}),(n=i.TopDataFilterType||(i.TopDataFilterType={}))[n.Top=0]="Top",n[n.Bottom=1]="Bottom",i.TopDataFilterType}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),i=t.SmartFilter||(t.SmartFilter={}),n=i.Options||(i.Options={}),o=function(){function e(e){e?(this.num1=e.num1,this.num2=e.num2,this.measureUniqueName=e.measureUniqueName,this.filterType=e.filterType):(this.num1=0,this.num2=0,this.measureUniqueName="",this.filterType=n.ValueDataFilterType.Equal)}return Object.defineProperty(e.prototype,"typeName",{get:function(){return e.typeName},enumerable:!0,configurable:!0}),e.typeName="valueFilter",e}(),n.ValueDataFilter=o}(Ranet||(Ranet={})),function(e){var t,i,n,o;t=e.Controls||(e.Controls={}),o=t.SmartFilter||(t.SmartFilter={}),i=o.Options||(o.Options={}),(n=i.ValueDataFilterType||(i.ValueDataFilterType={}))[n.Equal=0]="Equal",n[n.NotEqual=1]="NotEqual",n[n.Greater=2]="Greater",n[n.GreaterOrEqual=3]="GreaterOrEqual",n[n.Less=4]="Less",n[n.LessOrEqual=5]="LessOrEqual",n[n.Between=6]="Between",n[n.BetweenNotIncluding=7]="BetweenNotIncluding",n[n.NotBetween=8]="NotBetween",n[n.NotBetweenNotIncluding=9]="NotBetweenNotIncluding",i.ValueDataFilterType}(Ranet||(Ranet={})),function(e){var t;(function(e){var t=function(){};e.CustomFilterOptions=t;var i=function(){};e.LevelSelectorOptions=i;var n=function(){};e.FiltersGroupOptions=n})((t=e.Controls||(e.Controls={})).SmartFilter||(t.SmartFilter={}))}(Ranet||(Ranet={})),function(n){var o;(function(s){var e=function(){function a(e,t){this._filterControlChildren=new Array,this._onGroupRemoved=new o.Events.LiteEvent,this._onValueChanged=new o.Events.LiteEvent,this._$view=e,this._options=t,this._$conditionSelectorPanel=this._$view.find(".groupFilter-conditionSelector"),this._$addLabelFilterButton=this._$view.find(".groupFilter-addCaptionFilterButton"),this._$addFiltersGroupButton=this._$view.find(".groupFilter-addFiltersGroupButton"),this._$addValueFilterButton=this._$view.find(".groupFilter-addValueFilterButton"),this._$removeGroupButton=this._$view.find(".groupFilter-removeGroupFilterButton"),this._$expandButton=this._$view.find(".groupFilter-caret"),this._$expandButton.addClass("hidden-caret"),this._$validationIndicator=this._$view.find(".validation-alert-indicator"),this._$childPanel=this._$view.find(".groupFilter-childPanel")}return Object.defineProperty(a.prototype,"onGroupRemoved",{get:function(){return this._onGroupRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isValid",{get:function(){var e=!0;0===this._filterControlChildren.length&&(e=!1);for(var t=0;t<this._filterControlChildren.length;t++)this._filterControlChildren[t].isValid||(e=!1);return this.drawNotValidIndicator(),e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"actualGroupDescription",{get:function(){var e=new s.Options.FilterGroupDescription;e.operation=this._operationSelector.selectedItem.operation;for(var t=0;t<this._filterControlChildren.length;t++){var i=this._filterControlChildren[t];if(i instanceof s.LabelFilterControl){var n=i;e.filters.push(n.actualFilterDescription)}else if(i instanceof s.ValueFilterControl){var o=i;e.filters.push(o.actualFilterDescription)}else{if(!(i instanceof a))throw new Error("InvalidOperationException");var r=i;e.filters.push(r.actualGroupDescription)}}return e},enumerable:!0,configurable:!0}),a.prototype.init=function(){var t=this,e=this._operationSelector=new o.DropDownControl;e.displayPropertyExpr="caption",e.selectedExpr="isSelected",e.imageCssClassExp="imageClass",e.itemSource=a.getOperations(this._options.initialFilterGroupDescription.operation),e.selectionChanged.on(function(e){}),this._$conditionSelectorPanel.append(e.view),this._$addFiltersGroupButton.on("click",function(){var e=new s.Options.FilterGroupDescription;t.addFilterGroup(e),t.updateCaretState()}),this._$addLabelFilterButton.on("click",function(){var e=new s.Options.LabelDataFilter;t.addLabelFilter(e),t.updateCaretState()}),this._$addValueFilterButton.on("click",function(){t.addValueFilter(new s.Options.ValueDataFilter),t.updateCaretState()}),this._$removeGroupButton.on("click",function(){t._$view.remove(),t._onGroupRemoved.trigger(t)}),this._$expandButton.on("click",function(){t._$childPanel.toggle(),t._$expandButton.toggleClass("fa-caret-right"),t._$expandButton.toggleClass("fa-caret-down")}),this.init2(),this.updateCaretState()},a.prototype.addLabelFilter=function(e){var t=this,i=this._options.$labelFilterTemplate.clone(),n=new s.LabelFilterControl(i,e);n.onFilterRemoved.on(function(e){t._filterControlChildren.splice(t._filterControlChildren.indexOf(e),1),t.updateCaretState(),t._onValueChanged.trigger()}),n.onValueChanged.on(function(){t._onValueChanged.trigger()}),n.init(),this._filterControlChildren.push(n),this._$childPanel.append(i),this.drawNotValidIndicator(),this._onValueChanged.trigger()},a.prototype.addValueFilter=function(e){var t=this,i=this._options.$valueFilterTemplate.clone(),n=new s.ValueFilterControl(i,e,this._options.measuresTree,this._options.$container);n.onFilterRemoved.on(function(e){t._filterControlChildren.splice(t._filterControlChildren.indexOf(e),1),t.updateCaretState(),t._onValueChanged.trigger()}),n.onValueChanged.on(function(){t._onValueChanged.trigger()}),n.init(),this._filterControlChildren.push(n),this._$childPanel.append(i),this.drawNotValidIndicator(),this._onValueChanged.trigger()},a.prototype.addFilterGroup=function(e){var t=this,i=this._options.$groupFiltersTemplate.clone(),n=new s.FiltersGroupOptions;n.measuresTree=this._options.measuresTree,n.$container=this._options.$container,n.initialFilterGroupDescription=e,n.$groupFiltersTemplate=this._options.$groupFiltersTemplate,n.$labelFilterTemplate=this._options.$labelFilterTemplate,n.$valueFilterTemplate=this._options.$valueFilterTemplate;var o=new a(i,n);o.onGroupRemoved.on(function(e){t._filterControlChildren.splice(t._filterControlChildren.indexOf(e),1),t.updateCaretState(),t._onValueChanged.trigger()}),o._onValueChanged.on(function(){t._onValueChanged.trigger()}),o.init(),this._filterControlChildren.push(o),this._$childPanel.append(i),this.drawNotValidIndicator(),this._onValueChanged.trigger()},a.prototype.init2=function(){for(var e=0;e<this._options.initialFilterGroupDescription.filters.length;e++){var t=this._options.initialFilterGroupDescription.filters[e];if(t instanceof s.Options.LabelDataFilter)this.addLabelFilter(t);else if(t instanceof s.Options.ValueDataFilter)this.addValueFilter(t);else{if(!(t instanceof s.Options.FilterGroupDescription))throw new Error("InvalidOperationException");this.addFilterGroup(t)}}},a.prototype.updateCaretState=function(){0!==this._filterControlChildren.length?this._$expandButton.removeClass("hidden-caret"):this._$expandButton.addClass("hidden-caret")},a.getOperations=function(e){var t=new Array;return t.push(new i(n.Localization.localize("OperationType_And"),"imageLibrary_fcgroupand",s.Options.GroupOperation.And,e===s.Options.GroupOperation.And)),t.push(new i(n.Localization.localize("OperationType_Or"),"imageLibrary_fcgroupor",s.Options.GroupOperation.Or,e===s.Options.GroupOperation.Or)),t.push(new i(n.Localization.localize("OperationType_NotAnd"),"imageLibrary_fcgroupxor",s.Options.GroupOperation.NotAnd,e===s.Options.GroupOperation.NotAnd)),t.push(new i(n.Localization.localize("OperationType_NotOr"),"imageLibrary_fcgroupnot",s.Options.GroupOperation.NotOr,e===s.Options.GroupOperation.NotOr)),t},a.prototype.drawNotValidIndicator=function(){0===this._filterControlChildren.length?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},a}();s.FiltersGroupControl=e;var i=function(e,t,i,n){void 0===n&&(n=!1),this.caption=e,this.imageClass=t,this.operation=i,this.isSelected=n}})((o=n.Controls||(n.Controls={})).SmartFilter||(o.SmartFilter={}))}(Ranet||(Ranet={})),function(o){var r,a,n,s,e;r=o.Controls||(o.Controls={}),a=r.SmartFilter||(r.SmartFilter={}),n=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.levelPropertyName=i,this.isSelected=n},s=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n},e=function(){function e(e,t){this._onFilterRemoved=new r.Events.LiteEvent,this._onValueChanged=new r.Events.LiteEvent,this._$view=e,this._initialFilterDescription=t,this._actualFilterDescription=jQuery.extend(!0,{},this._initialFilterDescription)}return Object.defineProperty(e.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onFilterRemoved",{get:function(){return this._onFilterRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){var e,t=""!==this._$textBox1.val(),i=this._$textBox2.val();switch(this._actualFilterDescription.filterType){case a.Options.LabelDataFilterType.Between:case a.Options.LabelDataFilterType.BetweenNotIncluding:case a.Options.LabelDataFilterType.NotBetween:case a.Options.LabelDataFilterType.NotBetweenNotIncluding:e=""!==i;break;default:e=!0}return t&&e?(this.drawNotValidIndicator(!1),!0):(this.drawNotValidIndicator(!0),!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actualFilterDescription",{get:function(){return this._actualFilterDescription.text1=this._$textBox1.val(),this._actualFilterDescription.text2=this._$textBox2.val(),this._actualFilterDescription},enumerable:!0,configurable:!0}),e.prototype.parseView=function(e){this._$levelPropertyDropDownPanel=e.find(".labelFilter-propertySelector"),this._$labelFilterTypeDropDownPanel=e.find(".labelFilter-operationSelector"),this._$textBox1=e.find(".labelFilter-input1 input"),this._$textBox2=e.find(".labelFilter-input2 input"),this._$textBox1Panel=e.find(".labelFilter-input1"),this._$textBox2Panel=e.find(".labelFilter-input2"),this._$labelAndPanel=e.find(".labelFilter-andLabel"),this._$removeFilterButton=e.find(".labelFilter-removeFilterButton"),this._$validationIndicator=e.find(".validation-alert-indicator")},e.prototype.init=function(){var e=this;this.parseView(this._$view),this.initLevelPropName(),this.initFilterType(),this.initTextBoxes(),this._$removeFilterButton.on("click",function(){e._$view.remove(),e._onFilterRemoved.trigger(e)})},e.prototype.initTextBoxes=function(){var e=this;this._$textBox1.val(this._initialFilterDescription.text1),this._$textBox1.on("change",function(){e.drawNotValidIndicator(!1),e._onValueChanged.trigger()}),this._$textBox2.val(this._initialFilterDescription.text2),this._$textBox2.on("change",function(){e.drawNotValidIndicator(!1),e._onValueChanged.trigger()})},e.prototype.initLevelPropName=function(){var t=this,e=[new n(o.Localization.localize("Olap_Caption"),"imageLibrary_levelProperty","Caption","Caption".toUpperCase()===this._initialFilterDescription.levelPropertyName.toUpperCase()),new n(o.Localization.localize("Olap_Name"),"imageLibrary_levelProperty","Name","Name".toUpperCase()===this._initialFilterDescription.levelPropertyName.toUpperCase()),new n(o.Localization.localize("Olap_UniqueName"),"imageLibrary_levelProperty","UNIQUE_NAME","UNIQUE_NAME".toUpperCase()===this._initialFilterDescription.levelPropertyName.toUpperCase())],i=new r.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=e,i.selectionChanged.on(function(e){t._actualFilterDescription.levelPropertyName=e.levelPropertyName}),this._$levelPropertyDropDownPanel.append(i.view)},e.prototype.initFilterType=function(){var t=this,i=this;this.updateStateFilterType(this._initialFilterDescription.filterType);var e=new Array;e.push(new s(o.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",a.Options.LabelDataFilterType.Equal,a.Options.LabelDataFilterType.Equal===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_NotEqual"),"imageLibrary_fcopnotequal",a.Options.LabelDataFilterType.NotEqual,a.Options.LabelDataFilterType.NotEqual===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_Greater"),"imageLibrary_fcopgreater",a.Options.LabelDataFilterType.Greater,a.Options.LabelDataFilterType.Greater===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_GreaterOrEqual"),"imageLibrary_fcopgreaterorequal",a.Options.LabelDataFilterType.GreaterOrEqual,a.Options.LabelDataFilterType.GreaterOrEqual===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_Less"),"imageLibrary_fcopless",a.Options.LabelDataFilterType.Less,a.Options.LabelDataFilterType.Less===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_LessOrEqual"),"imageLibrary_fcoplessorequal",a.Options.LabelDataFilterType.LessOrEqual,a.Options.LabelDataFilterType.LessOrEqual===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_Between"),"imageLibrary_fcopbetween",a.Options.LabelDataFilterType.Between,a.Options.LabelDataFilterType.Between===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_BetweenNotIncluding"),"imageLibrary_fcopbetweennotincluding",a.Options.LabelDataFilterType.BetweenNotIncluding,a.Options.LabelDataFilterType.BetweenNotIncluding===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_NotBetween"),"imageLibrary_fcopnotbetween",a.Options.LabelDataFilterType.NotBetween,a.Options.LabelDataFilterType.NotBetween===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_NotBetweenNotIncluding"),"imageLibrary_fcopnotbetweennotincluding",a.Options.LabelDataFilterType.NotBetweenNotIncluding,a.Options.LabelDataFilterType.NotBetweenNotIncluding===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("LabelFilter_BeginWith"),"imageLibrary_fcopbegin",a.Options.LabelDataFilterType.BeginWith,a.Options.LabelDataFilterType.BeginWith===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("LabelFilter_NotBeginWith"),"imageLibrary_fcopbeginnot",a.Options.LabelDataFilterType.NotBeginWith,a.Options.LabelDataFilterType.NotBeginWith===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("LabelFilter_EndWith"),"imageLibrary_fcopend",a.Options.LabelDataFilterType.EndWith,a.Options.LabelDataFilterType.EndWith===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("LabelFilter_NotEndWith"),"imageLibrary_fcopendnot",a.Options.LabelDataFilterType.NotEndWith,a.Options.LabelDataFilterType.NotEndWith===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("LabelFilter_Contain"),"imageLibrary_fcopcontain",a.Options.LabelDataFilterType.Contain,a.Options.LabelDataFilterType.Contain===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("LabelFilter_NotContain"),"imageLibrary_fcopnotcontain",a.Options.LabelDataFilterType.NotContain,a.Options.LabelDataFilterType.NotContain===this._initialFilterDescription.filterType));var n=new r.DropDownControl;n.displayPropertyExpr="caption",n.imageCssClassExp="imageCssClass",n.selectedExpr="isSelected",n.itemSource=e,n.selectionChanged.on(function(e){i.updateStateFilterType(e.filterType),t._onValueChanged.trigger()}),this._$labelFilterTypeDropDownPanel.append(n.view)},e.prototype.updateStateFilterType=function(e){switch(this._actualFilterDescription.filterType=e){case a.Options.LabelDataFilterType.Between:case a.Options.LabelDataFilterType.BetweenNotIncluding:case a.Options.LabelDataFilterType.NotBetween:case a.Options.LabelDataFilterType.NotBetweenNotIncluding:this.updateStateTextEditor(!0);break;default:this.updateStateTextEditor(!1)}},e.prototype.updateStateTextEditor=function(e){e?(this._$textBox1Panel.removeClass("labelFilter-input1_100pct"),this._$textBox1Panel.addClass("labelFilter-input1_40pct"),this._$textBox2Panel.removeClass("labelFilter-element_hidden"),this._$labelAndPanel.removeClass("labelFilter-element_hidden")):(this._$textBox1Panel.addClass("labelFilter-input1_100pct"),this._$textBox1Panel.removeClass("labelFilter-input1_40pct"),this._$textBox2Panel.addClass("labelFilter-element_hidden"),this._$labelAndPanel.addClass("labelFilter-element_hidden"))},e.prototype.drawNotValidIndicator=function(e){e?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},e}(),a.LabelFilterControl=e}(Ranet||(Ranet={})),function(e){var n;(function(r){var a,e;(e=a||(a={}))[e.Add=0]="Add",e[e.Remove=1]="Remove";var t=function(){function e(e,t){this._onLevelSelectorRemoved=new n.Events.LiteEvent,this._isUpdateLevelsNow=!1,this._filterControlChildren=new Array,this._onValueChanged=new n.Events.LiteEvent,this._onSelectedLevelChanged=new n.Events.LiteEvent,this._options=t,this._$view=e,this._$levelSelector=this._$view.find(".levelSelector-levelsSelectorPanel"),this._$removeControlButton=this._$view.find(".levelSelector-removeSelectorButton"),this._$addFiltersGroupButton=this._$view.find(".levelSelector-addFiltersGroupButton"),this._$addTopFilterButton=this._$view.find(".levelSelector-addTopFilterButton"),this._$expandButton=this._$view.find(".levelSelector-caret"),this._$expandButton.addClass("hidden-caret"),this._$validationIndicator=this._$view.find(".validation-alert-indicator"),this._$childPanel=this._$view.find(".levelSelector-childPanel")}return Object.defineProperty(e.prototype,"onLevelSelectorRemoved",{get:function(){return this._onLevelSelectorRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedLevel",{get:function(){return this._levelChoiceControl.selectedItem},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){var e=!0,t=this._filterControlChildren;0===t.length&&(e=!1);for(var i=0;i<t.length;i++)t[i].isValid||(e=!1);return this.drawNotValidIndicator(),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSelectedLevelChanged",{get:function(){return this._onSelectedLevelChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actualFilterDescription",{get:function(){var e=new r.Options.LevelFilterDescription;null!==this._levelChoiceControl.selectedItem.uniqueName?e.level=this._levelChoiceControl.selectedItem:e.level=null;for(var t=0;t<this._filterControlChildren.length;t++)if(this._filterControlChildren[t]instanceof r.TopFilterControl){var i=this._filterControlChildren[t];e.filters.push(i.actualFilterDescription)}else{if(!(this._filterControlChildren[t]instanceof r.FiltersGroupControl))throw new Error("InvalidOperationException");var n=this._filterControlChildren[t];e.filters.push(n.actualGroupDescription)}return e.isValid=this.isValid,e},enumerable:!0,configurable:!0}),e.prototype.changeChildrenControls=function(e,t){if(t===a.Add)this._filterControlChildren.push(e);else{if(t!==a.Remove)throw new Error("InvalidOperationException");this._filterControlChildren.splice(this._filterControlChildren.indexOf(e),1)}0<this._filterControlChildren.filter(function(e){return e instanceof r.TopFilterControl}).length?this._$addTopFilterButton.attr("disabled","true"):this._$addTopFilterButton.removeAttr("disabled"),0<this._filterControlChildren.filter(function(e){return e instanceof r.FiltersGroupControl}).length?this._$addFiltersGroupButton.attr("disabled","true"):this._$addFiltersGroupButton.removeAttr("disabled")},e.prototype.getLevels=function(e,t){for(var i=new Array,n=!1,o=0;o<e.length;o++)e[o].isSelected=!1,e[o].uniqueName===t&&(n=e[o].isSelected=!0),i.push(e[o]);return!1===n&&(i[0].isSelected=!0),i.sort(function(e,t){return e.order>t.order?1:t.order>e.order?-1:0}),i},e.prototype.updateAvailableLevels=function(e){this._isUpdateLevelsNow=!0,e.push(this.selectedLevel),this._levelChoiceControl.itemSource=this.getLevels(e,this.selectedLevel.uniqueName),this._isUpdateLevelsNow=!1},e.prototype.init=function(){var t=this,e=this._levelChoiceControl=new n.DropDownControl;e.displayPropertyExpr="caption",e.selectedExpr="isSelected",e.imageCssClassExp="imageClass";var i=null;this._options.initialFilterDescription&&null!==this._options.initialFilterDescription.level&&(i=this._options.initialFilterDescription.level.uniqueName),e.itemSource=this.getLevels(this._options.levels,i),e.selectionChanged.on(function(e){t._isUpdateLevelsNow||t._onSelectedLevelChanged.trigger(e)}),this._$levelSelector.append(e.view),this._$addFiltersGroupButton.on("click",function(){t.addFilterGroup(new r.Options.FilterGroupDescription),t.updateCaretState()}),this._$addTopFilterButton.on("click",function(){t.addTopFilter(new r.Options.TopDataFilter),t.updateCaretState()}),this._$removeControlButton.on("click",function(){t._$view.remove(),t._onLevelSelectorRemoved.trigger(t),t.updateCaretState()}),this._$expandButton.on("click",function(){t._$childPanel.toggle(),t._$expandButton.toggleClass("fa-caret-right"),t._$expandButton.toggleClass("fa-caret-down")}),this.init2(),this.updateCaretState()},e.prototype.init2=function(){if(null!==this._options.initialFilterDescription)for(var e=0;e<this._options.initialFilterDescription.filters.length;e++){var t=this._options.initialFilterDescription.filters[e];if(t instanceof r.Options.TopDataFilter)this.addTopFilter(t);else{if(!(t instanceof r.Options.FilterGroupDescription))throw new Error("InvalidOperationException");this.addFilterGroup(t)}}},e.prototype.addFilterGroup=function(e){var t=this,i=this._options.$groupFiltersTemplate.clone(),n=new r.FiltersGroupOptions;n.initialFilterGroupDescription=e,n.measuresTree=this._options.measuresTree,n.$container=this._options.$container,n.$groupFiltersTemplate=this._options.$groupFiltersTemplate,n.$valueFilterTemplate=this._options.$valueFilterTemplate,n.$labelFilterTemplate=this._options.$labelFilterTemplate;var o=new r.FiltersGroupControl(i,n);o.onGroupRemoved.on(function(e){t.changeChildrenControls(e,a.Remove),t.updateCaretState(),t._onValueChanged.trigger()}),o.onValueChanged.on(function(){t._onValueChanged.trigger()}),o.init(),this.changeChildrenControls(o,a.Add),this._$childPanel.append(i),this._onValueChanged.trigger(),this.drawNotValidIndicator()},e.prototype.addTopFilter=function(e){var t=this,i=this._options.$topFilterTemplate.clone(),n=new r.TopFilterControl(i,e,this._options.measuresTree,this._options.$container);n.onFilterRemoved.on(function(e){t.changeChildrenControls(e,a.Remove),t.updateCaretState(),t._onValueChanged.trigger()}),n.onValueChanged.on(function(){t._onValueChanged.trigger()}),n.init(),this.changeChildrenControls(n,a.Add),this._$childPanel.prepend(i),this._onValueChanged.trigger(),this.drawNotValidIndicator()},e.prototype.updateCaretState=function(){0!==this._filterControlChildren.length?this._$expandButton.removeClass("hidden-caret"):this._$expandButton.addClass("hidden-caret")},e.prototype.drawNotValidIndicator=function(){0===this._filterControlChildren.length?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},e}();r.LevelSelectorControl=t})((n=e.Controls||(e.Controls={})).SmartFilter||(n.SmartFilter={}))}(Ranet||(Ranet={})),function(n){var o,r,a,s,e;o=n.Controls||(n.Controls={}),r=o.SmartFilter||(o.SmartFilter={}),a=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n},s=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterTargetType=i,this.isSelected=n},e=function(){function e(e,t,i,n){this._onFilterRemoved=new o.Events.LiteEvent,this._onValueChanged=new o.Events.LiteEvent,this._$view=e,this._initialFilterDescription=t,this._actualFilterDescription=jQuery.extend(!0,{},this._initialFilterDescription),this._treeMeasures=i,this._$measureChoiceContainer=n}return Object.defineProperty(e.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onFilterRemoved",{get:function(){return this._onFilterRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actualFilterDescription",{get:function(){return this._actualFilterDescription.count=parseInt(this._$countNumericDown.val()),isNaN(this._actualFilterDescription.count)&&(this._actualFilterDescription.count=0),this._actualFilterDescription},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){return!isNaN(parseInt(this._$countNumericDown.val()))&&this._actualFilterDescription.measureUniqueName?(this.drawNotValidIndicator(!1),!0):(this.drawNotValidIndicator(!0),!1)},enumerable:!0,configurable:!0}),e.prototype.init=function(){var e=this;this.parseView(this._$view),this.initFilterType(),this.initFilterTargetType(),this.initCountTextBox(),this.initMeasureChoiceControl(),this._$removeFilterButton.on("click",function(){e._$view.remove(),e._onFilterRemoved.trigger(e)})},e.prototype.initCountTextBox=function(){var e=this;this._$countNumericDown.val(this._initialFilterDescription.count.toString()),this._$countNumericDown.on("change",function(){e.drawNotValidIndicator(!1),e._onValueChanged.trigger()})},e.prototype.initFilterTargetType=function(){var e=new Array;e.push(new s(n.Localization.localize("Filter_Target_Items"),"imageLibrary_items",r.Options.TopDataFilterTargetType.Items,r.Options.TopDataFilterTargetType.Items===this.actualFilterDescription.filterTarget)),e.push(new s(n.Localization.localize("Filter_Target_Percent"),"imageLibrary_percent",r.Options.TopDataFilterTargetType.Percent,r.Options.TopDataFilterTargetType.Percent===this.actualFilterDescription.filterTarget)),e.push(new s(n.Localization.localize("Filter_Target_Sum"),"imageLibrary_sum",r.Options.TopDataFilterTargetType.Sum,r.Options.TopDataFilterTargetType.Sum===this.actualFilterDescription.filterTarget));var t=this,i=new o.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=e,i.selectionChanged.on(function(e){t._actualFilterDescription.filterTarget=e.filterTargetType}),this._$filterTargetTypeDropDownPanel.append(i.view)},e.prototype.initMeasureChoiceControl=function(){var t=this,e=new o.MeasureChoiceOptions(this._treeMeasures,!1),i=this;e.getPopupContainer=function(){return i._$measureChoiceContainer},e.isMultiSelect=!1,this._actualFilterDescription.measureUniqueName&&(e.selectedUniqueNames=[this._actualFilterDescription.measureUniqueName]),e.onSelectedMeasuresChanged=function(e){t._actualFilterDescription.measureUniqueName=e[0].uniqueName,t.drawNotValidIndicator(!1),t._onValueChanged.trigger()},new o.MeasureChoiceSelector(this._$measureChoicePanel[0],e).init()},e.prototype.initFilterType=function(){var t=this,e=new Array;e.push(new a(n.Localization.localize("Filter_Type_Top"),"imageLibrary_top",r.Options.TopDataFilterType.Top,r.Options.TopDataFilterType.Top===this._initialFilterDescription.filterType)),e.push(new a(n.Localization.localize("Filter_Type_Bottom"),"imageLibrary_bottom",r.Options.TopDataFilterType.Bottom,r.Options.TopDataFilterType.Bottom===this._initialFilterDescription.filterType));var i=new o.DropDownControl;i.displayPropertyExpr="caption",i.imageCssClassExp="imageCssClass",i.selectedExpr="isSelected",i.itemSource=e,i.selectionChanged.on(function(e){t._actualFilterDescription.filterType=e.filterType}),this._$topFilterDataTypeDropDownPanel.append(i.view)},e.prototype.parseView=function(e){this._$topFilterDataTypeDropDownPanel=e.find(".topFilter-directionSelector"),this._$filterTargetTypeDropDownPanel=e.find(".topFilter-targetSelector"),this._$measureChoicePanel=e.find(".topFilter-measureSelector"),this._$countNumericDown=e.find(".topFilter-valueInputPanel input"),this._$removeFilterButton=e.find(".topFilter-removeGroupFilterButton"),this._$validationIndicator=e.find(".validation-alert-indicator")},e.prototype.drawNotValidIndicator=function(e){e?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},e}(),r.TopFilterControl=e}(Ranet||(Ranet={})),function(o){var r,a,s,e;r=o.Controls||(o.Controls={}),a=r.SmartFilter||(r.SmartFilter={}),s=function(e,t,i,n){this.caption=e,this.imageCssClass=t,this.filterType=i,this.isSelected=n},e=function(){function e(e,t,i,n){this._onFilterRemoved=new r.Events.LiteEvent,this._onValueChanged=new r.Events.LiteEvent,this._$view=e,this._initialFilterDescription=t,this._treeMeasures=i,this._$measureChoiceContainer=n,this._actualFilterDescription=jQuery.extend(!0,{},this._initialFilterDescription)}return Object.defineProperty(e.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){var e,t=Number(this._$numericBox1.val()),i=!isNaN(t),n=Number(this._$numericBox2.val());switch(this._actualFilterDescription.filterType){case a.Options.ValueDataFilterType.Between:case a.Options.ValueDataFilterType.BetweenNotIncluding:case a.Options.ValueDataFilterType.NotBetween:case a.Options.ValueDataFilterType.NotBetweenNotIncluding:e=!isNaN(n);break;default:e=!0}return i&&e&&this._actualFilterDescription.measureUniqueName?(this.drawNotValidIndicator(!1),!0):(this.drawNotValidIndicator(!0),!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onFilterRemoved",{get:function(){return this._onFilterRemoved},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actualFilterDescription",{get:function(){return this._actualFilterDescription.num1=Number(this._$numericBox1.val()),this._actualFilterDescription.num2=Number(this._$numericBox2.val()),isNaN(this._actualFilterDescription.num1)&&(this._actualFilterDescription.num1=0),isNaN(this._actualFilterDescription.num2)&&(this._actualFilterDescription.num2=0),this._actualFilterDescription},enumerable:!0,configurable:!0}),e.prototype.parseView=function(e){this._$valueFilterTypeDropDownPanel=e.find(".valueFilter-operationSelector"),this._$numericBox1=e.find(".valueFilter-input1 input"),this._$numericBox2=e.find(".valueFilter-input2 input"),this._$numericBox1Panel=e.find(".valueFilter-input1"),this._$numericBox2Panel=e.find(".valueFilter-input2"),this._$labelAndPanel=e.find(".valueFilter-andLabel"),this._$removeFilterButton=e.find(".valueFilter-removeFilterButton"),this._$measureChoicePanel=e.find(".valueFilter-measureSelector"),this._$validationIndicator=e.find(".validation-alert-indicator")},e.prototype.init=function(){var e=this;this.parseView(this._$view),this.initFilterType(),this.initNumeriUpDowns(),this.initMeasureChoiceControl(),this._$removeFilterButton.on("click",function(){e._$view.remove(),e._onFilterRemoved.trigger(e)})},e.prototype.initMeasureChoiceControl=function(){var t=this,i=this,e=new r.MeasureChoiceOptions(this._treeMeasures,!1);e.getPopupContainer=function(){return i._$measureChoiceContainer},e.isMultiSelect=!1,this._actualFilterDescription.measureUniqueName&&(e.selectedUniqueNames=[this._actualFilterDescription.measureUniqueName]),e.onSelectedMeasuresChanged=function(e){i._actualFilterDescription.measureUniqueName=e[0].uniqueName,t.drawNotValidIndicator(!1),t._onValueChanged.trigger()},new r.MeasureChoiceSelector(this._$measureChoicePanel[0],e).init()},e.prototype.initNumeriUpDowns=function(){var e=this;this._$numericBox1.val(this._initialFilterDescription.num1.toString()),this._$numericBox1.on("change",function(){e._onValueChanged.trigger(),e.drawNotValidIndicator(!1)}),this._$numericBox2.val(this._initialFilterDescription.num2.toString()),this._$numericBox2.on("change",function(){e._onValueChanged.trigger(),e.drawNotValidIndicator(!1)})},e.prototype.initFilterType=function(){var t=this,i=this,e=new Array;e.push(new s(o.Localization.localize("ValueFilter_Equal"),"imageLibrary_fcopequal",a.Options.ValueDataFilterType.Equal,a.Options.ValueDataFilterType.Equal===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_NotEqual"),"imageLibrary_fcopnotequal",a.Options.ValueDataFilterType.NotEqual,a.Options.ValueDataFilterType.NotEqual===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_Greater"),"imageLibrary_fcopgreater",a.Options.ValueDataFilterType.Greater,a.Options.ValueDataFilterType.Greater===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_GreaterOrEqual"),"imageLibrary_fcopgreaterorequal",a.Options.ValueDataFilterType.GreaterOrEqual,a.Options.ValueDataFilterType.GreaterOrEqual===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_Less"),"imageLibrary_fcopless",a.Options.ValueDataFilterType.Less,a.Options.ValueDataFilterType.Less===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_LessOrEqual"),"imageLibrary_fcoplessorequal",a.Options.ValueDataFilterType.LessOrEqual,a.Options.ValueDataFilterType.LessOrEqual===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_Between"),"imageLibrary_fcopbetween",a.Options.ValueDataFilterType.Between,a.Options.ValueDataFilterType.Between===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_BetweenNotIncluding"),"imageLibrary_fcopbetweennotincluding",a.Options.ValueDataFilterType.BetweenNotIncluding,a.Options.ValueDataFilterType.BetweenNotIncluding===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_NotBetween"),"imageLibrary_fcopnotbetween",a.Options.ValueDataFilterType.NotBetween,a.Options.ValueDataFilterType.NotBetween===this._initialFilterDescription.filterType)),e.push(new s(o.Localization.localize("ValueFilter_NotBetweenNotIncluding"),"imageLibrary_fcopnotbetweennotincluding",a.Options.ValueDataFilterType.NotBetweenNotIncluding,a.Options.ValueDataFilterType.NotBetweenNotIncluding===this._initialFilterDescription.filterType)),this.updateStateFilterType(this._initialFilterDescription.filterType);var n=new r.DropDownControl;n.displayPropertyExpr="caption",n.imageCssClassExp="imageCssClass",n.selectedExpr="isSelected",n.itemSource=e,n.selectionChanged.on(function(e){i.updateStateFilterType(e.filterType),t._onValueChanged.trigger()}),this._$valueFilterTypeDropDownPanel.append(n.view)},e.prototype.updateStateFilterType=function(e){switch(this._actualFilterDescription.filterType=e){case a.Options.ValueDataFilterType.Between:case a.Options.ValueDataFilterType.BetweenNotIncluding:case a.Options.ValueDataFilterType.NotBetween:case a.Options.ValueDataFilterType.NotBetweenNotIncluding:this.updateStateTextEditor(!0);break;default:this.updateStateTextEditor(!1)}},e.prototype.updateStateTextEditor=function(e){e?(this._$numericBox1Panel.removeClass("valueFilter-input1_100pct"),this._$numericBox1Panel.addClass("valueFilter-input1_40pct"),this._$numericBox2Panel.removeClass("valueFilter-element_hidden"),this._$labelAndPanel.removeClass("valueFilter-element_hidden")):(this._$numericBox1Panel.removeClass("valueFilter-input1_40pct "),this._$numericBox1Panel.addClass("valueFilter-input1_100pct"),this._$numericBox2Panel.addClass("valueFilter-element_hidden"),this._$labelAndPanel.addClass("valueFilter-element_hidden"))},e.prototype.drawNotValidIndicator=function(e){e?this._$validationIndicator.removeClass("validation-indicator-hidden"):this._$validationIndicator.addClass("validation-indicator-hidden")},e}(),a.ValueFilterControl=e}(Ranet||(Ranet={})),function(e){var t;(function(e){var t=function(){this.hierarchiesRowsPanel=new Array,this.hierarchiesColumnsPanel=new Array};e.SortEditorOptions=t;var i,n=function(){};e.HierarchyDescription=n,(i=e.SortingMode||(e.SortingMode={}))[i.SortingByContext=0]="SortingByContext",i[i.SortingByProperty=1]="SortingByProperty",e.SortingMode;var o,r=function(){this.isUsed=!1,this.sortingByMeasure=new u,this.sortingByProperty=new d};e.SortingDescription=r,(o=e.SortingDirection||(e.SortingDirection={}))[o.Descending=0]="Descending",o[o.Ascending=1]="Ascending",o[o.None=2]="None";var a,s=e.SortingDirection;(a=e.HierarchyProperty||(e.HierarchyProperty={}))[a.Caption=0]="Caption",a[a.Key0=1]="Key0";var l=e.HierarchyProperty,c=function(){};e.CurrentElementDescription=c;var u=function(){this.members=null,this.measureUniqueName=null,this.direction=s.Ascending};e.SortingByMeasureModel=u;var p=function(){this.uniqueName=null,this.caption=null};e.MemberDescription=p;var h=function(){this.hierarchyUniqueName=null,this.property=l.Caption,this.direction=s.None};e.SortingHierarchyDescription=h;var d=function(){this.items=new Array};e.SortingByPropertyModel=d})((t=e.Controls||(e.Controls={})).SortingOptionsPivotTable||(t.SortingOptionsPivotTable={}))}(Ranet||(Ranet={})),function(w){var S,x,u,e;S=w.Controls||(w.Controls={}),x=S.SortingOptionsPivotTable.SortingDirection,u=S.SortingOptionsPivotTable.HierarchyProperty,e=function(){function b(e,t,i,n){this.getMeasureCaptionFunction=n,this._placementMode=S.PlacementAreaItemMode.Layout1,this._sortingByContext=null,this._sortingItems=null,this._isEnabled=!0,this.areaType=e,this.dataItems=t,this._$appContainer=i}return Object.defineProperty(b.prototype,"sortingByContext",{get:function(){return this._sortingByContext},set:function(e){this._sortingByContext=e,this._$imgDescAreaSorting&&this._$imgAscAreaSorting&&(this._$imgDescAreaSorting.hide(),this._$imgAscAreaSorting.hide(),this._$imgAscAreaSorting.attr("title",""),this._$imgDescAreaSorting.attr("title",""),null!==this._sortingByContext&&null!==this._sortingByContext.measureUniqueName&&(this._sortingByContext.direction===x.Ascending?(this._$imgAscAreaSorting.attr("title",w.Localization.localize("Title_SortingByMeasure")+" "+this.getMeasureCaptionFunction(this._sortingByContext.measureUniqueName)),this._$imgAscAreaSorting.show()):this._sortingByContext.direction===x.Descending&&(this._$imgDescAreaSorting.attr("title",w.Localization.localize("Title_SortingByMeasure")+" "+this.getMeasureCaptionFunction(this._sortingByContext.measureUniqueName)),this._$imgDescAreaSorting.show())))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sortingItems",{get:function(){return this._sortingItems},set:function(e){this._sortingItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"placementMode",{get:function(){return this._placementMode},set:function(e){this._placementMode=e,this._$boxAreaItem&&(this._$boxAreaItem.removeClass("queryDesigner-areaItemBox_layout1"),this._$boxAreaItem.removeClass("queryDesigner-areaItemBox_layout2"),this.placementMode===S.PlacementAreaItemMode.Layout1?this._$boxAreaItem.addClass("queryDesigner-areaItemBox_layout1"):this.placementMode===S.PlacementAreaItemMode.Layout2&&this._$boxAreaItem.addClass("queryDesigner-areaItemBox_layout2"))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,this._isEnabled?this._$container.droppable("enable"):this._$container.droppable("disable")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"listIdVisualItems",{get:function(){for(var e=new Array,t=this._$container.sortable("toArray"),i=0;i<t.length;i++)e.push(t[i]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isSortablePanel",{set:function(e){!1===e?this._$container.sortable("disable"):this._$container.sortable("enable")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"view",{get:function(){return this._$boxAreaItem},enumerable:!0,configurable:!0}),b.prototype.render=function(e){var t=$("<div/>");t.addClass("queryDesigner-areaItemBoxContent");var i=this.getContentLayoutItemHeader(this.areaType),n=$("<div/>");(this._$container=n).attr("id",this.getIdForPanel()),n.addClass("queryDesigner-listViewAreaItemBox"),t.append(i),t.append(n),this.initDroppableAreaItem(n),this.initSortableAreaItem(n);var o=$("<div/>");o.addClass("queryDesigner-areaItemBox"),this.placementMode===S.PlacementAreaItemMode.Layout1?o.addClass("queryDesigner-areaItemBox_layout1"):this.placementMode===S.PlacementAreaItemMode.Layout2&&o.addClass("queryDesigner-areaItemBox_layout2"),(this._$boxAreaItem=o).append(t),e.append(o)},b.prototype.getIdForPanel=function(){switch(this.areaType){case S.AreaType.Columns:return"columnsPane";case S.AreaType.Rows:return"rowsPane";case S.AreaType.Filters:return"filtersPane";case S.AreaType.Data:return"dataPane";default:throw new Error("NotImplementedException")}},b.prototype.initDroppableAreaItem=function(e){var i=this;$(e).droppable({drop:function(e,t){$(t.draggable).hasClass("ui-draggable")&&!$(t.draggable).hasClass("modal")&&i.droppedItem(e,t,i)},tolerance:"intersect",hoverClass:"queryDesigner_panel_content_childPanel_selected-orange",accept:function(e){return $(e).hasClass("ui-draggable")&&!$(e).hasClass("modal-dialog")&&!$(e).hasClass("slicerControl")}})},b.prototype.getPropConnectWithPane=function(){switch(this.areaType){case S.AreaType.Filters:return"#columnsPane, #rowsPane";case S.AreaType.Rows:return"#columnsPane, #filtersPane";case S.AreaType.Columns:return"#rowsPane, #filtersPane";case S.AreaType.Data:return""}throw new Error},b.prototype.initSortableAreaItem=function(n){n.sortable({connectWith:this.getPropConnectWithPane(),placeholder:"queryDesigner-itemAreaSortableEmptySpace",appendTo:this._$appContainer,scroll:!1,distance:5,delay:150,helper:"clone"});var o=this;n.on("sortstart",function(e,t){var i=$(t.item).attr("id");if(!i)throw new Error("InvalidOperationException");o.onStartSortable(o,i),$(n).sortable("refresh")}),n.on("sortstop",function(e,t){var i=$(t.item).attr("id");if(!i)throw new Error("InvalidOperationException");o.onStopSortable(o,i)})},b.prototype.paintDataItems=function(){var e=new Array;this._$container.empty();var t=function(e){switch(e){case u.Caption:return w.Localization.localize("Title_SortingByCaption");case u.Key0:return w.Localization.localize("Title_SortingByKey0")}return""};if(void 0!==this.dataItems)for(var i=0;i<this.dataItems.length;i++){var n=this.dataItems[i],o=x.None,r=null;if(null!==this.sortingItems)for(var a=0,s=this.sortingItems;a<s.length;a++){var l=s[a];if("hierarchy"===n.type&&l.hierarchyUniqueName===n.uniqueName){o=l.direction,r=t(l.property);break}if("level"===n.type&&l.hierarchyUniqueName===n.parentHierarchyId){o=l.direction,r=t(l.property);break}}var c=b.getDomNodeForDataItem(n,this.onDeleteDataItem.bind(this,this,n),this.onOpenFilterEditor.bind(this,this,n),o,r,this.onOpenSortingEditor.bind(this));this._$container.append(c),e.push(c)}return e},b.getDomNodeForDataItem=function(e,t,i,n,o,r){var a=this,s=$("<div/>"),l=$('<table class="queryDesigner-layoutItemTable"/>'),c=$("<tbody/>");l.append(c);var u=$("<td class='queryDesigner-imageColumnLayoutItemTable'/>"),p=$("<td class='queryDesigner-textColumnLayoutItemTable'/>"),h=$("<td class='queryDesigner-buttonColumnLayoutItemTable'/>");if(h.click(t),c.append(u),c.append(p),n!==x.None){var d=$("<td class='queryDesigner-buttonColumnLayoutItemTable'/>"),m=$("<div/>");n===x.Ascending?m.addClass("queryDesigner-ascIconMark"):n===x.Descending&&m.addClass("queryDesigner-descIconMark"),d.attr("title",o),d.on("click",function(){r(a)}),d.append(m),c.append(d)}var f=null;if("level"===e.type||"hierarchy"===e.type){f=$("<td class='queryDesigner-buttonColumnLayoutItemTable'/>");var g=$("<div/>");g.addClass("queryDesigner-openFilterButton"),g.append('<div class="queryDesigner-iconOpenFilterButton"/>'),f.append(g),f.click(i),c.append(f)}c.append(h),s.attr("title",e.caption),s.addClass("queryDesigner-itemListView");var _=$("<div/>");_.addClass("queryDesigner-contentItemListView"),_.append(l);var y=$("<div/>");y.addClass("queryDesigner-iconLayoutItemPanel"),e.filter&&(!1===b.hasFilterIcon(e.icon)&&e.filter.isUsed?e.icon=e.icon+"_filter":!0===b.hasFilterIcon(e.icon)&&!1===e.filter.isUsed&&(e.icon=e.icon.replace("_filter",""))),y.addClass(S.QueryDesigner.prefiximageLibrary+e.icon),u.append(y);var C=$('<span class="queryDesigner-textLayoutItem">'+e.caption+"</span>");p.append(C);var v=$("<div/>");return v.addClass("queryDesigner-deleteLayoutItemButton"),h.append(v),!1===w.ClientInformation.isMobileBrowser()&&(h.hide(),null!==f&&f.hide(),s.mouseenter(function(){h.show(),null!==f&&f.show()}),s.mouseleave(function(){h.hide(),null!==f&&f.hide()})),s.append(_),s},b.hasFilterIcon=function(e){var t="_filter",i=e.lastIndexOf(t);return-1!==i&&i+t.length===e.length},b.prototype.getContentLayoutItemHeader=function(e){var t,i,n,o=this,r=this._$imgAscAreaSorting=$("<div class='queryDesigner-ascIconMark queryDesigner-sortingIconArea' style='display:none;'/>"),a=this._$imgDescAreaSorting=$("<div class='queryDesigner-descIconMark queryDesigner-sortingIconArea' style='display:none;'/>");return r.on("click",function(){o.onOpenSortingEditor(o)}),a.on("click",function(){o.onOpenSortingEditor(o)}),null!==this.sortingByContext&&null!==this.sortingByContext.measureUniqueName&&(this.sortingByContext.direction===x.Ascending?(this._$imgAscAreaSorting.attr("title",w.Localization.localize("Title_SortingByMeasure")+" "+this.getMeasureCaptionFunction(this._sortingByContext.measureUniqueName)),this._$imgAscAreaSorting.css("display","")):this.sortingByContext.direction===x.Descending&&(this._$imgDescAreaSorting.css("display",""),this._$imgDescAreaSorting.attr("title",w.Localization.localize("Title_SortingByMeasure")+" "+this.getMeasureCaptionFunction(this._sortingByContext.measureUniqueName)))),e===S.AreaType.Columns?(t=$("<div/>"),(i=$("<div/>")).addClass("queryDesigner-columnsIconHeader"),n=$('<span class="queryDesigner-areaTitle">'+w.Localization.localize("MdxDesigner_ColumnsArea_Caption")+"</span>"),t.append(i),t.append(n),t.append(r),t.append(a),t):e===S.AreaType.Rows?(t=$("<div/>"),(i=$("<div/>")).addClass("queryDesigner-rowsIconHeader"),n=$('<span class="queryDesigner-areaTitle">'+w.Localization.localize("MdxDesigner_RowsArea_Caption")+"</span>"),t.append(i),t.append(n),t.append(r),t.append(a),t):e===S.AreaType.Data?(t=$("<div/>"),(i=$("<div/>")).addClass("queryDesigner-dataIconHeader"),n=$("<span>"+w.Localization.localize("MdxDesigner_DataArea_Caption")+"</span>"),t.append(i),t.append(n),t):e===S.AreaType.Filters?(t=$("<div/>"),(i=$("<div/>")).addClass("queryDesigner-filtersIconHeader"),n=$("<span>"+w.Localization.localize("MdxDesigner_FilterArea_Caption")+"</span>"),t.append(i),t.append(n),t):null},b.prototype.droppedItem=function(e,t,i){var n=jQuery.data(t.draggable.get(0),"data");i.onDroppedItem(n,i)},b}(),S.AreaItem=e}(Ranet||(Ranet={})),function(e){!function(e){var t;(t=e.AreaType||(e.AreaType={}))[t.Filters=0]="Filters",t[t.Rows=1]="Rows",t[t.Columns=2]="Columns",t[t.Data=3]="Data";e.AreaType}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(e){var t;t=function(e,t,i,n,o,r){this.caption=e,this.uniqueName=t,this.hierarchyUniqueName=i,this.maxHeight=n,this.columnCount=o,this.buttonWidth=r},(e.Controls||(e.Controls={})).AvailableSlicerDescription=t}(Ranet||(Ranet={})),function(e){var t;t=function(){},(e.Controls||(e.Controls={})).FilterOptions=t}(Ranet||(Ranet={})),function(c){var o,e;o=c.Controls||(c.Controls={}),e=function(){function e(e,t,i,n){var o=this;this.onFiltersChanged=new c.Controls.Events.LiteEvent,this.onLayoutChanged=new c.Controls.Events.LiteEvent,this._filters=e,this._rows=t,this._columns=i,this._data=n,this.onFiltersChanged.on(function(){o.recalculateLayoutItems()}),this.onLayoutChanged.on(function(){o.recalculateLayoutItems()}),this.onLayoutChanged.trigger()}return e.prototype.dropItem=function(e,t){e===o.AreaType.Filters?this.dropInFilters(t):e===o.AreaType.Rows?this.dropInRows(t):e===o.AreaType.Columns?this.dropInColumns(t):e===o.AreaType.Data&&this.dropInData(t)},e.prototype.deleteDataItem=function(e,t){var i=new Array;switch(e){case o.AreaType.Columns:i=this._columns;break;case o.AreaType.Rows:i=this._rows;break;case o.AreaType.Data:i=this._data;break;case o.AreaType.Filters:i=this._filters}if(0===i.length)throw Error();if(c.Utility.ArrayUtility.removeItem(i,t),"values"===t.type&&(this._data.length=0),e===o.AreaType.Data&&i.length<2){var n=this._columns.filter(function(e){return"values"===e.type})[0];void 0===n?void 0!==(n=this._rows.filter(function(e){return"values"===e.type})[0])&&c.Utility.ArrayUtility.removeItem(this._rows,n):c.Utility.ArrayUtility.removeItem(this._columns,n)}},e.prototype.findElement=function(e,t,i){for(var n=void 0,o=0;o<e.length;o++)if(e[o][i]===t[i]){n=e[o];break}return n},e.prototype.findElementTwoProps=function(e,t,i,n){for(var o=void 0,r=0;r<e.length;r++)if(e[r][t]===i[n]){o=e[r];break}return o},e.prototype.findDataItem=function(e,t){var i=void 0;return"hierarchy"===t.type?void 0===(i=this.findElement(e,t,"uniqueName"))&&(i=this.findElementTwoProps(e,"parentHierarchyId",t,"uniqueName")):"level"===t.type?void 0===(i=this.findElement(e,t,"parentHierarchyId"))&&(i=this.findElementTwoProps(e,"uniqueName",t,"parentHierarchyId")):"namedSet"!==t.type&&"calculatedNamedSet"!==t.type||(i=this.findElement(e,t,"name")),i},e.prototype.deleteOpponentRowsColumns=function(e){var t=this.findDataItem(this._rows,e);void 0!==t&&c.Utility.ArrayUtility.removeItem(this._rows,t);var i=this.findDataItem(this._columns,e);void 0!==i&&c.Utility.ArrayUtility.removeItem(this._columns,i)},e.prototype.dropInFilters=function(e){var t=e;if(this.canDropDataItemInFilters(t)){"dimension"===t.type&&(t=t.items.filter(function(e){return"hierarchy"===e.type})[0]);var i=this.findDataItem(this._filters,t);void 0!==i&&c.Utility.ArrayUtility.removeItem(this._filters,i),this._filters.push(t)}},e.prototype.canDropDataItemInFilters=function(e){return"dimension"===e.type||"hierarchy"===e.type||"level"===e.type},e.prototype.canDropDataItemInRows=function(e){return"dimension"===e.type||"hierarchy"===e.type||"level"===e.type||"namedSet"===e.type||"values"===e.type||"calculatedNamedSet"===e.type},e.prototype.canDropDataItemInColumns=function(e){return"dimension"===e.type||"hierarchy"===e.type||"level"===e.type||"namedSet"===e.type||"values"===e.type||"calculatedNamedSet"===e.type},e.prototype.dropInRows=function(e){var t=e;this.canDropDataItemInRows(t)&&("dimension"===t.type&&(t=e.items.filter(function(e){return"hierarchy"===e.type})[0]),this.deleteOpponentRowsColumns(t),this._rows.push(t))},e.prototype.dropInColumns=function(e){var t=e;this.canDropDataItemInColumns(t)&&("dimension"===t.type&&(t=e.items.filter(function(e){return"hierarchy"===e.type})[0]),this.deleteOpponentRowsColumns(t),this._columns.push(t))},e.prototype.dropInData=function(e){var t=e;if("measure"===t.type||"kpiInfo"!==t.type||"kpiItem"!==t.type||"calculatedMember"===t.type){var i=new Array;if("measure"===t.type||"kpiItem"===t.type||"calculatedMember"===t.type)i.push(t);else if("kpiInfo"===t.type)for(var n=0;n<t.items.length;n++)i.push(t.items[n]);for(var o=0;o<i.length;o++){var r=i[o],a=this.findElement(this._data,r,"uniqueName");void 0!==a&&c.Utility.ArrayUtility.removeItem(this._data,a),this._data.push(r)}if(1<this._data.length){var s=this._rows.filter(function(e){return"values"===e.type});if(0===s.length&&(s=this._columns.filter(function(e){return"values"===e.type})),0===s.length){var l={caption:c.Localization.localize("MdxDesigner_ValuesNode_Caption"),type:"values",icon:"values"};this._columns.push(l)}}}},Object.defineProperty(e.prototype,"layoutItems",{get:function(){return this._layoutItems},enumerable:!0,configurable:!0}),e.prototype.recalculateLayoutItems=function(){var t=[];this._filters.forEach(function(e){t.push(e.uniqueName)}),this.getAxisItems(this._rows).forEach(function(e){t.push(e)}),this.getAxisItems(this._columns).forEach(function(e){t.push(e)}),this._data.forEach(function(e){t.push(e.uniqueName)}),this._layoutItems=t},e.prototype.getAxisItems=function(e){var i=[];return e.forEach(function(e){if("values"!==e.type&&(e.uniqueName?i.push(e.uniqueName):i.push(e.name),e.filter&&e.filter.membersFilter&&e.filter.isUsed)){var t=e.filter.membersFilter;t.isUsed&&t.selectionNodes.forEach(function(e){o.MemberChoice.MemberChoiceTreeNode.selectionList(e).forEach(function(e){i.push(e.uniqueName)})})}}),i},e}(),o.IntegrityDataManager=e}(Ranet||(Ranet={})),function(e){!function(e){var t;(t=e.PlacementAreaItemMode||(e.PlacementAreaItemMode={}))[t.Layout1=0]="Layout1",t[t.Layout2=1]="Layout2";e.PlacementAreaItemMode}(e.Controls||(e.Controls={}))}(Ranet||(Ranet={})),function(c){var p,e;p=c.Controls||(c.Controls={}),e=function(){function u(e,t){var i=this;this._placementMode=p.PlacementAreaItemMode.Layout1,this._$slicerLabel=null,this._slicers=new Array,this._availableSlicers=new Array,this._panel=e,this._options=t,this._onLayoutChanged=function(e){i.checkSlicers(),t.hasOwnProperty("onLayoutChanged")&&t.onLayoutChanged(e)},this._availableSlicers=t.availableSlicers?t.availableSlicers:new Array,this._isVisibleLayoutButton=!1,this._layoutDropDownItems=t.layoutDropdownItems||[]}return Object.defineProperty(u.prototype,"showToolbar",{set:function(e){this._options.showToolbar=e,this.updateToolbar()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"plainDataSource",{get:function(){return this._plainDataSource},set:function(e){if(this._plainDataSource=e,void 0!==this.layout){var t=this.getActualLayout(this.layout);this.updateAreas(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e;var t=$(this._panel).find(".queryDesigner-layoutViewer");this._filtersPanel.isEnabled=this._rowsPanel.isEnabled=this._columnsPanel.isEnabled=this._dataPanel.isEnabled=this._isEnabled,this._isEnabled?(t.removeClass("queryDesigner-disabledPanel"),this._$defferedPanel.removeClass("queryDesigner-disabledPanel"),this._$defferedPanel.find(":input").removeAttr("disabled")):(t.addClass("queryDesigner-disabledPanel"),this._$defferedPanel.addClass("queryDesigner-disabledPanel"),this._$defferedPanel.find(":input").attr("disabled","true"))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"placementMode",{get:function(){return this._placementMode},set:function(e){this._placementMode=e,this._filtersPanel&&(this._filtersPanel.placementMode=e),this._rowsPanel&&(this._rowsPanel.placementMode=e),this._columnsPanel&&(this._columnsPanel.placementMode=e),this._dataPanel&&(this._dataPanel.placementMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"mapDataSource",{get:function(){return this._plainDataSource},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"connection",{get:function(){return this._options.connection},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"cubeName",{get:function(){return this._options.cubeName},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"layout",{get:function(){if(void 0!==this._filtersPanel&&void 0!==this._rowsPanel&&void 0!==this._columnsPanel&&void 0!==this._dataPanel)return{filters:this.cutOffExcess(jQuery.extend(!0,[],this._filtersPanel.dataItems)),rows:this.cutOffExcess(jQuery.extend(!0,[],this._rowsPanel.dataItems)),columns:this.cutOffExcess(jQuery.extend(!0,[],this._columnsPanel.dataItems)),data:this.cutOffExcess(jQuery.extend(!0,[],this._dataPanel.dataItems))}},set:function(e){var t=this.getActualLayout(e);this.updateAreas(t)},enumerable:!0,configurable:!0}),u.prototype.updateAreas=function(e){this._filtersPanel.dataItems.length=0,this._rowsPanel.dataItems.length=0,this._columnsPanel.dataItems.length=0,this._dataPanel.dataItems.length=0,this.addRangeDataToPanel(this._filtersPanel.dataItems,e.filters),this.addRangeDataToPanel(this._rowsPanel.dataItems,e.rows),this.addRangeDataToPanel(this._columnsPanel.dataItems,e.columns),this.addRangeDataToPanel(this._dataPanel.dataItems,e.data),this.mergeWithDataSource(this._plainDataSource,e),this.rePaintPanels()},Object.defineProperty(u.prototype,"dataItemsFilters",{get:function(){return this._dataItemsFilters},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"dataItemsRows",{get:function(){return this._dataItemsRows},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"dataItemsColumns",{get:function(){return this._dataItemsColumns},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"dataItemsData",{get:function(){return this._dataItemsData},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"treeMeasures",{get:function(){return this._treeMeasures},set:function(e){this._treeMeasures=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"sortingRowsOptions",{get:function(){return this._sortingRowsOptions},set:function(e){this._sortingRowsOptions=e,null!==this._sortingRowsOptions&&this._sortingRowsOptions.isUsed?this._rowsPanel.sortingItems=this._sortingRowsOptions.sortingByProperty.items:this._rowsPanel.sortingItems=null,null!==this._sortingRowsOptions&&this._sortingRowsOptions.sortingByMeasure?this._rowsPanel.sortingByContext=this._sortingRowsOptions.sortingByMeasure:this._rowsPanel.sortingByContext=null,this.rePaintPanels()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"sortingColumnsOptions",{get:function(){return this._sortingColumnsOptions},set:function(e){this._sortingColumnsOptions=e,null!==this._sortingColumnsOptions&&this._sortingColumnsOptions.isUsed?this._columnsPanel.sortingItems=this._sortingColumnsOptions.sortingByProperty.items:this._columnsPanel.sortingItems=null,null!==this._sortingColumnsOptions&&this._sortingColumnsOptions.sortingByMeasure?this._columnsPanel.sortingByContext=this._sortingColumnsOptions.sortingByMeasure:this._columnsPanel.sortingByContext=null,this.rePaintPanels()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"integrityDataManager",{get:function(){return this._integrityDataManager},enumerable:!0,configurable:!0}),u.prototype.onDeleteItem=function(e,t){c.UserActionsTracker.track("Change the structure of the report",{method:"DeleteItem",areaType:e.areaType}),this._integrityDataManager.deleteDataItem(e.areaType,t),this._integrityDataManager.onLayoutChanged.trigger()},u.prototype.onDroppedItem=function(e,t){if(void 0===e)throw Error("Element with this ID doesn't present in the data source.");c.UserActionsTracker.track("Change the structure of the report",{method:"DragAndDrop",areaType:t.areaType}),this._integrityDataManager.dropItem(t.areaType,e),this._integrityDataManager.onLayoutChanged.trigger()},u.prototype.rePaintPanels=function(){this._mapIdVisualElementToDataItem={};var e=function(e,t,i){for(var n=0;n<e.length;n++){var o=c.Utility.Guid.newGuid();e[n].attr("id",o),i[o]=t[n]}};e(this._filtersPanel.paintDataItems(),this._filtersPanel.dataItems,this._mapIdVisualElementToDataItem),e(this._rowsPanel.paintDataItems(),this._rowsPanel.dataItems,this._mapIdVisualElementToDataItem),e(this._columnsPanel.paintDataItems(),this._columnsPanel.dataItems,this._mapIdVisualElementToDataItem),e(this._dataPanel.paintDataItems(),this._dataPanel.dataItems,this._mapIdVisualElementToDataItem)},u.prototype.onStartSortable=function(e,t){c.UserActionsTracker.track("Change the structure of the report",{method:"SortableItems"});var i=this._mapIdVisualElementToDataItem[t];this._filtersPanel.isSortablePanel=this._integrityDataManager.canDropDataItemInFilters(i),this._rowsPanel.isSortablePanel=this._integrityDataManager.canDropDataItemInRows(i),this._columnsPanel.isSortablePanel=this._integrityDataManager.canDropDataItemInColumns(i)},u.prototype.onStopSortable=function(e,t){this._filtersPanel.isSortablePanel=this._rowsPanel.isSortablePanel=this._columnsPanel.isSortablePanel=!0;var i=this.dataItemsFilters.length<this._rowsPanel.listIdVisualItems.length&&this._filtersPanel.listIdVisualItems.length<this.dataItemsFilters.length,n=this.dataItemsColumns.length<this._columnsPanel.listIdVisualItems.length&&this._filtersPanel.listIdVisualItems.length<this.dataItemsFilters.length,o=this._columnsPanel.listIdVisualItems,r=this._rowsPanel.listIdVisualItems;if(i||n){var a=this._mapIdVisualElementToDataItem[t],s=void 0;for(s=0;s<o.length;s++){var l=this._mapIdVisualElementToDataItem[o[s]];if(a!==l&&a.type===l.type&&a.uniqueName===l.uniqueName){o.splice(s,1);break}}for(s=0;s<r.length;s++){var c=this._mapIdVisualElementToDataItem[r[s]];if(a!==c&&a.type===c.type&&a.uniqueName===c.uniqueName){r.splice(s,1);break}}}this.dataItemsFilters.splice(0),this.dataItemsRows.splice(0),this.dataItemsColumns.splice(0),this.dataItemsData.splice(0),u.fillDataItems(this.dataItemsFilters,this._filtersPanel.listIdVisualItems,this._mapIdVisualElementToDataItem),u.fillDataItems(this.dataItemsRows,r,this._mapIdVisualElementToDataItem),u.fillDataItems(this.dataItemsColumns,o,this._mapIdVisualElementToDataItem),u.fillDataItems(this.dataItemsData,this._dataPanel.listIdVisualItems,this._mapIdVisualElementToDataItem),this.rePaintPanels(),this._onLayoutChanged(this.layout)},u.fillDataItems=function(e,t,i){for(var n=0;n<t.length;n++){var o=i[t[n]];e.push(o)}},u.prototype.renderLayout=function(){var e=$("<div/>");e.addClass("queryDesigner-layoutViewer"),this._filtersPanel.render(e),this._rowsPanel.render(e),this._columnsPanel.render(e),this._dataPanel.render(e),$(this._panel).append(e)},u.prototype.onOpenSortingEditor=function(){this._options.onOpenSortingEditor&&this._options.onOpenSortingEditor()},u.prototype.createBottomToolBar=function(){var t=this,e=$("<div/>");e.addClass("queryDesigner-toolBar");var i=$('<div class="queryDesigner-deferredExecutionCheckBox"/>');this._$defferedPanel=i;var n=$('<input type="checkbox">');n.click(function(){t._options.onChangeAutoExecuteMdxQuery(!n.is(":checked"))}),!1===this._options.autoExecuteQuery&&n.attr("checked","true"),i.append(n);var o=$('<span class="queryDesigner-textDeferredExecution">'+c.Localization.localize("QueryDesigner_DeferredExecutionLabel")+"</span>");o.attr("title",c.Localization.localize("QueryDesigner_DeferredExecutionLabel")),o.click(function(){if(!1!==t.isEnabled){var e=!n.is(":checked");n.prop("checked",e),t._options.onChangeAutoExecuteMdxQuery(!e)}}),i.append(o),e.append(i);var r=$('<div class="queryDesigner-updateDataButtonPanel"/>'),a=$('<button class="btn btn-default queryDesigner-updateDataButton">'+c.Localization.localize("QueryDesigner_UpdateButton")+"</button>");r.append(a),a.click(function(){t._options.onUpdateData&&t._options.onUpdateData()}),e.append(r),this._options.showToolbar?$(this._panel).find(".queryDesigner-layoutViewer").removeClass("queryDesigner-layoutViewer_withoutToolbar"):(e.css("display","none"),$(this._panel).find(".queryDesigner-layoutViewer").addClass("queryDesigner-layoutViewer_withoutToolbar")),$(this._panel).append(e)},u.prototype.updateToolbar=function(){var e=$(this._panel).find(".queryDesigner-toolBar");this._options.showToolbar?(e.css("display","block"),$(this._panel).find(".queryDesigner-layoutViewer").removeClass("queryDesigner-layoutViewer_withoutToolbar")):(e.css("display","none"),$(this._panel).find(".queryDesigner-layoutViewer").addClass("queryDesigner-layoutViewer_withoutToolbar"))},u.prototype.localizeItems=function(e){var t=function(e){var t,i;for(t=0;t<e.length;t++)if("values"===(i=e[t]).type)return i},i=t(e.columns);i?i.caption=c.Localization.localize("MdxDesigner_ValuesNode_Caption"):(i=t(e.rows))&&(i.caption=c.Localization.localize("MdxDesigner_ValuesNode_Caption"))},u.prototype.mergeWithDataSource=function(e,t){this.extentMetaDataItems(e,t.rows,function(e){e.icon||"level"===e.type&&e.filter&&e.filter.isUsed&&(e.icon+="_filter")}),this.extentMetaDataItems(e,t.columns,function(e){e.icon||"level"===e.type&&e.filter&&e.filter.isUsed&&(e.icon+="_filter")}),this.extentMetaDataItems(e,t.filters,function(e){e.icon||"level"===e.type&&e.filter&&e.filter.isUsed&&(e.icon+="_filter")}),this.extentMetaDataItems(e,t.data,function(e){})},u.prototype.extentMetaDataItems=function(e,t,i){for(var n=0;n<t.length;n++){var o=t[n];switch(o.type){case"hierarchy":if(!(a=u.findMemberDataInDataSource(e,o.uniqueName,"uniqueName")))throw new Error("Not found item of metadata cube");delete(r=$.extend({},{},a)).items,u.copyProps(o,r),u.generateSetFromSelectionNodes(o);break;case"values":o.caption=c.Localization.localize("MdxDesigner_ValuesNode_Caption"),o.icon="values";break;case"kpiItem":case"measure":case"level":if(!(a=u.findMemberDataInDataSource(e,o.uniqueName,"uniqueName")))throw new Error("Not found item of metadata cube");var r=$.extend({},{},a);u.copyProps(o,r),"level"===o.type&&u.generateSetFromSelectionNodes(o);break;case"namedSet":case"calculatedMember":case"calculatedNamedSet":var a;if(!(a=u.findMemberDataInDataSource(e,o.name,"name")))throw console.log(o.name),new Error("Not found item of metadata cube");r=$.extend({},{},a);u.copyProps(o,r)}i(o)}},u.findMemberDataInDataSource=function(e,t,i){var n=void 0;for(var o in e)if(e.hasOwnProperty(o)&&e[o][i]===t){n=e[o];break}return n},u.copyProps=function(e,t){for(var i in delete t.id,delete t.isDraggable,t)e.hasOwnProperty(i)||(e[i]=t[i])},u.generateSetFromSelectionNodes=function(e){if(e.filter&&e.filter.isUsed&&e.filter.membersFilter.isUsed){var t=p.MemberChoice.MemberChoiceTreeNode.convertJsObject(e.filter.membersFilter.selectionNodes),i="";if(1===t.length)i=t[0].buildMdx();else{var n=new p.MemberChoice.MemberChoiceTreeNode("artificialRootNode",void 0,void 0,void 0);n.childNodes=t,i=n.buildMdx()}e.filter.membersFilter.set=i}},u.prototype.updateFilterDataItem=function(e,t,i){var n=i.membersChoiceFilterOptions.selectionRootNodes,o=null;if(n)if(1===n.length)o=n[0].buildMdx();else{var r=new p.MemberChoice.MemberChoiceTreeNode("artificialRootNode",void 0,void 0,void 0);r.childNodes=n,o=r.buildMdx()}e.filter={isUsed:i.useMembersChoiceFilter||i.customFilterOptions.isUsed||i.smartCustomFilterDescription.isUsed,membersFilter:{isUsed:i.useMembersChoiceFilter,set:o,selectionNodes:n}},e.filter.smartCustomFilterDescription=i.smartCustomFilterDescription,e.filter.customFilter=i.customFilterOptions,this._integrityDataManager.onFiltersChanged.trigger(e)},u.prototype.changeMembersFilter=function(e,t){for(var i=null,n=0,o=this._dataItemsFilters;n<o.length;n++){var r=o[n];if("level"===r.type&&r.parentHierarchyId===e){i=r;break}if("hierarchy"===r.type&&r.uniqueName===e){i=r;break}}var a=t,s=null;if(a)if(1===a.length)s=a[0].buildMdx();else{var l=new p.MemberChoice.MemberChoiceTreeNode("artificialRootNode",void 0,void 0,void 0);l.childNodes=a,s=l.buildMdx()}if(null===i)throw new Error("InvalidOperationException");i.filter={isUsed:!0,membersFilter:{isUsed:!0,set:s,selectionNodes:a},customFilter:new p.CustomFilterOptions},this._integrityDataManager.onFiltersChanged.trigger(i)},u.prototype.onOpenFiltersEditor=function(e,t){this.openFiltersEditor(e.areaType,t)},u.prototype.openFiltersEditor=function(i,n){var o=this,e=null;if("hierarchy"===n.type)e=n;else{if("level"!==n.type)throw new Error("InvalidOperationException");for(var t in this.plainDataSource)if(this.plainDataSource.hasOwnProperty(t)){var r=this.plainDataSource[t];if("hierarchy"===r.type&&r.uniqueName===n.parentHierarchyId){e=r;break}}}if(null===e)throw new Error("InvalidOperationException");var a=this.getFilterOptions(n);a.membersChoiceFilterOptions.isVisibleSlicerButton=i===p.AreaType.Filters,new p.FilterEditorWindow(a,this._treeMeasures,i!==p.AreaType.Filters,e,this._options.container,function(e,t){o.updateFilterDataItem(n,i,t)}).show()},u.prototype.getFilterOptions=function(e){var t,i=this,n=null,o=void 0,r=!1,a=new p.CustomFilterOptions,s=new p.SmartFilter.Options.SmartCustomFilterDescription;if("level"===e.type)t=e.parentHierarchyId,n=e.uniqueName;else{if("hierarchy"!==e.type)throw new Error("NotImplementationException");t=e.uniqueName}null!==e.filter&&(null!==e.filter.membersFilter&&(void 0!==e.filter.membersFilter.selectionNodes&&null!==e.filter.membersFilter.selectionNodes&&(o=p.MemberChoice.MemberChoiceTreeNode.parse(JSON.stringify(e.filter.membersFilter.selectionNodes))),r=e.filter.membersFilter.isUsed),null!==e.filter.customFilter&&(a=e.filter.customFilter),null!==e.filter.smartCustomFilterDescription&&void 0!==e.filter.smartCustomFilterDescription&&(s=p.SmartFilter.Options.SmartCustomFilterDescription.parse(JSON.stringify(e.filter.smartCustomFilterDescription))));var l=new p.MemberChoice.MemberChoiceOptions;l.cubeName=this.cubeName,l.connection=this.connection,l.container=this._options.container,l.hierarchyUniqueName=t,l.startLevelUniqueName=n,l.selectionRootNodes=o,l.events.onCreateSlicer=function(e){i.createNewSlicerControl(e,function(e){i._availableSlicers.push(e)})};var c=new p.FilterOptions;return c.useMembersChoiceFilter=r,c.membersChoiceFilterOptions=l,c.customFilterOptions=a,c.smartCustomFilterDescription=s,c},u.prototype.addRangeDataToPanel=function(e,t){for(var i in t)t.hasOwnProperty(i)&&e.push(t[i])},u.prototype.cutOffExcess=function(e){for(var t=0;t<e.length;t++){var i=e[t];delete i.items,delete i.id,delete i.isDraggable}return e},u.prototype.getActualLayoutItems=function(e){for(var t=new Array,i=0;i<e.length;i++){var n=e[i];"calculatedNamedSet"===n.type||"calculatedMember"===n.type?void 0!==u.findMemberDataInDataSource(this._plainDataSource,n.name,"name")&&t.push(n):t.push(n)}return t},u.prototype.getActualLayout=function(e){return 0!==e.filters.length&&(e.filters=this.getActualLayoutItems(e.filters)),0!==e.columns.length&&(e.columns=this.getActualLayoutItems(e.columns)),0!==e.rows.length&&(e.rows=this.getActualLayoutItems(e.rows)),0!==e.data.length&&(e.data=this.getActualLayoutItems(e.data)),e},u.prototype.initQueryDesigner=function(){var t=this,e=this._options;void 0!==e.layout&&(this.mergeWithDataSource(this._plainDataSource,e.layout),this.localizeItems(e.layout)),this._dataItemsFilters=void 0!==e.layout?e.layout.filters:new Array,this._dataItemsRows=void 0!==e.layout?e.layout.rows:new Array,this._dataItemsColumns=void 0!==e.layout?e.layout.columns:new Array,this._dataItemsData=void 0!==e.layout?e.layout.data:new Array,this._integrityDataManager=new p.IntegrityDataManager(this.dataItemsFilters,this.dataItemsRows,this.dataItemsColumns,this.dataItemsData),this._integrityDataManager.onLayoutChanged.on(function(){t.rePaintPanels(),t._onLayoutChanged(t.layout)}),this._integrityDataManager.onFiltersChanged.on(function(e){t.onFilterChanged(t.layout,p.AreaType.Filters,e),t.rePaintPanels()});var i=function(e){return u.findMemberDataInDataSource(t.plainDataSource,e,"uniqueName").caption},n=new p.AreaItem(p.AreaType.Filters,this.dataItemsFilters,this._options.container,i),o=new p.AreaItem(p.AreaType.Rows,this.dataItemsRows,this._options.container,i),r=new p.AreaItem(p.AreaType.Columns,this.dataItemsColumns,this._options.container,i),a=new p.AreaItem(p.AreaType.Data,this.dataItemsData,this._options.container,i);n.onOpenFilterEditor=o.onOpenFilterEditor=r.onOpenFilterEditor=a.onOpenFilterEditor=this.onOpenFiltersEditor.bind(this),n.onOpenSortingEditor=o.onOpenSortingEditor=r.onOpenSortingEditor=a.onOpenSortingEditor=this.onOpenSortingEditor.bind(this),a.onDroppedItem=n.onDroppedItem=o.onDroppedItem=r.onDroppedItem=this.onDroppedItem.bind(this),a.onDeleteDataItem=n.onDeleteDataItem=o.onDeleteDataItem=r.onDeleteDataItem=this.onDeleteItem.bind(this),a.onStartSortable=n.onStartSortable=o.onStartSortable=r.onStartSortable=this.onStartSortable.bind(this),a.onStopSortable=n.onStopSortable=o.onStopSortable=r.onStopSortable=this.onStopSortable.bind(this),this._filtersPanel=n,this._rowsPanel=o,this._columnsPanel=r,this._dataPanel=a,null!==e.sortingColumnsOptions&&e.sortingColumnsOptions.isUsed?(this._columnsPanel.sortingItems=e.sortingColumnsOptions.sortingByProperty.items,this._columnsPanel.sortingByContext=e.sortingColumnsOptions.sortingByMeasure):(this._columnsPanel.sortingItems=null,this._columnsPanel.sortingByContext=null),null!==e.sortingRowsOptions&&e.sortingRowsOptions.isUsed?(this._rowsPanel.sortingItems=e.sortingRowsOptions.sortingByProperty.items,this._rowsPanel.sortingByContext=e.sortingRowsOptions.sortingByMeasure):(this._rowsPanel.sortingItems=null,this._rowsPanel.sortingByContext=null),e.placementLayoutMode&&(this.placementMode=e.placementLayoutMode),this._layoutButton=this.initLayoutButton().hide(),$(this._panel).append(this._layoutButton),this.renderLayout(),this.createBottomToolBar(),this.isEnabled=e.isEnabled,this.refreshSlicerLabel(),0===this.dataItemsFilters.length&&0===this.dataItemsRows.length&&0===this.dataItemsColumns.length&&0===this.dataItemsData.length||this.rePaintPanels()},u.prototype.onFilterChanged=function(e,t,i){this._options.hasOwnProperty("onFilterChanged")&&this._options.onFilterChanged(e,t,i)},u.prototype.findReferenceLayoutItem=function(e,t){for(var i=0;i<e.length;i++)if(t.type===e[i].type&&t.uniqueName===e[i].uniqueName)return e[i];throw new Error("InvalidOperationException")},u.prototype.deleteActiveFilter=function(e,t){c.UserActionsTracker.track("Disable active filters.",{areatype:e});var i=void 0;switch(e){case p.AreaType.Filters:i=this.findReferenceLayoutItem(this._filtersPanel.dataItems,t);break;case p.AreaType.Rows:i=this.findReferenceLayoutItem(this._rowsPanel.dataItems,t);break;case p.AreaType.Columns:i=this.findReferenceLayoutItem(this._columnsPanel.dataItems,t);break;default:throw new Error("NotImplementedException")}i.filter.isUsed=!1,i.filter.customFilter.isUsed=!1,i.filter.membersFilter.isUsed=!1,this.onFilterChanged(this.layout,e,i),this.rePaintPanels()},u.prototype.showFilterEditor=function(e,t){var i=void 0;switch(e){case p.AreaType.Filters:i=this.findReferenceLayoutItem(this._filtersPanel.dataItems,t);break;case p.AreaType.Rows:i=this.findReferenceLayoutItem(this._rowsPanel.dataItems,t);break;case p.AreaType.Columns:i=this.findReferenceLayoutItem(this._columnsPanel.dataItems,t);break;default:throw new Error("NotImplementedException")}this.openFiltersEditor(e,i)},Object.defineProperty(u.prototype,"isVisibleLayoutButton",{get:function(){return this._isVisibleLayoutButton},set:function(e){e?this.showLayoutButton():this.hideLayoutButton()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"layoutDropdownItems",{get:function(){return this._layoutDropDownItems},set:function(e){this._layoutDropDownItems=e;for(var t=$(this._panel).find(".dropdown-menu").empty(),i=0;i<this._layoutDropDownItems.length;i++){var n=$("<li/>").on("click",this._layoutDropDownItems[i].onSelected),o=$("<a/>").text(this._layoutDropDownItems[i].title);n.append(o),t.append(n)}},enumerable:!0,configurable:!0}),u.prototype.initLayoutButton=function(){for(var e=$("<div/>").addClass("btn-group default-dropdown layout-button").css("z-index","100"),t=$("<button/>").addClass("btn btn-default dropdown-toggle").attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false").attr("title",c.Localization.localize("LayoutsOfDesignerButton_ToolTip")),i=$("<ul/>").addClass("dropdown-menu"),n=0;n<this._layoutDropDownItems.length;n++){var o=$("<li/>").on("click",this._layoutDropDownItems[n].onSelected),r=$("<a/>"),a=$("<div class='"+this._layoutDropDownItems[n].icon+" queryDesigner-dropDownImage'></div>"),s=$("<span>"+this._layoutDropDownItems[n].title+"</span>");r.append(a),r.append(s),o.append(r),i.append(o)}var l=$("<div/>").addClass("button-contentImage imageLibrary_designPanel");return e.append(t),t.append(l),e.append(i),e},u.prototype.showLayoutButton=function(){this._layoutButton&&this._layoutButton.show(),$(this._panel).find(".queryDesigner-layoutViewer").addClass("visible-layout-button"),this._isVisibleLayoutButton=!0},u.prototype.hideLayoutButton=function(){this._layoutButton&&this._layoutButton.hide(),$(this._panel).find(".queryDesigner-layoutViewer").removeClass("visible-layout-button"),this._isVisibleLayoutButton=!1},u.prototype.refreshSlicerLabel=function(){var n=this;null!==this._$slicerLabel&&this._$slicerLabel.remove();var e=$("<div/>").css("position","absolute").css("top",0).css("right",0),t=$("<div/>").addClass("dropdown-toggle").attr("data-toggle","dropdown").attr("aria-haspopup","true").attr("aria-expanded","false");t.append('<div class="queryDesigner-slicerLabel">'+this._availableSlicers.length+"</div>");for(var i=$("<ul/>").addClass("dropdown-menu"),o=0;o<this._availableSlicers.length;o++){var r=this._availableSlicers[o],a=$("<li/>").on("click",function(){for(var e=null,t=0;t<n._filtersPanel.dataItems.length;t++){var i=n._filtersPanel.dataItems[t];if(null!==i.filter&&null!==i.filter.membersFilter){if("level"===i.type&&i.parentHierarchyId===r.hierarchyUniqueName){e=i.filter.membersFilter.selectionNodes;break}if("hierarchy"===i.type&&i.uniqueName===r.hierarchyUniqueName){e=i.filter.membersFilter.selectionNodes;break}}}n.showSlicerControl(r,e)}),s=$("<a/>"),l=$("<span>"+r.caption+"</span>");s.append(l),a.append(s),i.append(a)}e.append(t),e.append(i),this._$slicerLabel=e,0<this._availableSlicers.length&&this._filtersPanel.view.append(e)},Object.defineProperty(u.prototype,"availableSlicers",{get:function(){return this._availableSlicers},enumerable:!0,configurable:!0}),u.prototype.createNewSlicerControl=function(n,o){var r=this,a=new p.Slicer.SlicerSettingsControl,e=new p.Windows.FloatingWindowOptions;e.content=a.view,e.title=c.Localization.localize("WindowTitleSlicerSettings"),e.size=p.Windows.WindowSize.Small,e.container=this._options.container,e.onClosed=function(e,t){if(!1!==t.dialogResult){var i=new p.AvailableSlicerDescription(n.caption,n.uniqueName,n.hierarchyUniqueName,a.maxHeight,a.columnCount,a.buttonWidth);o(i),r.showSlicerControl(i,n.selectionTree)}},new p.Windows.FloatingWindow(e).show()},u.prototype.showSlicerControl=function(t,e){var i=this,n=this;if(!(0<this._slicers.filter(function(e){return e.levelUniqueName===t.uniqueName}).length)){var o=new p.Slicer.SlicerControlOptions;o.maxHeight=t.maxHeight,o.columnCount=t.columnCount,o.buttonWidth=t.buttonWidth,o.container=this._options.container,o.cubeName=this._options.cubeName,o.connection=this._options.connection,o.header=t.caption,o.startSelectionTree=e,o.levelUniqueName=t.uniqueName,o.hierarchyUniqueName=t.hierarchyUniqueName;var r=new p.Slicer.SlicerControl(o);n._slicers.push(r),r.onStateChanged.on(function(e){n.changeMembersFilter(e.e.hierarchyUniqueName,e.e.selectionMembersTree)}),r.onSlicerDeleted.on(function(t){var e=i._availableSlicers.filter(function(e){return e.uniqueName===t.sender.levelUniqueName})[0];n._availableSlicers.splice(n._availableSlicers.indexOf(e),1),n._slicers.splice(n._slicers.indexOf(t.sender),1),i.refreshSlicerLabel()}),r.onSettingsChanged.on(function(t){var e=i._availableSlicers.filter(function(e){return e.uniqueName===t.sender.levelUniqueName})[0];e.buttonWidth=t.newSettings.defaultButtonWidth,e.columnCount=t.newSettings.defaultColumnCount,e.maxHeight=t.newSettings.defaultMaxHeight}),r.onSlicerMinimized.on(function(e){n._slicers.splice(n._slicers.indexOf(e.sender),1)}),this._options.container.append(r.view),n.refreshSlicerLabel()}},u.prototype.checkSlicers=function(){for(var e=new Array,t=0;t<this._availableSlicers.length;t++){for(var i=this._availableSlicers[t].hierarchyUniqueName,n=null,o=0,r=this._dataItemsFilters;o<r.length;o++){var a=r[o];if("level"===a.type&&a.parentHierarchyId===i){n=a;break}if("hierarchy"===a.type&&a.uniqueName===i){n=a;break}}n||e.push(i)}for(var s=0,l=e;s<l.length;s++){var c=l[s];this.deleteSlicerByHierarchy(c)}},u.prototype.deleteSlicerByHierarchy=function(t){var e=this._slicers.filter(function(e){return e.hierarchyUniqueName===t})[0];if(e)e.remove();else{var i=this._availableSlicers.filter(function(e){return e.hierarchyUniqueName===t})[0];this._availableSlicers.splice(this._availableSlicers.indexOf(i),1)}},u.prefiximageLibrary="imageLibrary_",u}(),p.QueryDesigner=e}(Ranet||(Ranet={})),function(r){r.ranetQueryDesigner=function(e,t){var i,n=this,o={};this.settings={},this.getLayout=function(){return i.layout},this.getAvailableSlicers=function(){return i.availableSlicers},this.initQueryDesigner=function(){i.initQueryDesigner()},this.init=function(){n.settings=r.extend({},o,t),i=new Ranet.Controls.QueryDesigner(e,t)},this.deleteActiveFilter=function(e,t){i.deleteActiveFilter(e,t)},this.showFilterEditor=function(e,t){i.showFilterEditor(e,t)},this.option=function(e){e.hasOwnProperty("layout")&&(i.layout=e.layout),e.hasOwnProperty("dataSource")&&(i.plainDataSource=e.dataSource),e.hasOwnProperty("placementMode")&&(i.placementMode=e.placementMode),e.hasOwnProperty("treeMeasures")&&(i.treeMeasures=e.treeMeasures),e.hasOwnProperty("isEnabled")&&(i.isEnabled=e.isEnabled),e.hasOwnProperty("sortingRowsOptions")&&(i.sortingRowsOptions=e.sortingRowsOptions),e.hasOwnProperty("sortingColumnsOptions")&&(i.sortingColumnsOptions=e.sortingColumnsOptions),e.hasOwnProperty("showToolbar")&&(i.showToolbar=e.showToolbar)},this.isVisibleLayoutButton=function(e){if(void 0===e)return i.isVisibleLayoutButton;i.isVisibleLayoutButton=e},this.integrityDataManager=function(){return i.integrityDataManager},this.init()},r.fn.ranetQueryDesigner=function(t){return this.each(function(){if(null==r(this).data("ranetQueryDesigner")){var e=new r.ranetQueryDesigner(this,t);r(this).data("ranetQueryDesigner",e)}})}}(jQuery),function(e){var t;t=function(){this.isEnabled=!0,this.autoExecuteQuery=!0},(e.Controls||(e.Controls={})).QueryDesignerOptions=t}(Ranet||(Ranet={})),function(i){var e,o,t;e=i.Controls||(i.Controls={}),o=e.Slicer||(e.Slicer={}),t=function(){function e(e,t,i,n){this._connection=e,this._cubeName=t,this._hierarchyUniqueName=i,this._levelUniqueName=n,this._queryManager=new o.QueryManager(this._cubeName,this._hierarchyUniqueName,this._levelUniqueName)}return e.prototype.getMemberCount=function(){var t=$.Deferred();return $.ajax({type:"POST",url:i.PathManager.applicationUrl+"api/olap/memberchoice/getMemberCount",data:{connection:this._connection,query:this._queryManager.getCountMembersQuery()},success:function(e){t.resolve(e)},error:function(e){i.LogService.error(e),i.UserMessageService.showServerError(e),t.reject(e)}}),t},e.prototype.getMembers=function(e){var t=$.Deferred();return $.ajax({type:"POST",url:i.PathManager.applicationUrl+"api/olap/memberchoice/getMembers",data:{connection:this._connection,query:this._queryManager.getMembersQuery(e)},success:function(e){t.resolve(e)},error:function(e){i.LogService.error(e),i.UserMessageService.showServerError(e),t.reject(e)}}),t},e}(),o.DataManager=t}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Slicer||(t.Slicer={}),n=function(){function e(e,t,i){this._cubeName=e,this._hierarchyUniqueName=t,this._levelUniqueName=i}return e.prototype.getCountMembersQuery=function(){return"WITH  MEMBER[Measures].__ROslicermembercount as "+this._levelUniqueName+".MEMBERS.Count SELECT {[Measures].__ROslicermembercount } ON 0 FROM "+this._cubeName+" CELL PROPERTIES VALUE"},e.prototype.getMembersQuery=function(e){return"SELECT SUBSET("+this._levelUniqueName+".MEMBERS, 0, "+(e+1)+") DIMENSION PROPERTIES KEY0, HIERARCHY_UNIQUE_NAME ON 0 FROM "+this._cubeName},e}(),i.QueryManager=n}(Ranet||(Ranet={})),function(e){var n,t,i;n=e.Controls||(e.Controls={}),t=n.Slicer||(n.Slicer={}),i=function(){function e(e){this._memberData=e,this._onStateChanged=new n.Events.LiteEvent;var t=$("<div class='slicerControl-slicerItem'/>");t.append(this._memberData.caption),this._viewContent=t;var i=$('<button type="button" class="btn btn-default slicerControl-slicerButton"></button>');i.append(t),this._view=i}return Object.defineProperty(e.prototype,"onStateChanged",{get:function(){return this._onStateChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memberData",{get:function(){return this._memberData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChecked",{get:function(){return this._view.hasClass("active")},set:function(e){e?!1===this._view.hasClass("active")&&this._view.addClass("active"):this._view.removeClass("active")},enumerable:!0,configurable:!0}),e.prototype.onClick=function(){this._view.toggleClass("active"),this._onStateChanged.trigger({sender:this,e:{memberData:this._memberData,newState:this._view.hasClass("active")}})},e.prototype.getView=function(e){return this._viewContent.css("width",e),this._view.unbind(),this._view.on("click",this.onClick.bind(this)),this._view},e}(),t.SlicerItem=i}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){},(t.Slicer||(t.Slicer={})).SlicerSettingsControlOptions=i}(Ranet||(Ranet={})),function(e){var t,i;t=e.Controls||(e.Controls={}),i=function(){},(t.Slicer||(t.Slicer={})).SlicerStateChangedArgs=i}(Ranet||(Ranet={})),function(a){var i;(function(o){var e=function(){function e(e,t,i){this._sortingHierarchyDescription=null,this._$template=e,this._hierarchyDescription=t,void 0!==i&&(this._sortingHierarchyDescription=i),this._$propertyDropDown=this._$template.find(".sortOptionsEditor-propertySelector"),this._$sortingDirectionDropDown=this._$template.find(".sortOptionsEditor-sortingDirectionSelector"),this._$hierarchyLabel=this._$template.find(".sortOptionsEditor-hierarchyCaption")}return Object.defineProperty(e.prototype,"sortingDescription",{get:function(){var e=new o.SortingHierarchyDescription;return e.hierarchyUniqueName=this._hierarchyDescription.uniqueName,e.direction=this._directionSelector.selectedItem.direction,e.property=this._propertySelector.selectedItem.property,e},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._propertySelector=new i.DropDownControl,this._propertySelector.displayPropertyExpr="caption",this._propertySelector.imageCssClassExp="iconClass",this._propertySelector.selectedExpr="isSelected",this._propertySelector.itemSource=this.getProperties(),this._$propertyDropDown.append(this._propertySelector.view),this._directionSelector=new i.DropDownControl,this._directionSelector.displayPropertyExpr="caption",this._directionSelector.imageCssClassExp="iconClass",this._directionSelector.selectedExpr="isSelected",this._directionSelector.itemSource=this.getDirections(),this._$sortingDirectionDropDown.append(this._directionSelector.view),this._$hierarchyLabel.text(this._hierarchyDescription.caption)},e.prototype.getDirections=function(){var e=new Array,t=new r;t.caption=a.Localization.localize("Sorting_None_Label"),t.iconClass="imageLibrary_sortingDirectionNone",t.isSelected=!1,t.direction=o.SortingDirection.None;var i=new r;i.caption=a.Localization.localize("Sorting_Ascending_Label"),i.iconClass="imageLibrary_sortingDirectionAscending",i.isSelected=!1,i.direction=o.SortingDirection.Ascending;var n=new r;if(n.caption=a.Localization.localize("Sorting_Descending_Label"),n.iconClass="imageLibrary_sortingDirectionDescending",n.isSelected=!1,n.direction=o.SortingDirection.Descending,null===this._sortingHierarchyDescription)t.isSelected=!0;else if(this._sortingHierarchyDescription.direction===o.SortingDirection.Ascending)i.isSelected=!0;else{if(this._sortingHierarchyDescription.direction!==o.SortingDirection.Descending)throw new Error("InvalidOperationException");n.isSelected=!0}return e.push(t),e.push(i),e.push(n),e},e.prototype.getProperties=function(){var e=new Array,t=new n;t.caption=a.Localization.localize("Caption"),t.iconClass="imageLibrary_sortingProperty",t.isSelected=!1,t.property=o.HierarchyProperty.Caption;var i=new n;if(i.caption="Key0",i.iconClass="imageLibrary_sortingProperty",i.isSelected=!1,i.property=o.HierarchyProperty.Key0,null===this._sortingHierarchyDescription)t.isSelected=!0;else if(this._sortingHierarchyDescription.property===o.HierarchyProperty.Caption)t.isSelected=!0;else{if(this._sortingHierarchyDescription.property!==o.HierarchyProperty.Key0)throw new Error("InvalidOperationException");i.isSelected=!0}return e.push(t),e.push(i),e},e}();o.SortingHierarchyControl=e;var t=function(){},n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t),r=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t)})((i=a.Controls||(a.Controls={})).SortingOptionsPivotTable||(i.SortingOptionsPivotTable={}))}(Ranet||(Ranet={})),function(N){var g;(function(m){var f,e;(e=f||(f={}))[e.Columns=0]="Columns",e[e.Rows=1]="Rows";var t=function(){function n(t){this.options=t,this._$view=$("<div/>"),this._sortingHerarchyControlsColumns=new Array,this._sortingHerarchyControlsRows=new Array,n._directoryTemplate=N.PathManager.templatesPath;var i=this;this.getTemplate().done(function(e){i._$view.append(e.$rootLayout),i._templateDescription=e,i.syncStateWithOptions(e.$sortingHierarchyTemplate,e.columns,t.measuresTree,t.sortingColumnsOptions,f.Columns),i.syncStateWithOptions(e.$sortingHierarchyTemplate,e.rows,t.measuresTree,t.sortingRowsOptions,f.Rows),i.initInteraction()})}return n.syncStateWithSortingMode=function(e,t){switch(t){case m.SortingMode.SortingByContext:e.sortByContext.$panel.show(),e.sortByProperty.$panel.hide();break;case m.SortingMode.SortingByProperty:e.sortByContext.$panel.hide(),e.sortByProperty.$panel.show();break;default:throw new Error("InvalidOperationException")}},n.prototype.setStateEditor=function(e,t){if(t===f.Columns)e?this._templateDescription.$rootLayout.find("#columns .sortOptionsEditor-partPanel").removeClass("disabled"):this._templateDescription.$rootLayout.find("#columns .sortOptionsEditor-partPanel").addClass("disabled");else{if(t!==f.Rows)throw new Error("InvalidOperationException");e?this._templateDescription.$rootLayout.find("#rows .sortOptionsEditor-partPanel").removeClass("disabled"):this._templateDescription.$rootLayout.find("#rows .sortOptionsEditor-partPanel").addClass("disabled")}},n.prototype.initInteraction=function(){var e=this;this._templateDescription.columns.$useSortingCheckBox.click(function(){e._templateDescription.columns.$useSortingCheckBox.is(":checked")?e.setStateEditor(!0,f.Columns):e.setStateEditor(!1,f.Columns)}),this._templateDescription.rows.$useSortingCheckBox.click(function(){e._templateDescription.rows.$useSortingCheckBox.is(":checked")?e.setStateEditor(!0,f.Rows):e.setStateEditor(!1,f.Rows)});var t=function(e){if(e.$setByPropertySortModeCheckBox.is(":checked"))n.syncStateWithSortingMode(e,m.SortingMode.SortingByProperty);else{if(!e.$setByContextSortModeCheckBox.is(":checked"))throw new Error("NotInvalidException");n.syncStateWithSortingMode(e,m.SortingMode.SortingByContext)}};this._templateDescription.columns.$setByPropertySortModeCheckBox.click(function(){t(e._templateDescription.columns)}),this._templateDescription.columns.$setByContextSortModeCheckBox.click(function(){t(e._templateDescription.columns)}),this._templateDescription.rows.$setByPropertySortModeCheckBox.click(function(){t(e._templateDescription.rows)}),this._templateDescription.rows.$setByContextSortModeCheckBox.click(function(){t(e._templateDescription.rows)})},Object.defineProperty(n.prototype,"sortingRowsOptions",{get:function(){return this.getCurrentState(this._templateDescription.rows,f.Rows)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sortingColumnsOptions",{get:function(){return this.getCurrentState(this._templateDescription.columns,f.Columns)},enumerable:!0,configurable:!0}),n.prototype.getCurrentState=function(e,t){if(!1===e.$useSortingCheckBox.is(":checked"))return null;var i;if(e.$setByPropertySortModeCheckBox.is(":checked"))i=m.SortingMode.SortingByProperty;else{if(!e.$setByContextSortModeCheckBox.is(":checked"))throw new Error("InvalidOperationException");i=m.SortingMode.SortingByContext}var n=new m.SortingDescription;if(n.isUsed=e.$useSortingCheckBox.is(":checked"),i===m.SortingMode.SortingByContext)n.sortingByMeasure=this.getSortingDescriptionByMeasure(e,t);else{if(i!==m.SortingMode.SortingByProperty)throw new Error("InvalidOperationException");n.sortingByProperty=this.getSortingDescriptionByProperty(t)}return null===n.sortingByMeasure&&i===m.SortingMode.SortingByContext&&(n.isUsed=!1),0===n.sortingByProperty.items.length&&i===m.SortingMode.SortingByProperty&&(n.isUsed=!1),n.mode=i,n},n.prototype.getSortingDescriptionByProperty=function(e){var t,i=new m.SortingByPropertyModel;switch(e){case f.Rows:t=this._sortingHerarchyControlsRows;break;case f.Columns:t=this._sortingHerarchyControlsColumns;break;default:throw new Error("InvalidOpearionException")}for(var n=0;n<t.length;n++){var o=t[n].sortingDescription;o.direction!==m.SortingDirection.None&&i.items.push(o)}return i},n.prototype.getSortingDescriptionByMeasure=function(e,t){var i=new m.SortingByMeasureModel;return e.sortByContext.$useSortingByMemberCheckBox.is(":checked")?i.members=t===f.Columns?this.options.sortingColumnsOptions.sortingByMeasure.members:this.options.sortingRowsOptions.sortingByMeasure.members:i.members=null,e.sortByContext.$useSortingByMeasureCheckbox.is(":checked")?i.measureUniqueName=t===f.Columns?this._measureChoiceSelectorColumns.selectedUniqueNames[0]:this._measureChoiceSelectorRows.selectedUniqueNames[0]:i.measureUniqueName=null,null===i.measureUniqueName&&null===i.members?null:(i.direction=e.$setAscendingRadio.is(":checked")?m.SortingDirection.Ascending:m.SortingDirection.Descending,i)},n.prototype.syncStateWithOptions=function(e,t,i,n,o){var r=new g.MeasureChoiceOptions(i,!1);r.isMultiSelect=!1;var a=this;r.getPopupContainer=function(){return a._$view.closest(".ranetDynamicPivotGrid")};for(var s=o===f.Columns?this.options.hierarchiesColumnsPanel:this.options.hierarchiesRowsPanel,l=0;l<s.length;l++){var c=s[l],u=n.sortingByProperty.items.filter(function(e){return e.hierarchyUniqueName===c.uniqueName})[0],p=e.clone(),h=new m.SortingHierarchyControl(p,c,u);if(h.init(),o===f.Columns)this._sortingHerarchyControlsColumns.push(h);else{if(o!==f.Rows)throw new Error("InvalidOperationException");this._sortingHerarchyControlsRows.push(h)}t.sortByProperty.$panel.append(p)}if(n.isUsed)if(t.$useSortingCheckBox.prop("checked",!0),n.mode===m.SortingMode.SortingByContext){if(t.$setByContextSortModeCheckBox.prop("checked",!0),t.sortByProperty.$panel.hide(),t.sortByContext.$panel.show(),t.$useSortingCheckBox.prop("checked",!0),this.setStateEditor(!0,o),n.sortingByMeasure.direction===m.SortingDirection.Ascending)t.$setAscendingRadio.prop("checked",!0);else{if(n.sortingByMeasure.direction!==m.SortingDirection.Descending)throw new Error("InvalidOperationException");t.$setDescendingRadio.prop("checked",!0)}null!==n.sortingByMeasure.members&&0<n.sortingByMeasure.members.length?(t.sortByContext.$useSortingByMemberCheckBox.prop("checked",!0),t.sortByContext.$sortingByMemberPanel.show(),t.sortByContext.$sortingByMemberLabel.text(N.Localization.localize("SortingEditor_SetSortingByMember")+' "'+n.sortingByMeasure.members.map(function(e){return e.caption}).join(", ")+'"')):t.sortByContext.$sortingByMemberPanel.hide(),null!==n.sortingByMeasure.measureUniqueName?(t.sortByContext.$useSortingByMeasureCheckbox.prop("checked",!0),r.selectedUniqueNames=[n.sortingByMeasure.measureUniqueName]):t.sortByContext.$useSortingByMeasureCheckbox.prop("checked",!1)}else{if(n.mode!==m.SortingMode.SortingByProperty)throw new Error("InvalidOperationException");t.$setByPropertySortModeCheckBox.prop("checked",!0),t.sortByContext.$panel.hide(),t.sortByProperty.$panel.show()}else t.$useSortingCheckBox.prop("checked",!1),this.setStateEditor(!1,o);var d=new g.MeasureChoiceSelector(t.sortByContext.$sortingByMeasureSelector.get(0),r);if(o===f.Columns)this._measureChoiceSelectorColumns=d;else{if(o!==f.Rows)throw new Error("InvalidOperationException");this._measureChoiceSelectorRows=d}d.init()},Object.defineProperty(n.prototype,"view",{get:function(){return this._$view},enumerable:!0,configurable:!0}),n.prototype.getTemplate=function(){var E=$.Deferred();return $.when($.ajax({url:n._directoryTemplate+"sort-options-editor.html"}),$.ajax({url:n._directoryTemplate+"sort-hierarchy-template.html"})).done(function(e,t){var i=$(N.Localization.localizeTemplate(e[0])),n=$(N.Localization.localizeTemplate(t[0])),o=i.find("#columns .sortOptionsEditor-usingSortingSwitcher"),r=i.find('#columns input[value="ascending"]'),a=i.find('#columns input[value="descending"]'),s=i.find("#columns .sortOptionsEditor-usingSortingByMemberPanel"),l=s.find(".sortOptionsEditor-inputLabel"),c=s.find("input"),u=i.find("#columns .sortOptionsEditor-usingSortingByMeasurePanel"),p=u.find("input"),h=u.find(".sortOptionsEditor-measureSelector"),d=i.find("#rows .sortOptionsEditor-usingSortingSwitcher"),m=i.find('#rows input[value="ascending"]'),f=i.find('#rows input[value="descending"]'),g=i.find('#rows input[value="byProperty"]'),_=i.find('#rows input[value="byContext"]'),y=i.find("#rows .sortOptionsEditor-sortByContextPanel"),C=i.find("#rows .sortOptionsEditor-sortByPropertyPanel"),v=i.find('#columns input[value="byProperty"]'),b=i.find('#columns input[value="byContext"]'),w=i.find("#columns .sortOptionsEditor-sortByContextPanel"),S=i.find("#columns .sortOptionsEditor-sortByPropertyPanel"),x=i.find("#rows .sortOptionsEditor-usingSortingByMemberPanel"),D=x.find(".sortOptionsEditor-inputLabel"),T=x.find("input"),P=i.find("#rows .sortOptionsEditor-usingSortingByMeasurePanel"),M=P.find("input"),I=P.find(".sortOptionsEditor-measureSelector");E.resolve({$rootLayout:i,$sortingHierarchyTemplate:n,columns:{$useSortingCheckBox:o,$setAscendingRadio:r,$setDescendingRadio:a,$setByPropertySortModeCheckBox:v,$setByContextSortModeCheckBox:b,sortByContext:{$panel:w,$sortingByMemberPanel:s,$sortingByMemberLabel:l,$useSortingByMemberCheckBox:c,$useSortingByMeasureCheckbox:p,$sortingByMeasureSelector:h},sortByProperty:{$panel:S}},rows:{$useSortingCheckBox:d,$setAscendingRadio:m,$setDescendingRadio:f,$setByPropertySortModeCheckBox:g,$setByContextSortModeCheckBox:_,sortByContext:{$panel:y,$sortingByMemberPanel:x,$sortingByMemberLabel:D,$useSortingByMemberCheckBox:T,$useSortingByMeasureCheckbox:M,$sortingByMeasureSelector:I},sortByProperty:{$panel:C}}})}).fail(function(e){N.LogService.error(e),E.reject(e)}),E},n}();m.SortOptionsEditorControl=t})((g=N.Controls||(N.Controls={})).SortingOptionsPivotTable||(g.SortingOptionsPivotTable={}))}(Ranet||(Ranet={})),function(e){var t,u,i,n;t=e.Utility||(e.Utility={}),u=e.Controls.MemberChoice.MemberChoiceTreeNode,i=e.Controls.CustomFilterOptions,n=function(){function e(){}return e.getFilterTreeWhereItemSelectedSelf=function(e){var t=null,i=null;if(null!==e.parents)for(var n=0;n<e.parents.length;n++){var o=e.parents[n],r=new u(o.uniqueName,void 0,void 0,void 0);null===t||null===i?t=i=r:(i.childNodes=new Array(r),i=r)}return null===i?t=new u(e.uniqueName,!0,void 0,void 0):i.childNodes=new Array(new u(e.uniqueName,!0,void 0,void 0)),t},e.getFilterTreeWhereItemsSelectedSelf=function(e){for(var t=new Array,i={},n=0;n<e.length;n++){var o=e[n],r=null;if(null!==o.parents)for(var a=0;a<o.parents.length;a++){var s,l=o.parents[a];i.hasOwnProperty(l.uniqueName)?s=i[l.uniqueName]:(s=new u(l.uniqueName,void 0,void 0,void 0),i[l.uniqueName]=s,0===a&&0===t.filter(function(e){return e.uniqueName===s.uniqueName}).length&&t.push(s)),null!==r&&-1===r.childNodes.indexOf(s)&&r.childNodes.push(s),r=s}var c=void 0;i.hasOwnProperty(o.uniqueName)?(c=i[o.uniqueName],i[o.uniqueName].selectedSelf=!0):c=new u(o.uniqueName,!0,void 0,void 0),null!==r?r.childNodes.push(c):t.push(c)}return t},e.getFilterInstance=function(e){return{isUsed:!0,membersFilter:{isUsed:!0,selectionNodes:e},customFilter:new i}},e.getActionsAfterDrillDownByHierarchy=function(e,t,i){var n=Array();for(var o in e)if(e.hasOwnProperty(o)){var r=e[o];r.header.axisType!==i&&n.push(r)}var a={actionType:"expand",header:{}};return a.header.axisType=i,a.header.uniqueName=t.defaultMember,a.header.hierarchyUniqueName=t.uniqueName,n.push(a),n},e.getLayoutAfterDetailedCellsAnalysisCurrentStructure=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){for(var n=0;n<e.rows.length;n++){var o=e.rows[n];if("hierarchy"===o.type&&o.uniqueName===i){o.filter=this.getFilterInstance(t[i]);break}if("level"===o.type&&o.parentHierarchyId===i){o.filter=this.getFilterInstance(t[i]);break}}for(var r=0;r<e.columns.length;r++){var a=e.columns[r];if("hierarchy"===a.type&&a.uniqueName===i){a.filter=this.getFilterInstance(t[i]);break}if("level"===a.type&&a.parentHierarchyId===i){a.filter=this.getFilterInstance(t[i]);break}}}return e},e.getLayoutAfterDetailedCellsAnalysisFilterAxis=function(e,t){var i=e.rows.filter(function(e){return"values"===e.type}),n=e.columns.filter(function(e){return"values"===e.type});for(var o in e.rows.length=0,(e.columns.length=0)!==i.length?e.rows.push(i[0]):0!==n.length&&e.columns.push(n[0]),t)t.hasOwnProperty(o)&&e.filters.push({type:"hierarchy",uniqueName:o,filter:this.getFilterInstance(t[o])});return e},e.getLayoutAfterDrillDownByHierarchy=function(e,t,i,n){var o;if("rows"===n)o=e.rows;else{if("columns"!==n)throw new Error("InvalidOperationException");o=e.columns}for(var r in o.length=0,o.push({type:"hierarchy",uniqueName:t.uniqueName}),i)if(i.hasOwnProperty(r)){var a=void 0;for(var s in e.filters)if(e.filters.hasOwnProperty(s)){var l=e.filters[s];if("level"===l.type&&l.parentHierarchyId===r){a=l;break}if("hierarchy"===l.type&&l.uniqueName===r){a=l;break}}void 0!==a?a.filter=this.getFilterInstance(new Array(i[r])):e.filters.push({type:"hierarchy",uniqueName:r,filter:this.getFilterInstance(new Array(i[r]))})}return e},e}(),t.DynamicPivotGridHelper=n}(Ranet||(Ranet={})),function(e){var t,i;t=e.Utility||(e.Utility={}),i=function(){function c(){}return c.filterMeasureGroupMetadata=function(e,t){if(!t)return e;for(var i=new Array,n=0;n<e.length;n++){var o=e[n];if("kpiRootNode"!==o.type)if("measuresRootNode"!==o.type)if("setsRootNode"!==o.type)if("customCalculations"!==o.type){if("dimension"===o.type)for(var r=0;r<t.dimensions.length;r++){t.dimensions[r]===o.uniqueName&&i.push(o)}}else i.push(o);else i.push(o);else{var a=c.getNewMeasureNode(o,t.measures);0<a.items.length&&i.push(a)}else{var s=c.getNewKpiNode(o,t.kpis);0<s.items.length&&i.push(s)}}return i},c.getNewMeasureNode=function(e,t){var i=jQuery.extend(!0,{},e);return i.items=c.getNodeChildren(e.items,t,"measure","uniqueName"),i},c.getNewKpiNode=function(e,t){var i=jQuery.extend(!0,{},e);return i.items=c.getNodeChildren(e.items,t,"kpiInfo","caption"),i},c.getNodeChildren=function(e,t,i,n){for(var o=new Array,r=0;r<e.length;r++){var a=e[r];if("folder"===a.type){if(this.canIncludeFolder(a,t,n)){var s=jQuery.extend(!0,{},a);s.items=new Array,s.items=c.getNodeChildren(a.items,t,i,n),o.push(s)}}else if(a.type===i)for(var l=0;l<t.length;l++)a[n]===t[l]&&o.push(a)}return o},c.canIncludeFolder=function(e,t,i){for(var n=0;n<e.items.length;n++){var o,r=e.items[n];if("folder"!==r.type){for(o=0;o<t.length;o++)if(t[o]===r[i])return!0}else for(o=0;o<e.items.length;o++)if(this.canIncludeFolder(e.items[o],t,i))return!0}return!1},c.filterByText=function(e,t){for(var i=new Array,n=0;n<e.length;n++){var o=e[n];if(-1!==o.caption.toLowerCase().indexOf(t.toLowerCase())&&i.push(o),void 0!==o.items&&0<o.items.length){var r=c.filterByText(o.items,t);0<r.length&&(o.items=r,o.isOpen=!0,-1===i.indexOf(o)&&i.push(o))}}return i},c}(),t.TreeMetadataHelper=i}(Ranet||(Ranet={})),function(e){var t=function(){function t(){}return Object.defineProperty(t,"templatesPath",{get:function(){return t._templatesPath},enumerable:!0,configurable:!0}),Object.defineProperty(t,"resourcePath",{get:function(){return t._resourcePath},set:function(e){t._templatesPath=(t._resourcePath=e)+"templates/",t._mapsPath=t._resourcePath+"maps/"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"mapPath",{get:function(){return t._mapsPath},enumerable:!0,configurable:!0}),Object.defineProperty(t,"applicationUrl",{get:function(){return t._applicationUrl},set:function(e){t._applicationUrl=e},enumerable:!0,configurable:!0}),t._resourcePath="/assets/",t._mapsPath="/assets/maps/",t._templatesPath="/assets/templates/",t._applicationUrl="/",t}();e.PathManager=t}(Ranet||(Ranet={})),function(e){var t;(function(e){var o=function(){function e(){}return e.palettes={default:["#565077","#6babac","#cbc87b","#9ab57e","#e55253","#7e4452","#e8c267"],pastel:["#ab394b","#dac599","#153459","#bb7862","#70b3a1","#bb626a","#057d85"],softpastel:["#90ba58","#456c68","#60a69f","#78b6d9","#6682bb","#a37182","#eeba69"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"]},e}();e.PaletteCollection=o;var t=function(){function e(e){this._currentPalette=e?o.palettes[e.toLowerCase()]:o.palettes["Default".toLowerCase()]}return e.prototype.getColor=function(e,t){t||(t=this._currentPalette.length);var i=e%t;return this._currentPalette[i]},e.prototype.checkForRepeating=function(e,t){return(e-1)%t==0},e.prototype.getRecomendedColorNumber=function(e,t){return t||(t=this._currentPalette.length),1===t?this._currentPalette.length:this.checkForRepeating(e,t)?this.getRecomendedColorNumber(e,t-1):t},e.prototype.getRecomendedColor=function(e,t,i){var n=this.getRecomendedColorNumber(t,i);return this.getColor(e,n)},e}();e.ColorGenerator=t;var i=function(){function e(){}return e.getColor=function(e,t,i){var n=o.palettes[e];return i||(i=n.length),n[t%i]},e.checkForRepeating=function(e,t){return(e-1)%t==0},e.getRecomendedColorNumber=function(e,t,i){var n=o.palettes[e];return i||(i=n.length),1===i?n.length:this.checkForRepeating(t,i)?this.getRecomendedColorNumber(e,t,i-1):i},e}();e.ColorGeneratorStatic=i})((t=e.Controls||(e.Controls={})).Extensions||(t.Extensions={}))}(Ranet||(Ranet={})),function(i){var e;(function(s){function n(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var i in e)e.hasOwnProperty(i)&&(t[i]=n(e[i]));return t}var e=function(){function e(e,t){this._htmlElement=e,this._element=d3.select(e),this._options=t,this._pieOptions=n(this._options),this._data=t.dataSource,this._guid=i.Utility.Guid.newGuid(),this._initialHeight=t.size.canvasHeight,this._minHeight=t.minHeight||0,this._titles=t.titles||[],this._options.specifiedSeria||(this._options.specifiedSeria={index:null,title:"Error. Invalid seria."}),console.log(t),this._options.labels.mainLabel.color=this._options.labels.mainLabel.color||"fff",this._element.classed("ranetPie",!0),this._element.attr("id",this._guid),this._pieOptions.tooltips={enabled:!1},this._initialHeight=this._currentHeight=this._options.size.canvasHeight,this._hiddenIndexes=[],this._dataUpdated=!0}return e.prototype.draw=function(){var t=this;if(this._element.classed("ranetPie",!0),this._options.dataSource){this.drawLegend(),this._pieOptions.legend.position!==s.PieLegendPosition.Left&&this._pieOptions.legend.position!==s.PieLegendPosition.Right||this._element.select(".legend").classed("vertical",!0),this.resize();var e,i,n,o,r=this._element.node(),a=r.getBoundingClientRect();0!==a.width&&(this._pieOptions.legend.visible&&this._pieOptions.legend.position!==s.PieLegendPosition.None?(r=this._element.select(".legend").node(),this._pieOptions.legend.position===s.PieLegendPosition.Top||this._pieOptions.legend.position===s.PieLegendPosition.Bottom?(e=r?r.getBoundingClientRect().height:0,i=0):(i=r?r.getBoundingClientRect().width:0,e=0)):i=e=0,a.height-e<200||a.width-i<300?this._pieOptions.labels.outer.format="none":this._pieOptions.labels.outer.format=this._options.labels.outer.format,"none"===this._options.labels.outer.format?(n=a.height-e-20,o=a.width-i-5):(n=a.height-e-20,o=a.width-8-i),this._pieOptions.size.canvasHeight=n,this._pieOptions.size.canvasWidth=o,this._pieOptions.legend.position===s.PieLegendPosition.Left||this._pieOptions.legend.position===s.PieLegendPosition.Top?this._container=this._element.append("div").classed("ranetPieContainer",!0).style("height",n+"px").style("width",o+5+"px"):this._container=this._element.insert("div",".legend").classed("ranetPieContainer",!0).style("height",n+"px").style("width",o+5+"px"),s.PieFactory.getPie(this._pieOptions,this._container,this._data,this._pieOptions.specifiedSeria.title),setTimeout(function(){var e=t._container.select("svg");e.attr("width",function(){return parseFloat(e.attr("width").substring(0,e.attr("width").length-2))+5+"px"})},0),this._options.tooltips.enabled&&setTimeout(function(){t.drawTooltips()},0))}},e.prototype.drawLegend=function(){var n=this;if(this._legend&&(this._legend.clear(),this._element.select(".legend").remove()),this._pieOptions.legend.visible&&0<this._pieOptions.legend.legendItems.length&&0!==this._options.dataSource.length&&this._pieOptions.legend.position!==s.PieLegendPosition.None){for(var e=this._element.insert("div",":first-child").attr("class","legend"),t=0;t<this._pieOptions.legend.legendItems.length;t++)0===this._data[t].value&&(this._pieOptions.legend.legendItems[t].show=!1);this._legend=new s.Legend(e,{visible:!0,onclickevent:function(e,t){var i=n._hiddenIndexes.indexOf(t);0<=i?n._hiddenIndexes.splice(i,1):n._hiddenIndexes.push(t),n.redraw()}},this._pieOptions.legend.legendItems),this._legend.clear(),this._legend.create()}},e.prototype.drawTooltips=function(){var a=this;this._container.selectAll("g[class*='_arc']").each(function(e){$(this).popover({container:"#"+a._guid,trigger:"manual",content:"<span color='"+e.color+"'>"+e.label+": "+e.displayValue+"<span>",html:!0,delay:0,placement:"auto top",template:'<div class="popover piePopover hidden" role="tooltip" style="visibility: hidden;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),$(this).popover("show"),$(this).popover("hide")}).on("mousemove",function(){var e=d3.select("body").node(),t=d3.mouse(e),i=a._element.select(".piePopover").node();if(i){var n=i.getBoundingClientRect(),o=n.width/2,r=n.height+15;a._element.select(".piePopover").attr("style","top: "+(t[1]-r)+"px; left: "+(t[0]-o)+"px; display: block;").attr("class","popover piePopover")}}).on("mouseenter",function(e){$(this).popover("show")}).on("mouseleave",function(e){$(this).popover("hide")}),this._container.selectAll("text[class*='_segmentValue-inner']").each(function(e){$(this).popover({container:"#"+a._guid,trigger:"manual",content:function(){return"<span color='"+e.color+"'>"+e.label+": "+e.displayValue+"<span>"},html:!0,delay:0,placement:"auto top",template:'<div class="popover piePopover hidden" role="tooltip" style="visibility: hidden;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),$(this).popover("show"),$(this).popover("hide")}).on("mousemove",function(){var e=d3.select("body").node(),t=d3.mouse(e),i=a._container.select(".piePopover").node();if(i){var n=i.getBoundingClientRect(),o=n.width/2,r=n.height+15;a._element.select(".piePopover").attr("style","top: "+(t[1]-r)+"px; left: "+(t[0]-o)+"px; display: block;").attr("class","popover piePopover")}}).on("mouseenter",function(e){$(this).popover("show")}).on("mouseleave",function(e){$(this).popover("hide"),a._element.select(".piePopover").attr("class","popover piePopover hidden")})},e.prototype.resize=function(){var e=this._element.select(".ranetPieContainer").node(),t=e?e.getBoundingClientRect().height:0,i=!(e=this._element.select(".ranetPieContainer").node())||this._options.legend.position!==s.PieLegendPosition.Top&&this._options.legend.position!==s.PieLegendPosition.Bottom?0:e.getBoundingClientRect().height,n=(t=t>this._minHeight?t:this._minHeight)<this._initialHeight?t+i:this._initialHeight;n!==this._currentHeight&&(this._currentHeight=n,this._pieOptions.size.canvasHeight=this._currentHeight,this._currentHeight<300?this._pieOptions.labels.inner.format="none":this._pieOptions.labels.inner.format=this._options.labels.inner.format)},e.prototype.redraw=function(){this.clear(),this.updateData(),this._element=d3.select(this._htmlElement),this.draw()},e.prototype.clear=function(){this._container&&(this._container.remove(),this._container=null,this._legend&&(this._legend.clear(),this._element.selectAll(".pieLegend").each(function(){""===d3.select(this).html()&&d3.select(this).remove()})),this._element.classed("ranetPie",!1))},e.prototype.updateData=function(){this._data=n(this._options.dataSource);for(var e=0;e<this._data.length;e++)0<=this._hiddenIndexes.indexOf(e)?(this._data[e].value=null,this._pieOptions.legend.legendItems[e].visible=!1):this._pieOptions.legend.legendItems[e].visible=!0},Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(e){this._options.dataSource!==e.dataSource&&(this._dataUpdated=!0),this._options=e,this._options.legend.legendItems=e.legend.legendItems||[],this._pieOptions=n(this._options),this._data=[],this._data.concat(this._pieOptions.dataSource),this._pieOptions.tooltips={enabled:!1},this.redraw()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._htmlElement},enumerable:!0,configurable:!0}),e}();s.Pie=e})((e=i.Controls||(i.Controls={})).Extensions||(e.Extensions={}))}(Ranet||(Ranet={})),function(e){var t,_,i;t=e.Controls||(e.Controls={}),_=t.Extensions||(t.Extensions={}),i=function(){function e(){}return e.getPieData=function(e,t){for(var i=[],n=e.cells.values,o=e.cells.displayValues,r=new _.ColorGenerator(t),a=r.getRecomendedColorNumber(e.rows.positions.length),s=0;s<e.rows.positions.length;s++){for(var l="",c=0;c<e.rows.positions[s].positions.length;c++)""!==l&&(l+=", "),l+=e.rows.members[e.rows.positions[s].positions[c].id].caption;for(var u=l,p=0;p<e.columns.positions.length;p++){var h={};h.label=u,i[p]||(i[p]=[]);var d=n[s][p],m=o[s][p];null===d?h.value=0:d.toFixed?h.value=parseFloat(d.toFixed(3)):h.value=0,h.displayValue=m||"0",h.color=r.getColor(s,a);var f=this.getRowDescription(e,s),g=this.getColumnDescription(e,p);h.data={row:f,column:g},i[p].push(h)}}return i},e.getRowDescription=function(e,t){for(var i={},n=e.rows.positions[t].positions[0].id,o=e.rows.members[n],r="",a=0;a<e.rows.positions[t].positions.length;a++)""!==r&&(r+=", "),r+=e.rows.members[e.rows.positions[t].positions[a].id].caption;return i.caption=r,i.hierarchy=e.rows.hierarchies[0],i.place="rows",i.endRow=i.startRow=t,i.column=0,i.ancestors=[],i.data=o,i},e.getColumnDescription=function(e,t){for(var i={},n=e.columns.positions[t].positions[0].id,o=e.columns.members[n],r="",a=0;a<e.columns.positions[t].positions.length;a++)""!==r&&(r+=", "),r+=e.columns.members[e.columns.positions[t].positions[a].id].caption;return i.caption=r,i.hierarchy=e.columns.hierarchies[0],i.place="columns",i.endColumn=i.startColumn=t,i.row=0,i.ancestors=[],i.data=o,i},e.getPieLegendItems=function(e,t){for(var i=new _.ColorGenerator(t),n=i.getRecomendedColorNumber(e.rows.positions.length),o=[],r=0;r<e.rows.positions.length;r++){for(var a="",s=0;s<e.rows.positions[r].positions.length;s++)""!==a&&(a+=", "),a+=e.rows.members[e.rows.positions[r].positions[s].id].caption;o.push({name:a,color:i.getColor(r,n),visible:!0,show:!0})}return o},e.getPieTitles=function(e){for(var t,i=[],n=0;n<e.columns.positions.length;n++){var o="";for(t=0;t<e.columns.positions[n].positions.length;t++)""!==o&&(o+=", "),o+=e.columns.members[e.columns.positions[n].positions[t].id].caption;i.push(o)}return i},e.getPieSeries=function(e){for(var t,i=[],n=0;n<e.columns.positions.length;n++){var o="";for(t=0;t<e.columns.positions[n].positions.length;t++)""!==o&&(o+=", "),o+=e.columns.members[e.columns.positions[n].positions[t].id].caption;i.push({index:n,title:o})}return i},e}(),_.PieDataHelper=i}(Ranet||(Ranet={})),function(e){var t,i,n;n=e.Controls||(e.Controls={}),t=n.Extensions||(n.Extensions={}),(i=t.PieLegendPosition||(t.PieLegendPosition={}))[i.Top=0]="Top",i[i.Bottom=1]="Bottom",i[i.Left=2]="Left",i[i.Right=3]="Right",i[i.None=4]="None",t.PieLegendPosition}(Ranet||(Ranet={})),function(s){var e,t,_,i;e=s.Controls||(s.Controls={}),t=e.Extensions||(e.Extensions={}),_=function(e,t,i){var n,o,r,a,s,l,c=e||{},u=1,p=arguments.length,h=!1,d=Object.prototype.toString,m=Object.prototype.hasOwnProperty,f={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},g={isFunction:function(e){return"function"===g.type(e)},isArray:Array.isArray||function(e){return"array"===g.type(e)},isWindow:function(e){return null!==e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null===e?String(e):f[d.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==g.type(e)||e.nodeType)return!1;try{if(e.constructor&&!m.call(e,"constructor")&&!m.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var t;for(t in e);return void 0===t||m.call(e,t)}};for("boolean"==typeof c&&(h=c,c=t||{},u=2),"object"==typeof c||g.isFunction(c)||(c={}),p===u&&(c=this,--u);u<p;u++)if(null!==(n=arguments[u]))for(o in n)r=c[o],c!==(a=n[o])&&(h&&a&&(g.isPlainObject(a)||(s=g.isArray(a)))?(s?(s=!1,l=r&&g.isArray(r)?r:[]):l=r&&g.isPlainObject(r)?r:{},c[o]=_(h,l,a)):void 0!==a&&(c[o]=a));return c},i=function(){function e(){}return e.getPie=function(e,t,i,n){var o,r=_(!0,e,r),a=s.Utility.Guid.newGuid();return t.attr("id",a),i&&0!==i.length&&(r.data.content=i,r.header.title.text=n||"",o=new d3pie(a,r)),o},e.setPieOptions=function(e,t){var i=e.options;e.options=_(!0,i,t)},e}(),t.PieFactory=i}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.SearchTreeView||(t.SearchTreeView={}),n=function(e){function t(){e.call(this)}return __extends(t,e),t}(t.TreeViewOptions),i.SearchTreeViewContentOptions=n}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.SearchTreeView||(t.SearchTreeView={}),n=function(){function e(){}return e.filter=function(e,t,i,n){if(""===t)return e;for(var o=JSON.stringify(e),r=JSON.parse(o),a=[],s=0;s<r.length;s++)r[s].items?(r[s].items=this.filter(r[s].items,t,i,n),0<r[s].items.length&&(r[s][n]=!0,a.push(r[s]))):0<=r[s][i].toLowerCase().indexOf(t.toLowerCase())&&a.push(r[s]);return a},e}(),i.SearchTreeFilter=n}(Ranet||(Ranet={})),function(e){var a,s,t;a=e.Controls||(e.Controls={}),s=a.SearchTreeView||(a.SearchTreeView={}),t=function(){function e(e,t){var i=this;this._isVisibleSearch=t.isVisibleSearch,this._dataSource=t.dataSource;var n=(this._treeViewOptions=t).onItemSelected;this._treeViewOptions.onItemSelected=function(e){i._selectedItems=[e.data],n(i._selectedItems),i.selectItemInDataSource({data:i._selectedItems[0]},i._dataSource)},this._filteredDataSource=this._dataSource,this._$panel=$(e),this._$container=$("<div/>"),this._$container.addClass("ranet-searchTreeViewContainer"),this._treeView=new a.TreeView(this._$container[0],this._treeViewOptions),this._isVisibleSearch?this._$container.addClass("ranet-searchTreeViewContainer-withSearchPanel"):this._$container.addClass("ranet-searchTreeViewContainer-withoutSearchPanel")}return Object.defineProperty(e.prototype,"displayed",{get:function(){return this._displayed},set:function(e){this._displayed=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=e,this.selectItemInDataSource({data:this._selectedItems[0]},this._dataSource)},enumerable:!0,configurable:!0}),e.prototype.repaint=function(){this._treeView.repaint()},e.prototype.selectItemInDataSource=function(e,t){for(var i=0;i<t.length;i++)"folder"===t[i].type?(e.data[this._treeViewOptions.displayExpr]===t[i][this._treeViewOptions.displayExpr]&&e.data[this._treeViewOptions.keyExpr]===t[i][this._treeViewOptions.keyExpr]?t[i][this._treeViewOptions.selectedExpr]=!0:t[i][this._treeViewOptions.selectedExpr]=!1,this.selectItemInDataSource(e,t[i].items)):t[i][this._treeViewOptions.keyExpr]===e.data[this._treeViewOptions.keyExpr]?t[i][this._treeViewOptions.selectedExpr]=!0:t[i][this._treeViewOptions.selectedExpr]=!1},e.prototype.update=function(){this._displayed&&(this._$panel.empty(),this._$panel.append(this.getView()))},e.prototype.init=function(){this._$panel.append(this.getView()),this._displayed=!0},e.prototype.getView=function(){var n=this,o=$("<div/>");o.addClass("ranet-searchTreeViewContent"),this._filteredDataSource=this._dataSource;var r=this.getTreeViewContainer(this._filteredDataSource);if(this._isVisibleSearch){var e=$("<div/>");e.addClass("ranet-searchTreeViewContent-searchPanel"),o.append(e);var t=new a.Editors.TextBoxControlOptions;t.icon=a.Editors.IconTextBox.Search,t.onTextChanged=function(e,t){r.remove();var i=t;n._treeView.selectedText=i,n._filteredDataSource=s.SearchTreeFilter.filter(n._dataSource,i,n._treeViewOptions.displayExpr,n._treeViewOptions.expandedExpr),r=n.getTreeViewContainer(n._filteredDataSource),o.append(r)};var i=new a.Editors.TextBoxControl(t);e.append(i.view())}return o.append(r),o},e.prototype.getTreeViewContainer=function(e){return this._treeView.dataSource=e,this._$container},e}(),s.SearchTreeViewContent=t}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(){function e(e,t){this._sparkLine=i.SpartLineFactory.getSparkLine(e,t)}return e.prototype.draw=function(){this._sparkLine.draw()},e}(),i.SparkLine=n}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(){function e(){}return e.getDataFromString=function(e){return e.split?e.split(" | ").map(function(e){return""===e?0:parseFloat(e)||0}):[]},e}(),i.SpartLineDataHelper=n}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(){function e(){}return e.getSparkLine=function(e,t){switch(t.type){case i.SparkLineType.Bar:return new i.BarSparkLine(e,t);case i.SparkLineType.Line:return new i.LineSparkLine(e,t);case i.SparkLineType.Area:return new i.AreaSparkLine(e,t);case i.SparkLineType.WinLoss:return new i.WinlossSparkLine(e,t)}return null},e}(),i.SpartLineFactory=n}(Ranet||(Ranet={})),function(o){o.ranetSparklines=function(e,t){var i,n={dataSource:[],type:Ranet.Controls.Extensions.SparkLineType.Bar,showMinMax:!1,maxColor:"#9868B9",minColor:"#439BE0",baseColor:"silver",firstColor:"#F7C472",lastColor:"#F7C472",winlossThreshold:15e3,tooltip:{enabled:!0,container:".dynamicPivotGrid"}};i=o.extend({},n,t),new Ranet.Controls.Extensions.SparkLine(e,i).draw()},o.fn.ranetSparklines=function(t){return this.each(function(){if(null==o(this).data("ranetSparklines")){var e=new o.ranetSparklines(this,t);o(this).data("ranetSparklines",e)}})}}(jQuery),function(e){var t,i,n;n=e.Controls||(e.Controls={}),t=n.Extensions||(n.Extensions={}),(i=t.SparkLineType||(t.SparkLineType={}))[i.Bar=0]="Bar",i[i.Line=1]="Line",i[i.Area=2]="Area",i[i.WinLoss=3]="WinLoss",t.SparkLineType}(Ranet||(Ranet={})),function(o){var e,t,i;e=o.Controls||(o.Controls={}),t=e.Extensions||(e.Extensions={}),i=function(){function e(e,t){var i=this;this._htmlElement=e,this._element=d3.select(e),this._width=e.clientWidth,this._height=e.clientHeight,this._id=o.Utility.Guid.newGuid(),this._data=t.dataSource,this._enableTooltips=!!t.tooltip&&t.tooltip.enabled,this._enableTooltips&&(this._tooltipContainer=t.tooltip.container||"body"),this._showMinMax=t.showMinMax,this._colors={base:t.baseColor||"#EEEEEE",firstItem:t.firstColor||t.baseColor||"#EEEEEE",lastItem:t.lastColor||t.baseColor||"#EEEEEE",maxItem:t.maxColor||t.baseColor||"#EEEEEE",minItem:t.minColor||t.baseColor||"#EEEEEE"};var n=e.clientWidth;this._xScale=d3.scale.linear(),this._xScale.range([3,n-3]),this._xScale.domain([-.5,this._data.length+.5]),this._element.append("div").classed("popOvers",!0),this._htmlElement.id=this._id,this._enableTooltips&&$(this._htmlElement).popover({container:this._tooltipContainer,trigger:"hover",content:function(){return"<ul class='list-unstyled'><li>Maximum: "+Math.floor(d3.max(i._data))+"</li><li>Mimimum: "+Math.floor(d3.min(i._data))+"</li><li>Average: "+Math.floor(d3.sum(i._data)/i._data.length)+"</li></ul>"},html:!0,placement:"auto top",template:'<div class="popover chartPopover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'})}return e.prototype.draw=function(){console.error("This class is abstract")},e}(),t.BaseSparkLine=i}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(o){function e(e,t){o.call(this,e,t),this._yScale=d3.scale.linear(),this._yScale.range([5,this._height-3]);var i=d3.max(this._data),n=d3.min(this._data);n=n<0?n:0,this._xScale.domain([0,this._data.length-1]),this._xScale.range([5,this._width-5]),this._yScale.domain([i,n])}return __extends(e,o),e.prototype.draw=function(){var i=this,e=d3.svg.area().x(function(e,t){return i._xScale(t)}).y0(this._yScale(0)).y1(function(e,t){return i._yScale(i._data[t])});this._element.append("svg").attr("height",this._height).attr("width",this._width).attr("class","area").append("path").datum(this._data).attr("d",e).attr("stroke",this._colors.base).attr("fill",this._colors.base).attr("stroke-width","2"),this._element.select("svg").append("g").attr("class","point").selectAll("point").data(this._data).enter().append("circle").attr("cx",function(e,t){return i._xScale(t)}).attr("cy",function(e){return i._yScale(e)}).attr("r",2.5).attr("fill",function(e,t){return e===d3.max(i._data)&&i._showMinMax?i._colors.maxItem:e===d3.min(i._data)&&i._showMinMax?i._colors.minItem:0===t?i._colors.firstItem:t===i._data.length-1?i._colors.lastItem:i._colors.base})},e}(i.BaseSparkLine),i.AreaSparkLine=n}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(o){function e(e,t){o.call(this,e,t),this._yScale=d3.scale.linear(),this._yScale.range([3,this._height-6]);var i=d3.max(this._data),n=d3.min(this._data);n=n<0?n:0,this._yScale.domain([n,i])}return __extends(e,o),e.prototype.draw=function(){var i=this,e=10;e=1<=(e=this._width/(this._data.length+1)-3)?e:1,this._element.append("svg").attr("height",this._height).attr("width",this._width).selectAll("rect").data(this._data).enter().append("rect").attr("x",function(e,t){return i._xScale(t)}).attr("y",function(e){return i._height-3-i._yScale(e)}).attr("height",function(e){return i._yScale(e)}).attr("width",e).attr("fill",function(e,t){return e===d3.max(i._data)&&i._showMinMax?i._colors.maxItem:e===d3.min(i._data)&&i._showMinMax?i._colors.minItem:0===t?i._colors.firstItem:t===i._data.length-1?i._colors.lastItem:i._colors.base})},e}(i.BaseSparkLine),i.BarSparkLine=n}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(o){function e(e,t){o.call(this,e,t),this._yScale=d3.scale.linear(),this._yScale.range([5,this._height-3]);var i=d3.max(this._data),n=d3.min(this._data);this._xScale.domain([0,this._data.length-1]),this._xScale.range([5,this._width-5]),this._yScale.domain([i,n])}return __extends(e,o),e.prototype.draw=function(){var i=this,e=d3.svg.line().x(function(e,t){return i._xScale(t)}).y(function(e,t){return i._yScale(i._data[t])});this._element.append("svg").attr("height",this._height).attr("width",this._width).attr("class","line").append("path").datum(this._data).attr("d",e).attr("stroke",this._colors.base).attr("fill","none").attr("stroke-width","2"),this._element.select("svg").append("g").attr("class","point").selectAll("point").data(this._data).enter().append("circle").attr("cx",function(e,t){return i._xScale(t)}).attr("cy",function(e){return i._yScale(e)}).attr("r",1.75).attr("fill",function(e,t){return e===d3.max(i._data)&&i._showMinMax?i._colors.maxItem:e===d3.min(i._data)&&i._showMinMax?i._colors.minItem:0===t?i._colors.firstItem:t===i._data.length-1?i._colors.lastItem:i._colors.base})},e}(i.BaseSparkLine),i.LineSparkLine=n}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(o){function e(e,t){o.call(this,e,t),this._yScale=d3.scale.linear(),this._yScale.range([3,this._height-6]);var i=d3.max(this._data),n=d3.min(this._data);n=n<0?n:0,this._yScale.domain([n,i])}return __extends(e,o),e.prototype.draw=function(){var i=this,e=10;e=1<=(e=this._width/(this._data.length+1)-3)?e:1,this._element.append("svg").attr("height",this._height).attr("width",this._width).selectAll("rect").data(this._data).enter().append("rect").attr("x",function(e,t){return i._xScale(t)}).attr("y",function(e){return e>=i._winlossThreshold?i._height-3-(i._height/2-3):i._height-3+(i._height/2-3)}).attr("height",function(){return i._height/2-3}).attr("width",e).attr("fill",function(e,t){return e===d3.max(i._data)?i._colors.maxItem:e===d3.min(i._data)?i._colors.minItem:0===t?i._colors.firstItem:t===i._data.length-1?i._colors.lastItem:i._colors.base})},e}(i.BaseSparkLine),i.WinlossSparkLine=n}(Ranet||(Ranet={})),function(e){var t,o,i;t=e.Controls||(e.Controls={}),o=t.Editors||(t.Editors={}),i=function(){function e(e){this._options=e;var t=this;this.createView(),0===this.text.length&&this._$removeTextButtonContainer.hide(),this._$input.on("input",function(){t.onTextChanged()}),this._$input.on("keypress",function(e){t.onKeyPressed(e)}),this._$clearTextButton.on("click",function(){t.text="",t.setFocus()})}return Object.defineProperty(e.prototype,"text",{get:function(){return this._$input.val()},set:function(e){this._$input.val(e),this.onTextChanged()},enumerable:!0,configurable:!0}),e.prototype.setFocus=function(){this._$input.focus()},e.prototype.onKeyPressed=function(e){this._options.onKeyPressed&&this._options.onKeyPressed(this,e)},e.prototype.onTextChanged=function(){0===this.text.length?this._$removeTextButtonContainer.hide():this._$removeTextButtonContainer.show(),this._options.onTextChanged&&this._options.onTextChanged(this,this._$input.val())},e.prototype.createView=function(){var e=$("<div/>");e.addClass("textBoxControl");var t=$("<input/>");switch(t.addClass("textBoxControl-inputElement"),this._options.icon){case o.IconTextBox.Search:t.addClass("textBoxControl-inputElementWithIcon"),t.addClass("textBoxControl-searchIcon");break;case o.IconTextBox.None:break;default:throw new Error("NotImplementedException")}var i=$('<i class="fa fa-times-circle" aria-hidden="true"></i>'),n=$("<div class='textBoxControl-removeTextButtonContainer'/>");n.append(i),e.append(t),e.append(n),this._$view=e,this._$input=t,this._$removeTextButtonContainer=n,this._$clearTextButton=i},e.prototype.view=function(){return this._$view},e}(),o.TextBoxControl=i}(Ranet||(Ranet={})),function(e){var t;(function(e){var t,i=function(){this.icon=n.None};e.TextBoxControlOptions=i,(t=e.IconTextBox||(e.IconTextBox={}))[t.None=0]="None",t[t.Search=1]="Search";var n=e.IconTextBox})((t=e.Controls||(e.Controls={})).Editors||(t.Editors={}))}(Ranet||(Ranet={})),function(o){var e,t;e=o.Controls||(o.Controls={}),t=function(){function e(e,t,i,n){this._startIndex=t,this._onLoadedNewItems=n,this._getPromiseLoadNeighbors=i,this.dataItem=e}return Object.defineProperty(e.prototype,"parents",{get:function(){throw new Error("NotImplementedException")},set:function(e){throw new Error("NotImplementedException")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){throw new Error("NotImplementedException")},set:function(e){throw new Error("NotImplementedException")},enumerable:!0,configurable:!0}),e.prototype.hide=function(){this._$viewTreeViewItem.remove()},e.prototype.goToStartState=function(){var n=this;this._$headerContent.empty();var e=$("<span>"+o.Localization.localize("MemberChoice_LoadNext")+"</span>"),t=$('<button type="button" class="btn btn-default btn-xs" style="font-size: 11px;"></button>');t.append(e),t.click(function(){n._$headerContent.empty();var e=$('<button type="button" class="btn btn-default btn-xs disabled" style="font-size: 11px;"></button>'),t=$('<i class="fa fa-spinner fa-spin"></i>'),i=$("<span style='margin-left:3px;'>"+o.Localization.localize("Loading")+"</span>");e.append(t),e.append(i),n._$headerContent.append(e),n.loadNewItems()}),this._$headerContent.append(t)},e.prototype.loadNewItems=function(){var t=this;this._getPromiseLoadNeighbors(this.dataItem,this._startIndex).done(function(e){t.hide(),t._onLoadedNewItems(t,e)}).fail(function(e){o.LogService.error(e),t.goToStartState()})},e.prototype.render=function(e){var t=e.find("tr").last().find("td").length,i=$("<tr/>");this._$viewTreeViewItem=i;var n=$("<td/>");this._$headerContent=n,this.goToStartState();for(var o=0;o<t-1;o++)i.append("<td/>");i.append(n),e.append(i)},e}(),e.LoadNextTreeViewItem=t}(Ranet||(Ranet={})),function(r){r.ranetTreeView=function(e,t){var i,n=this,o={};this.settings={},this.init=function(){n.settings=r.extend({},o,t),i=new Ranet.Controls.TreeView(e,t)},this.option=function(e){e.hasOwnProperty("dataSource")&&(i.dataSource=e.dataSource)},this.init()},r.fn.ranetTreeView=function(t){return this.each(function(){if(null==r(this).data("ranetTreeView")){var e=new r.ranetTreeView(this,t);r(this).data("ranetTreeView",e)}})}}(jQuery),function(e){var t=function(){function e(){}return e.showServerError=function(e){e.responseText?alert(e.responseText):alert("Please check your connection.")},e.showError=function(e){alert(e)},e.showInfo=function(e){alert(e)},e}();e.UserMessageService=t}(Ranet||(Ranet={})),function(e){var t=function(){function e(){}return e.track=function(e,t){try{mixpanel&&(t?mixpanel.track(e,t):mixpanel.track(e))}catch(e){}},e}();e.UserActionsTracker=t}(Ranet||(Ranet={})),function(e){var t,i;t=e.Utility||(e.Utility={}),i=function(){function n(){}return n.removeItem=function(e,t){for(var i=e.length;i--;)n.equals(e[i],t)&&e.splice(i,1)},n.FindByFunc=function(e,t,i){if(e)for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return null},n.equals=function(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var i in e)if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i))return!1;if(e[i]!==t[i]){if("object"!=typeof e[i])return!1;if(!n.equals(e[i],t[i]))return!1}}for(i in t)if(t.hasOwnProperty(i)&&!e.hasOwnProperty(i))return!1;return!0},n}(),t.ArrayUtility=i}(Ranet||(Ranet={})),function(n){!function(e){var t=function(){function e(){}return e.getColors=function(){var e=new Array;return e.push(new i(n.Localization.localize("Color_Primary"),"#FF9868B9")),e.push(new i(n.Localization.localize("Color_Secondary"),"#FF439BE0")),e.push(new i(n.Localization.localize("Color_Active"),"#FFF7C472")),e.push(new i(n.Localization.localize("Color_Neutral"),"#FF9EA8B8")),e.push(new i(n.Localization.localize("Color_Red"),"#FFFF0000")),e.push(new i(n.Localization.localize("Color_Green"),"#FF00FF21")),e.push(new i(n.Localization.localize("Color_White"),"#FFFFFFFF")),e.push(new i(n.Localization.localize("Color_DarkGray"),"#FFA9A9A9")),e.push(new i(n.Localization.localize("Color_Black"),"#FF000000")),e.push(new i(n.Localization.localize("Color_Blue"),"#FF0026FF")),e.push(new i(n.Localization.localize("Color_Brown"),"#FFA52A2A")),e.push(new i(n.Localization.localize("Color_Cyan"),"#FF00FFFF")),e.push(new i(n.Localization.localize("Color_Gray"),"#FF808080")),e.push(new i(n.Localization.localize("Color_Magenta"),"#FFFF00FF")),e.push(new i(n.Localization.localize("Color_Orange"),"#FFFFA500")),e.push(new i(n.Localization.localize("Color_Purple"),"#FF800080")),e.push(new i(n.Localization.localize("Color_Yellow"),"#FFFFFF00")),e.push(new i(n.Localization.localize("Color_LightBlue"),"#FFADD8E6")),e.push(new i(n.Localization.localize("Color_LightCyan"),"#FFE0FFFF")),e.push(new i(n.Localization.localize("Color_LightGoldenRodYellow"),"#FFFAFAD2")),e.push(new i(n.Localization.localize("Color_LightGrey"),"#FFD3D3D3")),e.push(new i(n.Localization.localize("Color_LightGreen"),"#FF90EE90")),e.push(new i(n.Localization.localize("Color_LightPink"),"#FFFFB6C1")),e.push(new i(n.Localization.localize("Color_LightSalmon"),"#FFFFA07A")),e.push(new i(n.Localization.localize("Color_LightSeaGreen"),"#FF20B2AA")),e.push(new i(n.Localization.localize("Color_LightSkyBlue"),"#FF87CEFA")),e.push(new i(n.Localization.localize("Color_LightSlateGray"),"#FF778899")),e.push(new i(n.Localization.localize("Color_LightSteelBlue"),"#FFB0C4DE")),e.push(new i(n.Localization.localize("Color_LightYellow"),"#FFFFFFE0")),e},e.argbToHexWithoutOpacity=function(e){var t=function(e){var t=parseInt(e);return 2===t.toString(16).length?t.toString(16):"0"+t.toString(16)};if(e.match(/^\#[\dA-F]{6}|\#[\dA-F]{3}$/g))return e;var i=/rgba\(([\d]*),([\d]*),([\d]*),.*\)/g.exec(e);return"#"+t(i[1])+t(i[2])+t(i[3])},e.argbToArgbObject=function(e){var t=/rgba\(([\d]*),([\d]*),([\d]*),([\d.]*)\)/g.exec(e);return{a:Math.ceil(255*parseFloat(t[4])),r:t[1],g:t[2],b:t[3]}},e}();e.ColorHelper=t;var i=function(){function e(e,t){this._caption=e,this._hex=t;var i=this.hexToArgb(this._hex);this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._argb="rgba("+i.r+","+i.g+","+i.b+","+i.a+")"}return Object.defineProperty(e.prototype,"r",{get:function(){return this._r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this._b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a",{get:function(){return this._a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"caption",{get:function(){return this._caption},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hex",{get:function(){return this._hex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"argbText",{get:function(){return this._argb},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webHex",{get:function(){var e=2===this._r.toString(16).length?this._r.toString(16):"0"+this._r.toString(16),t=2===this._g.toString(16).length?this._g.toString(16):"0"+this._g.toString(16),i=2===this._b.toString(16).length?this._b.toString(16):"0"+this._b.toString(16);return"#"+e.toUpperCase()+t.toUpperCase()+i.toUpperCase()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webArgb",{get:function(){return"rgba("+this._r+","+this._g+","+this._b+","+parseFloat((this._a/255).toFixed(1))+")"},enumerable:!0,configurable:!0}),e.prototype.hexToArgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{a:parseInt(t[1],16),r:parseInt(t[2],16),g:parseInt(t[3],16),b:parseInt(t[4],16)}:null},e}();e.Color=i}(n.Utility||(n.Utility={}))}(Ranet||(Ranet={})),function(e){!function(e){var t=function(){function e(){this._debouncerId=null}return e.debounce=function(e,t){clearTimeout(window.debouncerId),window.debouncerId=setTimeout(e(),t)},e}();e.Debouncer=t;var i=function(){function e(){}return e.addEventHandler=function(e,t,i){null!=e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)},e.removeEventHandler=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1),e.detachEvent&&e.detachEvent("on"+t,i)},e}();e.EventHandlers=i}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={})),function(e){!function(e){var t,i=function(){function e(){}return e.getDataItem=function(e,t,i,n){var o=t.filter;if(e===a.CalculatedMember){if(n&&n.calculatedMembers){var r=this.getDescriptionFromMetadata(n.calculatedMembers,t,e);if(o&&(r.filter=o),r)return r}return t}if(e===a.CalculatedNamedSet){if(n&&n.calculatedNamedSets){r=this.getDescriptionFromMetadata(n.calculatedNamedSets,t,e);if(o&&(r.filter=o),r)return r}return t}if(i&&i.treeMetadata){r=this.getDescriptionFromMetadata(i.treeMetadata,t,e);if(o&&(r.filter=o),r)return r}return t},e.getLevelItem=function(e){return{type:"level",uniqueName:e.uniqueName,icon:"li0",caption:e.caption,parentHierarchyId:e.parentHierarchyId}},e.getHierarchyItem=function(e){return{type:"hierarchy",icon:"attributeHierarchy",caption:e.caption,uniqueName:e.uniqueName}},e.getDimensionItem=function(e){return{type:"dimension",caption:e.caption,uniqueName:e.uniqueName}},e.getNamedSetItem=function(e){return{type:"namedSet",name:e.name,caption:e.caption,icon:"namedSet"}},e.getCalculatedNamedSetItem=function(e){return{caption:e.name,name:e.name,icon:"customNamedSet",isDraggable:!0,type:"calculatedNamedSet"}},e.getCalculatedMember=function(e){return{caption:e.name,name:e.name,icon:"customMeasure",uniqueName:e.name,isDraggable:!0,type:"calculatedMember"}},e.getValuesItem=function(e){return{type:"values"}},e.getDescriptionFromMetadata=function(e,t,i){switch(i){case a.Hierarchy:return this.findItem(e,"hierarchy","uniqueName",t.uniqueName);case a.Dimension:return this.findItem(e,"dimension","uniqueName",t.uniqueName);case a.Level:return this.findItem(e,"level","uniqueName",t.uniqueName);case a.NamedSet:return this.findItem(e,"namedSet","name",t.name);case a.CalculatedNamedSet:return this.getCalculatedNamedSetItem(this.findItem(e,"calculatedNamedSet","name",t.name,!0));case a.Measure:return this.findItem(e,"measure","uniqueName",t.uniqueName);case a.KpiItem:return this.findItem(e,"kpiItem","uniqueName",t.uniqueName);case a.KpiInfo:return this.findItem(e,"kpiInfo","name",t.name);case a.CalculatedMember:return this.getCalculatedMember(this.findItem(e,"calculatedMember","name",t.name,!0));default:return}},e.findItem=function(e,t,i,n,o){void 0===o&&(o=!1);for(var r=0;r<e.length;r++){if(e[r][i]===n&&(e[r].type===t||o))return e[r];if(e[r].items){var a=this.findItem(e[r].items,t,i,n);if(a)return a}}},e}();e.DataItemGenerator=i,(t=e.DataType||(e.DataType={}))[t.Level=0]="Level",t[t.Hierarchy=1]="Hierarchy",t[t.Dimension=2]="Dimension",t[t.NamedSet=3]="NamedSet",t[t.CalculatedNamedSet=4]="CalculatedNamedSet",t[t.Measure=5]="Measure",t[t.KpiInfo=6]="KpiInfo",t[t.KpiItem=7]="KpiItem",t[t.CalculatedMember=8]="CalculatedMember";var a=e.DataType}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={})),function(e){var t,i;t=e.Utility||(e.Utility={}),i=function(){function e(){}return e.newGuid=function(){var i=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==e?t:3&t|8).toString(16)})},e}(),t.Guid=i}(Ranet||(Ranet={})),function(e){!function(e){var o=function(e,t){this.caption=e,this.imageClass=t};e.ImageDescription=o;var t=function(){function n(){}return n.getImages=function(){for(var e=new Array,t=0;t<n._imageClasses.length;t++){var i=n._imageClasses[t];e.push(new o(i.replace("imageLibrary_",""),i))}return e},n._imageClasses=["imageLibrary_status_cylinder_-1","imageLibrary_status_gauge-ascending_0","imageLibrary_status_gauge-ascending_1","imageLibrary_status_gauge-ascending_-1","imageLibrary_status_gauge-descending_0","imageLibrary_status_gauge-descending_1","imageLibrary_status_gauge-descending_-1","imageLibrary_status_roadsigns_0","imageLibrary_status_roadsigns_1","imageLibrary_status_roadsigns_-1","imageLibrary_status_shapes_0","imageLibrary_status_shapes_1","imageLibrary_status_shapes_-1","imageLibrary_status_thermometer_0","imageLibrary_status_thermometer_1","imageLibrary_status_thermometer_-1","imageLibrary_status_trafficlight_0","imageLibrary_status_trafficlight_1","imageLibrary_status_trafficlight_-1","imageLibrary_status_variancearrow_0","imageLibrary_status_variancearrow_-1","imageLibrary_status_variancearrow_1","imageLibrary_status_cube_0","imageLibrary_status_cube_-1","imageLibrary_status_cube_1","imageLibrary_status_cylinder_1","imageLibrary_status_cylinder_0","imageLibrary_trend_standardarrow_0","imageLibrary_trend_standardarrow_1","imageLibrary_trend_standardarrow_-1","imageLibrary_trend_statusarrow-ascending_0","imageLibrary_trend_statusarrow-ascending_1","imageLibrary_trend_statusarrow-ascending_-1","imageLibrary_trend_statusarrow-descending_0","imageLibrary_trend_statusarrow-descending_1","imageLibrary_trend_statusarrow-descending_-1","imageLibrary_trend_arrowcolor_0","imageLibrary_trend_arrowcolor_1","imageLibrary_trend_arrowColor_-1"],n}();e.ImageStorage=t}(e.Utility||(e.Utility={}))}(Ranet||(Ranet={})),function(e){var t,i,n;n=e.Controls||(e.Controls={}),t=n.Extensions||(n.Extensions={}),(i=t.ExtensionTypes||(t.ExtensionTypes={}))[i.Chart=0]="Chart",i[i.VectorMap=1]="VectorMap",i[i.Pie=2]="Pie",t.ExtensionTypes}(Ranet||(Ranet={})),function(a){var e;(function(e){var i=function(){function e(e,t){this._mapData=e,this._countryList=t}return e.prototype.getMapData=function(e,t){var o=this,i=e||this._mapData,n=t||this._countryList;this._cachedMap=i,this._cachedCountryList=$.Deferred();var r=$.Deferred();$.when($.ajax({url:i}),$.ajax({url:n})).done(function(e,t){var i={};jQuery.parseJSON(t[0]).forEach(function(e){i[parseInt(e["country-code"])]=e.name[0]});var n={};jQuery.parseJSON(t[0]).forEach(function(e){n[parseInt(e["country-code"])]=e["alpha-3"]}),o._cachedCountryList.resolve({data:jQuery.parseJSON(t[0])}),r.resolve({countryMap:i,map:jQuery.parseJSON(e[0]),iso:n})}).fail(function(e){a.LogService.error(e),r.reject(e)}),this._promice=r},e.prototype.compareMaps=function(e){return e===this._cachedMap},Object.defineProperty(e.prototype,"mapData",{set:function(e){this._mapData=e,this._promice=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"countryList",{set:function(e){this._countryList=e,this._promice=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._promice||this.getMapData(),this._promice},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"countryListDeferred",{get:function(){return this._cachedCountryList||this.getMapData(),this._cachedCountryList},enumerable:!0,configurable:!0}),e}();e.MapRequestHelper=i;var h=function(){function e(e){this._data=e}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),e}();e.MapRawDataCache=h;var t=function(){function e(){}return e.checkValidMapData=function(e){if(console.log(e),!e)return!1;if(!e.rows)return!1;if(!e.rows.hierarchies)return!1;for(var t=e.rows.hierarchies[e.rows.hierarchies.length-1].levelProperties,i=0;i<t.length;i++)if("Country"===t[i].name||"State-Province"===t[i].name)return!0;return!1},e.getRequest=function(){return this.mapData=a.PathManager.mapPath+"world-50m.txt",this.countryList=a.PathManager.mapPath+"countryList.txt",this.requestHelper?this.requestHelper.compareMaps(this.mapData)||(this.requestHelper.mapData=this.mapData):this.requestHelper=new i(this.mapData,this.countryList),this.requestHelper.data},e.parseData=function(e,t){this.dataCache?this.dataCache.data=e:this.dataCache=new h(e);for(var i=[],n=e.cells.values,o=e.cells.displayValues,r=0;r<e.rows.positions.length;r++){var a,s={},l="";for(a=0;a<e.rows.positions[r].positions.length-1;a++)""!==l&&(l+=", "),l+=e.rows.members[e.rows.positions[r].positions[a].id].caption;if(l===t){s.row=e.rows.members[e.rows.positions[r].positions[a].id].caption;for(var c=0;c<e.columns.positions.length;c++){var u=n[r][c],p=o[r][c];null!==u&&(s["column"+c]=u,s["displayValue"+c]=p)}i.push(s)}}return i},e.parseDataForMap=function(e,s,t){var l=this.parseData(e,t),c=$.Deferred(),u={};return this.requestHelper||(this.requestHelper=new i(this.mapData,this.countryList)),this.requestHelper.countryListDeferred.done(function(e){for(var t=e.data,i=0;i<l.length;i++)for(var n=0;n<t.length;n++)if(0<=t[n].name.indexOf(l[i].row)){var o=t[n]["alpha-3"],r=l[i]["column"+s],a=l[i]["displayValue"+s];u[o]={value:r,displayValue:a}}c.resolve({data:u})}),c},e.getDetailedMapData=function(e){var t=$.Deferred();return $.ajax(a.PathManager.mapPath+e+".txt").done(function(e){t.resolve({data:e})}),t},e.parseDataForDetailedMap=function(e,t,i,n){for(var o={},r=this.parseData(e,i),a=0;a<r.length;a++){var s=r[a]["column"+t],l=r[a]["displayValue"+t];"FRA"===n&&(r[a].row=r[a].row.replace(/\ /g,"-"));var c=iso3166.subdivision(n,r[a].row);c&&(o[c.code]={value:s,displayValue:l})}return o},e.generateColumnList=function(e){var t=[];if(!e.columns)return t;for(var i=0;i<e.columns.positions.length;i++){for(var n="",o=e.columns.positions[i],r=0;r<o.positions.length;r++){var a=o.positions[r].id;n+=e.columns.members[a].caption+", "}""!==(n=n.substr(0,n.length-2))&&t.push(n)}return t},e.generateRowList=function(e){var t=[];if(!e.rows)return t;for(var i=0;i<e.rows.positions.length;i++){for(var n="",o=e.rows.positions[i],r=0;r<o.positions.length-1;r++){var a=o.positions[r].id;n+=e.rows.members[a].caption+", "}n=n.substr(0,n.length-2),t.indexOf(n)<0&&""!==n&&t.push(n)}return t},e.generateGroups=function(e,t){t||(t=5);var i=[];for(var n in e)e.hasOwnProperty(n)&&i.push(e[n].value);for(var o=d3.max(i)-1,r=d3.min(i)+1,a=(o-r)/(t-2),s=[],l=0;l<t-1;l++)s[l]=Math.floor(r+a*l);return s},e.currentRow=function(e){return 0},e.calculateRowIndex=function(e,t,i){if(t&&iso3166.country(t)){var n;n=""!==e?e+", "+iso3166.country(t).name:iso3166.country(t).name;for(var o=0;o<i.rows.positions.length;o++){for(var r="",a=i.rows.positions[o],s=0;s<a.positions.length;s++){var l=a.positions[s].id;r+=i.rows.members[l].caption+", "}if((r=r.substr(0,r.length-2))===n)return o}}return-1},e.currentColumn=function(){return 0},e.createActionHeaderDescription=function(e,t,i){var n={actionType:"drillDown",place:"rows",ancestors:[]},o=this.calculateRowIndex(i,e,t),r=t.rows.positions[o];if(r){n.data=t.rows.members[r.positions[r.positions.length-1].id],n.hierarchy=t.rows.hierarchies[r.positions.length-1],n.neighborsHierarchy=[];for(var a=0;a<r.positions.length-1;a++){n.neighborsHierarchy[a]={},n.neighborsHierarchy[a].data=t.rows.members[r.positions[a].id],n.neighborsHierarchy[a].hierarchy=t.rows.hierarchies[a];var s=r.positions[a].parentId;n.neighborsHierarchy[a].ancestors=[];for(var l=0;-1!==s;){var c=t.rows.members[s];n.neighborsHierarchy[a].ancestors[l]=c.uniqueName,s=this.getRowParentId(s,t,a).parentId,l++}}}return n},e.getCountryCode=function(n){this.mapData=a.PathManager.mapPath+"world-50m.txt",this.countryList=a.PathManager.mapPath+"countryList.txt",this.requestHelper||(this.requestHelper=new i(this.mapData,this.countryList));var e=this.requestHelper.countryListDeferred,o=$.Deferred();return e.done(function(e){for(var t=0;t<e.data.length;t++)for(var i=0;i<e.data[t].name.length;i++)e.data[t].name[i]===n&&o.resolve({iso:e.data[t]["alpha-3"]});o.resolve({iso:null})}),o},e.getRowParentId=function(e,t,i){for(var n=0;n<t.rows.positions.length;n++)if(t.rows.positions[n].positions[i].id===e)return t.rows.positions[n].positions[i];return null},e.mapData=a.PathManager.mapPath+"world-50m.txt",e.countryList=a.PathManager.mapPath+"countryList.txt",e}();e.MapDataHelper=t;var n=function(){function e(){}return e.generateMapPalette=function(e){for(var t=[],i=d3.rgb(a.Utility.ColorHelper.argbToHexWithoutOpacity(e)),n=0;n<5;n++)t.push(i.darker(n).toString());return t},e}();e.MapColorHelper=n})((e=a.Controls||(a.Controls={})).Extensions||(e.Extensions={}))}(Ranet||(Ranet={})),function(e){var t,i,n;n=e.Controls||(e.Controls={}),t=n.Extensions||(n.Extensions={}),(i=t.Position||(t.Position={}))[i.Top=0]="Top",i[i.Bottom=1]="Bottom",i[i.Left=2]="Left",i[i.Right=3]="Right",t.Position}(Ranet||(Ranet={})),function(e){var t,i,n;t=e.Controls||(e.Controls={}),i=t.Extensions||(t.Extensions={}),n=function(){function e(e){this._palette=e.palette,this._element=e.element,this._groups=e.groups,this._groups.push(1/0),this._position=e.position,this._visible=e.visible,this._position===i.Position.Top||this._position===i.Position.Left?this._content=d3.select(this._element).insert("div","svg").attr("class","mapLegend"):this._content=d3.select(this._element).insert("div",".popOvers").attr("class","mapLegend"),this._position!==i.Position.Right&&this._position!==i.Position.Left||this._content.attr("class","mapLegend sideLegend"),!1===this._visible?this._content.style("display","none"):this._content.style("display","")}return e.prototype.draw=function(){var n=this;this._visible&&this._content.selectAll("items").data(this._groups).enter().append("xhtml:span").html(function(e,t){var i="<span style='color:"+(n._palette[t]||"black")+";font-size:18px;'>&#9632;</span>&nbsp;";return 0===t?i+="<&nbsp;"+e:t===n._groups.length-1?i+=">&nbsp;"+n._groups[t-1]:i+="от "+n._groups[t-1]+" до "+n._groups[t],i}).attr("class","legendItem")},Object.defineProperty(e.prototype,"palette",{set:function(e){var i=this;this._palette=e,this._content.selectAll("span > span").style("color",function(e,t){return i._palette[t]||"black"})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groups",{set:function(e){var n=this;this._content.selectAll("span").remove(),this._groups=e,this._groups[this._groups.length-1]!==1/0&&this._groups.push(1/0),this._content.selectAll("items").data(this._groups).enter().append("xhtml:span").html(function(e,t){var i="<span style='color:"+(n._palette[t]||"black")+";font-size:18px;'>&#9632;</span>&nbsp;";return 0===t?i+="<&nbsp;"+e:t===n._groups.length-1?i+=">&nbsp;"+n._groups[t-1]:i+="от "+n._groups[t-1]+" до "+n._groups[t],i}).attr("class","legendItem")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._content.remove(),this._position===i.Position.Top||this._position===i.Position.Left?this._content=d3.select(this._element).insert("div","svg").attr("class","mapLegend"):this._content=d3.select(this._element).insert("div",".popOvers").attr("class","mapLegend"),this._position!==i.Position.Right&&this._position!==i.Position.Left||this._content.attr("class","mapLegend sideLegend")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{get:function(){return this._visible},set:function(e){this._visible=e,!1===this._visible?this._content.style("display","none"):this._content.style("display","")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return console.log(parseFloat(this._content.style("height"))),parseFloat(this._content.style("height"))||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return parseFloat(this._content.style("width"))||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return{position:this._position,visibility:this._visible}},enumerable:!0,configurable:!0}),e}(),i.MapLegend=n}(Ranet||(Ranet={})),function(a){var e,t,i;e=a.Controls||(a.Controls={}),t=e.Extensions||(e.Extensions={}),i=function(){function e(e,c,t,i,n){var u=this;this._updateData=n,this._detailedData=i,this._detailedMapSettings=c,this._popover=t,this._element=e,this._drawn=!1;var o=e.getBoundingClientRect(),r=parseInt(d3.select(e).select(".mapLegend").style("width"))+2;this._mapHeight=o.height,this._mapWidth=o.width-r,this._projection=d3.geo.albersUsa().scale(1).translate([0,0]),this._path=d3.geo.path().projection(this._projection),d3.select(this._element).select(".regions").remove(),d3.select(this._element).select(".region-labels").remove(),this._svg=d3.select(e).insert("svg","svg").attr("class","regions").attr("width",this._mapWidth).attr("height",this._mapHeight).attr("display","inline-block"),this._background=this._svg.append("rect").attr("width",this._mapWidth).attr("height",this._mapHeight).attr("class","ranetMapBackground"),d3.json(a.PathManager.mapPath+"USA.txt",function(e,t){if(e)throw e;u._feature=topojson.feature(t,t.objects.USA);var i=u._path.bounds(u._feature),n=.95/Math.max((i[1][0]-i[0][0])/u._mapWidth,(i[1][1]-i[0][1])/u._mapHeight),o=[(u._mapWidth-n*(i[1][0]+i[0][0]))/2,(u._mapHeight-n*(i[1][1]+i[0][1]))/2];if(u._projection.scale(n).translate(o),u._svg.selectAll("path").data(u._feature.features).enter().append("path").attr("d",u._path).attr("fill","gray").attr("fill",function(e){return"region-"+e.properties.HASC_1.replace(".","-")}),c.showRegionNames){for(var r=u._svg.append("g").attr("class","region-labels"),a=u,s=u._feature.features,l=0;l<s.length;l++)s[l].geometry&&(s[l].geometry.coordinates=[u.getLargestBoundingRegion(s[l])],s[l].geometry.type="Polygon");r.selectAll("text").data(s).enter().append("text").attr("x",function(e){var t=u._path.centroid(e.geometry);return t[0]?t[0]:""}).attr("y",function(e){var t=u._path.centroid(e.geometry);return t[1]?t[1]:""}).text(function(e){return e.properties.NAME}).attr("text-anchor","middle").attr("font-size",10).attr("visibility",function(e){return a.checkLabelVisibility(this,e)})}c.tooltip.enabled&&u._svg.selectAll("path").on("mouseover",function(e){if(e.properties.HASC_1){u.showTooltip();var t=c.tooltip.customizeTooltip.call(u,e);u.tooltipContent(t)}else u.hideTooltip()}).on("mouseleave",function(){u.hideTooltip()}),$(u._svg.node()).on("mousemove",function(e){u.updateTooptipPosition(e)}),u.updateDetailedMap(),u._drawn=!0})}return e.prototype.updateDetailedMap=function(){var i=this;this._svg.selectAll("path").style("fill",function(e){var t=i.getDetailedGroup(e.properties.HASC_1);return-1===t?"gray":i._detailedMapSettings.palette[t]||"black"})},e.prototype.checkLabelVisibility=function(e,t){var i,n;return!this._detailedMapSettings.showRegionNames||"Admin-0 country"===t.properties.featurecla||!(i=this._svg.select(".region-"+t.properties.HASC_1.replace(".","-")).node())||(n=i.getBoundingClientRect(),e.getBoundingClientRect().width>n.width)?"hidden":"visible"},e.prototype.getLargestBoundingRegion=function(e){var t;if(null===e.geometry)return[0,0];if("MultiPolygon"===e.geometry.type){for(var i={type:"Feature",geometry:{type:"Polygon",coordinates:e.geometry.coordinates[0]}},n=1;n<e.geometry.coordinates.length;n++){var o={type:"Feature",geometry:{type:"Polygon",coordinates:e.geometry.coordinates[n]}};this._path.area(o)>this._path.area(i)&&(i=o,t=e.geometry.coordinates[n][0])}t||i.geometry.coordinates&&(t=i.geometry.coordinates[0])}else t=e.geometry.coordinates[0];return t},e.prototype.getDetailedGroup=function(e){if(!e)return-1;if(e=e.replace(".","-"),!this._detailedData[e])return-1;var t=this._detailedData[e].value;if(t<this._detailedMapSettings.groups[0])return 0;for(var i=0;i<this._detailedMapSettings.groups.length-1;i++)if(t>=this._detailedMapSettings.groups[i]&&t<this._detailedMapSettings.groups[i+1])return i+1;return t>=this._detailedMapSettings.groups[this._detailedMapSettings.groups.length-1]?this._detailedMapSettings.groups.length:-1},e.prototype.showTooltip=function(){$(this._popover).data("bs.popover").tip().hasClass("in")||$(this._svg.node().parentNode).find("svg.ranetMapContent").popover("show")},e.prototype.hideTooltip=function(){$(this._svg.node().parentNode).find("svg.ranetMapContent").popover("hide")},e.prototype.updateTooptipPosition=function(e){var t=$(this._popover).data("bs.popover");$(e.target)[0]!==$(this._background)[0][0]?t.$tip&&t.$tip.addClass(t.options.placement).attr("style","top: "+(e.pageY-t.$tip.height()-15)+"px; left: "+(e.pageX-t.$tip.width()/2)+"px; display: block;"):this.hideTooltip()},e.prototype.tooltipContent=function(e){var t=d3.event,i=$(this._popover).attr("data-content",e).data("bs.popover");i.setContent(),i.$tip.addClass(i.options.placement).attr("style","top: "+(t.pageY-i.$tip.height()-15)+"px; left: "+(t.pageX-i.$tip.width()/2)+"px; display: block;")},e.prototype.resize=function(){if(this._drawn){var e=this._element.getBoundingClientRect(),t=parseInt(d3.select(this._element).select(".mapLegend").style("width"))+4;this._mapHeight=e.height,this._mapWidth=e.width-t,this._projection.scale(1).translate([0,0]);var i=this._path.bounds(this._feature),n=.95/Math.max((i[1][0]-i[0][0])/this._mapWidth,(i[1][1]-i[0][1])/this._mapHeight),o=[(this._mapWidth-n*(i[1][0]+i[0][0]))/2,(this._mapHeight-n*(i[1][1]+i[0][1]))/2];this._projection.scale(n).translate(o),this._svg.attr("width",this._mapWidth).attr("height",this._mapHeight).selectAll("path").attr("d",this._path)}},Object.defineProperty(e.prototype,"data",{set:function(e){this._detailedData=e,this.updateDetailedMap()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"svg",{get:function(){return this._svg},enumerable:!0,configurable:!0}),e.prototype.delete=function(){this._svg.remove()},e}(),t.UsaDetailedMap=i}(Ranet||(Ranet={})),function(e){var t,a,i;t=e.Controls||(e.Controls={}),a=t.Extensions||(t.Extensions={}),i=function(){function e(e,t){var n=this,i=e.getBoundingClientRect();e.setAttribute("class","mapContainer disableSelection"),this._prevMapWidth=-1,this._updateData=t.updateData,this._element=e,this._palette=[["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"]],this._paletteId=3,t.customPalette&&(this._useCustomPalette=!0,this._customPalette=t.customPalette),this._presetDetailedRegion=t.presetDetailedRegion||"",this._data=t.data,this._groups=t.groups||a.MapDataHelper.generateGroups(this._data,5),t.bounds.minLon?this._bounds=t.bounds:this._bounds={minLon:-180,maxLat:85,maxLon:180,minLat:-60},this._mapHeight=i.height,this._mapHeight<0&&(this._mapHeight=0),this._mapWidth=i.width,this._showCountryLabels=void 0===t.showCountryLabels||t.showCountryLabels,this._maxScale=t.maxScale||3200,this._minScale=t.minScale||900,this._tooltipOptions=t.tooltip||{enabled:!0},this._customizeTooltip=this._tooltipOptions.customizeTooltip||function(e){var t,i=n._data[e.properties.ADM0_A3];return t=i&&i.displayValue||"N/A",(e.properties.NAME||"Disput territory")+" "+t},this._previousScale=this._minScale,this._detailedMapSettings=t.detailedMapSettings;var o=t.legend.position||a.Position.Right,r=this._palette[this._paletteId];this._detailedMapSettings.groups||(this._detailedMapSettings.groups=this._groups),this._detailedMapSettings.palette||(this._detailedMapSettings.palette=r),this._detailedMapSettings.tooltip?this._detailedMapSettings.tooltip.customizeTooltip||(this._detailedMapSettings.tooltip.customizeTooltip=function(e){var t,i=n._detailedData[e.properties.HASC_1.replace(".","-")];return t=i?i.displayValue:"N/A",(e.properties.NAME||"Disput territory")+" "+t}):this._detailedMapSettings.tooltip=this._tooltipOptions,this.createMap(),this._legend=new a.MapLegend({visible:t.legend.visible||!1,palette:r,groups:this._groups,element:this._element,position:o}),this._legend.draw(),this.createZoomButtons(),this.createTranslateButtons(),this.drawMap()}return e.prototype.drawMap=function(){var o=this;a.MapDataHelper.getRequest().done(function(e){o._mapData=e.map,o._countryList=e.countryMap;var i=o;o._group.append("g").attr("class","countries").selectAll("path").data(topojson.feature(o._mapData,o._mapData.objects.ne_10m_admin_0_countries).features).enter().append("path").attr("d",o._path).attr("class",function(e){return"country-"+e.properties.ADM0_A3}).style("fill",function(e){var t=o.getGroup(e.properties.ADM0_A3);return-1===t||o._detailedView?"gray":o._palette[o._paletteId][t]||"black"}).on("dblclick",function(e){o._detailedMapSettings.enable&&o._updateData.call(o,e.properties.ADM0_A3)});for(var t=topojson.feature(o._mapData,o._mapData.objects.ne_10m_admin_0_countries).features,n=0;n<t.length;n++)t[n].geometry&&(t[n].geometry.coordinates=[o.getLargestBoundingRegion(t[n])],t[n].geometry.type="Polygon");o._group.append("g").attr("class","labels").selectAll("text").data(t).enter().append("text").attr("x",function(e){if(e.geometry&&e.geometry.coordinates===[]){var t=i._path.centroid(e.geometry);if(t[0])return t[0]}return""}).attr("y",function(e){if(e.geometry&&e.geometry.coordinates===[]){var t=i._path.centroid(e.geometry);if(t[1])return t[1]+5}return""}).text(function(e){return e.properties.NAME}).attr("text-anchor","middle").attr("font-size",10).attr("visibility",function(e){return i.checkLabelVisibility(this,e)}).on("dblclick",function(e){o._detailedMapSettings.enable&&o._updateData.call(o,e.properties.ADM0_A3)}),o.createTooltip(),o.resize(),o._svg.on("mouseleave",function(){o.hideTooltip()}),o._presetDetailedRegion&&o.drawDetails(o._presetDetailedRegion),console.log("Drawn!")})},e.prototype.updateColors=function(){var i=this;this._group.selectAll(".countries path").style("fill",function(e){var t=i.getGroup(e.properties.ADM0_A3);return-1===t||i._detailedView?"gray":i._useCustomPalette?i._customPalette[t]||"black":i._palette[i._paletteId][t]||"black"})},e.prototype.getGroup=function(e){if(!this._data[e])return-1;var t=this._data[e].value;if(t<this._groups[0])return 0;for(var i=0;i<this._groups.length-1;i++)if(t>=this._groups[i]&&t<this._groups[i+1])return i+1;return t>=this._groups[this._groups.length-1]?this._groups.length:-1},e.prototype.createMap=function(){this._projection=d3.geo.mercator().scale(this._minScale).rotate([0,0,0]).center([0,30]).translate([this._mapWidth/2,this._mapHeight/2]),this._path=d3.geo.path().projection(this._projection),this._zoom=d3.behavior.zoom().translate(this._projection.translate()).scale(this._projection.scale()).scaleExtent([this._minScale,this._maxScale]).on("zoom",function(){if(m._detailedView){var e=m._projection.translate();return m._zoom.translate(e),void m._group.selectAll("text").attr("visibility",function(e){return m.checkLabelVisibility(this,e)}).attr("x",function(e){if(e.geometry&&e.geometry.coordinates!==[]){var t=m._path.centroid(e.geometry);return t[0].toString()}return""}).attr("y",function(e){if(e.geometry&&e.geometry.coordinates!==[]){var t=m._path.centroid(e.geometry);return t[1].toString()}return""})}var t=d3.event,i=t.translate,n=t.scale;m.redrawScalePoint(n);var o=!1,r=1;m._previousScale!==n&&(o=!0,r=n/m._previousScale,m._previousScale=n);var a=m._projection(m._projection.center()),s=m._projection([m._bounds.minLon,m._bounds.maxLat]),l=m._projection([m._bounds.maxLon,m._bounds.minLat]),c=m._projection.translate(),u=Math.abs(s[0]-a[0]),p=Math.abs(l[0]-a[0]),h=Math.abs(s[1]-a[1]),d=Math.abs(l[1]-a[1]);o?(u*r<m._mapWidth/2?i[0]=m._mapWidth/2:(i[0]+p*r<m._mapWidth&&(i[0]=m._mapWidth-p*r),0<i[0]-u*r&&(i[0]=u*r)),h*r<m._mapHeight/2?i[1]=m._mapHeight/2:(i[1]+d*r<m._mapHeight&&(i[1]=m._mapHeight-d*r),0<i[1]-h*r&&(i[1]=h*r))):(0<s[0]&&l[0]<m._mapWidth?i[0]=c[0]:i[0]>c[0]?i[0]=d3.min([i[0],u]):i[0]=d3.max([i[0],m._mapWidth-p]),0<s[1]&&l[1]<m._mapHeight?i[1]=c[1]:i[1]>c[1]?i[1]=d3.min([i[1],h]):i[1]=d3.max([i[1],m._mapHeight-d])),m._zoom.translate(i),m._projection.scale(n).translate(i),m._path=d3.geo.path().projection(m._projection),m._group.selectAll("path").attr("d",m._path),m._group.selectAll("text").attr("x",function(e){var t=m._path.centroid(e.geometry);return t[0]?t[0]:""}).attr("y",function(e){var t=m._path.centroid(e.geometry);return t[1]?t[1]+5:""}).attr("visibility",function(e){return m.checkLabelVisibility(this,e)})});var m=this;this._svg=d3.select(this._element).append("svg").attr("class","ranetMapContent").attr("width",this._mapWidth).attr("height",this._mapHeight).attr("overflow","hidden"),this._group=this._svg.append("g").call(this._zoom).on("dblclick.zoom",null),this._background=this._group.append("rect").attr("width",this._mapWidth).attr("height",this._mapHeight).attr("class","ranetMapBackground"),this._tooltip=d3.select(this._element).append("div").attr("class","popOvers")},e.prototype.createZoomButtons=function(){var l=this;this._zoomButtons=this._svg.append("g").attr("transform","translate(40,100)").attr("class","disableSelection");var e=this._zoomButtons.append("g").attr("class","zoomUp").attr("style","cursor: pointer;").on("click",function(){if(!(Math.floor(l._zoom.scale())>=l._maxScale-5)){var e=2;l._zoom.scale()*e>l._maxScale&&(e=l._maxScale/l._zoom.scale());var t=l._zoom.scale()*e,i=l._mapWidth/2,n=l._mapHeight/2,o=l._projection.translate(),r=i-o[0],a=n-o[1],s=[];s[0]=i-r*e,s[1]=n-a*e,l._svg.on("dblclick.zoom",null).call(l._zoom.translate(s).scale(t).event)}}),t=(e.append("rect").attr("width",22).attr("height",22).attr("x",0).attr("y",0).attr("fill","white").attr("stroke","darkgrey"),e.append("text").attr("x",11).attr("y",16).text("+").attr("text-anchor","middle").attr("fill","#4a9fe2").attr("font-weight","bolder"),this._zoomButtons.append("g").attr("class","zoomDown").attr("style","cursor: pointer;").on("click",function(){if(!(l._zoom.scale()<=l._minScale+5)){var e=.5;l._zoom.scale()*e<l._minScale&&(e=l._minScale/l._zoom.scale());var t=l._zoom.scale()*e,i=l._mapWidth/2,n=l._mapHeight/2,o=l._projection.translate(),r=i-o[0],a=n-o[1],s=[];s[0]=i-r*e,s[1]=n-a*e,l._svg.on("dblclick.zoom",null).call(l._zoom.scale(t).translate(s).event)}})),i=(t.append("rect").attr("width",22).attr("height",22).attr("x",0).attr("y",140).attr("fill","white").attr("stroke","darkgrey"),t.append("text").attr("x",11).attr("y",156).text("-").attr("text-anchor","middle").attr("fill","#4a9fe2").attr("font-weight","bolder"),d3.behavior.drag().on("drag",function(){var e=d3.event,t=d3.scale.linear().range([d._minScale,d._maxScale]).domain([0,100]),i=d3.scale.linear().range([0,100]).domain([d._minScale,d._maxScale]),n=d._zoom.scale(),o=i(n),r=t(o-e.dy);if(!(r>d._maxScale||r<d._minScale)){var a=r/n,s=d._mapWidth/2,l=d._mapHeight/2,c=d._projection.translate(),u=s-c[0],p=l-c[1],h=[];h[0]=s-u*a,h[1]=l-p*a,d._svg.call(d._zoom.scale(r).translate(h).event).on("dblclick.zoom",null)}})),n=this._zoomButtons.append("g").attr("class","zoomScale");n.append("line").attr("x1",11).attr("x2",11).attr("y1",22).attr("y2",140).attr("stroke","#4c4c4c").attr("stroke-width",4),this._zoomScalePoint=n.append("rect").attr("width",20).attr("height",6).attr("x",1).attr("y",128).attr("fill","white").attr("stroke","darkgrey").attr("style","cursor: pointer;").call(i);var d=this},e.prototype.createTooltip=function(){var i=this;if(this._tooltipOptions.enabled){var n=this;this._popover=$(this._svg.node()).popover({container:".mapContainer .popOvers",trigger:"manual",content:function(){return""},html:!0,delay:0,placement:"auto top",template:'<div class="popover chartPopover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),$(this._svg.node()).on("mousemove",function(e){i.updateTooptipPosition(e)}),this._group.selectAll(".countries > path").on("mouseenter",function(){d3.select(this).node()!==d3.select(".countryHovered").node()&&n.toggleCountryHover(this)}).on("mouseover",function(e){n.showTooltip();var t=n._customizeTooltip(e);n.tooltipContent(t)}),this._group.selectAll(".labels > text").on("mouseenter",function(e){i.showTooltip();var t=i._customizeTooltip(e);i.tooltipContent(t)}).on("mouseleave",function(){i.hideTooltip()})}},e.prototype.drawDetails=function(d){var m=this;if(this._group.selectAll(".country-"+this._selectedCountry).style("visibility","visible"),this._group.selectAll(".regions").remove(),this._group.selectAll(".region-labels").remove(),this._returnButton&&this._returnButton.remove(),"USA"===(this._selectedCountry=d))return this._usaDetails=new a.UsaDetailedMap(this._element,this._detailedMapSettings,this._popover,this._data,this._updateData),this.hideTooltip(),this.detailedView(!0),void this._svg.style("display","none");a.MapDataHelper.getDetailedMapData(d).done(function(e){var t=JSON.parse(e.data);"RUS"===d||"FJI"===d?m._projection.rotate()!==[-130,0,0]&&(m._projection.rotate([-130,0,0]),m._path=d3.geo.path().projection(m._projection),m._group.selectAll("path").attr("d",m._path)):m._projection.rotate()!==[0,0,0]&&(m._projection.rotate([0,0,0]),m._path=d3.geo.path().projection(m._projection),m._group.selectAll("path").attr("d",m._path));var i=topojson.feature(t,t.objects[d]);if(m._group.append("g").attr("class","regions").selectAll("path").data(i.features).enter().append("path").attr("class",function(e){return"region-"+e.properties.HASC_1.replace(".","-")}).attr("d",m._path),m._tooltipOptions.enabled&&m._group.selectAll(".regions > path").on("mouseover",function(e){if(e.properties.HASC_1){m.showTooltip();var t=m._detailedMapSettings.tooltip.customizeTooltip.call(m,e);m.tooltipContent(t)}else m.hideTooltip()}).on("mouseleave",function(){m.hideTooltip()}),m._detailedMapSettings.showRegionNames){for(var n=m,o=i.features,r=0;r<o.length;r++)o[r].geometry&&(o[r].geometry.coordinates=[m.getLargestBoundingRegion(o[r])],o[r].geometry.type="Polygon");m._group.append("g").attr("class","region-labels").selectAll("text").data(o).enter().append("text").attr("x",function(e){var t=n._path.centroid(e.geometry);return t[0]?t[0]:""}).attr("y",function(e){var t=n._path.centroid(e.geometry);return t[1]?t[1]:""}).text(function(e){return e.properties.NAME}).attr("text-anchor","middle").attr("font-size",10).attr("visibility",function(e){return"hidden"}),m._tooltipOptions.enabled&&m._group.selectAll(".region-labels > text").on("mouseover",function(e){if(e.properties.HASC_1){m.showTooltip();var t=m._detailedMapSettings.tooltip.customizeTooltip.call(m,e);m.tooltipContent(t)}else m.hideTooltip()}).on("mouseleave",function(){m.hideTooltip()})}m._detailedBounds=m._path.bounds(i);var a=m._detailedBounds,s=a[1][0]-a[0][0],l=a[1][1]-a[0][1],c=(a[0][0]+a[1][0])/2,u=(a[0][1]+a[1][1])/2,p=.9/Math.max(s/m._mapWidth,l/m._mapHeight),h=[m._mapWidth/2-p*c,m._mapHeight/2-p*u];m._group.on(".zoom",null),m._group.transition().duration(750).style("stroke-width",1.5/p+"px").attr("transform","translate("+h+")scale("+p+")").each("end",function(){m._group.selectAll("text").attr("font-size",function(){return 10/p}),m.resize()}),m.updateDetailedMap(),m.detailedView(!0),m._group.selectAll(".country-"+d).style("visibility","hidden")})},e.prototype.resizeDetailedMap=function(){var e=this,t=this._detailedBounds,i=t[1][0]-t[0][0],n=t[1][1]-t[0][1],o=(t[0][0]+t[1][0])/2,r=(t[0][1]+t[1][1])/2,a=.9/Math.max(i/this._mapWidth,n/this._mapHeight),s=[this._mapWidth/2-a*o,this._mapHeight/2-a*r];this._group.on(".zoom",null),this._group.transition().duration(750).style("stroke-width",1.5/a+"px").attr("transform","translate("+s+")scale("+a+")").each("end",function(){e._group.selectAll("text").attr("font-size",function(){return 10/a})})},e.prototype.updateDetailedMap=function(){var i=this;this._group.selectAll(".regions path").style("fill",function(e){var t=i.getDetailedGroup(e.properties.HASC_1);return-1===t?"#c8c8c8":i._detailedMapSettings.palette[t]||"black"})},e.prototype.getDetailedGroup=function(e){if(!e)return-1;if(e=e.replace(".","-"),!this._detailedData[e])return-1;var t=this._detailedData[e].value;if(t<this._detailedMapSettings.groups[0])return 0;for(var i=0;i<this._detailedMapSettings.groups.length-1;i++)if(t>=this._detailedMapSettings.groups[i]&&t<this._detailedMapSettings.groups[i+1])return i+1;return t>=this._detailedMapSettings.groups[this._detailedMapSettings.groups.length-1]?this._detailedMapSettings.groups.length:-1},e.prototype.detailedView=function(e){var t=this;this._detailedView=e,this._detailedView?(this._prevMapWidth=this._mapWidth,this._prevMapHeight=this._mapHeight,this.displayControls(!1)):("USA"===this._selectedCountry&&(this._svg.style("display","inline-block"),this._usaDetails.delete()),this.displayControls(!0),this._group.selectAll(".country-"+this._selectedCountry).style("visibility","visible"),this._group.selectAll(".regions").remove(),this._group.selectAll(".region-labels").remove(),this._selectedCountry=null,this._group.transition().duration(750).style("stroke-width","1.5px").attr("transform","").each("end",function(){t._group.selectAll("text").attr("font-size",10),t._group.call(t._zoom).on("dblclick.zoom",null),t._projection.rotate()!==[0,0,0]&&t._projection.rotate([0,0,0]),t.resize()})),this.updateColors()},e.prototype.closeDetails=function(){this.detailedView(!1)},e.prototype.displayControls=function(e){e?(this._transButtons.style("visibility","visible"),this._zoomButtons.style("visibility","visible")):(this._transButtons.style("visibility","hidden"),this._zoomButtons.style("visibility","hidden"))},e.prototype.createTranslateButtons=function(){var t=this;this._transButtons=this._svg.append("g").attr("transform","translate(20,20)").attr("class","disableSelection");var e=this._transButtons.append("g").attr("class","transUp").attr("style","cursor: pointer;").on("click",function(){var e=t._projection.translate();e[1]=e[1]+40,t._svg.call(t._zoom.translate(e).event).on("dblclick.zoom",null)}),i=(e.append("rect").attr("width",22).attr("height",22).attr("x",20).attr("y",-7).attr("fill","white").attr("stroke","darkgray"),e.append("image").attr("x",14).attr("y",9).attr("height",15).attr("width",15).attr("transform","rotate(90, 33, 14.5)").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU2RjU3NTA4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU2RjU3NEY4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ4ZDJhMjA2LTU2NDQtNzE0OC04OTk1LTViYWJlZDc5OTkyYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70ySKrAAABH0lEQVR42mL4//8/g9f8RwxMDBDwHyCAGEE8INjMAuKBWAABxAhS473gMQNMAKYWBH6CCIAAgukBg60JsnAVJ5C1bANic5gqkIAXELPCBAACCNkWGNAC4qtQMxlZoIIKQHyfAQuAWfoAiEvxKQCBHpCVUFwNEwQIIGxuAAEdIC4EuiGZCYupp4D4MhAngTgsSBIaQHwdlxuOYZNEVmDJgAPAFICs+oFPwV8g5gTiCnzhAAKd0Hj4BRMACDBwOIAAlrBABiAnlAFxHRCzw+IJPRjQATMQlwBxAxBz4DMZ3clFQNyMTxMuA3YAsTsDiQA5kDKA+DglBoCSpBU0tWkC8UlSDUAGN4DYAmqYNhCfITYQsYFrQGyKlMzbgfg1TBIA9UJCXgUGrJkAAAAASUVORK5CYII="),this._transButtons.append("g").attr("class","transLeft").attr("style","cursor: pointer;").on("click",function(){var e=t._projection.translate();e[0]=e[0]+40,t._svg.call(t._zoom.translate(e).event).on("dblclick.zoom",null)})),n=(i.append("rect").attr("width",22).attr("height",22).attr("x",-7).attr("y",20).attr("fill","white").attr("stroke","darkgray"),i.append("image").attr("x",-5).attr("y",23).attr("height",15).attr("width",15).attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU2RjU3NTA4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU2RjU3NEY4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ4ZDJhMjA2LTU2NDQtNzE0OC04OTk1LTViYWJlZDc5OTkyYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70ySKrAAABH0lEQVR42mL4//8/g9f8RwxMDBDwHyCAGEE8INjMAuKBWAABxAhS473gMQNMAKYWBH6CCIAAgukBg60JsnAVJ5C1bANic5gqkIAXELPCBAACCNkWGNAC4qtQMxlZoIIKQHyfAQuAWfoAiEvxKQCBHpCVUFwNEwQIIGxuAAEdIC4EuiGZCYupp4D4MhAngTgsSBIaQHwdlxuOYZNEVmDJgAPAFICs+oFPwV8g5gTiCnzhAAKd0Hj4BRMACDBwOIAAlrBABiAnlAFxHRCzw+IJPRjQATMQlwBxAxBz4DMZ3clFQNyMTxMuA3YAsTsDiQA5kDKA+DglBoCSpBU0tWkC8UlSDUAGN4DYAmqYNhCfITYQsYFrQGyKlMzbgfg1TBIA9UJCXgUGrJkAAAAASUVORK5CYII="),this._transButtons.append("g").attr("class","transRight").attr("style","cursor: pointer;").on("click",function(){var e=t._projection.translate();e[0]=e[0]-40,t._svg.call(t._zoom.translate(e).event).on("dblclick.zoom",null)})),o=(n.append("rect").attr("width",22).attr("height",22).attr("x",47).attr("y",20).attr("fill","white").attr("stroke","darkgray"),n.append("image").attr("x",46).attr("y",21).attr("height",15).attr("width",15).attr("transform","rotate(180, 56, 30)").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU2RjU3NTA4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU2RjU3NEY4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ4ZDJhMjA2LTU2NDQtNzE0OC04OTk1LTViYWJlZDc5OTkyYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70ySKrAAABH0lEQVR42mL4//8/g9f8RwxMDBDwHyCAGEE8INjMAuKBWAABxAhS473gMQNMAKYWBH6CCIAAgukBg60JsnAVJ5C1bANic5gqkIAXELPCBAACCNkWGNAC4qtQMxlZoIIKQHyfAQuAWfoAiEvxKQCBHpCVUFwNEwQIIGxuAAEdIC4EuiGZCYupp4D4MhAngTgsSBIaQHwdlxuOYZNEVmDJgAPAFICs+oFPwV8g5gTiCnzhAAKd0Hj4BRMACDBwOIAAlrBABiAnlAFxHRCzw+IJPRjQATMQlwBxAxBz4DMZ3clFQNyMTxMuA3YAsTsDiQA5kDKA+DglBoCSpBU0tWkC8UlSDUAGN4DYAmqYNhCfITYQsYFrQGyKlMzbgfg1TBIA9UJCXgUGrJkAAAAASUVORK5CYII="),this._transButtons.append("g").attr("class","transDown").attr("style","cursor: pointer;").on("click",function(){var e=t._projection.translate();e[1]=e[1]-40,t._svg.call(t._zoom.translate(e).event).on("dblclick.zoom",null)}));o.append("rect").attr("width",22).attr("height",22).attr("x",20).attr("y",47).attr("fill","white").attr("stroke","darkgray"),o.append("image").attr("x",14).attr("y",50).attr("height",15).attr("width",15).attr("transform","rotate(270, 27, 53.5)").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU2RjU3NTA4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU2RjU3NEY4MUZGMTFFNEFBQzdEREI2Rjg3OEJFRUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ4ZDJhMjA2LTU2NDQtNzE0OC04OTk1LTViYWJlZDc5OTkyYiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpmMjgxNWQyYy1lMTdhLWZlNDQtOGY5OC00ZmRlYTMzYmNkYzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz70ySKrAAABH0lEQVR42mL4//8/g9f8RwxMDBDwHyCAGEE8INjMAuKBWAABxAhS473gMQNMAKYWBH6CCIAAgukBg60JsnAVJ5C1bANic5gqkIAXELPCBAACCNkWGNAC4qtQMxlZoIIKQHyfAQuAWfoAiEvxKQCBHpCVUFwNEwQIIGxuAAEdIC4EuiGZCYupp4D4MhAngTgsSBIaQHwdlxuOYZNEVmDJgAPAFICs+oFPwV8g5gTiCnzhAAKd0Hj4BRMACDBwOIAAlrBABiAnlAFxHRCzw+IJPRjQATMQlwBxAxBz4DMZ3clFQNyMTxMuA3YAsTsDiQA5kDKA+DglBoCSpBU0tWkC8UlSDUAGN4DYAmqYNhCfITYQsYFrQGyKlMzbgfg1TBIA9UJCXgUGrJkAAAAASUVORK5CYII=")},e.prototype.redrawScalePoint=function(e){var t=d3.scale.linear().range([0,100]).domain([this._minScale,this._maxScale])(e);this._zoomScalePoint.attr("transform","translate(0,"+-t+")")},e.prototype.getLargestBoundingRegion=function(e){var t;if(null===e.geometry)return[0,0];if("MultiPolygon"===e.geometry.type){for(var i={type:"Feature",geometry:{type:"Polygon",coordinates:e.geometry.coordinates[0]}},n=1;n<e.geometry.coordinates.length;n++){var o={type:"Feature",geometry:{type:"Polygon",coordinates:e.geometry.coordinates[n]}};this._path.area(o)>this._path.area(i)&&(i=o,t=e.geometry.coordinates[n][0])}t||i.geometry.coordinates&&(t=i.geometry.coordinates[0])}else t=e.geometry.coordinates[0];return t},e.prototype.showTooltip=function(){$(this._popover).data("bs.popover").tip().hasClass("in")||$(this._svg.node()).popover("show")},e.prototype.hideTooltip=function(){$(this._svg.node()).popover("hide")},e.prototype.updateTooptipPosition=function(e){var t=$(this._popover).data("bs.popover");$(e.target)[0]!==$(this._background)[0][0]?t.$tip&&t.$tip.addClass(t.options.placement).attr("style","top: "+(e.pageY-t.$tip.height()-15)+"px; left: "+(e.pageX-t.$tip.width()/2)+"px; display: block;"):this.hideTooltip()},e.prototype.toggleCountryHover=function(e){var t=this;this._group.select(".countryHovered").attr("class",function(e){return"country-"+e.properties.ADM0_A3}),e.parentNode.appendChild(e),d3.select(e).on("dblclick",function(e){t._detailedMapSettings.enable&&t._updateData.call(t,e.properties.ADM0_A3)}).attr("class",function(e){return"countryHovered country-"+e.properties.ADM0_A3})},e.prototype.tooltipContent=function(e){var t=d3.event,i=$(this._popover).attr("data-content",e).data("bs.popover");i.setContent(),i.$tip.addClass(i.options.placement).attr("style","top: "+(t.pageY-i.$tip.height()-15)+"px; left: "+(t.pageX-i.$tip.width()/2)+"px; display: block;")},e.prototype.checkLabelVisibility=function(e,t){var i;return(!this._showCountryLabels||"Admin-0 country"!==t.properties.featurecla||(i=this._group.select(".country-"+t.properties.ADM0_A3).node().getBoundingClientRect(),e.getBoundingClientRect().width>i.width||t.properties.ADM0_A3===this._selectedCountry))&&(!this._detailedMapSettings.showRegionNames||"Admin-0 country"===t.properties.featurecla||(i=this._group.select(".region-"+t.properties.HASC_1.replace(".","-")).node().getBoundingClientRect(),e.getBoundingClientRect().width>i.width||t.properties.ADM0_A3===this._selectedCountry))?"hidden":"visible"},e.prototype.hide=function(){$(this._element).css("display","none")},e.prototype.show=function(){$(this._element).css("display","inline-block"),this.resize()},e.prototype.resize=function(){this._detailedView||-1!==this._prevMapWidth||(this._prevMapWidth=this._mapWidth,this._prevMapHeight=this._mapHeight);var e=this._element.getBoundingClientRect();if(this._legend.position===a.Position.Bottom||this._legend.position===a.Position.Top?(this._mapHeight=e.height-this._legend.height,this._mapHeight<0&&(this._mapHeight=0),this._mapWidth=e.width):(this._mapHeight=e.height,this._mapHeight<0&&(this._mapHeight=0),0<=Math.floor(e.width-this._legend.width-4)?this._mapWidth=Math.floor(e.width-this._legend.width-4):this._mapWidth=0),this._svg.attr("width",this._mapWidth).attr("height",this._mapHeight),this._background.attr("width",this._mapWidth).attr("height",this._mapHeight),this._detailedView)this._usaDetails?this._usaDetails.resize():this.resizeDetailedMap();else{var t=this._projection.translate();t[0]-=this._prevMapWidth/2,t[1]-=this._prevMapHeight/2,this._prevMapWidth=-1,t[0]+=this._mapWidth/2,t[1]+=this._mapHeight/2,this._projection.translate(t),this._zoom.translate(t)}this._svg.call(this._zoom.event).on("dblclick.zoom",null)},e.prototype.test=function(){this._legend.visibility=!this._legend.visibility},e.prototype.throwError=function(e){this.hide();var t=document.createElement("div");t.classList.add("alert"),t.classList.add("alert-warning"),t.classList.add("fade"),t.classList.add("in"),t.innerHTML=e,t.setAttribute("id","vectorMapError"),this._element.parentElement.appendChild(t)},e.prototype.clearError=function(){var e=this._element.parentElement.querySelector("#vectorMapError");e&&d3.select(e).remove()},Object.defineProperty(e.prototype,"paletteId",{get:function(){return this._paletteId},set:function(e){this._paletteId=e%this._palette.length,this._legend.palette=this._palette[this._paletteId],this._detailedMapSettings.palette=this._palette[this._paletteId],this.updateColors()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pallete",{get:function(){return this._palette[this._paletteId]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPalette",{get:function(){return this._useCustomPalette?this._customPalette:this._palette[this._paletteId]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"customPalette",{set:function(e){console.log(e),e?(this._useCustomPalette=!0,this._legend.palette=e,this._detailedMapSettings.palette=e,this._customPalette=e):this._useCustomPalette=!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minScale",{get:function(){return this._minScale},set:function(e){this._minScale=e,this._zoom.scaleExtent([this._minScale,this._maxScale])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e,this._zoom.scaleExtent([this._minScale,this._maxScale])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this._groups},set:function(e){this._groups=e||a.MapDataHelper.generateGroups(this._data,5),this._legend.groups=e,this._detailedMapSettings.groups=this._groups,this.resize(),this.updateColors()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e,this.updateColors(),this._detailedData=e,this.updateDetailedMap(),this._usaDetails&&(this._usaDetails.data=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"details",{get:function(){return this._selectedCountry},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return{data:this._data,groups:this._groups,maxScale:this._maxScale,minScale:this._minScale,palette:this._palette,bounds:this._bounds,tooltip:this._tooltipOptions,legend:this._legend.settings,detailedMapSettings:this._detailedMapSettings}},set:function(e){this._palette=e.palette||this._palette,this.data=e.data||this.data,this.minScale=e.minScale||this.minScale,this.maxScale=e.maxScale||this.maxScale},enumerable:!0,configurable:!0}),e}(),a.VectorMap=i}(Ranet||(Ranet={})),function(a){a.ranetVectorMap=function(n,e){var o,r=this;this.settings=function e(t){if(null==t||"object"!=typeof t)return t;var i=t.constructor();for(var n in t)t.hasOwnProperty(n)&&(i[n]=e(t[n]));return i}({data:{},groups:[],showCountryLabels:!1,minScale:100,maxScale:3200,paletteId:0,tooltip:{enabled:!0},legend:{visible:!0},presetDetailedRegion:"",detailedMapSettings:{enable:!1,showRegionNames:!0,tooltip:{enabled:!0,customizeTooltip:function(e){var t,i=this._detailedData[e.properties.HASC_1.replace(".","-")];return t=i&&i.displayValue||"N/A",(e.properties.NAME||"Disput territory")+" "+t}}}}),this.option=function(e,t){return console.log(e,t),void 0===t?(o&&(r.settings[e]=o[e]),r.settings[e]):"details"===e?o?o.details:null:("data"===e?a.isEmptyObject(t)?o?(r.settings[e]=t,o[e]=t):(o=new Ranet.Controls.Extensions.VectorMap(n,r.settings),r.error("No countries or regions specified in datasource.")):o?(r.settings[e]=t,o[e]=t):(r.settings.data=t,o=new Ranet.Controls.Extensions.VectorMap(n,r.settings)):(i="groups"===e||"paletteId"===e?t:o?a.extend({},o[e],t):t,r.settings[e]=i,o&&(o[e]=i)),void(o&&(r.settings=o.options,o.updateColors())));var i},this.options=function(){return o?o.options:r.settings},this.hide=function(){o&&o.hide()},this.show=function(){o&&o.show()},this.test=function(){o&&o.test()},this.drawDetails=function(e){o&&o.drawDetails(e)},this.closeDetails=function(){o&&o.closeDetails()},this.resize=function(){o&&o.resize()},this.error=function(e){o.throwError(e)},this.clearError=function(){o&&o.clearError()};var t=function(e){0!==n.getBoundingClientRect().width&&o&&o.resize()};this.destroy=function(){a(window).off("resize",t)},r.settings.minScale=e.minScale||r.settings.minScale,r.settings.maxScale=e.maxScale||r.settings.maxScale,r.settings.bounds=a.extend(r.settings.bounds,e.bounds),r.settings.tooltip=a.extend(r.settings.tooltip,e.tooltip),r.settings.data=a.extend(r.settings.data,e.data),r.settings.groups=a.extend(r.settings.groups,e.groups),r.settings.detailedMapSettings=a.extend(r.settings.detailedMapSettings,e.detailedMapSettings),r.settings.updateData=e.updateData,a.isEmptyObject(r.settings.data)||(o=new Ranet.Controls.Extensions.VectorMap(n,r.settings),r.settings=o.options),a(window).on("resize",t)},a.fn.ranetVectorMap=function(t){return this.each(function(){if(null==a(this).data("ranetVectorMap")){var e=new a.ranetVectorMap(this,t);a(this).data("ranetVectorMap",e)}})}}(jQuery),function(u){var e,t,i;e=u.View||(u.View={}),t=e.RightExtensionView||(e.RightExtensionView={}),i=function(){function e(){this._$view=null,this._$headerTextArea=$('<textarea class="rightExtView_textArea" readonly></textarea>'),this._$footerTextArea=$('<textarea class="rightExtView_textArea" readonly></textarea>')}return Object.defineProperty(e.prototype,"headerText",{get:function(){return this._$headerTextArea.val()},set:function(e){this._$headerTextArea.val(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"footerText",{get:function(){return this._$footerTextArea.val()},set:function(e){this._$footerTextArea.val(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return null===this._$view&&(this._$view=this.getView()),this._$view},enumerable:!0,configurable:!0}),e.prototype.getView=function(){var e=this,t=$("<div class='rightExtView_container'/>"),i=u.Localization.localize("PivotGrid_EditHeaderAndFooter_ToolTip"),n=$('<div title="'+i+"\" class='imageLibrary_edit rightExtView_icon rightExtView_editButton'></div>");n.click(function(){n.toggleClass("rightExtView_editButton-active"),e._$headerTextArea.removeAttr("readonly"),e._$footerTextArea.removeAttr("readonly"),n.hasClass("rightExtView_editButton-active")||(e._$headerTextArea.attr("readonly","true"),e._$footerTextArea.attr("readonly","true"))}),t.append(n);var o=$("<div><div class='imageLibrary_pivotGridHeader rightExtView_icon'></div><span>"+u.Localization.localize("PivotGrid_HeaderText")+"</span></div>"),r=$('<div class="rightExtView_textAreaContainer"></div>');r.append(this._$headerTextArea);var a=$('<div class="rightExtView_itemLayout"/>');a.append(o),a.append(r);var s=$('<div class="rightExtView_itemLayout"/>'),l=$("<div><div class='imageLibrary_pivotGridFooter rightExtView_icon'></div><span>"+u.Localization.localize("PivotGrid_FooterText")+"</span></div>"),c=$('<div class="rightExtView_textAreaContainer"></div>');return c.append(this._$footerTextArea),s.append(l),s.append(c),t.append(a),t.append(s),this.activateResizable(r),this.activateResizable(c),t},e.prototype.activateResizable=function(i){i.resizable({helper:"resizable-helper",handles:"s",stop:function(e,t){i.css("width","")}})},e}(),t.RightExtView=i}(Ranet||(Ranet={})),function(v){var m,e;(e=m||(m={}))[e.Right=0]="Right",e[e.Left=1]="Left",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom";var C,r=function(){function e(){this.countRowsColumnsPane=0,this.countColumnsRowsPane=0,this.defaultCellHeight=22,this.defaultColumnWidth=130,this.minColumnWidth=10,this.minRowHeight=10,this.levelDepthOffset=20,this.additionalWithCellsPanel=80,this.additionalHeightCellsPanel=30,this.mapWidthCells={},this.mapHeightCells={},this.mapWidthColumnInRowsPanel={},this.mapHeightRowInColumnsPanel={}}function t(){for(var e=0,t=0;t<this.countColumnsRowsPane;t++)e+=this.getWidthColumnRowsPanel(t);return e}return Object.defineProperty(e.prototype,"widthContentRowsPanel",{get:function(){return t.call(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"widthRowsPanel",{get:function(){return void 0===this._widthRowsPanel?t.call(this):this._widthRowsPanel},set:function(e){this._widthRowsPanel=e},enumerable:!0,configurable:!0}),e.prototype.columnsPanelHeight=function(){for(var e=0,t=0;t<this.countRowsColumnsPane;t++)e+=this.getHeightRowColumnsPanel(t);return e},e.prototype.getSizeColumn=function(e){return this.mapWidthCells.hasOwnProperty(e)?this.mapWidthCells[e]:this.defaultColumnWidth},e.prototype.setSizeColumn=function(e,t){this.mapWidthCells[e]=t},e.prototype.setSizeRow=function(e,t){this.mapHeightCells[e]=t},e.prototype.getSizeRow=function(e){return this.mapHeightCells.hasOwnProperty(e)?this.mapHeightCells[e]:this.defaultCellHeight},e.prototype.setWidthColumnRowsPanel=function(e,t){this.mapWidthColumnInRowsPanel[e]={value:t,isDefault:!1}},e.prototype.setDefaultWidthColumnInRowsPanel=function(e,t){e in this.mapWidthColumnInRowsPanel||(this.mapWidthColumnInRowsPanel[e]={value:t,isDefault:!0})},e.prototype.getWidthColumnRowsPanel=function(e){return this.mapWidthColumnInRowsPanel.hasOwnProperty(e)?this.mapWidthColumnInRowsPanel[e].value:200},e.prototype.setHeightRowColumnsPanel=function(e,t){this.mapHeightRowInColumnsPanel[e]={value:t,isDefault:!1}},e.prototype.setDefaultHeightRowInColumnsPanel=function(e,t){e in this.mapHeightRowInColumnsPanel||(this.mapHeightRowInColumnsPanel[e]={value:t,isDefault:!0})},e.prototype.getHeightRowColumnsPanel=function(e){return this.mapHeightRowInColumnsPanel.hasOwnProperty(e)?this.mapHeightRowInColumnsPanel[e].value:40},e.prototype.saveState=function(e){var t,i,n,o,r,a;for(t in this._backupWidthCell={},this._backupHeightCell={},this._backupWithColumnRowsPanel={},this._backupHeightRowColumnsPanel={},this.mapWidthCells)if(this.mapWidthCells.hasOwnProperty(t)){for(n="",o=0;o<e.countHierarchyInColumns;o++)""!==n&&(n+="+"),n+=e.getDataColumnAction(Number(t),o).uniqueName;this._backupWidthCell[n]=this.mapWidthCells[t]}for(t in this.mapHeightCells)if(this.mapHeightCells.hasOwnProperty(t)){for(n="",o=0;o<e.countHierarchyInRows;o++)""!==n&&(n+="+"),n+=e.getDataRowAction(o,Number(t)).uniqueName;this._backupHeightCell[n]=this.mapHeightCells[t]}for(t in this.mapWidthColumnInRowsPanel)if(this.mapWidthColumnInRowsPanel.hasOwnProperty(t)&&!1===this.mapWidthColumnInRowsPanel[t].isDefault)if("hierarchy"===e.indexToTypeRows[t])a=e.absoluteIndexItemToHierarchyIndexRows[Number(t)],i=e.getHierarchyDescriptionInRows(a),this._backupWithColumnRowsPanel[i.uniqueName]=this.mapWidthColumnInRowsPanel[t].value;else{if("customProperty"!==e.indexToTypeRows[t])throw new Error("NotImplementedException");r=e.getLevelPropertyInRows(Number(t)).name,this._backupWithColumnRowsPanel[r]=this.mapWidthColumnInRowsPanel[t].value}for(t in this.mapHeightRowInColumnsPanel)if(this.mapHeightRowInColumnsPanel.hasOwnProperty(t)&&!1===this.mapHeightRowInColumnsPanel[t].isDefault)if("hierarchy"===e.indexToTypeColumns[t])a=e.absoluteIndexItemToHierarchyIndexColumns[Number(t)],i=e.getHierarchyDescriptionInColumns(a),this._backupHeightRowColumnsPanel[i.uniqueName]=this.mapHeightRowInColumnsPanel[t].value;else{if("customProperty"!==e.indexToTypeColumns[t])throw new Error("NotImplementedException");r=e.getLevelPropertyInColumns(Number(t)).name,this._backupHeightRowColumnsPanel[r]=this.mapHeightRowInColumnsPanel[t].value}},e.prototype.restoreState=function(e){var t,i,n,o;if(this.mapWidthCells={},this.mapHeightCells={},this.mapWidthColumnInRowsPanel={},this.mapHeightRowInColumnsPanel={},void 0!==this._backupWidthCell&&0<e.countHierarchyInColumns)for(var r=0;r<e.maxColumns;r++){for(n="",i=0;i<e.countHierarchyInColumns;i++)""!==n&&(n+="+"),n+=e.getDataColumnAction(r,i).uniqueName;n in this._backupWidthCell&&(this.mapWidthCells[r]=this._backupWidthCell[n])}if(void 0!==this._backupHeightCell&&0<e.countHierarchyInRows)for(var a=0;a<e.maxRows;a++){for(n="",i=0;i<e.countHierarchyInRows;i++)""!==n&&(n+="+"),n+=e.getDataRowAction(i,a).uniqueName;n in this._backupHeightCell&&(this.mapHeightCells[a]=this._backupHeightCell[n])}if(void 0!==this._backupWithColumnRowsPanel)for(var s=0;s<e.countColumnsInRows;s++)if("hierarchy"===e.indexToTypeRows[s])o=e.absoluteIndexItemToHierarchyIndexRows[s],(t=e.getHierarchyDescriptionInRows(o)).uniqueName in this._backupWithColumnRowsPanel&&(this.mapWidthColumnInRowsPanel[s]={value:this._backupWithColumnRowsPanel[t.uniqueName],isDefault:!1});else{if("customProperty"!==e.indexToTypeRows[s])throw new Error("NotImplementedException");var l=e.getLevelPropertyInRows(s).name;l in this._backupWithColumnRowsPanel&&(this.mapWidthColumnInRowsPanel[s]={value:this._backupWithColumnRowsPanel[l],isDefault:!1})}if(void 0!==this._backupHeightRowColumnsPanel)for(var c=0;c<e.countRowsInColumns;c++)if("hierarchy"===e.indexToTypeColumns[c])o=e.absoluteIndexItemToHierarchyIndexColumns[c],(t=e.getHierarchyDescriptionInColumns(o)).uniqueName in this._backupHeightRowColumnsPanel&&(this.mapHeightRowInColumnsPanel[c]={isDefault:!1,value:this._backupHeightRowColumnsPanel[t.uniqueName]});else{if("customProperty"!==e.indexToTypeColumns[c])throw new Error("NotImplementedException");var u=e.getLevelPropertyInColumns(c).name;u in this._backupHeightRowColumnsPanel&&(this.mapHeightRowInColumnsPanel[c]={isDefault:!1,value:this._backupHeightRowColumnsPanel[u]})}},e}(),d=function(){function u(e,t){if(v(e).hasClass(t))return e;for(var i=v(e).parents(),n=0;n<i.length;n++)if(v(i[n]).hasClass(t))return i[n]}function p(e){var t="";return e.hasClass("fa-caret-right")?t="expand":e.hasClass("fa-caret-down")?t="collapse":e.hasClass("pivotTable-contentHeader")&&(t="drillDown"),t}function e(e,t,i,n,o,r){this._onContextMenuCallback=r,this._onActionHeader=n,this._onHeaderTouch=o,this._$paneColumns=e,this._$paneRows=t,this._dataManager=i}return e.prototype.activateMouseActions=function(){var t=this;v(this._$paneColumns).mousedown(function(e){if(Ranet.ClientInformation.isMobileBrowser())!function(e,t,i){var n=d.findHierarchyItem(e);if(n){var o=Number(v(n).attr("data-end-column")),r=Number(v(n).attr("data-start-column")),a=Number(v(u(n,"pivotTable-panel")).attr("data-index-hierarchy")),s=t.getDataColumnAction(o,a),l=void 0;t.columnIsParent(o,a)?l="expanded":t.hasChildrenColumnsPanel(o,a)&&(l="collapsed");var c={place:"columns",row:a,endColumn:o,startColumn:r,data:s,hierarchy:t.getHierarchyInColumns(a),ancestors:t.getAncestorsInColumns(o,a),actionType:void 0,currentState:l};0<a&&(c.neighborsHierarchy=t.getNeighborsHierarchyInColumns(o,a)),i(n,c)}}(e.target,t._dataManager,t._onHeaderTouch);else{if(1!==e.which)return;!function(e,t,i){var n=v(e);if(n.hasClass("fa-caret-right")||n.hasClass("fa-caret-down")){var o=p(n),r=d.findHierarchyItem(e);if(r){var a=Number(v(r).attr("data-end-column")),s=Number(v(r).attr("data-start-column")),l=Number(v(u(r,"pivotTable-panel")).attr("data-index-hierarchy")),c={place:"columns",row:l,endColumn:a,startColumn:s,data:t.getDataColumnAction(a,l),hierarchy:t.getHierarchyInColumns(l),ancestors:t.getAncestorsInColumns(a,l),actionType:o};0<l&&(c.neighborsHierarchy=t.getNeighborsHierarchyInColumns(a,l)),i(r,c)}}}(e.target,t._dataManager,t._onActionHeader)}}),v(this._$paneRows).mousedown(function(e){if(Ranet.ClientInformation.isMobileBrowser())!function(e,t,i){var n=d.findHierarchyItem(e);if(n){var o=Number(v(n).attr("data-start-row")),r=Number(v(n).attr("data-end-row")),a=Number(v(u(n,"pivotTable-panel")).attr("data-index-hierarchy")),s=t.getDataRowAction(a,r),l=void 0;t.rowIsParent(a,r)?l="expanded":t.hasChildrenRowsPanel(a,r)&&(l="collapsed");var c={place:"rows",endRow:r,column:a,startRow:o,data:s,hierarchy:t.getHierarchyInRows(a),ancestors:t.getAncestorsInRows(a,r),actionType:void 0,currentState:l};0<a&&(c.neighborsHierarchy=t.getNeighborsHierarchyInRows(a,r)),i(n,c)}}(e.target,t._dataManager,t._onHeaderTouch);else{if(1!==e.which)return;!function(e,t,i){var n=v(e);if(n.hasClass("fa-caret-right")||n.hasClass("fa-caret-down")){var o=p(n),r=d.findHierarchyItem(e);if(r){var a=Number(v(r).attr("data-end-row")),s=Number(v(r).attr("data-start-row")),l=Number(v(u(r,"pivotTable-panel")).attr("data-index-hierarchy")),c={place:"rows",endRow:a,startRow:s,column:l,data:t.getDataRowAction(l,a),hierarchy:t.getHierarchyInRows(l),ancestors:t.getAncestorsInRows(l,a),actionType:o};0<l&&(c.neighborsHierarchy=t.getNeighborsHierarchyInRows(l,a)),i(r,c)}}}(e.target,t._dataManager,t._onActionHeader)}})},e.prototype.activateContextMenu=function(){var n=this;this._$paneColumns.on("contextmenu",function(e){var t=function(e,t){var i=d.findHierarchyItem(e);if(!i)return null;var n=Number(v(i).attr("data-end-column")),o=Number(v(i).attr("data-start-column")),r=Number(v(u(i,"pivotTable-panel")).attr("data-index-hierarchy")),a=void 0;t.columnIsParent(n,r)?a="expanded":t.hasChildrenColumnsPanel(n,r)&&(a="collapsed");var s={place:"columns",row:r,endColumn:n,startColumn:o,data:t.getDataColumnAction(n,r),hierarchy:t.getHierarchyInColumns(r),ancestors:t.getAncestorsInColumns(n,r),currentState:a};return 0<r&&(s.neighborsHierarchy=t.getNeighborsHierarchyInColumns(n,r)),{element:i,data:s}}(e.target,n._dataManager);if(!t)return!1;var i={elementDescription:t.data,eventArgs:e};return n._onContextMenuCallback(t.element,i),!1}),this._$paneRows.on("contextmenu",function(e){var t=function(e,t){var i=d.findHierarchyItem(e);if(!i)return null;var n=Number(v(i).attr("data-end-row")),o=Number(v(i).attr("data-start-row")),r=Number(v(u(i,"pivotTable-panel")).attr("data-index-hierarchy")),a=void 0;t.rowIsParent(r,n)?a="expanded":t.hasChildrenRowsPanel(r,n)&&(a="collapsed");var s={place:"rows",endRow:n,startRow:o,column:r,data:t.getDataRowAction(r,n),hierarchy:t.getHierarchyInRows(r),ancestors:t.getAncestorsInRows(r,n),currentState:a};return 0<r&&(s.neighborsHierarchy=t.getNeighborsHierarchyInRows(r,n)),{element:i,data:s}}(e.target,n._dataManager);if(!t)return!1;var i={elementDescription:t.data,eventArgs:e};return n._onContextMenuCallback(t.element,i),!1})},e.findHierarchyItem=function(e){return u(e,"pivotTable-hierarchyItem")},e}(),b=function(){function e(e,t,i,n){this._$cellsPanel=e,this._dataManager=t,this._selectedCellManager=i,this._onShowContextMenuCallback=n}return e.prototype.activateContextMenu=function(){var l=this;this._$cellsPanel.on("contextmenu",function(e){var t=v(e.target);if(t.hasClass("pivotTable-cellsPanel"))return!0;var i=function(e,t){var i=null,n=(i=e.hasClass("pivotTable-cell")?e:e.parents(".pivotTable-cell")).parents(".pivotTable-panel"),o=Number(i.attr("data-row")),r=Number(n.attr("data-column"));if(NaN===o||NaN===r)throw new Error("InvalidOperationException");var a=t.getCellData(r,o),s=t.getDescriptionOfTuplesForCell(r,o);return{element:i,data:a,rows:s.rows,columns:s.columns,rowIndex:o,columnIndex:r}}(t,l._dataManager);if(!i)return!0;if(l._selectedCellManager.hasSelectionCells&&l._selectedCellManager.selectionCellsContainsCell(i.columnIndex,i.rowIndex)){var n=l._selectedCellManager.focusedCell,o=l._dataManager.getCellData(n.columnFocusedCell,n.rowFocusedCell),r=l._dataManager.getDescriptionOfTuplesForCell(n.columnFocusedCell,n.rowFocusedCell),a={$cell:i.element,sender:e,focusedCellDescription:{cellData:o,rows:r.rows,columns:r.columns},selectedCells:function(e,t){for(var i=[],n=e.startColumn;n<=e.endColumn;n++)for(var o=e.startRow;o<=e.endRow;o++){var r=t.getCellData(n,o),a=t.getDescriptionOfTuplesForCell(n,o),s={cellData:r,rows:a.rows,columns:a.columns,rowIndex:o,columnIndex:n};i.push(s)}return i}(l._selectedCellManager.rangeSelectedCells,l._dataManager)};l._onShowContextMenuCallback(a)}else{var s={$cell:i.element,sender:e,focusedCellDescription:{cellData:i.data,rows:i.rows,columns:i.columns},selectedCells:[{cellData:i.data,rows:i.rows,columns:i.columns}]};l._onShowContextMenuCallback(s)}return!1})},e}(),w=function(){function d(e,t){var i,n,o=!1;if(e===m.Bottom){if(!(i=t.offset()))return!0;n=this._$cellsScrollPanel.offset();var r=this._$cellsScrollPanel.height(),a=t.height(),s=i.top+a;n.top+r<s+23&&(o=!0)}if(e===m.Top){if(n=this._$cellsScrollPanel.offset(),!(i=t.offset()))return!0;n.top>i.top&&(o=!0)}if(e===m.Left){if(!(i=t.offset()))return!0;(n=this._$cellsScrollPanel.offset()).left>i.left&&(o=!0)}if(e===m.Right){if(!(i=t.offset()))return!0;n=this._$cellsScrollPanel.offset();var l=this._$cellsScrollPanel.width(),c=t.width();n.left+l-23<i.left+c&&(o=!0)}return o}function u(e,t){var i=this.maxIndexColumn,n=this.maxIndexRow,o=null===this.focusedCell?-1:this.focusedCell.columnFocusedCell,r=null===this.focusedCell?-1:this.focusedCell.rowFocusedCell,a=d.call(this,t,e);if(!e.length||a){if(t===m.Left||t===m.Right){var s=this._$cellsScrollPanel.scrollLeft();if(t===m.Right)for(var l=o-1;l<=o;l++)s+=this.sizeManager.getSizeColumn(l);if(t===m.Left)for(var c=o+1;o<=c;c--)s-=this.sizeManager.getSizeColumn(c);o===i&&(s=this._$paneCells.width()-this._$cellsScrollPanel.width()+15),this._$cellsScrollPanel.scrollLeft(s)}else if(t===m.Top||t===m.Bottom){var u=this._$cellsScrollPanel.scrollTop();if(t===m.Bottom)for(var p=r-1;p<=r;p++)u+=this.sizeManager.getSizeRow(p);if(t===m.Top)for(var h=r+1;r<=h;h--)u-=this.sizeManager.getSizeRow(h);r===n&&(u=this._$paneCells.height()-this._$cellsScrollPanel.height()+15),this._$cellsScrollPanel.scrollTop(u)}}else 0===o&&this._$cellsScrollPanel.scrollLeft(0),0===r&&this._$cellsScrollPanel.scrollTop(0),o===i&&this._$cellsScrollPanel.scrollLeft(this._$paneCells.width()-this._$cellsScrollPanel.width()+15),r===n&&this._$cellsScrollPanel.scrollTop(this._$paneCells.height()-this._$cellsScrollPanel.height()+15)}function T(e,t,i){var n=v(e).find("[data-column='"+t+"']").first();return v(n).find("[data-row='"+i+"']").first()}function r(e,t){var i=v(e).children().last();return v(i).find("[data-end-column='"+t+"']").first()}function a(e,t){var i=v(e).children().last();return v(i).find("[data-end-row='"+t+"']").first()}function P(e,t,i,n,o){r(e,t).addClass("pivotTable-headerColumn_state_selectedCell"),a(i,n).addClass("pivotTable-headerRow_state_selectedCell")}function p(e,t,i,n,o){r(e,t).removeClass("pivotTable-headerColumn_state_selectedCell"),a(i,n).removeClass("pivotTable-headerRow_state_selectedCell")}function e(e,t,i,n,o,r,a){this._selectedRanges=[],this._$paneCells=e,this._$cellsScrollPanel=t,this.sizeManager=o,this._dataManager=r,this._$paneColumns=i,this._$paneRows=n,this.onValueChanged=a,this._userSelectionDescription=null,this._focusedCell=null,this.activateCellsSelection()}return Object.defineProperty(e.prototype,"focusedCell",{get:function(){return this._focusedCell},set:function(e){this._focusedCell=e,this.onValueChanged(this._focusedCell)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxIndexColumn",{get:function(){return this._maxIndexColumn},set:function(e){this._maxIndexColumn=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxIndexRow",{get:function(){return this._maxIndexRow},set:function(e){this._maxIndexRow=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSelectionCells",{get:function(){return null!==this._userSelectionDescription},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeSelectedCells",{get:function(){return this._userSelectionDescription},enumerable:!0,configurable:!0}),e.prototype.selectionCellsContainsCell=function(e,t){return!1!==this.hasSelectionCells&&(this._userSelectionDescription.startColumn<=e&&this._userSelectionDescription.endColumn>=e&&this._userSelectionDescription.startRow<=t&&this._userSelectionDescription.endRow>=t)},e.prototype.selectionCellsContainsColumn=function(e){return null!==this.focusedCell&&(this.focusedCell.columnFocusedCell===e||null!==this._userSelectionDescription&&(this._userSelectionDescription.startColumn<=e&&this._userSelectionDescription.endColumn>=e))},e.prototype.selectionCellsContainsRow=function(e){return null!==this.focusedCell&&(this.focusedCell.rowFocusedCell===e||null!==this._userSelectionDescription&&(this._userSelectionDescription.startRow<=e&&this._userSelectionDescription.endRow>=e))},e.prototype.removeCellsSelection=function(){this._$paneCells.find(".pivotTable-selectedCell").each(function(){v(this).removeClass("pivotTable-selectedCell")}),this._$paneColumns.find(".pivotTable-headerColumn_state_selectedCell").each(function(){v(this).removeClass("pivotTable-headerColumn_state_selectedCell")}),this._$paneRows.find(".pivotTable-headerRow_state_selectedCell").each(function(){v(this).removeClass("pivotTable-headerRow_state_selectedCell")}),this._selectionPanel&&this._selectionPanel.remove();(function(){this.focusedCell&&(T(this._$paneCells,this.focusedCell.columnFocusedCell,this.focusedCell.rowFocusedCell).addClass("pivotTable-cell_state_selected"),P(this._$paneColumns,this.focusedCell.columnFocusedCell,this._$paneRows,this.focusedCell.rowFocusedCell,this.sizeManager))}).call(this),this._userSelectionDescription=null},e.prototype.activateCellsSelection=function(){var o=this;this._isLeftMouseButtonPressed=!1,this._$cellsScrollPanel.mousedown(function(e){3!==e.which&&(o._isLeftMouseButtonPressed=!0)}),this._$cellsScrollPanel.mouseup(function(e){o._isLeftMouseButtonPressed=!1}),v(document).mouseup(function(e){o._isLeftMouseButtonPressed=!1}),v(document).mousedown(function(e){3!==e.which&&!1===o._isLeftMouseButtonPressed&&o.removeCellsSelection()});var e=v("<div style='position: absolute; top: 0px; left: 0px;'/>");this._$topBorder=v("<div style='position: absolute; background-color: black; height: 2px;  display: block; top: 111px; left: 239px;'/>"),this._$leftBorder=v("<div style='position: absolute; background-color: black; width: 2px;  display: block; top: 111px; left: 239px;'/>"),this._$rightBorder=v("<div style='position: absolute; background-color: black; width: 2px;  display: block; top: 111px; left: 239px;'/>"),this._$bottomBorder=v("<div style='position: absolute; background-color: black; height: 2px; display: block; top: 111px; left: 239px;'/>"),e.append(this._$topBorder),e.append(this._$leftBorder),e.append(this._$rightBorder),e.append(this._$bottomBorder),this._selectionPanel=e,this._$cellsScrollPanel.mousemove(function(e){if(!1===o._isLeftMouseButtonPressed)return!0;if(null===o.focusedCell)return!0;var t=v(e.target);if(!1===t.hasClass("pivotTable-cell")&&(t=t.parents(".pivotTable-cell")),!t.hasClass("pivotTable-cell"))return!0;var i=Number(v(t).attr("data-row")),n=Number(v(t).parent().first().attr("data-column"));return function(e,t,i,n){var o=this;o.removeCellsSelection();var r,a,s,l,c,u,p="",h=0,d=0;if(e<=i)for(p="bottom",r=e;r<=i;r++)h+=o.sizeManager.getSizeRow(r);else if(i<=e)for(p="top",r=i;r<=e;r++)h+=o.sizeManager.getSizeRow(r);if(t<=n)for(p+="right",a=t;a<=n;a++)d+=o.sizeManager.getSizeColumn(a);else if(n<=t)for(p+="left",a=n;a<=t;a++)d+=o.sizeManager.getSizeColumn(a);t<=n?(s=t,l=n):n<t&&(s=n,l=t),e<=i?(c=e,u=i):i<e&&(c=i,u=e);for(var m=s;m<=l;m++){var f=o._$paneCells.find("[data-column='"+m+"']");if(0!==f.length)for(var g=c;g<=u;g++){var _=f.find("[data-row='"+g+"']");0!==_.length&&(P(o._$paneColumns,m,o._$paneRows,g),g===o.focusedCell.rowFocusedCell&&m===o.focusedCell.columnFocusedCell||_.addClass("pivotTable-selectedCell"))}}o._userSelectionDescription={startColumn:s,endColumn:l,startRow:c,endRow:u},T.call(o,o._$paneCells,o.focusedCell.columnFocusedCell,o.focusedCell.rowFocusedCell).removeClass("pivotTable-cell_state_selected");var y=0,C=0,v=T.call(o,o._$paneCells,t,e);if(1===v.length)"bottomright"!==p&&"bottomleft"!==p||(y=parseInt(v.css("top"),10)),"bottomright"!==p&&"topright"!==p||(C=parseInt(v.parent().first().css("left"),10));else{if("bottomright"===p||"bottomleft"===p)for(var b=0;b<e;b++)y+=o.sizeManager.getSizeRow(b);if("bottomright"===p||"topright"===p)for(var w=0;w<t;w++)C+=o.sizeManager.getSizeColumn(w)}var S=T(this._$paneCells,n,i);"topleft"!==p&&"topright"!==p||(y=parseInt(S.css("top"),10)),"topleft"!==p&&"bottomleft"!==p||(C=parseInt(S.parent().first().css("left"),10)),C-=2,y-=2;var x=h+1,D=d+1;this._$topBorder.css("width",D),this._$topBorder.css("left",C),this._$topBorder.css("top",y),this._$leftBorder.css("left",C),this._$leftBorder.css("height",x),this._$leftBorder.css("top",y),this._$rightBorder.css("top",y),this._$rightBorder.css("left",C+D),this._$rightBorder.css("height",x),this._$bottomBorder.css("top",y+x),this._$bottomBorder.css("width",D),this._$bottomBorder.css("left",C),o._$cellsScrollPanel.append(o._selectionPanel)}.call(o,o.focusedCell.rowFocusedCell,o.focusedCell.columnFocusedCell,i,n),!0})},e.prototype.move=function(e){var t=null,i=this.focusedCell.columnFocusedCell,n=this.focusedCell.rowFocusedCell,o=T(this._$paneCells,i,n);if(0===o.length)return!1;switch(o.removeClass("pivotTable-cell_state_selected"),p(this._$paneColumns,i,this._$paneRows,n,this.sizeManager),e){case m.Left:i-=1;break;case m.Top:n-=1;break;case m.Right:if(i===this.maxIndexColumn)break;i+=1;break;case m.Bottom:if(this.maxIndexRow===n)break;n+=1}i<0&&(i=0),n<0&&(n=0),(t=T(this._$paneCells,i,n)).addClass("pivotTable-cell_state_selected"),P(this._$paneColumns,i,this._$paneRows,n,this.sizeManager),u.call(this,t,e),this.focusedCell={rowFocusedCell:n,columnFocusedCell:i}},e.prototype.initKeyBoardController=function(){var t=this;v(this._$paneCells).keydown(function(e){if(37===e.which||38===e.which||39===e.which||40===e.which)switch(t.removeCellsSelection(),e.which){case 37:t.move(m.Left);break;case 38:t.move(m.Top);break;case 39:t.move(m.Right);break;case 40:t.move(m.Bottom)}return!1})},e.prototype.initMouseController=function(){var c=this;v(this._$paneCells).mousedown(function(e){var t=v(e.target);if(!1===t.hasClass("pivotTable-cell")&&(t=t.parents(".pivotTable-cell")),!t.hasClass("pivotTable-cell"))return!0;var i=Number(v(t).attr("data-row")),n=Number(v(t).parent().first().attr("data-column"));if(3===e.which&&null!=c._userSelectionDescription&&c._userSelectionDescription.startRow<=i&&c._userSelectionDescription.endRow>=i&&c._userSelectionDescription.startColumn<=n&&c._userSelectionDescription.endColumn>=n)return!0;c.removeCellsSelection();var o=d.call(c,m.Bottom,t),r=d.call(c,m.Top,t),a=d.call(c,m.Left,t);!0===d.call(c,m.Right,t)&&u.call(c,t,m.Right),a&&u.call(c,t,m.Left),r&&u.call(c,t,m.Top),o&&u.call(c,t,m.Bottom);var s=null===c.focusedCell?-1:c.focusedCell.columnFocusedCell,l=null===c.focusedCell?-1:c.focusedCell.rowFocusedCell;-1!==s&&-1!==l&&(v(T(c._$paneCells,s,l)).removeClass("pivotTable-cell_state_selected"),p(c._$paneColumns,s,c._$paneRows,l,c.sizeManager)),v(t).addClass("pivotTable-cell_state_selected"),l=i,s=n,P(c._$paneColumns,s,c._$paneRows,l,c.sizeManager),c.focusedCell={rowFocusedCell:l,columnFocusedCell:s}})},e.prototype.refresh=function(e,t){this.maxIndexColumn=e-1,this.maxIndexRow=t-1,this._selectedRanges=[]},e}(),S=function(){function r(e,t,i){var n=v(e).find("[data-column='"+t+"']").first();return v(n).find("[data-row='"+i+"']").first()}function e(e,t,i,n,o){this._$panelCells=e,this._$scrollPanelCells=t,this._celectedCellManager=i,this._dataManager=n,this._isVisibleEditor=!1,this._onDataChangedCallback=o}function a(e){if(!0===this._isVisibleEditor)throw new Error("InvalidOperationException");this._isVisibleEditor=!0,function(){this._$paneTextBox=v("<div style='z-index:2;position:absolute;background-color:white;display:block;'></div>"),this._$textBox=v('<textarea style="width:100%;width:100%;height:100%;outline-style: none;padding: 6px; box-sizing: border-box; overflow-y: hidden;font-size: 13px;font-family: Helvetica, Arial;resize: none; border:none;box-shadow: 0 0 0 2px #ff8800 inset;"></textarea>'),this._$paneTextBox.append(this._$textBox),this._$panelCells.append(this._$paneTextBox)}.call(this),function(){var e=r(this._$panelCells,this.focusedCell.columnFocusedCell,this.focusedCell.rowFocusedCell),t=e.height()+5,i=e.width()+5,n=e.offset().left-this._$panelCells.offset().left-2,o=e.offset().top-this._$panelCells.offset().top-2;this._$paneTextBox.css("height",t),this._$paneTextBox.css("width",i),this._$paneTextBox.css("left",n),this._$paneTextBox.css("top",o)}.call(this),this._currentColumnOfEditor=this.focusedCell.columnFocusedCell,this._currentRowOfEditor=this.focusedCell.rowFocusedCell;var n=this;this._$textBox.keydown(function(e){if(e.stopPropagation(),setTimeout(function(){1<v.countLines(n._$textBox).visual&&n._$paneTextBox.width(n._$paneTextBox.width()+7)}),13===e.keyCode||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode){switch(s.call(n,!0),e.keyCode){case 40:case 13:n._celectedCellManager.move(m.Bottom);break;case 37:n._celectedCellManager.move(m.Left);break;case 38:n._celectedCellManager.move(m.Top);break;case 39:n._celectedCellManager.move(m.Right)}if(e.preventDefault(),Ranet.ClientInformation.isIE())r(n._$panelCells,n.focusedCell.columnFocusedCell,n.focusedCell.rowFocusedCell).focus();else n._$panelCells.focus();return!1}return!1!=!(31<(i=(t=e).which?t.which:t.keyCode)&&(i<46||57<i)&&"."!==t.key&&110!==i&&(i<96||105<i));var t,i}),this._$textBox.mousedown(function(e){e.stopPropagation()}),this._$textBox.focus(),this._$textBox.text(e)}function s(e){this._isVisibleEditor=!1,this._$paneTextBox.remove();var t=this._currentColumnOfEditor,i=this._currentRowOfEditor,n=r(this._$panelCells,t,i);e&&(this._dataManager.setNewValue(t,i,this._$textBox.val()),this._onDataChangedCallback&&this._onDataChangedCallback(n,t,i))}return e.prototype.activate=function(){var o=this;this._$panelCells.keydown(function(e){if(o._dataManager.isUpdateableData&&!1!==o._dataManager.canUpdate(o.focusedCell.columnFocusedCell,o.focusedCell.rowFocusedCell))if(46===e.which&&o._dataManager.isUpdated(o.focusedCell.columnFocusedCell,o.focusedCell.rowFocusedCell)){o._dataManager.deleteUpdatedValue(o.focusedCell.columnFocusedCell,o.focusedCell.rowFocusedCell);var t=r(o._$panelCells,o.focusedCell.columnFocusedCell,o.focusedCell.rowFocusedCell);o._onDataChangedCallback(t,o.focusedCell.columnFocusedCell,o.focusedCell.rowFocusedCell),Ranet.ClientInformation.isIE()&&r(o._$panelCells,o.focusedCell.columnFocusedCell,o.focusedCell.rowFocusedCell).focus()}else{var i,n;if(!1!=(!((n=(i=e).which?i.which:i.keyCode)<47||57<n)||!(n<96||105<n)))37!==e.which&&38!==e.which&&39!==e.which&&40!==e.which&&13!==e.which&&a.call(o,e.key)}}),v("body").mousedown(function(){o._dataManager.isUpdateableData&&!0===o._isVisibleEditor&&s.call(o,!1)}),this._$panelCells.mousedown(function(){o._dataManager.isUpdateableData&&(!0===o._isVisibleEditor&&(s.call(o,!0),Ranet.ClientInformation.isIE()&&r(o._$panelCells,o.focusedCell.columnFocusedCell,o.focusedCell.rowFocusedCell).focus()))}),this._$scrollPanelCells.scroll(function(){o._dataManager.isUpdateableData&&o._isVisibleEditor&&s.call(o,!0)})},Object.defineProperty(e.prototype,"focusedCell",{get:function(){return this._focusedCell},set:function(e){this._prevFocusedCell=this._focusedCell,this._focusedCell=e},enumerable:!0,configurable:!0}),e}(),a=function(){var n=[];function e(e,t){var i=v("<div/>");i.attr("id",e+"-content"),this._$panelPivotTable=i,v("#"+e).append(i),this._$panelPivotTable.addClass("pivotTable"),this.onShowingSparklines=function(e){},this.onActionHeader=function(e,t){},this.onHeaderTouch=function(e,t){},this.onContextMenuHeaderCallback=function(e,t){},this._onCellValueChanged=function(e,t,i){},this._onChangeValueCellDeleted=function(e){},t.hasOwnProperty("onShowingSparklines")&&(this.onShowingSparklines=t.onShowingSparklines),t.hasOwnProperty("onActionHeader")&&(this.onActionHeader=t.onActionHeader),t.hasOwnProperty("onHeaderTouch")&&(this.onHeaderTouch=t.onHeaderTouch),t.hasOwnProperty("onContextMenuHeaderCallback")&&(this.onContextMenuHeaderCallback=t.onContextMenuHeaderCallback),t.hasOwnProperty("onContextMenuCellsCallback")&&(this.onContextMenuCellsCallback=t.onContextMenuCellsCallback),t.hasOwnProperty("onCellValueChanged")&&(this._onCellValueChanged=t.onCellValueChanged),t.hasOwnProperty("onChangeValueCellDeleted")&&(this._onChangeValueCellDeleted=t.onChangeValueCellDeleted),this.createLayout(),this.init(),n.push(this)}function t(i,n,o,r){for(var e=0;e<i.children().length;e++)for(var t=i.children().eq(e).children(),a=0;a<t.length;a++){var s=t[a];null==s.getAttribute("data-end-row")&&null==s.getAttribute("data-end-column")||(v(s).resizable({grid:5,helper:"resizable-helper",handles:"e,s",stop:function(e,t){r(e,t,i,n),o()}}),v(s).css("position","absolute"))}}function i(e,t,i,n){if(t.size.width!==t.originalSize.width){var o,r=v(t.element).parent().first().attr("data-row"),a=i.children().last().attr("data-row"),s=v(t.element).attr("data-end-column");if(r===a)o=t.size.width;else{var l=t.size.width-t.originalSize.width;o=n.getSizeColumn(s)+l}o<n.minColumnWidth&&(o=n.minColumnWidth),n.setSizeColumn(s,o)}if(t.size.height!==t.originalSize.height){var c=parseInt(v(t.element).css("top"),10),u=t.size.height+c,p=v(t.element).parent().first().attr("data-row");n.setHeightRowColumnsPanel(p,u)}}function o(e,t,i,n){if(t.size.height!==t.originalSize.height){var o,r=v(t.element).parent().first().attr("data-column"),a=i.children().last().attr("data-column"),s=v(t.element).attr("data-end-row");if(r===a)o=t.size.height;else{var l=t.size.height-t.originalSize.height;o=n.getSizeRow(s)+l}o<n.minRowHeight&&(o=n.minRowHeight),n.setSizeRow(s,o)}if(t.size.width!==t.originalSize.width){var c=parseInt(v(t.element).css("left"),10),u=t.size.width+c,p=v(t.element).parent().first().attr("data-column");n.setWidthColumnRowsPanel(p,u)}}function a(e,t){for(var i=0,n=0;n<e;n++)i+=this._sizeManager.getSizeColumn(n);this._$cellsArea.css("width",i+this._sizeManager.additionalWithCellsPanel+"px");for(var o=0,r=0;r<t;r++)o+=this._sizeManager.getSizeRow(r);this._$cellsArea.css("height",o+this._sizeManager.additionalHeightCellsPanel+"px")}function s(){this._$scrollPanelCells.css("height",this._$panelPivotTable.height()-this._sizeManager.columnsPanelHeight()),this._$scrollPanelCells.css("width",this._$panelPivotTable.width()-this._sizeManager.widthRowsPanel),this._$scrollPanelCells.css("margin-left",this._sizeManager.widthRowsPanel),this._$scrollPanelCells.css("margin-top",this._sizeManager.columnsPanelHeight())}function l(){this._rowsDescriptionPanel.$panel.addClass("pivotTable-rowsPanel"),this._sizeManager.widthRowsPanel=void 0,this._sizeManager.widthContentRowsPanel>.7*this._$panelPivotTable.width()&&(this._sizeManager.widthRowsPanel=.6*this._$panelPivotTable.width());var e=this._sizeManager.widthRowsPanel;this._rowsDescriptionPanel.$panel.css("width",e),this._rowsDescriptionPanel.$panel.css("height",this._$panelPivotTable.height()),this._rowsDescriptionPanel.$rowsArea.css("width",this._sizeManager.widthContentRowsPanel),this._rowsDescriptionPanel.$rowsArea.css("height",this._$panelPivotTable.height()-this._sizeManager.columnsPanelHeight()),this._rowsDescriptionPanel.$titlePanel.css("width",this._sizeManager.widthContentRowsPanel),this._rowsDescriptionPanel.$titlePanel.css("height",this._sizeManager.columnsPanelHeight()-1),this._rowsDescriptionPanel.$titlePanel.css("padding-top",this._sizeManager.columnsPanelHeight()-20)}function c(){this._columnsDescriptionPanel.$panel.css("width",this._$panelPivotTable.width()-this._sizeManager.widthRowsPanel),this._columnsDescriptionPanel.$panel.css("height",this._sizeManager.columnsPanelHeight());var e=this._sizeManager.widthRowsPanel;this._columnsDescriptionPanel.$panel.css("margin-left",e-1)}function E(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t+=i+":"+e[i]+";");return t}function N(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t+=i+"='"+e[i]+"' ");return t}function g(e,t){var i={},n=null;if(e.appearance.options.useBackColor&&(i["background-color"]=e.appearance.backColor),e.appearance.options.useForeColor&&(i.color=e.appearance.foreColor),e.appearance.options.useImage)if(e.appearance.options.showValue){var o="<div class='pivotTable-cellImage pivotTable-cellImage_left "+e.appearance.cssClassImage+"'></div>",r='<span class="pivotTable-cell-content">'+t+"</span>";n="<div class='pivotTable-cellPanel' style='"+E(i)+"'>"+o+r+"</div>"}else{var a="<div class='pivotTable-cellImageContainer'>"+("<div class='pivotTable-cellImage pivotTable-cellImage_center "+e.appearance.cssClassImage+"'></div>")+"</div>";n="<div class='pivotTable-cellPanel' style='"+E(i)+"'>"+a+"</div>"}else if(e.appearance.options.showValue){var s='<span class="pivotTable-cell-content">'+t+"</span>";n="<div class='pivotTable-textCellPanel' style='"+E(i)+"'>"+s+"</div>"}else n="<div style='"+E(i)+"' class='pivotTable-cellPanel'></div>";return n}function P(e,t,i,n,o,r,a){var s=e.getDisplayValueForCell(t,i),l="",c="";"#error"===s.toLowerCase()&&(c=e.getValueCell(t,i));var u='<span class="pivotTable-cell-content" '+(void 0===c?"":"title='"+c+"'")+">"+s+"</span>",p={},h=e.getBackColorForCell(t,i),d=e.getForeColorForCell(t,i);return""!==h&&(p.background=h),""!==d&&(p.color=d),e.isUpdateableData&&e.canUpdate(t,i)&&(p["background-color"]="#FFFFE1"),e.isUpdateableData&&e.isUpdated(t,i)&&(p["background-color"]="#C5EECD"),n&&n.length&&(l=function(e,t,i,n,o){var r=t.getTuplesForCell(i,n),a=r.columns.concat(r.rows),s=t.getDisplayValueForCell(i,n),l=null,c=t.getValueCell(i,n);if(null!==c){e&&1===e.length&&a.push(e[0].uniqueName);for(var u=0;u<a.length;u++)for(var p=a[u],h=0;h<o.length;h++){var d=o[h];if(p===d.memberUniqueName)for(var m=0;m<d.conditions.length;m++){var f=d.conditions[m];if(f.conditionType===Ranet.Controls.CellConditionType.Less&&c<f.value1){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.Greater&&c>f.value1){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.Equal&&f.value1===c){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.NotEqual&&f.value1!==c){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.GreaterOrEqual&&c>=f.value1){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.LessOrEqual&&c<=f.value1){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.Between&&c>=f.value1&&c<=f.value2){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.NotBetween&&(c<=f.value1||c>=f.value2)){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.BetweenNotIncluding&&c>f.value1&&c<f.value2){l=g(f,s);break}if(f.conditionType===Ranet.Controls.CellConditionType.NotBetweenNotIncluding&&(c<f.value1||c>f.value2)){l=g(f,s);break}}}return l}}(o,e,t,i,n)),e.isSparkline(t,i)&&(l="<div style='height:"+r+"px;' data-sparkline='"+s+"'>"+s+"</div>"),l||(l="<div class='pivotTable-textCellPanel' style='"+E(p)+" '>"+u+"</div>"),l}function _(e,t,i,n,o,r,a,s,l){for(var c="",u=o,p=e.absoluteIndexItemToHierarchyIndexRows[r],h=a;h<e.maxRows;){var d=t.rangeSizeRows(p,h),m=h;p+1!==e.countHierarchyInRows&&(m=h+d.Count-1);var f=m+1===e.maxRows,g=e.getDataRowAction(p,h).caption,_=e.rowIsParent(p,m),y=e.getRowLevelDepth(p,h),C={},v={},b=[];v.title=g,b.push("pivotTable-contentHeader"),u<0&&(C.top=Math.abs(u)+"px");for(var w=y*i.levelDepthOffset,S=0;S<y;S++){var x={};x.left=S*i.levelDepthOffset+"px",x.height=d.Size+1+"px",x.width=i.levelDepthOffset+"px",x.top=u+"px",f&&(x["border-bottom-width"]="1px"),c+="<div class='"+["pivotTable-panel-indent","pivotTable-panel-indent_border_bottom"].join(" ")+"' style='"+E(x)+"'></div>"}var D={},T={},P=[];P.push("pivotTable-header"),P.push("pivotTable-rowHeader"),P.push("pivotTable-hierarchyItem"),l&&s.selectionCellsContainsRow(h)&&P.push("pivotTable-headerRow_state_selectedCell"),T["data-start-row"]=h,T["data-end-row"]=m,D.left=w+"px",D.top=u+"px",D.width=i.getWidthColumnRowsPanel(r)-w+"px",f&&(D["border-bottom-width"]="1px"),l&&(D["border-right-width"]="1px"),D.height=d.Size+1+"px";var M="";_?M='<span class="pivotTable-headerItem-icon fa fa-caret-down"></span>':e.hasChildrenRowsPanel(p,m)&&(M='<span class="pivotTable-headerItem-icon fa fa-caret-right"></span>');var I="<span class='"+b.join(" ")+"' style='"+E(C)+"' "+N(v)+">"+M+g+"</span>";if(c+="<div class='"+P.join(" ")+"' style='"+E(D)+"' "+N(T)+">"+I+"</div>",h+=d.Count,n<(u+=d.Size))break}return c}function y(e,t,i,n,o,r,a,s,l){for(var c="",u=o,p=e.absoluteIndexItemToHierarchyIndexRows[r],h=a;h<e.maxRows;){var d=t.rangeSizeRows(p,h),m=h;p+1!==e.countHierarchyInRows&&(m=h+d.Count-1);var f=m+1===e.maxRows,g=e.getValueCustomPropRows(r,h).value,_={},y={},C=[];y.title=g,C.push("pivotTable-contentHeader"),u<0&&(_.top=Math.abs(u)+"px");var v={},b={},w=[];w.push("pivotTable-header"),w.push("pivotTable-rowHeader"),w.push("pivotTable-customPropertyItem"),l&&s.selectionCellsContainsRow(h)&&w.push("pivotTable-headerRow_state_selectedCell"),l&&(v["border-right-width"]="1px"),b["data-start-row"]=h,b["data-end-row"]=m,v.left="0px",v.top=u+"px",v.width=i.getWidthColumnRowsPanel(r)+"px",f&&(v["border-bottom-width"]="1px"),v.height=d.Size+1+"px";var S="<span class='"+C.join(" ")+"' style='"+E(_)+"' "+N(y)+">"+g+"</span>";if(c+="<div class='"+w.join(" ")+"' style='"+E(v)+"' "+N(b)+">"+S+"</div>",h+=d.Count,n<(u+=d.Size))break}return c}function f(e,t,i,n,o,r,a,s){for(var l=o,c=o,u="",p=e.absoluteIndexItemToHierarchyIndexColumns[n],h=s;h<e.maxColumns;){var d=t.rangeSizeColumns(p,h),m=h;p+1!==e.countHierarchyInColumns&&(m=h+d.Count-1);var f=m+1===e.maxColumns,g=e.getDataColumnAction(h,p).caption,_=e.columnIsParent(m,p),y=e.getColumnLevelDepth(h,p),C="";_?C='<span class="pivotTable-headerItem-icon fa fa-caret-down"></span>':e.hasChildrenColumnsPanel(m,p)&&(C='<span class="pivotTable-headerItem-icon fa fa-caret-right"></span>');var v={},b=[],w=[];b.title=g,w.push("pivotTable-contentHeader"),l<0&&(v.left=Math.abs(l)+"px");for(var S=0;S<y;S++){var x={};x.top=S*i.levelDepthOffset+"px",x.left=l+"px",x.width=d.Size+1+"px",x.height=i.levelDepthOffset+"px",f&&(x["border-right-width"]="1px"),u+="<div class='"+["pivotTable-panel-indent","pivotTable-panel-indent_border_top"].join(" ")+"' style='"+E(x)+"'></div>"}var D=y*i.levelDepthOffset,T={},P=["pivotTable-header","pivotTable-columnHeader","pivotTable-hierarchyItem"],M={};n+1===e.countRowsInColumns&&r.selectionCellsContainsColumn(h)&&P.push("pivotTable-headerColumn_state_selectedCell"),T["data-end-column"]=m,T["data-start-column"]=h,M.top=D+"px",M.left=l+"px",M.height=i.getHeightRowColumnsPanel(n)-D+"px",f?(M["border-right-width"]="1px",M.width=d.Size+1+"px"):M.width=d.Size+"px",0===e.countColumnsInRows&&0===h&&(M.left="3px",M.width=d.Size-2+"px",v.left="0px"),n+1===e.countRowsInColumns&&(M["border-bottom-width"]="1px");var I="<span class='"+w.join(" ")+"' style='"+E(v)+"' "+N(b)+">"+C+g+"</span>";if(u+="<div class='"+P.join(" ")+"' style='"+E(M)+"' "+N(T)+">"+I+"</div>",h+=d.Count,l+=d.Size,a<(c+=d.Size))break}return u}function C(e,t,i,n,o,r,a,s){for(var l=o,c=o,u="",p=e.absoluteIndexItemToHierarchyIndexColumns[n],h=s;h<e.maxColumns;){var d=t.rangeSizeColumns(p,h),m=h;p+1!==e.countHierarchyInColumns&&(m=h+d.Count-1);var f=m+1===e.maxColumns,g=e.getValueCustomPropColumns(h,n).value,_={},y=[],C=[];y.title=g,C.push("pivotTable-contentHeader"),l<0&&(_.left=Math.abs(l)+"px");var v={},b=["pivotTable-header","pivotTable-columnHeader","pivotTable-customPropertyItem"],w={};n+1===e.countRowsInColumns&&r.selectionCellsContainsColumn(h)&&b.push("pivotTable-headerColumn_state_selectedCell"),v["data-end-column"]=m,v["data-start-column"]=h,w.top="0px",w.left=l+"px",w.height=i.getHeightRowColumnsPanel(n)-0+"px",w.width=f?d.Size+1+"px":d.Size+"px",0===e.countColumnsInRows&&0===h&&(w.left="3px",w.width=d.Size-2+"px",_.left="0px"),n+1===e.countRowsInColumns&&(w["border-bottom-width"]="1px");var S="<span class='"+C.join(" ")+"' style='"+E(_)+"' "+N(y)+">"+g+"</span>";if(u+="<div class='"+b.join(" ")+"' style='"+E(w)+"' "+N(v)+">"+S+"</div>",h+=d.Count,l+=d.Size,a<(c+=d.Size))break}return u}Object.defineProperty(e.prototype,"focusedCell",{get:function(){if(this._selectedCellManager.focusedCell&&(-1!==this._selectedCellManager.focusedCell.rowFocusedCell||-1!==this._selectedCellManager.focusedCell.columnFocusedCell)){var e={coordinates:this._selectedCellManager.focusedCell,cellData:this._dataManager.getCellData(this._selectedCellManager.focusedCell.columnFocusedCell,this._selectedCellManager.focusedCell.rowFocusedCell)};return e.rows=function(e){return{items:this._dataManager.getNeighborsHierarchyInRows(this._dataManager.countHierarchyInRows,e)}}.call(this,this._selectedCellManager.focusedCell.rowFocusedCell),e.columns=function(e){return{items:this._dataManager.getNeighborsHierarchyInColumns(e,this._dataManager.countHierarchyInColumns)}}.call(this,this._selectedCellManager.focusedCell.columnFocusedCell),e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellConditions",{get:function(){return this._cellConditions},set:function(e){this._cellConditions=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"measuresInDataSource",{get:function(){return this._measuresInDataSource},set:function(e){this._measuresInDataSource=e},enumerable:!0,configurable:!0}),e.prototype.resetScrolls=function(){this._visualStateHelper&&(this._visualStateHelper.horizontalScrollValue=0,this._visualStateHelper.verticalScrollValue=0)},e.prototype.reDraw=function(){this.updateDataSource(this.currentDataSource)},e.prototype.dispose=function(){n.pop(this)},e.prototype.resetState=function(){this.currentDataSource=void 0,this._selectedCellManager.focusedCell=void 0};var u=function(e){t(this._rowsDescriptionPanel.$rowsArea,this._sizeManager,e,o),t(this._columnsDescriptionPanel.$panel,this._sizeManager,e,i)};function p(){var e=-1,t=-1;this._selectedCellManager.focusedCell&&(e=this._selectedCellManager.focusedCell.columnFocusedCell,t=this._selectedCellManager.focusedCell.rowFocusedCell);var i=this._dataManager.maxColumns,n=this._dataManager.maxRows,o=this._$panelPivotTable.height()-this._columnsDescriptionPanel.$panel.height(),r=this._$panelPivotTable.width()-this._rowsDescriptionPanel.$panel.width();l.call(this),c.call(this),s.call(this),a.call(this,i,n),h.call(this,t,e,o,r),u.call(this,p.bind(this))}function h(e,t,i,n){(function(){var e=function(e,t){for(var i=0;i<e.length;i++){var n=v(e[i]);n.detach(),t&&setTimeout(function(e){e.remove()},10,n)}};e(this._rowsDescriptionPanel.$titlePanel.children(),!1),e(this._rowsDescriptionPanel.$rowsArea.children(),!0),e(this._$cellsArea.children(),!1),e(this._columnsDescriptionPanel.$panel.children(),!0)}).call(this),0<this._dataManager.countColumnsInRows&&this._dataManager.columns&&function(e,t,i){for(var n=0,o=0;o<i.countColumnsInRows;o++){var r;if("hierarchy"===i.indexToTypeRows[o]){var a=i.absoluteIndexItemToHierarchyIndexRows[o];r=i.getHierarchyDescriptionInRows(a).caption}else{if("customProperty"!==i.indexToTypeRows[o])throw new Error("NotImplementedException");r=i.getLevelPropertyInRows(o).name}"Measures"===r&&Ranet&&Ranet.Localization&&(r=Ranet.Localization.localize("Measures"));var s=t.getWidthColumnRowsPanel(o),l=v("<div/>");l.append(r),l.addClass("pivotTable-headItemRowsPane"),l.css("width",s-4),l.css("margin-left",n),l.attr("title",r),n+=s,e.append(l)}}(this._rowsDescriptionPanel.$titlePanel,this._sizeManager,this._dataManager),null!==this._dataManager.columns&&null!==this._dataManager.columns.members&&null!==this._dataManager.rows&&null!==this._dataManager.rows.hierarchies&&function(e,t,i,n,o){for(var r=n.currentRow,a=n.offsetCurrentRow,s=e.height(),l="",c=0,u=0;u<i.countColumnsInRows;u++){var p={},h={},d=[];d.push("pivotTable-panel"),h.left=c+"px",h.width=t.getWidthColumnRowsPanel(u)+"px";var m,f=u+1===i.countColumnsInRows;if(p["data-column"]=u,"hierarchy"===i.indexToTypeRows[u])p["data-index-hierarchy"]=i.absoluteIndexItemToHierarchyIndexRows[u],m=_(i,n,t,s,a,u,r,o,f);else{if("customProperty"!==i.indexToTypeRows[u])throw new Error("InvalidOperationException");m=y(i,n,t,s,a,u,r,o,f)}var g="<div class='"+d.join(" ")+"' style='"+E(h)+"' "+N(p)+">"+m+"</div>";c+=t.getWidthColumnRowsPanel(u),l+=g}e.get(0).innerHTML=l}(this._rowsDescriptionPanel.$rowsArea,this._sizeManager,this._dataManager,this._visualStateHelper,this._selectedCellManager),function(e,t,i,n,o){for(var r=n.currentColumn,a=n.offsetCurrentColumn,s=0,l="",c=e.width(),u=0;u<i.countRowsInColumns;u++){var p={},h={};p.top=s+"px",p.height=t.getHeightRowColumnsPanel(u)+"px",h["data-row"]=u;var d="";if("hierarchy"===i.indexToTypeColumns[u])h["data-index-hierarchy"]=i.absoluteIndexItemToHierarchyIndexColumns[u],d=f(i,n,t,u,a,o,c,r);else{if("customProperty"!==i.indexToTypeColumns[u])throw new Error("InvalidOperationException");d=C(i,n,t,u,a,o,c,r)}var m="<div class='"+["pivotTable-panel"].join(" ")+"' style='"+E(p)+"' "+N(h)+">"+d+"</div>";s+=t.getHeightRowColumnsPanel(u),l+=m}e.get(0).innerHTML=l}(this._columnsDescriptionPanel.$panel,this._sizeManager,this._dataManager,this._visualStateHelper,this._selectedCellManager),function(e,t,i,n,o,r,a,s,l){for(var c=n.offsetCurrentColumnAbsolute,u=0,p="",h=n.currentColumn;h<i.maxColumns;h++){var d=t.getSizeColumn(h),m={},f={};f["data-column"]=h,m.left=c+"px",m.width=d+"px";for(var g=0,_="",y=n.offsetCurrentRowAbsolute,C=n.currentRow;C<i.maxRows;C++){var v=t.getSizeRow(C),b=P(i,h,C,a,s,v),w=0===i.countColumnsInRows&&h===n.currentColumn,S=0===i.countRowsInColumns&&C===n.currentRow,x={},D=["pivotTable-cell"],T={};if(T["data-row"]=C,x.top=y+"px",x.height=v+"px",x.width=d+"px",x["line-height"]=v-1+"px",w&&(x["border-left-width"]="1px",x.left="2px",x.width=d-2+"px",m.width=d-2+"px"),S&&(x["border-top-width"]="1px",x.top="2px"),!1===l.hasSelectionCells?null!=l.focusedCell&&C===l.focusedCell.rowFocusedCell&&l.focusedCell.columnFocusedCell===h&&D.push("pivotTable-cell_state_selected"):l.selectionCellsContainsCell(h,C)&&(C===l.focusedCell.rowFocusedCell&&l.focusedCell.columnFocusedCell===h||D.push("pivotTable-selectedCell")),y+=v,_+="<div style='"+E(x)+"' class='"+D.join(" ")+"' "+N(T)+">"+b+"</div>",o<(g+=v))break}if(c+=d,p+="<div style='"+E(m)+"' class='"+["pivotTable-panel"].join(" ")+"' "+N(f)+">"+_+"</div>",r<(u+=d))break}e.get(0).innerHTML=p}(this._$cellsArea,this._sizeManager,this._dataManager,this._visualStateHelper,i,n,this.cellConditions,this.measuresInDataSource,this._selectedCellManager),function(e,t,i,n){var o=v(e).find("[data-sparkline]");if(0!==o.length){for(var r=[],a=0;a<o.length;a++){for(var s=o[a],l=v(s).parents(),c=void 0,u=void 0,p={},h=0;h<l.length;h++)if(l[h].hasAttribute("data-column")){if(c=v(l[h]).attr("data-column"),void 0!==u)break}else if(l[h].hasAttribute("data-row")&&(u=v(l[h]).attr("data-row"),void 0!==c))break;for(var d=n.getTuplesForCell(c,u),m=d.columns.concat(d.rows),f=0;f<m.length;f++)for(var g=m[f],_=0;_<i.length;_++)g===i[_].memberUniqueName&&(p=i[_].conditions[0].appearance.sparklines);r.push({column:c,row:u,element:s,options:p})}t(r)}}(this._$cellsArea,this.onShowingSparklines,this.cellConditions,this._dataManager)}return e.prototype.createLayout=function(){var e=this._$panelPivotTable;if(null==e.height()||null==e.width())throw new Error("Size equal null.");this._rowsDescriptionPanel=function(){var e=v("<div/>");e.addClass("pivotTable-blockPanels pivotTable-areaNoSelect");var t=v("<div/>");t.addClass("pivotTable-blockPanels");var i=v("<div/>");return e.append(i),e.append(t),{$panel:e,$titlePanel:i,$rowsArea:t}}(),e.append(this._rowsDescriptionPanel.$panel),this._columnsDescriptionPanel={$panel:v('<div class="pivotTable-blockPanels pivotTable-areaNoSelect"></div>')},e.append(this._columnsDescriptionPanel.$panel),this._$scrollPanelCells=v('<div class="pivotTable-cellsScrollPanel"></div>');var t=this._$scrollPanelCells;e.append(t),this._$cellsArea=v('<div tabindex="0" class="pivotTable-areaNoSelect pivotTable-cellsPanel"></div>'),t.append(this._$cellsArea)},e.prototype.init=function(){this._dataManager=new x(this._onCellValueChanged,this._onChangeValueCellDeleted);var e=new d(this._columnsDescriptionPanel.$panel,this._rowsDescriptionPanel.$rowsArea,this._dataManager,function(e,t){this._selectedCellManager.focusedCell&&("expand"===t.actionType||"collapse"===t.actionType?"rows"===t.place?t.startRow:"columns"===t.place&&t.startColumn:t.actionType);this.onActionHeader(e,t)}.bind(this),this.onHeaderTouch.bind(this),this.onContextMenuHeaderCallback.bind(this));e.activateMouseActions(),e.activateContextMenu(),this._sizeManager=new r,this._visualStateHelper=new D(this._sizeManager,this._dataManager);var n=this;this._selectedCellManager=new w(this._$cellsArea,this._$scrollPanelCells,this._columnsDescriptionPanel.$panel,this._rowsDescriptionPanel.$rowsArea,this._sizeManager,this._dataManager,function(e){n._editorCellsManager.focusedCell=e}),this._selectedCellManager.initMouseController(),this._selectedCellManager.initKeyBoardController(),new b(this._$cellsArea,this._dataManager,this._selectedCellManager,this.onContextMenuCellsCallback.bind(this)).activateContextMenu(),function(){var s,l,c=this;e=this._$scrollPanelCells,t=function(e,t){c._visualStateHelper.horizontalScrollValue=e,c._visualStateHelper.verticalScrollValue=t;var i=c._selectedCellManager.focusedCell?c._selectedCellManager.focusedCell.columnFocusedCell:-1,n=c._selectedCellManager.focusedCell?c._selectedCellManager.focusedCell.rowFocusedCell:-1,o=c._$panelPivotTable.width()-c._rowsDescriptionPanel.$panel.width()+(e-c._visualStateHelper.offsetCurrentColumnAbsolute),r=c._$panelPivotTable.height()-c._columnsDescriptionPanel.$panel.height()+(t-c._visualStateHelper.offsetCurrentRowAbsolute);if(h.call(c,n,i,r,o),c._dataManager.isUpdateableData&&Ranet.ClientInformation.isIE()){var a=c._$cellsArea.find(".pivotTable-cell_state_selected");a.focus()}s&&clearTimeout(s),l&&clearTimeout(l),s=setTimeout(u.bind(c,p.bind(c)),500),l=setTimeout(function(){},50)},i=e.scrollLeft(),n=e.scrollTop(),e.scroll(function(){i!==e.scrollLeft()&&(i=e.scrollLeft()),n!==e.scrollTop()&&(n=e.scrollTop()),t(i,n)});var e,t,i,n}.call(this),this._editorCellsManager=new S(this._$cellsArea,this._$scrollPanelCells,this._selectedCellManager,this._dataManager,function(e,t,i){(function(e,t,i){var n=P(this._dataManager,t,i,this.cellConditions,this.measuresInDataSource,this._sizeManager.getSizeRow(i)),o=e.children()[0];v(o).replaceWith(n)}).call(n,e,t,i)}),this._editorCellsManager.activate()},e.prototype.updateDataSource=function(e){if(void 0!==e){var t=!1;this._dataManager.hasLocalChanges&&(t=!0,this._dataManager.saveLocalChanges()),void 0!==this.currentDataSource&&this.currentDataSource!==e&&this._sizeManager.saveState(this._dataManager),this._dataManager.setNewDataSource(e),this._sizeManager.countRowsColumnsPane=this._dataManager.countRowsInColumns,this._sizeManager.countColumnsRowsPane=this._dataManager.countColumnsInRows,void 0!==this.currentDataSource&&this.currentDataSource!==e&&this._sizeManager.restoreState(this._dataManager),t&&this._dataManager.restoreLocalChanges(),this.currentDataSource=e,function(){for(var e,t,i=0;i<this._dataManager.countColumnsInRows;i++)if("hierarchy"===this._dataManager.indexToTypeRows[i])t=this._dataManager.absoluteIndexItemToHierarchyIndexRows[i],e=this._dataManager.getCountLevelDepthInColumnFromRowsPane(t),this._sizeManager.setDefaultWidthColumnInRowsPanel(i,120+15*e);else{if("customProperty"!==this._dataManager.indexToTypeRows[i])throw new Error("InvalidOperationException");this._sizeManager.setDefaultWidthColumnInRowsPanel(i,110)}for(var n=0;n<this._dataManager.countRowsInColumns;n++)if("hierarchy"===this._dataManager.indexToTypeColumns[n])t=this._dataManager.absoluteIndexItemToHierarchyIndexColumns[n],e=this._dataManager.getCountLevelDepthInRowFromColumnsPane(t),this._sizeManager.setDefaultHeightRowInColumnsPanel(n,14+22*e);else{if("customProperty"!==this._dataManager.indexToTypeColumns[n])throw new Error("InvalidOperationException");this._sizeManager.setDefaultHeightRowInColumnsPanel(n,23)}}.call(this);var i=this._dataManager.maxColumns,n=this._dataManager.maxRows;this._selectedCellManager.refresh(i,n),this._selectedCellManager.focusedCell&&(i<=this._selectedCellManager.focusedCell.columnFocusedCell||n<=this._selectedCellManager.focusedCell.rowFocusedCell)&&(this._selectedCellManager.focusedCell={rowFocusedCell:-1,columnFocusedCell:-1}),l.call(this),c.call(this),s.call(this),a.call(this,i,n),v(this._$scrollPanelCells).scrollTop(this._visualStateHelper.verticalScrollValue),v(this._$scrollPanelCells).scrollLeft(this._visualStateHelper.horizontalScrollValue);var o=this._selectedCellManager.focusedCell?this._selectedCellManager.focusedCell.columnFocusedCell:-1,r=this._selectedCellManager.focusedCell?this._selectedCellManager.focusedCell.rowFocusedCell:-1;h.call(this,r,o,this._$panelPivotTable.height()-this._columnsDescriptionPanel.$panel.height(),this._$panelPivotTable.width()-this._rowsDescriptionPanel.$panel.width()),u.call(this,p.bind(this))}},e.prototype.clearLocalChanges=function(){this._dataManager.clearLocalChanges()},e}(),x=function(){function a(e,t){if(!e)return{countItems:0};for(var i=e.length,n=[],o=0,r={},a={},s=0;s<e.length;s++){var l=t[e[s].uniqueName];if(n[o]="hierarchy",r[o]=s,l){for(var c=0;c<l.length;c++)n[++o]="customProperty",r[o]=s,a[o]=c;i+=l.length}o++}return{countItems:i,indexItemToType:n,absoluteIndexItemToHierarchyIndex:r,absoluteIndexItemToIndexProp:a}}function s(e){for(var t={},i=0;i<e.positions.length;i++)for(var n=e.positions[i],o=0;o<n.positions.length;o++){var r=e.members[n.positions[o].id],a=e.hierarchies[o];r.memberProperties&&(t[a.uniqueName]=r.memberProperties.map(function(e){return e.name}))}return t}function e(e,t){this.isUpdateableData=!1,this._onCellValueChanged=e,this._onChangeValueCellDeleted=t}function o(e){for(var t={},i=[],n=e.length,o=0,r=0;r<n;r++){var a=e[r];1!==t[a]&&(t[a]=1,i[o++]=a)}return i}function r(e,t){for(var i=this.getTuplesForCell(e,t),n={},o=0;o<i.columns.length;o++)n[this.getHierarchyInColumns(o).uniqueName]=i.columns[o];for(var r=0;r<i.rows.length;r++)n[this.getHierarchyInRows(r).uniqueName]=i.rows[r];return n}return e.prototype.setNewDataSource=function(e){if(this.maxRows=this.maxColumns=0,this.countColumnsInRows=this.countRowsInColumns=0,this.countHierarchyInRows=this.countHierarchyInColumns=0,e.cells.hasOwnProperty("canUpdateStates")?this.isUpdateableData=!0:this.isUpdateableData=!1,e.rows){var t=s(e.rows),i=a(e.rows.hierarchies,t);this.countColumnsInRows=i.countItems,this.indexToTypeRows=i.indexItemToType,this.absoluteIndexItemToHierarchyIndexRows=i.absoluteIndexItemToHierarchyIndex,this._absoluteIndexItemToIndexPropRows=i.absoluteIndexItemToIndexProp,this.hierarchyInRows=e.rows.hierarchies,this.countHierarchyInRows=e.rows.positions[0].positions.length}if(e.columns){var n=s(e.columns),o=a(e.columns.hierarchies,n);this.countRowsInColumns=o.countItems,this.indexToTypeColumns=o.indexItemToType,this.absoluteIndexItemToHierarchyIndexColumns=o.absoluteIndexItemToHierarchyIndex,this._absoluteIndexItemToIndexPropColumns=o.absoluteIndexItemToIndexProp,this.hierarchyInColumns=e.columns.hierarchies,this.countHierarchyInColumns=e.columns.positions[0].positions.length}0!==e.cells.values.length?(this.maxColumns=e.cells.values[0].length,this.maxRows=e.cells.values.length):null!=e.rows&&(this.maxRows=e.rows.positions.length);var r=function(e,t,i){for(var n=t,o=i,r=[],a=[],s=[],l=[],c=[],u=[],p=0;p<o;p++)a[p]=new Array(n),l[p]=new Array(n),c[p]=new Array(n),s[p]=new Array(n),r[p]=new Array(n),u[p]=new Array(n);return e.cells?(r=e.cells.values,a=e.cells.displayValues,s=e.cells.foreColors,{displayValueCells:a,backColorCells:l=e.cells.backColors,formatStringCells:c=e.cells.formatStrings,foreColorCells:s,valueCells:r,canUpdateStates:u=e.cells.canUpdateStates}):{displayValueCells:a,backColorCells:l,formatStringCells:c,foreColorCells:s,valueCells:r,canUpdateStates:u}}(e,this.maxColumns,this.maxRows);this.displayValueCells=r.displayValueCells,this.backColorCells=r.backColorCells,this.formatStringCells=r.formatStringCells,this.rows=e.rows,this.columns=e.columns,this.foreColorCells=r.foreColorCells,this.valueCells=r.valueCells,this.isUpdateableData&&(this.canUpdateStates=r.canUpdateStates)},e.prototype.getHierarchyDescriptionInRows=function(e){return this.hierarchyInRows[e]},e.prototype.getHierarchyDescriptionInColumns=function(e){return this.hierarchyInColumns[e]},e.prototype.getLevelPropertyInRows=function(e){var t=this.absoluteIndexItemToHierarchyIndexRows[e];return this.rows.members[this.rows.positions[0].positions[t].id].memberProperties[this._absoluteIndexItemToIndexPropRows[e]]},e.prototype.getLevelPropertyInColumns=function(e){var t=this.absoluteIndexItemToHierarchyIndexColumns[e];return this.columns.members[this.columns.positions[0].positions[t].id].memberProperties[this._absoluteIndexItemToIndexPropColumns[e]]},e.prototype.getCellData=function(e,t){return{displayValue:this.getDisplayValueForCell(e,t),value:this.getValueCell(e,t),backColor:this.getBackColorForCell(e,t),foreColor:this.getForeColorForCell(e,t),formatString:this.getFormatStringForCell(e,t)}},e.prototype.getTuplesForCell=function(e,t){for(var i=[],n=[],o=0;o<this.countHierarchyInRows;o++)i.push(this.rows.members[this.rows.positions[t].positions[o].id].uniqueName);for(var r=0;r<this.countHierarchyInColumns;r++)n.push(this.columns.members[this.columns.positions[e].positions[r].id].uniqueName);return{rows:i,columns:n}},e.prototype.getDescriptionOfTuplesForCell=function(e,t){for(var i=[],n=[],o=0;o<this.countHierarchyInRows;o++)i.push({memberUniqueName:this.rows.members[this.rows.positions[t].positions[o].id].uniqueName,memberCaption:this.rows.members[this.rows.positions[t].positions[o].id].caption,hierarchyUniqueName:this.rows.hierarchies[o].uniqueName,hierarchyCaption:this.rows.hierarchies[o].caption,isCalculatedMember:this.rows.members[this.rows.positions[t].positions[o].id].isCalculated});for(var r=0;r<this.countHierarchyInColumns;r++)n.push({memberUniqueName:this.columns.members[this.columns.positions[e].positions[r].id].uniqueName,memberCaption:this.columns.members[this.columns.positions[e].positions[r].id].caption,hierarchyUniqueName:this.columns.hierarchies[r].uniqueName,hierarchyCaption:this.columns.hierarchies[r].caption,isCalculatedMember:this.columns.members[this.columns.positions[e].positions[r].id].isCalculated});return{rows:i,columns:n}},e.prototype.getValueCustomPropRows=function(e,t){var i=this.absoluteIndexItemToHierarchyIndexRows[e],n=this.rows;return n.members[n.positions[t].positions[i].id].memberProperties[this._absoluteIndexItemToIndexPropRows[e]]},e.prototype.getValueCustomPropColumns=function(e,t){var i=this.absoluteIndexItemToHierarchyIndexColumns[t],n=this.columns;return n.members[n.positions[e].positions[i].id].memberProperties[this._absoluteIndexItemToIndexPropColumns[t]]},e.prototype.getValueCell=function(e,t){return this.valueCells[t][e]},e.prototype.getDisplayValueForCell=function(e,t){return this.isUpdated(e,t)?this.getUpatedValue(e,t):this.displayValueCells[t][e]},e.prototype.getFormatStringForCell=function(e,t){return this.formatStringCells[t][e]},e.prototype.isSparkline=function(e,t){return"Sparkline"===this.getFormatStringForCell(e,t)},e.prototype.getHierarchyInColumns=function(e){return this.columns.hierarchies[e]},e.prototype.getHierarchyInRows=function(e){return this.rows.hierarchies[e]},e.prototype.getAncestorsInRows=function(e,t){var i=this.rows,n=i.positions[t].positions[e].parentId,o=[];if(-1===n)return o;for(var r=n,a=t-1;0<=a;a--)if(i.positions[a].positions[e].id===r){if(o.push(i.members[r].uniqueName),-1===i.positions[a].positions[e].parentId)break;r=i.positions[a].positions[e].parentId}return o},e.prototype.getAncestorsInColumns=function(e,t){var i=this.columns,n=i.positions[e].positions[t].parentId,o=[];if(-1===n)return o;for(var r=n,a=e-1;0<=a;a--)if(i.positions[a].positions[t].id===r){if(o.push(i.members[r].uniqueName),-1===i.positions[a].positions[t].parentId)break;r=i.positions[a].positions[t].parentId}return o},e.prototype.getBackColorForCell=function(e,t){return this.backColorCells[t][e]},e.prototype.getForeColorForCell=function(e,t){return this.foreColorCells[t][e]},e.prototype.getDataRowAction=function(e,t){var i=this.rows,n=i.members[i.positions[t].positions[e].id];return n.countChildren=this.getCountChildrenRowsPanel(e,t),n},e.prototype.getDataColumnAction=function(e,t){var i=this.columns,n=i.members[i.positions[e].positions[t].id];return n.countChildren=this.getCountChildrenColumnsPanel(e,t),n},e.prototype.rowIsParent=function(e,t){var i=this.rows.positions[t].positions[e].id;if(this.rows.positions.length<=t+1)return!1;if(this.rows.positions[t+1].positions[e].id===i){for(var n=t+2;t<this.rows.positions.length;n++)if(this.rows.positions[n].positions[e].id!==i){var o=this.rows.positions[n].positions[e].parentId;if(-1===o)return!1;if(i===o)return!0}return!1}var r=this.rows.positions[t+1].positions[e].parentId;return-1!==r&&i===r},e.prototype.hasChildrenRowsPanel=function(e,t){return 0!==this.rows.positions[t].positions[e].childCount},e.prototype.hasChildrenColumnsPanel=function(e,t){return 0!==this.columns.positions[e].positions[t].childCount},e.prototype.getCountChildrenColumnsPanel=function(e,t){return this.columns.positions[e].positions[t].childCount},e.prototype.getCountChildrenRowsPanel=function(e,t){return this.rows.positions[t].positions[e].childCount},e.prototype.columnIsParent=function(e,t){var i=this.columns.positions[e].positions[t].id;if(this.columns.positions.length<=e+1)return!1;if(this.columns.positions[e+1].positions[t].id===i){for(var n=e+2;n<this.columns.positions.length;n++)if(this.columns.positions[n].positions[t].id!==i){var o=this.columns.positions[n].positions[t].parentId;if(-1===o)return!1;if(i===o)return!0}return!1}var r=this.columns.positions[e+1].positions[t].parentId;return-1!==r&&i===r},e.prototype.getRowLevelDepth=function(e,t){var i=this.rows.positions[t].positions[e].parentId;if(-1===i)return 0;for(var n=0,o=t;!(--o<0||this.rows.positions[o].positions[e].parentId!==i&&(this.rows.positions[o].positions[e].id===i&&(i=this.rows.positions[o].positions[e].parentId,n+=1),-1===this.rows.positions[o].positions[e].parentId)););return n},e.prototype.getColumnLevelDepth=function(e,t){var i=this.columns.positions[e].positions[t].parentId;if(-1===i)return 0;for(var n=0,o=e;!(--o<0||this.columns.positions[o].positions[t].parentId!==i&&(this.columns.positions[o].positions[t].id===i&&(i=this.columns.positions[o].positions[t].parentId,n+=1),-1===this.columns.positions[o].positions[t].parentId)););return n},e.prototype.getCountLevelDepthInColumnFromRowsPane=function(e){for(var t=[],i=0;i<this.rows.positions.length;i++){var n=this.rows.positions[i].positions[e];t.push(this.rows.members[n.id].levelDepth)}return o(t).length},e.prototype.getCountLevelDepthInRowFromColumnsPane=function(e){for(var t=[],i=0;i<this.columns.positions.length;i++){var n=this.columns.positions[i].positions[e];t.push(this.columns.members[n.id].levelDepth)}return o(t).length},e.prototype.getNeighborsHierarchyInColumns=function(e,t){for(var i=[],n=t-1;0<=n;n--)i.push({ancestors:this.getAncestorsInColumns(e,n),data:this.getDataColumnAction(e,n),hierarchy:this.getHierarchyInColumns(n)});return i},e.prototype.getNeighborsHierarchyInRows=function(e,t){for(var i=[],n=e-1;0<=n;n--)i.push({ancestors:this.getAncestorsInRows(n,t),data:this.getDataRowAction(n,t),hierarchy:this.getHierarchyInRows(n)});return i},e.prototype.getCountRowsMemberData=function(e,t){for(var i=0,n=this.rows,o=n.positions[t].positions[e].id,r=t;0<=r;r--){if(n.positions[r].positions[e].id!==o)break;i++}return i},e.prototype.getCountColumnsMemberData=function(e,t){for(var i=0,n=this.columns,o=n.positions[e].positions[t].id,r=e;0<=r;r--){if(n.positions[r].positions[t].id!==o)break;i++}return i},e.prototype.setNewValue=function(e,t,i){void 0===this._updatedCells&&(this._updatedCells=new Array),!1===this._updatedCells.hasOwnProperty(e)&&(this._updatedCells[e]=new Array),this._updatedCells[e][t]=i;var n=this.getValueCell(e,t),o=r.call(this,e,t);this._onCellValueChanged(o,i,n)},e.prototype.isUpdated=function(e,t){return!(void 0===this._updatedCells||!this._updatedCells.hasOwnProperty(e)||!this._updatedCells[e].hasOwnProperty(t))},e.prototype.canUpdate=function(e,t){return this.canUpdateStates[t][e]},e.prototype.deleteUpdatedValue=function(e,t){delete this._updatedCells[e][t];var i=r.call(this,e,t);this._onChangeValueCellDeleted(i)},e.prototype.getUpatedValue=function(e,t){return this._updatedCells[e][t]},e.prototype.clearLocalChanges=function(){this._updatedCells=void 0,this._localChanges=void 0},e.prototype.saveLocalChanges=function(){void 0===this._localChanges&&(this._localChanges={});var e=this._updatedCells;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];for(var n in i)if(i.hasOwnProperty(n)){var o=this.getTuplesForCell(t,n),r=o.rows.concat(o.columns).join(",");this._localChanges[r]=e[t][n]}}},e.prototype.restoreLocalChanges=function(){this._updatedCells={};for(var e=0;e<this.maxColumns;e++)for(var t=0;t<this.maxRows;t++){var i=this.getTuplesForCell(e,t),n=i.rows.concat(i.columns).join(",");this._localChanges.hasOwnProperty(n)&&(void 0===this._updatedCells&&(this._updatedCells=new Array),!1===this._updatedCells.hasOwnProperty(e)&&(this._updatedCells[e]=new Array),this._updatedCells[e][t]=this._localChanges[n],delete this._localChanges[n])}},Object.defineProperty(e.prototype,"hasLocalChanges",{get:function(){return void 0!==this._updatedCells&&0!==this._updatedCells.length||function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(this._localChanges)},enumerable:!0,configurable:!0}),e}(),D=function(){function e(e,t){this.sizeManager=e,this.dataManager=t,this._horizontalScrollValue=0,this._verticalScrollValue=0,this.currentColumn=0,this.offsetCurrentColumn=0,this.offsetCurrentColumnAbsolute=0,this.currentRow=0,this.offsetCurrentRow=0,this.offsetCurrentRowAbsolute=0}return Object.defineProperty(e.prototype,"horizontalScrollValue",{get:function(){return this._horizontalScrollValue},set:function(e){this._horizontalScrollValue=e;var t=function(e,t,i){for(var n=0,o=0;o<e.maxColumns;o++){var r=n;if(i<(n+=t.getSizeColumn(o)))return{currentColumn:o,offsetCurrentColumn:r}}}(this.dataManager,this.sizeManager,this._horizontalScrollValue);t&&(this.currentColumn=t.currentColumn,this.offsetCurrentColumn=t.offsetCurrentColumn-this._horizontalScrollValue,this.offsetCurrentColumnAbsolute=t.offsetCurrentColumn)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalScrollValue",{get:function(){return this._verticalScrollValue},set:function(e){this._verticalScrollValue=e;var t=function(e,t,i){for(var n=0,o=0;o<e.maxRows;o++){var r=n;if(i<(n+=t.getSizeRow(o)))return{currentRow:o,offsetCurrentRow:r}}}(this.dataManager,this.sizeManager,this._verticalScrollValue);t&&(this.currentRow=t.currentRow,this.offsetCurrentRow=t.offsetCurrentRow-this._verticalScrollValue,this.offsetCurrentRowAbsolute=t.offsetCurrentRow)},enumerable:!0,configurable:!0}),e.prototype.rangeSizeRows=function(e,t){for(var i=0,n=0,o=t;o<this.dataManager.rows.positions.length;o++){if(i+=this.sizeManager.getSizeRow(o),n++,this.dataManager.rows.positions.length>o+1==!1)break;if(this.dataManager.rows.positions[o].positions[e].id!==this.dataManager.rows.positions[o+1].positions[e].id)break}return{Count:n,Size:i}},e.prototype.rangeSizeColumns=function(e,t){for(var i=0,n=0,o=t;o<this.dataManager.columns.positions.length;o++){if(i+=this.sizeManager.getSizeColumn(o),n++,this.dataManager.columns.positions.length>o+1==!1)break;if(this.dataManager.columns.positions[o].positions[e].id!==this.dataManager.columns.positions[o+1].positions[e].id)break}return{Count:n,Size:i}},e}();v.pivotTable=function(e,t){var i={},n=this;n.settings={};var o={};n.init=function(){n.settings=v.extend({},i,t),o=new a(e.id,n.settings),n.settings.hasOwnProperty("dataSource")&&o.updateDataSource(n.settings.dataSource)},n.resetScrolls=function(){o.resetScrolls()},n.getInfoFocusedCell=function(){return o.focusedCell},n.getAllHierarchies=function(){if(void 0===o.currentDataSource||null===o.currentDataSource)return[];var e=null==o.currentDataSource.rows?[]:o.currentDataSource.rows.hierarchies,t=null==o.currentDataSource.columns?[]:o.currentDataSource.columns.hierarchies;return e.concat(t)},Object.defineProperty(n,"currentDataSource",{get:function(){return o.currentDataSource},enumerable:!0,configurable:!0}),n.clear=function(){v(e).empty(),o.resetState()},n.clearLocalChanges=function(){o.clearLocalChanges()},n.destroy=function(){o.dispose()},n.reDraw=function(){o.reDraw()},n.option=function(e){e.hasOwnProperty("onActionHeader")&&(o.onActionHeader=e.onActionHeader),e.hasOwnProperty("cellConditions")&&(o.cellConditions=e.cellConditions),e.hasOwnProperty("measuresInDataSource")&&(o.measuresInDataSource=e.measuresInDataSource),e.hasOwnProperty("dataSource")&&o.updateDataSource(e.dataSource)},n.init()},v.fn.pivotTable=function(t){return this.each(function(){if(null==v(this).data("pivotTable")){var e=new v.pivotTable(this,t);v(this).data("pivotTable",e)}})},(C=v).countLines=function(n,e){e=C.extend({},{recalculateCharWidth:!0,charsMode:"random",fontAttrs:["font-family","font-size","text-decoration","font-style","font-weight"]},e);var t,i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";n.jquery||(n=C(n));var o=n.val();switch(e.charsMode){case"random":for(e.chars="",i+=".,?!-+;:'\"",t=1;t<=12;t++)e.chars+=i[Math.floor(Math.random()*i.length)];break;case"alpha":e.chars=i;break;case"alpha_extended":e.chars=i+".,?!-+;:'\"";break;case"from_ta":if(o.length<15)e.chars=i;else for(t=1;t<=15;t++)e.chars+=o[Math.floor(Math.random()*o.length)]}C.isArray(e.chars)||(e.chars=e.chars.split(""));var r="";for(t=1;t<=10;t++)r+=Math.floor(10*Math.random())+1;n.after("<span id='s"+r+"'></span>");var a=C("#s"+r);a.hide(),C.each(e.fontAttrs,function(e,t){a.css(t,n.css(t))});var s,l=o.split("\n"),c=l.length;if(e.recalculateCharWidth||null==n.data("average_char")){var u=e.chars,p=u.length,h=0;C.each(u,function(e,t){a.text(t),h+=a.width()}),n.data("average_char",Math.ceil(h/p))}s=n.data("average_char"),a.remove();var d,m=2*(n.outerWidth()-n.width()),f=0,g=0,_=0;C.each(l,function(e,t){if((d=(t.length+1)*s+m)>=n.outerWidth()){var i=Math.floor(d/n.outerWidth());g+=i,f++}""===C.trim(t)&&_++});var y={};return y.actual=c,y.wrapped=f,y.wraps=g,y.visual=c+g,y.blank=_,y}}(jQuery);var pageDynamicPivotGrid=function(v){var n,e,c,t;(e=n||(n={}))[e.Add=0]="Add",e[e.Clear=1]="Clear",e[e.Navigate=2]="Navigate",(t=c||(c={}))[t.State=0]="State",t[t.Query=1]="Query";var i=function(){function o(e){for(var t=[],i=0;i<e.length;i++)t.push(jQuery.extend(!0,{},e[i]));return t}function i(e,t,i){if(this._indexCurrentPoint<this._historyItems.length-1&&(this._historyItems.length=this._indexCurrentPoint+1),t===c.State){var n=jQuery.extend(!0,{},e);this._historyItems.push({point:n,type:t,startActions:o(i)})}else t===c.Query&&this._historyItems.push({point:e,type:t,startActions:o(i)});this._indexCurrentPoint++}function e(i,e){this._indexCurrentPoint=-1,this._historyItems=[],this.onHistoryChanged=function(e,t){i(e,t)},this._onUpdateDataCallback=e}function t(e){var t=$.extend(!0,{},e);if(e.hasOwnProperty("point"))this._onUpdateDataCallback(t,this.getAllActions());else if(e.hasOwnProperty("action"))for(var i=this._indexCurrentPoint;0<=i;i--){var n=this._historyItems[i];if(n.hasOwnProperty("point")){var o=$.extend(!0,{},n);this._onUpdateDataCallback(o,this.getAllActions());break}}}return Object.defineProperty(e.prototype,"canGoToStart",{get:function(){return this.canGoToBack},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canGoToBack",{get:function(){return 1<this._historyItems.length&&0!==this._indexCurrentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canGoToNext",{get:function(){return this._historyItems.length-1>this._indexCurrentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canGoToEnd",{get:function(){return this.canGoToNext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastInitialHistoryPoint",{get:function(){for(var e=null,t=this._indexCurrentPoint;0<=t;t--){var i=this._historyItems[t];if(i.hasOwnProperty("point")){e=i;break}}return e},enumerable:!0,configurable:!0}),e.prototype.goToStart=function(){this.canGoToStart&&(this._indexCurrentPoint=0,t.call(this,this._historyItems[this._indexCurrentPoint]),this.onHistoryChanged(this,n.Navigate))},e.prototype.goToBack=function(){this.canGoToBack&&(this._indexCurrentPoint--,t.call(this,this._historyItems[this._indexCurrentPoint]),this.onHistoryChanged(this,n.Navigate))},e.prototype.goToNext=function(){this.canGoToNext&&(this._indexCurrentPoint++,t.call(this,this._historyItems[this._indexCurrentPoint]),this.onHistoryChanged(this,n.Navigate))},e.prototype.goToEnd=function(){this.canGoToEnd&&(this._indexCurrentPoint=this._historyItems.length-1,t.call(this,this._historyItems[this._indexCurrentPoint]),this.onHistoryChanged(this,n.Navigate))},e.prototype.getAllActions=function(){for(var e=[],t=this._indexCurrentPoint;0<=t;t--){var i=this._historyItems[t];if(i.hasOwnProperty("action"))e.push(i.action);else if(e=e.reverse(),i.hasOwnProperty("point")){e=i.startActions.concat(e);break}}return e},e.prototype.addAction=function(e){(function(e){var t=jQuery.extend(!0,{},e);this._indexCurrentPoint<this._historyItems.length-1&&(this._historyItems.length=this._indexCurrentPoint+1),this._historyItems.push({action:t}),this._indexCurrentPoint++}).call(this,e),this.onHistoryChanged(this,n.Add)},e.prototype.addStatePoint=function(e,t){i.call(this,e,c.State,t),this.onHistoryChanged(this,n.Add)},e.prototype.addQueryPoint=function(e,t){i.call(this,e,c.Query,t),this.onHistoryChanged(this,n.Add)},e.prototype.clear=function(){-1===this._indexCurrentPoint&&0===this._historyItems.length||(this._indexCurrentPoint=-1,this._historyItems.length=0,this.onHistoryChanged(this,n.Clear))},e}();function o(e){return e||(e={calculatedMembers:[],calculatedNamedSets:[]}),void 0===e.calculatedMembers&&(e.calculatedMembers=[]),void 0===e.calculatedNamedSets&&(e.calculatedNamedSets=[]),e}function l(e,t,i,n){var o={},r={};o.actionType="expand","hierarchy"===t.type?(r.uniqueName=t.defaultMember,r.hierarchyUniqueName=t.uniqueName):"level"===t.type&&(r.uniqueName=t.uniqueName,r.hierarchyUniqueName=t.uniqueName),r.axisType=i,!0===n&&("rows"===r.axisType?r.axisType="columns":"columns"===r.axisType&&(r.axisType="rows")),r.neighbors=[];for(var a=0;a<e.items.length;a++){var s=e.items[a];r.neighbors.push({uniqueName:s.data.uniqueName,hierarchyUniqueName:s.hierarchy.uniqueName,ancestors:s.ancestors})}return o.header=r,o}function u(e,t,i,n,o,r){for(var a=jQuery.Deferred(),s=void 0,l=0;l<o.length;l++){var c=o[l],u=!1;if(0===r.length){s=c;break}for(var p=0;p<r.length;p++){var h=r[p];switch(h.type){case"hierarchy":h.uniqueName===c.uniqueName&&(u=!0);break;case"level":h.parentHierarchyId===c.parentHierarchyId&&(u=!0);break;case"values":h.type===c.type&&(u=!0);break;case"calculatedNamedSet":case"namedSet":h.name===c.name&&(u=!0)}if(!1===u){s=c;break}}if(s)break}if(!s)throw new Error("NotImplementedException");switch(s.type){case"hierarchy":a.resolve([s.uniqueName]);break;case"level":a.resolve([s.parentHierarchyId]);break;case"values":a.resolve(["[Measures]"]);break;case"calculatedNamedSet":for(var d=void 0,m=0;m<t.length;m++)t[m].name===s.name&&(d=t[m]);if(!d)throw new Error("InvalidOperationException");var f={cubeName:i,connection:n,expression:d.expression,name:d.name};$.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/getHierarchiesForCustomCalculationSet",contentType:"application/json; charset=utf-8",data:JSON.stringify(f)}).done(function(e){a.resolve(e)}).fail(function(e){v.LogService.error(e),a.resolve([])});break;case"namedSet":for(var g in e)e.hasOwnProperty(g)&&e[g].name===s.name&&a.resolve(e[g].dimensions)}return a}function a(e){var t=[];if(null==e)return t;if(null!==e.hierarchies)for(var i=0;i<e.hierarchies.length;i++)t.push(e.hierarchies[i].uniqueName);return t}function s(e,t){for(var i={},n=0;n<e.length;n++){for(var o=e[n],r=0;r<o.columns.length;r++){var a=o.columns[r];if("[Measures]"!==a.hierarchyUniqueName)if(i.hasOwnProperty(a.hierarchyUniqueName)){if(-1!==i[a.hierarchyUniqueName].indexOf(a.memberUniqueName))continue;i[a.hierarchyUniqueName].push(a.memberUniqueName)}else i[a.hierarchyUniqueName]=[a.memberUniqueName]}for(var s=0;s<o.rows.length;s++){var l=o.rows[s];if("[Measures]"!==l.hierarchyUniqueName)if(i.hasOwnProperty(l.hierarchyUniqueName)){if(-1!==i[l.hierarchyUniqueName].indexOf(l.memberUniqueName))continue;i[l.hierarchyUniqueName].push(l.memberUniqueName)}else i[l.hierarchyUniqueName]=[l.memberUniqueName]}}var c=[];for(var u in i)if(i.hasOwnProperty(u)){var p=new v.Controls.MemberChoice.QueryManager(t,u).getQueryMemberWithParents(i[u]);c.push(p)}return c}$.fn.percWidth=function(){return this.outerWidth()/this.parent().outerWidth()*100},$.fn.percHeight=function(){return this.outerHeight()/this.parent().outerHeight()*100};var m=function(){if(this._$elementQueryDesigner){var e=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();this._$elementActiveFilters.data("ranetActiveFilters")&&this._$elementActiveFilters.data("ranetActiveFilters").setLayout(e)}},p=function(){var e=this._$elementPivotTable.data("pivotTable");e&&e.reDraw(),this._$elementChart.data("ranetChart")&&this._$elementChart.data("ranetChart").redraw(),this._$elementVectorMap.data("ranetVectorMap")&&this._$elementVectorMap.data("ranetVectorMap").resize()},r=function(){var e=this._$elementQueryDesigner.percWidth(),t=this._$elementCubeExplorer.percWidth();switch(this.placementLayoutModeQueryDesigner){case 0:this._$elementQueryDesigner.css("width",e+"%"),this._$elementQueryDesigner.css("height","100%"),this._$elementCubeExplorer.css("width",t+"%"),this._$elementCubeExplorer.css("height","100%"),this._$viewPanel.css("width",98-e-t+"%");break;case 1:var i=this._$queryDesignerAndCubeExplorerPanel.percWidth();this._$queryDesignerAndCubeExplorerPanel.css("width",i+"%"),this._$queryDesignerAndCubeExplorerPanel.css("height","100%"),this._$viewPanel.css("width",98-i+"%");break;case 2:this._$elementCubeExplorer.css("width",t+"%"),this._$elementCubeExplorer.css("height","100%"),this._$viewPanel.css("width",98-t+"%");break;case 3:case 4:this._$elementQueryDesigner.css("width",e+"%"),this._$elementQueryDesigner.css("height","100%"),this._$viewPanel.css("width",98-e+"%")}p.call(this)},h=function(){for(var e=0;e<2;e++)this._$elementDataViewer.removeClass("ranetDataViewerPanel_layout"+e),this._$elementActiveFilters.removeClass("ranetDynamicPivotGrid_activeFilters_layout"+e);!1===this.isVisibleActiveFilters?(this._$elementDataViewer.addClass("ranetDataViewerPanel_layout0"),this._$elementActiveFilters.addClass("ranetDynamicPivotGrid_activeFilters_layout0")):!0===this.isVisibleActiveFilters&&(this._$elementDataViewer.addClass("ranetDataViewerPanel_layout1"),this._$elementActiveFilters.addClass("ranetDynamicPivotGrid_activeFilters_layout1")),function(){this._$elementActiveFilters.hasClass("ui-resizable")&&this._$elementActiveFilters.resizable("destroy");var n=this;this._$elementActiveFilters.css("height",""),this._$elementDataViewer.css("height",""),this._$elementActiveFilters.resizable({helper:"resizable-helper",handles:"s",stop:function(e,t){var i=Math.round(n._$elementActiveFilters.percHeight());n._$elementActiveFilters.css("width",""),n._$elementActiveFilters.css("height",i+"%"),n._$elementDataViewer.css("height",100-i+"%"),p.call(n)}})}.call(this),p.call(this)},d=function(){for(var e,t,i=this.placementLayoutModeQueryDesigner,n=0;n<5;n++)this._$viewPanel.removeClass("ranetViewPanel_layout"+n),this._$elementQueryDesigner.removeClass("ranetQueryDesigner_layout"+n),this._$elementCubeExplorer.removeClass("ranetCubeExplorer_layout"+n);switch(this._$elementCubeExplorer.show(),this._$elementQueryDesigner.show(),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.show(),i){case 0:this._$viewPanel.addClass("ranetViewPanel_layout0"),this._$elementQueryDesigner.addClass("ranetQueryDesigner_layout0"),this._$elementCubeExplorer.addClass("ranetCubeExplorer_layout0"),(e=this._$elementQueryDesigner.data("ranetQueryDesigner"))&&(e.option({placementMode:v.Controls.PlacementAreaItemMode.Layout1}),e.isVisibleLayoutButton(!1)),(t=this._$elementCubeExplorer.data("ranetCubeExplorer"))&&t.isVisibleLayoutButton(!0),this._$currentPanel.prepend(this._$elementQueryDesigner),this._$currentPanel.prepend(this._$elementCubeExplorer),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.remove(),!1===this.showMetadataAndQueryDesigner&&(this._$elementQueryDesigner.hide(),this._$elementCubeExplorer.hide());break;case 1:this._$queryDesignerAndCubeExplorerPanel=$("<div/>"),this._$queryDesignerAndCubeExplorerPanel.addClass("queryDesignerAndCubeExplorerPanel"),this._$viewPanel.addClass("ranetViewPanel_layout1"),this._$elementQueryDesigner.addClass("ranetQueryDesigner_layout1"),this._$elementCubeExplorer.addClass("ranetCubeExplorer_layout1"),this._$queryDesignerAndCubeExplorerPanel.append(this._$elementCubeExplorer),this._$queryDesignerAndCubeExplorerPanel.append(this._$elementQueryDesigner),(e=this._$elementQueryDesigner.data("ranetQueryDesigner"))&&(e.option({placementMode:v.Controls.PlacementAreaItemMode.Layout2}),e.isVisibleLayoutButton(!1)),(t=this._$elementCubeExplorer.data("ranetCubeExplorer"))&&t.isVisibleLayoutButton(!0),!1===this.showMetadataAndQueryDesigner&&this._$queryDesignerAndCubeExplorerPanel.hide(),this._$currentPanel.prepend(this._$queryDesignerAndCubeExplorerPanel);break;case 2:this._$elementCubeExplorer.addClass("ranetCubeExplorer_layout2"),this._$viewPanel.addClass("ranetViewPanel_layout2"),this._$elementQueryDesigner.addClass("ranetQueryDesigner_layout2"),!1===(1===this._$currentPanel.has(this._$elementCubeExplorer).lenght)&&(this._$currentPanel.prepend(this._$elementQueryDesigner),this._$currentPanel.prepend(this._$elementCubeExplorer)),!1===this.showMetadataAndQueryDesigner&&this._$elementCubeExplorer.hide(),(t=this._$elementCubeExplorer.data("ranetCubeExplorer"))&&t.isVisibleLayoutButton(!0),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.remove();break;case 4:case 3:this._$elementCubeExplorer.addClass("ranetCubeExplorer_layout"+i),this._$viewPanel.addClass("ranetViewPanel_layout"+i),this._$elementQueryDesigner.addClass("ranetQueryDesigner_layout"+i),(e=this._$elementQueryDesigner.data("ranetQueryDesigner"))&&(3===i?e.option({placementMode:v.Controls.PlacementAreaItemMode.Layout2}):4===i&&e.option({placementMode:v.Controls.PlacementAreaItemMode.Layout1}),e.isVisibleLayoutButton(!0)),(t=this._$elementCubeExplorer.data("ranetCubeExplorer"))&&t.isVisibleLayoutButton(!1),!1===(1===this._$currentPanel.has(this._$elementQueryDesigner).lenght)&&(this._$currentPanel.prepend(this._$elementQueryDesigner),this._$currentPanel.prepend(this._$elementCubeExplorer)),!1===this.showMetadataAndQueryDesigner&&this._$elementQueryDesigner.hide(),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.remove();break;default:throw new Error("NotImplementedException")}this.showMetadataAndQueryDesigner?(this._$viewPanel.css("height",""),this._$viewPanel.css("width","")):this._$viewPanel.css("width","98%"),p.call(this),this._$elementCubeExplorer.css("height",""),this._$elementCubeExplorer.css("width",""),this._$elementQueryDesigner.css("height",""),this._$elementQueryDesigner.css("width",""),function(){var n=this;switch(this._$elementCubeExplorer.hasClass("ui-resizable")&&this._$elementCubeExplorer.resizable("destroy"),this._$elementQueryDesigner.hasClass("ui-resizable")&&this._$elementQueryDesigner.resizable("destroy"),this._$queryDesignerAndCubeExplorerPanel&&this._$queryDesignerAndCubeExplorerPanel.hasClass("ui-resizable")&&this._$queryDesignerAndCubeExplorerPanel.resizable("destroy"),this.placementLayoutModeQueryDesigner){case 0:this._$elementQueryDesigner.resizable({helper:"resizable-helper",handles:"e",stop:function(e,t){r.call(n)}}),this._$elementCubeExplorer.resizable({helper:"resizable-helper",handles:"e",stop:function(e,t){r.call(n)}});break;case 1:this._$queryDesignerAndCubeExplorerPanel.resizable({helper:"resizable-helper",handles:"e",stop:function(e,t){r.call(n)}}),this._$elementCubeExplorer.resizable({helper:"resizable-helper",handles:"s",stop:function(e,t){var i=n._$elementCubeExplorer.percHeight();n._$elementQueryDesigner.css("height",100-i+"%"),n._$elementCubeExplorer.css("height",i+"%"),n._$elementQueryDesigner.css("width","100%"),n._$elementCubeExplorer.css("width","100%")}});break;case 2:this._$elementCubeExplorer.resizable({helper:"resizable-helper",handles:"e",stop:function(e,t){r.call(n)}});break;case 4:case 3:this._$elementQueryDesigner.resizable({helper:"resizable-helper",handles:"e",stop:function(e,t){r.call(n)}})}}.call(this)},f=function(){switch(this.placementLayoutModeDataViewer){case 2:case 1:var e=this._$elementPivotTable.percHeight();this._$elementPivotTable.css("height",e+"%"),this._$elementExtensionPanel.css("height",100-e+"%"),this._$elementPivotTable.css("width",""),this._$elementExtensionPanel.css("width",""),this._$elementPivotTable.css("top","0px");break;case 4:case 3:var t=this._$elementPivotTable.percWidth();this._$elementPivotTable.css("width",t+"%"),this._$elementExtensionPanel.css("width",100-t+"%"),this._$elementPivotTable.css("height","100%"),this._$elementExtensionPanel.css("height","100%"),this._$elementPivotTable.css("left","0px")}p.call(this)},g=function(){this.extensionSettings.extensionType!==v.Controls.Extensions.ExtensionTypes.Chart&&this.extensionSettings.extensionType!==v.Controls.Extensions.ExtensionTypes.Pie||(this._$elementChart.css("height","100%"),this._$elementChart.css("width","100%"),this._$elementChart.css("display","block"),this._$elementChart.css("overflow","hidden"),this._$elementChart.css("overflow-y","auto"),this._$elementVectorMap.css("display","none")),this.extensionSettings.extensionType===v.Controls.Extensions.ExtensionTypes.VectorMap&&(this._$elementVectorMap.css("height","100%"),this._$elementVectorMap.css("width","100%"),this._$elementVectorMap.css("display","block"),this._$elementChart.css("display","none"))},_=function(){for(var e=0;e<6;e++)this._$elementPivotTable.removeClass("ranetPivotTable_layout"+e),this._$elementExtensionPanel.removeClass("ranetExtension_layout"+e);switch(this._$elementPivotTable.css("height",""),this._$elementPivotTable.css("width",""),this._$elementExtensionPanel.css("width",""),this._$elementExtensionPanel.css("height",""),this.placementLayoutModeDataViewer){case 0:this._$elementPivotTable.addClass("ranetPivotTable_layout0"),this._$elementExtensionPanel.addClass("ranetExtension_layout0");break;case 1:0===this._$elementDataViewer.children().index(this._$elementPivotTable)&&this._$elementDataViewer.prepend(this._$elementExtensionPanel),this._$elementPivotTable.addClass("ranetPivotTable_layout1"),this._$elementExtensionPanel.addClass("ranetExtension_layout1");break;case 2:0===this._$elementDataViewer.children().index(this._$elementExtensionPanel)&&this._$elementDataViewer.prepend(this._$elementPivotTable),this._$elementPivotTable.addClass("ranetPivotTable_layout2"),this._$elementExtensionPanel.addClass("ranetExtension_layout2");break;case 3:0===this._$elementDataViewer.children().index(this._$elementExtensionPanel)&&this._$elementDataViewer.prepend(this._$elementPivotTable),this._$elementPivotTable.addClass("ranetPivotTable_layout3"),this._$elementExtensionPanel.addClass("ranetExtension_layout3");break;case 4:0===this._$elementDataViewer.children().index(this._$elementPivotTable)&&this._$elementDataViewer.prepend(this._$elementExtensionPanel),this._$elementPivotTable.addClass("ranetPivotTable_layout4"),this._$elementExtensionPanel.addClass("ranetExtension_layout4");break;case 5:this._$elementPivotTable.addClass("ranetPivotTable_layout5"),this._$elementExtensionPanel.addClass("ranetExtension_layout5");break;default:throw new Error("NotImplementedException")}(function(){var i=this;switch(this._$elementPivotTable.hasClass("ui-resizable")&&this._$elementPivotTable.resizable("destroy"),this.placementLayoutModeDataViewer){case 1:this._$elementPivotTable.resizable({helper:"resizable-helper",handles:"n",stop:function(e,t){f.call(i)}});break;case 2:this._$elementPivotTable.resizable({helper:"resizable-helper",handles:"s",stop:function(e,t){f.call(i)}});break;case 3:this._$elementPivotTable.resizable({helper:"resizable-helper",handles:"e",stop:function(e,t){f.call(i)}});break;case 4:this._$elementPivotTable.resizable({helper:"resizable-helper",handles:"w",stop:function(e,t){f.call(i)}})}}).call(this)},y=function(){this._$currentPanel.addClass("ranetDynamicPivotGrid");var e=$("<div/>");e.addClass("ranetCubeExplorer"),e.attr("id","ranetCubeExplorer-"+v.Utility.Guid.newGuid()),this._$elementCubeExplorer=e;var t=$("<div/>");t.addClass("ranetQueryDesigner"),t.attr("id","ranetQueryDesigner-"+v.Utility.Guid.newGuid()),this._$elementQueryDesigner=t;var i=$("<div/>");i.addClass("ranetDataViewerPanel");var n=$("<div/>");n.attr("id","ranetPivotTable-"+v.Utility.Guid.newGuid()),this._$elementPivotTable=n;var o=$("<div/>"),r=$("<div/>");r.attr("id","ranetChart-"+v.Utility.Guid.newGuid()),this._$elementChart=r;var a=$("<div/>");a.attr("id","ranetVectorMap-"+v.Utility.Guid.newGuid()),this._$elementVectorMap=a,o.append(this._$elementVectorMap),o.append(this._$elementChart),this._$elementExtensionPanel=o,i.append(this._$elementPivotTable),i.append(this._$elementExtensionPanel),this._$elementDataViewer=i,this._$elementActiveFilters=$("<div/>"),this._$elementActiveFilters.addClass("ranetDynamicPivotGrid_activeFilters");var s=$("<div/>");s.addClass("ranetDynamicPivotGrid_viewPanel");var l=$('<div class="ranetDynamicPivotGrid_viewContainer ranetDynamicPivotGrid_viewContainer-visibledExtension"/>');l.append(this._$elementActiveFilters),l.append(this._$elementDataViewer),this._$viewContainer=l,s.append(this._$viewContainer),this._$viewPanel=s,function(){var t=this._$viewContainer,i=$('<div class="ranetDynamicPivotGrid_rightExtPanel" style="display:none;"/>'),n=$("<i class='fa fa-caret-right ranetDynamicPivotGrid_showHideExtPanelButton'></i>"),o=$("<i class='fa fa-caret-left ranetDynamicPivotGrid_showHideExtPanelButton' style='display:none;'></i>"),r=$('<div class="ranetDynamicPivotGrid_extPanelContainer"></div>'),a=this,s=function(e){if(!1===e)i.css("width",""),t.css("width",""),i.hasClass("ui-resizable")&&i.resizable("option","disabled",!0),r.hide(),n.hide(),o.show(),i.css("width","14px"),t.addClass("ranetDynamicPivotGrid_viewContainer-collapsedExtension"),t.removeClass("ranetDynamicPivotGrid_viewContainer-visibledExtension");else{if(!0!==e)throw new Error("InvalidOperationException");i.css("width",""),t.css("width",""),i.hasClass("ui-resizable")&&i.resizable("option","disabled",!1),r.show(),n.show(),o.hide(),i.css("width","30%"),t.removeClass("ranetDynamicPivotGrid_viewContainer-collapsedExtension"),t.addClass("ranetDynamicPivotGrid_viewContainer-visibledExtension")}a.isShownExtensionPanel?i.css("display","auto"):i.css("display","none")};n.on("click",function(e){e.stopPropagation(),a.isVisibleExtensionPanel=!1,s(!1),p.call(a)}),o.on("click",function(e){e.stopPropagation(),a.isVisibleExtensionPanel=!0,s(!0),p.call(a)});var e=new v.View.RightExtensionView.RightExtView;e.headerText=this.headerText,e.footerText=this.footerText,r.append(e.view);var l=$('<div class="ranetDynamicPivotGrid_buttonsContainerExtPanel" />');l.on("click",function(){s(!a.isVisibleExtensionPanel),a.isVisibleExtensionPanel=!a.isVisibleExtensionPanel,p.call(a)}),l.append(n),l.append(o),i.append(l),i.append(r),this._$viewPanel.append(i),this._$rightExtensionPanel=i,this._rightExtensionView=e,s(this.isVisibleExtensionPanel)}.call(this);var c=$("<div/>");(this._$elementLoadPanel=c).ranetLoadPanel({message:"Loading...",visible:!1}),this._$currentPanel.append(this._$elementCubeExplorer),this._$currentPanel.append(this._$elementQueryDesigner),this._$currentPanel.append(this._$viewPanel),this._$currentPanel.append(this._$elementLoadPanel)},C=function(e){e.cubeName=this.cubeName,e.rotateAxes=this.rotateAxes;var t=jQuery.extend(!0,[],this.customCalculatedItems.calculatedNamedSets),i=jQuery.extend(!0,[],this.customCalculatedItems.calculatedMembers),n=jQuery.extend(!0,{},this.queryDesignerSetting);e.calculatedNamedSets=t,e.calculatedMembers=i,e.queryDesignerSetting=n},b=function(n){var o=this,r=$.Deferred();this._currentMdxQuery=n,this.messageBusyIndicator=v.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0;var e={connection:this.connection,query:n,contextId:this._contexId,isEnabledWhatIfAnalysis:this.isEnabledWhatIfAnalysis,orderMeasures:function(e){var t=[];for(var i in e.data)e.data.hasOwnProperty(i)&&t.push(e.data[i].uniqueName);return t}(this.layout),sortingColumnsOptions:this.sortingColumnsOptions,sortingRowsOptions:this.sortingRowsOptions,visualCalculations:this.additionalCalculations};return $.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/select",contentType:"application/json; charset=utf-8",data:JSON.stringify(e)}).done(function(e){var t=o._$elementQueryDesigner.data("ranetQueryDesigner").getLayout().data,i=function(e){var t=[];if(!v||!v.Controls)return console.log("We don't find Ranet namespace."),t;if(!e)return t;for(var i=0;i<e.length;i++){var n=e[i];if("kpiItem"===n.type&&("status"===n.kpiType||"trend"===n.kpiType)){var o=new v.Controls.CellConditionsDescriptor(n.uniqueName),r=n.valueGraphic.replace(/\s/g,"").toLowerCase(),a=new v.Controls.CellCondition;a.appearance.options.showValue=!1,a.appearance.options.useImage=!0,a.appearance.cssClassImage="imageLibrary_"+n.kpiType+"_"+r+"_-1",a.conditionType=v.Controls.CellConditionType.Less,a.value1=0;var s=new v.Controls.CellCondition;s.appearance.options.showValue=!1,s.appearance.options.useImage=!0,s.appearance.cssClassImage="imageLibrary_"+n.kpiType+"_"+r+"_0",s.conditionType=v.Controls.CellConditionType.Equal,s.value1=0;var l=new v.Controls.CellCondition;l.appearance.options.showValue=!1,l.appearance.options.useImage=!0,l.appearance.cssClassImage="imageLibrary_"+n.kpiType+"_"+r+"_1",l.conditionType=v.Controls.CellConditionType.Greater,l.value1=0,o.conditions.push(a),o.conditions.push(s),o.conditions.push(l),t.push(o)}}return t}.call(o,t);(function(e){for(var t=0;t<e.length;t++){var i=e[t];0===this.customCellsConditions.filter(function(e){return e.memberUniqueName===this.memberUniqueName},{memberUniqueName:i.memberUniqueName}).length&&this.customCellsConditions.push(i)}}).call(o,i),o._$elementPivotTable.data("pivotTable").option({dataSource:e,measuresInDataSource:t,cellConditions:o.customCellsConditions}),B.call(o,e),r.resolve({cellSetData:e})}).fail(function(e,t,i){v.UserMessageService.showServerError(e),v.LogService.error(e,n),r.reject(e,t,i)}).always(function(){o.visibleBusyIndicator=!1}),r},w=function(e,t){var n=$.Deferred(),o=this,r=e;this.messageBusyIndicator=v.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0;var i={state:r,actions:t,connection:this.connection,customPropertiesRows:this.customPropertiesRows,customPropertiesColumns:this.customPropertiesColumns,sortingColumnsOptions:this.sortingColumnsOptions,sortingRowsOptions:this.sortingRowsOptions};return $.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/transformStateToMdx",contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).done(function(e){o._initialQuery=e.initialQuery;var t=e.query;b.call(o,t).done(function(e){n.resolve(e)})}).fail(function(e,t,i){v.LogService.error(e,r),v.UserMessageService.showServerError(e),o.visibleBusyIndicator=!1,n.reject(e,t,i)}),n},S=function(e,t){var n=$.Deferred(),o=this;this.messageBusyIndicator=v.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0;var r={query:e,actions:t,connection:this.connection,customPropertiesRows:this.customPropertiesRows,customPropertiesColumns:this.customPropertiesColumns,hideEmptyColumns:this.queryDesignerSetting.hideEmptyColumns,hideEmptyRows:this.queryDesignerSetting.hideEmptyRows,rotateAxes:!1,sortingColumnsOptions:this.sortingColumnsOptions,sortingRowsOptions:this.sortingRowsOptions};return 0!==r.actions.length&&void 0!==this.currentDataSource&&(r.columnsPaneHierarchies=a(this.currentDataSource.columns),r.rowsPaneHierarchies=a(this.currentDataSource.rows)),$.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/transformMdxToMdx",contentType:"application/json; charset=utf-8",data:JSON.stringify(r)}).done(function(e){o._initialQuery=e.initialQuery;var t=e.query;b.call(o,t).done(function(e){n.resolve(e)})}).fail(function(e,t,i){v.LogService.error(e,r),v.UserMessageService.showServerError(e),o.visibleBusyIndicator=!1,n.reject(e,t,i)}),n},x=function(e,t){if(void 0===t)throw new Error("ArgumentException");var i=e;if(C.call(this,i),null!==t?this.historyManager.addStatePoint(i,t):this.historyManager.addStatePoint(i,this.historyManager.getAllActions()),!1!==this.autoExecuteMdxQuery)return w.call(this,i,this.historyManager.getAllActions())},D=function(e,t){null!==t?this.historyManager.addQueryPoint(e,t):this.historyManager.addQueryPoint(e,this.historyManager.getAllActions()),S.call(this,e,this.historyManager.getAllActions())},T=function(e){"drillDown"!==e.actionType&&"collapse"!==e.actionType&&"drillDownWithParent"!==e.actionType||this._$elementPivotTable.data("pivotTable").resetScrolls(),v.UserActionsTracker.track("Action in the pivotTable",{action:e.actionType});var t=function(e,t){var i={},n={};if(i.actionType=e.actionType,n.uniqueName=e.data.uniqueName,n.hierarchyUniqueName=e.hierarchy.uniqueName,n.axisType=e.place,!0===t&&("rows"===n.axisType?n.axisType="columns":"columns"===n.axisType&&(n.axisType="rows")),n.ancestors=e.ancestors,e.neighborsHierarchy){n.neighbors=[];for(var o=0;o<e.neighborsHierarchy.length;o++){var r=e.neighborsHierarchy[o];n.neighbors.push({uniqueName:r.data.uniqueName,hierarchyUniqueName:r.hierarchy.uniqueName,ancestors:r.ancestors})}}return i.header=n,i}(e,this.rotateAxes);this.historyManager.addAction(t);var i=this.historyManager.lastInitialHistoryPoint;if(i.type===c.State){var n=i.point;C.call(this,n),w.call(this,n,this.historyManager.getAllActions())}else{if(i.type!==c.Query)throw new Error("InvalidOperationException");S.call(this,i.point,this.historyManager.getAllActions())}},P=function(r){var e=this.historyManager.lastInitialHistoryPoint;if(void 0===e)throw new Error("InvalidOperationException");if(this._$elementPivotTable.data("pivotTable").resetScrolls(),null!==e){if(e.type!==c.State)throw new Error("InvalidOperationException");var t,i,n=e.point,o=this.currentFocusedCell;if(o)n.columns.length<r.columns.length?t=l(o.columns,r.columns[r.columns.length-1],"columns",this.rotateAxes):n.rows.length<r.rows.length&&(t=l(o.rows,r.rows[r.rows.length-1],"rows",this.rotateAxes)),t&&t.header.uniqueName&&this.historyManager.addAction(t);if(n.columns.length>r.columns.length?i=u(this._$elementCubeExplorer.data("ranetCubeExplorer").getMapIdToMetadata(),this.customCalculatedItems.calculatedNamedSets,this.cubeName,this.connection,n.columns,r.columns):n.rows.length>r.rows.length&&(i=u(this._$elementCubeExplorer.data("ranetCubeExplorer").getMapIdToMetadata(),this.customCalculatedItems.calculatedNamedSets,this.cubeName,this.connection,n.rows,r.rows)),i){var a=this;return void i.done(function(e){for(var t=[],i=a.historyManager.getAllActions(),n=0;n<i.length;n++){var o=i[n];0===e.filter(function(e){return e===this.actionHierarchyUniqueName},{actionHierarchyUniqueName:o.header.hierarchyUniqueName}).length&&t.push(o)}x.call(a,r,t)})}}var s=this.historyManager.getAllActions();return x.call(this,r,s)},M=function(u){var t,e,i,p=this,h=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout(),n=[];for(e=0;e<h.rows.length;e++)"level"===(i=h.rows[e]).type&&n.push(i.parentHierarchyId),"hierarchy"===i.type&&n.push(i.uniqueName),"namedSet"===i.type&&n.push(i.dimensions);for(e=0;e<h.columns.length;e++)"level"===(i=h.columns[e]).type&&n.push(i.parentHierarchyId),"hierarchy"===i.type&&n.push(i.uniqueName),"namedSet"===i.type&&n.push(i.dimensions);var o=new v.Controls.HierarchySelector.HierarchySelectorOptions;o.dataSource=this.cubeMetaData.treeMetadata,o.exludedHierarchies=n,o.onSelectedItem=function(e){t.isEnabledOkButton=!0};var d=new v.Controls.HierarchySelector.HierarchySelectorControl(o),r=new v.Controls.Windows.FloatingWindowOptions;r.content=d.view,r.title=v.Localization.localize("WindowSelectorHierarchy_Title"),r.size=v.Controls.Windows.WindowSize.Small,r.onClosed=function(e,t){if(t.dialogResult){v.UserActionsTracker.track("DrillDown by selected hierarchy");var i=u.data,n=u.hierarchy,o=new v.Controls.MemberChoice.QueryManager(p.cubeName,n.uniqueName),r=o.getQueryMemberWithParents([i.uniqueName]),a=new v.Controls.MemberChoice.DataService(p.connection),s=[a.getMembers(r)];if(void 0!==u.neighborsHierarchy)for(var l=0;l<u.neighborsHierarchy.length;l++){var c=u.neighborsHierarchy[l];r=(o=new v.Controls.MemberChoice.QueryManager(p.cubeName,c.hierarchy.uniqueName)).getQueryMemberWithParents([c.data.uniqueName]),s.push(a.getMembers(r))}p.messageBusyIndicator=v.Localization.localize("LoadPanel_GetData"),p.visibleBusyIndicator=!0,$.when.apply($,s).done(function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t][0],n=v.Utility.DynamicPivotGridHelper.getFilterTreeWhereItemSelectedSelf(i);e[i.hierarchyUniqueName]=n}var o=v.Utility.DynamicPivotGridHelper.getLayoutAfterDrillDownByHierarchy(h,d.selectedHierarchy,e,u.place),r=v.Utility.DynamicPivotGridHelper.getActionsAfterDrillDownByHierarchy(p.historyManager.getAllActions(),d.selectedHierarchy,u.place);p._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:o}),m.call(p),p.visibleBusyIndicator=!1,x.call(p,o,r)}).fail(function(e){v.LogService.error(e),p.visibleBusyIndicator=!1})}},r.container=p._$currentPanel,(t=new v.Controls.Windows.FloatingWindow(r)).isEnabledOkButton=!1,t.show()},I=function(){var e=new v.Controls.SortingOptionsPivotTable.SortEditorOptions;e.hierarchiesRowsPanel=this.currentDataSource.rows.hierarchies,e.hierarchiesColumnsPanel=this.currentDataSource.columns.hierarchies,void 0===this.sortingRowsOptions||null===this.sortingRowsOptions?e.sortingRowsOptions=new v.Controls.SortingOptionsPivotTable.SortingDescription:e.sortingRowsOptions=this.sortingRowsOptions,void 0===this.sortingColumnsOptions||null===this.sortingColumnsOptions?e.sortingColumnsOptions=new v.Controls.SortingOptionsPivotTable.SortingDescription:e.sortingColumnsOptions=this.sortingColumnsOptions,e.measuresTree=this.cubeMetaData.treeMetadata.filter(function(e){return"measuresRootNode"===e.type})[0];var i=new v.Controls.SortingOptionsPivotTable.SortOptionsEditorControl(e),n=this,t=new v.Controls.Windows.FloatingWindowOptions;t.content=i.view,t.title=v.Localization.localize("ContextMenu_SortingDetails"),t.size=v.Controls.Windows.WindowSize.Medium,t.onClosed=function(e,t){t.dialogResult&&(n.sortingColumnsOptions=i.sortingColumnsOptions,n.sortingRowsOptions=i.sortingRowsOptions,n.updateData())},t.container=this._$currentPanel,new v.Controls.Windows.FloatingWindow(t).show()},E=function(e,t){var i,n,o,r;if("columns"===e.place){if(this.sortingRowsOptions=new v.Controls.SortingOptionsPivotTable.SortingDescription,this.sortingRowsOptions.mode=v.Controls.SortingOptionsPivotTable.SortingMode.SortingByContext,this.sortingRowsOptions.isUsed=!0,this.sortingRowsOptions.sortingByMeasure=new v.Controls.SortingOptionsPivotTable.SortingByMeasureModel,-1===e.data.uniqueName.indexOf("[Measures]")){if(n=[],(o=new v.Controls.SortingOptionsPivotTable.MemberDescription).caption=e.data.caption,o.uniqueName=e.data.uniqueName,n.push(o),e.neighborsHierarchy)for(i=0;i<e.neighborsHierarchy.length;i++)(r=new v.Controls.SortingOptionsPivotTable.MemberDescription).caption=e.neighborsHierarchy[i].data.caption,r.uniqueName=e.neighborsHierarchy[i].data.uniqueName,n.push(r);this.sortingRowsOptions.sortingByMeasure.members=n}else this.sortingRowsOptions.sortingByMeasure.measureUniqueName=e.data.uniqueName;this.sortingRowsOptions.sortingByMeasure.direction=t}else{if("rows"!==e.place)throw new Error("InvalidOperationException");this.sortingRowsOptions||(this.sortingRowsOptions=new v.Controls.SortingOptionsPivotTable.SortingDescription),this.sortingRowsOptions.isUsed=!0,this.sortingRowsOptions.mode=v.Controls.SortingOptionsPivotTable.SortingMode.SortingByProperty;var a=new v.Controls.SortingOptionsPivotTable.SortingHierarchyDescription;a.hierarchyUniqueName=e.hierarchy.uniqueName,a.property=v.Controls.SortingOptionsPivotTable.HierarchyProperty.Caption,a.direction=t;var s=this.sortingRowsOptions.sortingByProperty.items.filter(function(e){return e.hierarchyUniqueName===a.hierarchyUniqueName});0<s.length&&this.sortingRowsOptions.sortingByProperty.items.splice(this.sortingRowsOptions.sortingByProperty.items.indexOf(s[0]),1),this.sortingRowsOptions.sortingByProperty.items.push(a)}this.updateData()},N=function(t){var i=this,e=[];return"[Measures]"!==t.hierarchy.uniqueName?(e.push({disabled:"expanded"===t.currentState||void 0===t.currentState,text:v.Localization.localize("PivotGrid_Expand"),onMenuItemClick:function(e){t.actionType="expand",T.call(i,t)}}),e.push({text:v.Localization.localize("PivotGrid_Collapse"),disabled:"collapsed"===t.currentState||void 0===t.currentState,afterInsertSeparator:!0,onMenuItemClick:function(e){t.actionType="collapse",T.call(i,t)}}),e.push({text:v.Localization.localize("PivotGrid_DrillDown"),onMenuItemClick:function(e){t.actionType="drilldown",T.call(i,t)}}),e.push({text:v.Localization.localize("PivotDesigner_DrillDownBy"),disabled:this.initialSourceType!==c.State||this._updatedCellsStorage.hasAnyChanges,onMenuItemClick:function(e){v.UserActionsTracker.track("Open window 'DrillDown by'"),M.call(i,t)}}),e.push({text:v.Localization.localize("PivotGrid_DetalizeWithParent"),afterInsertSeparator:!0,onMenuItemClick:function(e){t.actionType="drillDownWithParent",T.call(i,t)}}),e.push({text:v.Localization.localize("ContextMenu_SortAscending"),onMenuItemClick:function(e){v.UserActionsTracker.track("Set sorting",{direction:"Ascending"}),E.call(i,t,v.Controls.SortingOptionsPivotTable.SortingDirection.Ascending)}}),e.push({text:v.Localization.localize("ContextMenu_SortDescending"),onMenuItemClick:function(e){v.UserActionsTracker.track("Set sorting",{direction:"Descending"}),E.call(i,t,v.Controls.SortingOptionsPivotTable.SortingDirection.Descending)}}),e.push({text:v.Localization.localize("ContextMenu_SortingDetails"),afterInsertSeparator:!0,onMenuItemClick:function(e){v.UserActionsTracker.track("Open the sorting editor"),I.call(i,t)}}),e.push({text:v.Localization.localize("ContextMenu_ShowMemberProperties"),disabled:null===t.hierarchy.levelProperties||0===t.hierarchy.levelProperties.length,onMenuItemClick:function(e){v.UserActionsTracker.track("Open window 'Selector custom props'"),function(i,n){var e,o=this;if("rows"===n)e=this.rotateAxes?this.customPropertiesColumns[i.uniqueName]:this.customPropertiesRows[i.uniqueName];else{if("columns"!==n)throw new Error("InvalidOperationException");e=this.rotateAxes?this.customPropertiesRows[i.uniqueName]:this.customPropertiesColumns[i.uniqueName]}void 0===e&&(e=[]);var t=new v.Controls.CustomPropertiesSelector.CustomPropertiesSelectorOptions(i,e),r=new v.Controls.CustomPropertiesSelector.CustomPropertiesSelectorControl(t),a=new v.Controls.Windows.FloatingWindowOptions;a.content=r.view,a.title=v.Localization.localize("CustomPropertiesDialog_Caption"),a.size=v.Controls.Windows.WindowSize.Small,a.onClosed=function(e,t){if(t.dialogResult){if(v.UserActionsTracker.track("Add custom properties in pivot table"),!1===o.rotateAxes)if("rows"===n)o.customPropertiesRows[i.uniqueName]=r.selectedProperties;else{if("columns"!==n)throw new Error("InvalidOperationException");o.customPropertiesColumns[i.uniqueName]=r.selectedProperties}else if("rows"===n)o.customPropertiesColumns[i.uniqueName]=r.selectedProperties;else{if("columns"!==n)throw new Error("InvalidOperationException");o.customPropertiesRows[i.uniqueName]=r.selectedProperties}o.updateData()}},a.container=o._$currentPanel,new v.Controls.Windows.FloatingWindow(a).show()}.call(i,t.hierarchy,t.place)}})):(e.push({text:v.Localization.localize("ContextMenu_SortAscending"),onMenuItemClick:function(e){v.UserActionsTracker.track("Set sorting",{direction:"Ascending"}),E.call(i,t,v.Controls.SortingOptionsPivotTable.SortingDirection.Ascending)}}),e.push({text:v.Localization.localize("ContextMenu_SortDescending"),onMenuItemClick:function(e){v.UserActionsTracker.track("Set sorting",{direction:"Descending"}),E.call(i,t,v.Controls.SortingOptionsPivotTable.SortingDirection.Descending)}}),e.push({text:v.Localization.localize("ContextMenu_SortingDetails"),afterInsertSeparator:!0,onMenuItemClick:function(e){v.UserActionsTracker.track("Open the sorting editor"),I.call(i,t)}})),e.push({text:v.Localization.localize("ContextMenu_Properties"),onMenuItemClick:function(e){v.UserActionsTracker.track("Open window 'Member Props'"),function(e){var n=this,t=[];e.hierarchy.levelProperties&&(t=e.hierarchy.levelProperties.map(function(e){return e.uniqueName}));var i={uniqueName:e.data.uniqueName,connection:this.connection,cubeName:this.cubeName,customMemberPropsUniqueNames:t,calculatedNamedSets:this.customCalculatedItems.calculatedNamedSets,calculatedMembers:this.customCalculatedItems.calculatedMembers};$.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/getMember",contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).done(function(e){var t=new v.Controls.MemberPropertiesViewer.MemberPropertiesViewerControl(new v.Controls.MemberPropertiesViewer.MemberPropertiesViewerOptions(e)),i=new v.Controls.Windows.FloatingWindowOptions;i.content=t.view,i.title=v.Localization.localize("MemberPropertiesDialog_Caption"),i.size=v.Controls.Windows.WindowSize.Medium,i.isVisibleCancelButton=!1,i.container=n._$currentPanel,i.resizable=!0,new v.Controls.Windows.FloatingWindow(i).show()})}.call(i,t)}}),e},F=function(u){var e=[],i=this,t=0!==u.focusedCellDescription.rows.length&&0<u.focusedCellDescription.rows.filter(function(e){return e.isCalculatedMember}).length||0!==u.focusedCellDescription.columns.length&&0<u.focusedCellDescription.columns.filter(function(e){return e.isCalculatedMember}).length;return e.push({text:v.Localization.localize("ContextMenu_Copy"),afterInsertSeparator:!0,onMenuItemClick:function(e){for(var t=u.selectedCells,i="",n=[],o=0;o<t.length;o++){var r=t[o];void 0===n[r.rowIndex]&&(n[r.rowIndex]=[]),n[r.rowIndex].push(r)}for(var a in n)if(n.hasOwnProperty(a)){for(var s=0;s<n[a].length;s++){var l=n[a][s];0!==s&&(i+="\t"),null!==l.cellData.value&&(i+=l.cellData.value.toLocaleString())}i+="\r\n"}i=i.replace(new RegExp(String.fromCharCode(160),"g")," ");var c=$("<textarea>");$("body").append(c),c.val(i).select(),document.execCommand("copy"),c.remove()}}),e.push({text:v.Localization.localize("ContextMenu_DrillThrough"),disabled:0===u.focusedCellDescription.rows.length&&0===u.focusedCellDescription.columns.length||t,afterInsertSeparator:!0,onMenuItemClick:function(e){v.UserActionsTracker.track("DrillThrough"),function(o){var r=this,e=o.rows.map(function(e){return e.memberUniqueName}).concat(o.columns.map(function(e){return e.memberUniqueName})),t=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout(),i=this.cubeName,n="",a=0;if(t.filters){n+="WHERE ( ";for(var s=!0,l=0;l<t.filters.length;l++){var c=t.filters[l];if(c.filter&&c.filter.isUsed){var u=c.filter.membersFilter,p=u.set||"";if(u.selectionNodes)for(var h=0;h<u.selectionNodes.length;h++)1!==v.Controls.MemberChoice.MemberChoiceTreeNode.selectedCount(u.selectionNodes[h])&&(s=!1);if(""!==p&&"{}"!==p){var d="SELECT "+p+" ON COLUMNS FROM "+this.cubeName;i=i.replace(this.cubeName,"( "+d+" )"),a&&(n+=", "),n+=p,a++}}}if("WHERE ( {} )"!=(n+=" )")&&"WHERE (  )"!==n||(n=""),!s){var m=v.Localization.localize("MDXMultipleSelectionDrillthrough_Error");if(v.LogService.error(m),!confirm(m))return;n=""}}this.messageBusyIndicator=v.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0;var f={connection:this.connection,query:"DRILLTHROUGH SELECT( "+e.join(", ")+" ) ON 0 FROM "+i+n+" CELL PROPERTIES BACK_COLOR , CELL_ORDINAL , FORE_COLOR , FONT_NAME , FONT_SIZE , FONT_FLAGS , FORMAT_STRING , VALUE , FORMATTED_VALUE , UPDATEABLE , ACTION_TYPE"};$.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/selectDrillThroughQuery",contentType:"application/json; charset=utf-8",data:JSON.stringify(f)}).done(function(e){var t=new v.Controls.DrillThrough.DrillThroughControlOptions;t.dataSource=e,t.rows=o.rows,t.columns=o.columns,t.cellData=o.cellData,t.$container=r._$parentPanel;var i=new v.Controls.DrillThrough.DrillThroughControl(t),n=new v.Controls.Windows.FloatingWindowOptions;n.content=i.view,n.title=v.Localization.localize("DrillthroughDialog_Caption")+i.countString(),n.size=v.Controls.Windows.WindowSize.Large,n.onClosed=function(e,t){},n.container=r._$currentPanel,new v.Controls.Windows.FloatingWindow(n).show(),r.visibleBusyIndicator=!1}).fail(function(e){r.visibleBusyIndicator=!1,v.LogService.error(e),v.UserMessageService.showServerError(e)})}.call(i,u.focusedCellDescription)}}),e.push({text:v.Localization.localize("ContextMenu_Properties"),afterInsertSeparator:!0,onMenuItemClick:function(e){v.UserActionsTracker.track("Open window 'Cell Props'"),function(e){var t=new v.Controls.CellPropertiesViewer.CellPropertiesViewerControl(new v.Controls.CellPropertiesViewer.CellPropertiesViewerOptions(e)),i=new v.Controls.Windows.FloatingWindowOptions;i.content=t.view,i.title=v.Localization.localize("CellPropertiesDialog_Caption"),i.size=v.Controls.Windows.WindowSize.Medium,i.isVisibleCancelButton=!1,i.resizable=!0,i.container=this._$currentPanel,new v.Controls.Windows.FloatingWindow(i).show()}.call(i,u.focusedCellDescription)}}),e.push({text:v.Localization.localize("ContextMenu_CalculationType"),children:[{text:v.Localization.localize("ContextMenu_CalculationNormal"),onMenuItemClick:function(e){if(measure=O(u.focusedCellDescription),null==measure)i.additionalCalculations.defaultCalculationType=0;else{var t=v.Utility.ArrayUtility.FindByFunc(i.additionalCalculations.configuredCalculations,{measure:measure},function(e,t){return e.measure==t.measure});null==t?i.additionalCalculations.configuredCalculations.push({type:0,measure:measure}):i.additionalCalculations.configuredCalculations[t].type=0}i.updateData()},checked:function(){if(measure=O(u.focusedCellDescription),null==measure)return 0==i.additionalCalculations.defaultCalculationType;var e=v.Utility.ArrayUtility.FindByFunc(i.additionalCalculations.configuredCalculations,{measure:measure},function(e,t){return e.measure==t.measure});return null!=e&&0==i.additionalCalculations.configuredCalculations[e].type}()},{text:v.Localization.localize("ContextMenu_CalculationColumnTotal"),onMenuItemClick:function(e){if(measure=O(u.focusedCellDescription),null==measure)i.additionalCalculations.defaultCalculationType=1;else{var t=v.Utility.ArrayUtility.FindByFunc(i.additionalCalculations.configuredCalculations,{measure:measure},function(e,t){return e.measure==t.measure});null==t?i.additionalCalculations.configuredCalculations.push({type:1,measure:measure}):i.additionalCalculations.configuredCalculations[t].type=1}i.updateData()},checked:function(){if(measure=O(u.focusedCellDescription),null==measure)return 1==i.additionalCalculations.defaultCalculationType;var e=v.Utility.ArrayUtility.FindByFunc(i.additionalCalculations.configuredCalculations,{measure:measure},function(e,t){return e.measure==t.measure});return null!=e&&1==i.additionalCalculations.configuredCalculations[e].type}()},{text:v.Localization.localize("ContextMenu_CalculationRowTotal"),onMenuItemClick:function(e){if(measure=O(u.focusedCellDescription),null==measure)i.additionalCalculations.defaultCalculationType=2;else{var t=v.Utility.ArrayUtility.FindByFunc(i.additionalCalculations.configuredCalculations,{measure:measure},function(e,t){return e.measure==t.measure});null==t?i.additionalCalculations.configuredCalculations.push({type:2,measure:measure}):i.additionalCalculations.configuredCalculations[t].type=2}i.updateData()},checked:function(){if(measure=O(u.focusedCellDescription),null==measure)return 2==i.additionalCalculations.defaultCalculationType;var e=v.Utility.ArrayUtility.FindByFunc(i.additionalCalculations.configuredCalculations,{measure:measure},function(e,t){return e.measure==t.measure});return null!=e&&2==i.additionalCalculations.configuredCalculations[e].type}()}],afterInsertSeparator:!0}),e.push({text:v.Localization.localize("ContextMenu_DetailedCellsAnalysis_FilterAxis"),onMenuItemClick:function(e){(function(e){for(var a=this,t=s(e.selectedCells,this.cubeName),i=new v.Controls.MemberChoice.DataService(this.connection),n=[],o=0;o<t.length;o++){var r=t[o];n.push(i.getMembers(r))}this.messageBusyIndicator=v.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0,$.when.apply($,n).done(function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t],n=v.Utility.DynamicPivotGridHelper.getFilterTreeWhereItemsSelectedSelf(i);e[i[0].hierarchyUniqueName]=n}var o=a._$elementQueryDesigner.data("ranetQueryDesigner").getLayout(),r=v.Utility.DynamicPivotGridHelper.getLayoutAfterDetailedCellsAnalysisFilterAxis(o,e);a._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:r}),m.call(a),a.visibleBusyIndicator=!1,x.call(a,r,null)}).fail(function(e){v.LogService.error(e),a.visibleBusyIndicator=!1})}).call(i,u)}}),e.push({text:v.Localization.localize("ContextMenu_DetailedCellsAnalysis_CurrentSruct"),onMenuItemClick:function(e){(function(e){for(var a=this,t=s(e.selectedCells,this.cubeName),i=new v.Controls.MemberChoice.DataService(this.connection),n=[],o=0;o<t.length;o++){var r=t[o];n.push(i.getMembers(r))}this.messageBusyIndicator=v.Localization.localize("LoadPanel_GetData"),this.visibleBusyIndicator=!0,$.when.apply($,n).done(function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t],n=v.Utility.DynamicPivotGridHelper.getFilterTreeWhereItemsSelectedSelf(i);e[i[0].hierarchyUniqueName]=n}var o=a._$elementQueryDesigner.data("ranetQueryDesigner").getLayout(),r=v.Utility.DynamicPivotGridHelper.getLayoutAfterDetailedCellsAnalysisCurrentStructure(o,e);a._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:r}),m.call(a),a.visibleBusyIndicator=!1,x.call(a,r,null)}).fail(function(e){v.LogService.error(e),a.visibleBusyIndicator=!1})}).call(i,u)}}),e},O=function(e){for(var t=0;t<e.columns.length;t++)if("[Measures]"==e.columns[t].hierarchyUniqueName)return e.columns[t].memberUniqueName;for(t=0;t<e.rows.length;t++)if("[Measures]"==e.rows[t].hierarchyUniqueName)return e.rows[t].memberUniqueName;return null},L=function(){var l=this;this._$elementActiveFilters.ranetActiveFilters({cubeName:this.cubeName,isEnabled:this.initialSourceType===c.State&&!1===this._isEnabledWhatIfAnalysis,connection:this.connection,onDeleteFilter:function(e,t){l._$elementQueryDesigner.data("ranetQueryDesigner").deleteActiveFilter(e,t)},onShowFilterEditor:function(e,t){l._$elementQueryDesigner.data("ranetQueryDesigner").showFilterEditor(e,t)}}),this._$elementChart.ranetChart({}),this._$elementVectorMap.ranetVectorMap({data:{},groups:[],updateData:function(e){if(e){var t=v.Controls.Extensions.MapDataHelper.createActionHeaderDescription(e,l.currentDataSource,l.extensionSettings.vectorMapSettings.dataSettings.row);t.data&&T.call(l,t)}B.call(l)}}),v.Controls.Extensions.MapDataHelper.getRequest();var e=v.Controls.PlacementAreaItemMode.Layout1;3!==l.placementLayoutModeQueryDesigner&&1!==l.placementLayoutModeQueryDesigner||(e=v.Controls.PlacementAreaItemMode.Layout2);var t=function(){for(var e=[],t=0;t<5;t++){var i={};i.title=v.Localization.localize("ViewLayout_Layout"+t),i.icon="imageLibrary_viewLayout"+t,i.onSelected=function(e){this.placementLayoutModeQueryDesigner=e}.bind(this,t),e.push(i)}return e}.call(this);this._$elementQueryDesigner.ranetQueryDesigner({layout:this.layout,placementLayoutMode:e,connection:this.connection,cubeName:this.cubeName,autoExecuteQuery:this.autoExecuteMdxQuery,container:this._$currentPanel,isEnabled:this.initialSourceType===c.State&&!1===this._isEnabledWhatIfAnalysis,onLayoutChanged:function(e){m.call(l),P.call(l,e)},onFilterChanged:function(t,e,i){var n=l.historyManager.getAllActions();if(0<n.length&&i.filter.isUsed&&i.filter.membersFilter.isUsed){var o=i.filter.membersFilter.set,r=0;switch(e){case v.Controls.AreaType.Columns:r=0;break;case v.Controls.AreaType.Rows:r=1}var a={actions:n,set:o,axisType:r,connection:this.connection,cubeName:this.cubeName};$.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/getActualActions",contentType:"application/json; charset=utf-8",data:JSON.stringify(a)}).done(function(e){x.call(l,t,e)})}else x.call(l,t,l.historyManager.getAllActions());m.call(l)},onUpdateData:function(){v.UserActionsTracker.track("Click a button 'UpdateData'."),l.updateData()},onChangeAutoExecuteMdxQuery:function(e){v.UserActionsTracker.track("Click a button 'AutoExecute'.",{value:e}),l.autoExecuteMdxQuery=e},onOpenSortingEditor:function(){I.call(l)},layoutDropdownItems:t,sortingRowsOptions:this.sortingRowsOptions,sortingColumnsOptions:this.sortingColumnsOptions,availableSlicers:this._availableSlicers,showToolbar:this.queryDesignerSetting.showToolbar}),this._$elementPivotTable.pivotTable({onShowingSparklines:function(e){for(var t=0;t<e.length;t++){var i=e[t].element;i.innerHTML="";var n=l.currentDataSource.cells.values[e[t].row][e[t].column],o=e[t].options;o.dataSource=v.Controls.Extensions.SpartLineDataHelper.getDataFromString(n),o.tooltip={},o.tooltip.enabled=o.enableTooltip,o.tooltip.container=".dynamicPivotGrid",$(i).ranetSparklines(o)}},onActionHeader:function(e,t){T.call(l,t)},onHeaderTouch:function(e,t){var i=$("<div/>"),n=$("<textarea class='form-control' readonly>"+t.data.caption+"</textarea>"),o=$("<button  class='btn btn-default ranetDynamicPivotGrid-touchActionPivotTableButton'>"+v.Localization.localize("PivotGrid_DrillDown")+"</button>"),r=$("<button class='btn btn-default ranetDynamicPivotGrid-touchActionPivotTableButton'>"+v.Localization.localize("PivotGrid_Expand")+"</button>"),a=$("<button class='btn btn-default ranetDynamicPivotGrid-touchActionPivotTableButton'>"+v.Localization.localize("PivotGrid_Collapse")+"</button>");if(i.append(n),i.append(o),o.click(function(){t.actionType="drilldown",T.call(l,t)}),r.click(function(){t.actionType="expand",T.call(l,t)}),a.click(function(){t.actionType="collapse",T.call(l,t)}),void 0!==t.currentState)if("expanded"===t.currentState)i.append(a);else{if("collapsed"!==t.currentState)throw new Error("NotImplementedException");i.append(r)}var s={html:!0,container:l._$currentPanel,viewport:e,content:i,trigger:"hover"};if("rows"===t.place)s.placement="right";else{if("columns"!==t.place)throw new Error("NotImplementedException");s.placement="bottom"}$(e).popover(s),$(e).popover("show")},onContextMenuHeaderCallback:function(e,t){var i=l._$parentPanel.offset();v.UserActionsTracker.track("Show context menu in pivot table"),$(e).ranetContextMenu({$container:l._$currentPanel,dataSource:N.call(l,t.elementDescription),position:{top:t.eventArgs.clientY-i.top,left:t.eventArgs.clientX-i.left}}),$(e).data("ranetContextMenu").show()},onContextMenuCellsCallback:function(e){var t=l._$parentPanel.offset();v.UserActionsTracker.track("Show context menu in pivot table"),e.$cell.ranetContextMenu({$container:l._$currentPanel,dataSource:F.call(l,e),position:{top:e.sender.clientY-t.top,left:e.sender.clientX-t.left}}),e.$cell.data("ranetContextMenu").show()},onCellValueChanged:function(e,t,i){l._updatedCellsStorage.add(new v.Controls.UpdateEntry(e,t)),!1===l.useChangesCache&&l.recalculate()},onChangeValueCellDeleted:function(e){l._updatedCellsStorage.remove(new v.Controls.UpdateEntry(e))}}),this._$elementCubeExplorer.ranetCubeExplorer({keyExpr:"id",calculatedMembers:this.customCalculatedItems.calculatedMembers,calculatedNamedSets:this.customCalculatedItems.calculatedNamedSets,connection:this.connection,selectedMeasureGroupName:this.selectedMeasureGroupName,cubeName:this.cubeName,draggableOptions:{$dragContainer:l._$currentPanel},onDataSourceChanged:function(e,t){var i=t.metadataDescription.treeMetadata,n=e.getMapIdToMetadata(),o=i.filter(function(e){return"measuresRootNode"===e.type})[0];l._$elementQueryDesigner.data("ranetQueryDesigner").option({dataSource:n,treeMeasures:o}),l._$elementActiveFilters.data("ranetActiveFilters").setCubeMetaData(n),l._$elementQueryDesigner.data("ranetQueryDesigner").initQueryDesigner();var r=l._$elementQueryDesigner.data("ranetQueryDesigner").integrityDataManager();l._$elementCubeExplorer.data("ranetCubeExplorer").injectIntegrityDataManager(r),function(){var t=this;if(this.initialSourceType===c.State){if(this.loadStateFromHistory&&this._options.actions&&0<this._options.actions.length){var e=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();C.call(this,e),this._historyManager.addStatePoint(e,[]),this._options.actions.forEach(function(e){t.historyManager.addAction(e)})}}else{if(this.initialSourceType!==c.Query)throw new Error("NotImplementationException");this._historyManager.addQueryPoint(this.initialQuery,[])}}.call(l),function(){if(this.initialSourceType===c.State){if(m.call(this),0!==this.historyManager.getAllActions().length){if(!1===this.autoExecuteMdxQuery)return;var e=this.historyManager.lastInitialHistoryPoint.point;return void w.call(this,e,this.historyManager.getAllActions())}P.call(this,this.layout).done(function(){parent.postMessage("Controls created","*")})}else{if(this.initialSourceType!==c.Query)throw new Error("NotImplementationException");S.call(this,this._initialQuery,[])}}.call(l)},onMeasureGroupSelectedChanged:function(e,t){l._selectedMeasureGroupName=null===t.measureGroup?null:t.measureGroup.name},layoutDropdownItems:t}),v.Utility.EventHandlers.addEventHandler(window,"resize",function(){v.Utility.Debouncer.debounce(p.bind(l),50)})},A=function(){var n=this;this.messageBusyIndicator=v.Localization.localize("LoadPanel_GetMetadata"),this.visibleBusyIndicator=!0;var o=this._$elementCubeExplorer.is(":visible");this._$elementCubeExplorer.hide();var e={connection:this.connection,cubeName:this.cubeName};$.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/getMetadata",contentType:"application/json; charset=utf-8",data:JSON.stringify(e)}).done(function(e){!0===o&&n._$elementCubeExplorer.show(),n.isShownExtensionPanel&&n._$rightExtensionPanel.show(),n.visibleBusyIndicator=!1;var t,i=((t=e).treeMetadata.filter(function(e){switch(e.type){case"kpiRootNode":e.caption=v.Localization.localize("KPIS");break;case"measuresRootNode":e.caption=v.Localization.localize("Measures");break;case"setsRootNode":e.caption=v.Localization.localize("CalculationsListControl_NamedSets_TreeNode")}}),t);n._$elementCubeExplorer.data("ranetCubeExplorer").option({dataSource:i})}).fail(function(e){n.visibleBusyIndicator=!1,v.LogService.error(e),v.UserMessageService.showServerError(e)}).always(function(){void 0===n.layout&&(n.visibleBusyIndicator=!1)})},R=function(e){var t={chartDataSource:null,chartOptions:null,pieDataSource:null,pieOptions:null,series:null},i=[],n=[];if(t.pieOptions=$.extend({},this.extensionSettings.chartOptions.pie),t.chartOptions=$.extend({},this.extensionSettings.chartOptions),t.chartOptions.pie=null,this.extensionSettings.chartOptions&&(n=this.extensionSettings.chartOptions.seriesOptions||[]),t.chartOptions.extensionType===v.Controls.Extensions.ExtensionTypes.Pie&&(t.chartOptions.useMultipleCharts=!0),0!==this.placementLayoutModeDataViewer){var o=this.extensionSettings.chartOptions.palette||"default";if(e.columns&&e.rows)if(e.columns.members&&e.rows.members){if(function e(t){for(var i=0,n=0;n<t.length;n++){var o=t[n];o instanceof Array?i+=e(o):null!=o&&o instanceof String==0&&i++}return i}(e.cells.values)>(0<this.extensionSettings.chartOptions.cellNumber?this.extensionSettings.chartOptions.cellNumber:1e4))return this._$elementChart.data("ranetChart").error(v.Localization.localize("ChartMessage_ToMuchCells")),null;if(this.extensionSettings.extensionType===v.Controls.Extensions.ExtensionTypes.Pie&&50<e.columns.positions.length)return this._$elementChart.data("ranetChart").error(v.Localization.localize("ChartMessage_ToMuchCells")),null;this._$elementChart.data("ranetChart").clearError(),i=v.Controls.Extensions.Chart.ChartDataHelper.getDataSource(e),this.extensionSettings.chartOptions.autogenerate?!1===t.chartOptions.useMultipleCharts?n=v.Controls.Extensions.Chart.ChartDataHelper.getSeries(e,[],o,this.extensionSettings.chartOptions.defaultDiagramType):t.chartOptions.useMultipleCharts&&(n=v.Controls.Extensions.Chart.ChartDataHelper.generateOrgeredSeries(e,[],o,t.chartOptions.extensionType===v.Controls.Extensions.ExtensionTypes.Pie?5:this.extensionSettings.chartOptions.defaultDiagramType)):n=v.Controls.Extensions.Chart.ChartDataHelper.getSeries(e,n,o);var r=v.Controls.Extensions.PieDataHelper.getPieData(e,o),a=v.Controls.Extensions.PieDataHelper.getPieLegendItems(e,o);t.pieDataSource=r,t.pieOptions.legend.legendItems=a}else n=[];else n=[];var s=this;t.pieOptions.callbacks||(t.pieOptions.callbacks={}),t.chartOptions.onContextCallback=t.pieOptions.callbacks.onContextSegment=function(e,t,i){var n=$(e),o={};o.$container=s._$currentPanel,o.dataSource=function(t,i){var n=this,e=[];return e.push({text:t.caption+", "+v.Localization.localize("PivotGrid_DrillDown"),onMenuItemClick:function(e){t.actionType="drilldown",T.call(n,t)}}),e.push({text:t.caption+", "+v.Localization.localize("PivotDesigner_DrillDownBy"),disabled:this.initialSourceType!==c.State||this._updatedCellsStorage.hasAnyChanges,onMenuItemClick:function(e){v.UserActionsTracker.track("Open window 'DrillDown by'"),M.call(n,t)}}),e.push({text:t.caption+", "+v.Localization.localize("PivotGrid_DetalizeWithParent"),afterInsertSeparator:!0,onMenuItemClick:function(e){t.actionType="drillDownWithParent",T.call(n,t)}}),e.push({text:i.caption+", "+v.Localization.localize("PivotGrid_DrillDown"),onMenuItemClick:function(e){i.actionType="drilldown",T.call(n,i)}}),e.push({text:i.caption+", "+v.Localization.localize("PivotDesigner_DrillDownBy"),disabled:this.initialSourceType!==c.State||this._updatedCellsStorage.hasAnyChanges,onMenuItemClick:function(e){v.UserActionsTracker.track("Open window 'DrillDown by'"),M.call(n,i)}}),e.push({text:i.caption+", "+v.Localization.localize("PivotGrid_DetalizeWithParent"),onMenuItemClick:function(e){i.actionType="drillDownWithParent",T.call(n,i)}}),e}.call(s,t.data.row,t.data.column),o.position={top:i.clientY,left:i.clientX},n.ranetContextMenu(o),n.data("ranetContextMenu").show()},t.chartDataSource=i,t.series=n,t&&(this._$elementChart.data("ranetChart").options(t),this._$elementChart.data("ranetChart").redraw())}},B=function(e){e||(e=this.currentDataSource),this._$elementChart.data("ranetChart").clearError(),this._$elementVectorMap.data("ranetVectorMap").clearError(),this.extensionSettings.extensionType!==v.Controls.Extensions.ExtensionTypes.Chart&&this.extensionSettings.extensionType!==v.Controls.Extensions.ExtensionTypes.Pie||R.call(this,e),this.extensionSettings.extensionType===v.Controls.Extensions.ExtensionTypes.VectorMap&&function(o){if(v.Controls.Extensions.MapDataHelper.checkValidMapData(o)){this._$elementVectorMap.data("ranetVectorMap").show();var r=this,a=this.extensionSettings.vectorMapSettings.dataSettings.col,s=this.extensionSettings.vectorMapSettings.dataSettings.row,e=v.Controls.Extensions.MapDataHelper.generateRowList(o),t=this.extensionSettings.vectorMapSettings.mainColor||"rgba(247,104,161,1)";if(t)var l=v.Controls.Extensions.MapColorHelper.generateMapPalette(t);if(void 0!==s&&-1!==e.indexOf(s)||void 0===v.Controls.Extensions.MapDataHelper.generateRowList(o)[0]&&""===s)s=this.extensionSettings.vectorMapSettings.dataSettings.row;else{s=v.Controls.Extensions.MapDataHelper.generateRowList(o)[0]||"";var i=this.extensionSettings;i.vectorMapSettings.dataSettings.row=s,this.extensionSettings=i}for(var c,u=!0,p=r._$elementVectorMap.data("ranetVectorMap").option("details"),n=o.rows.hierarchies,h=n[n.length-1],d=o.rows.positions,m="",f=[],g=0;g<d.length;g++){var _=d[g].positions[d[g].positions.length-1].id,y=o.rows.members[_];-1===f.indexOf(y.uniqueName)&&(m+=y.uniqueName+", ",f.push(y.uniqueName))}m=m.slice(0,m.length-2);var C={connection:r.connection,query:"SELECT {"+m+"} DIMENSION PROPERTIES PARENT_UNIQUE_NAME, "+h.uniqueName+".[Country], "+h.uniqueName+".[State-Province] on 0, {} DIMENSION PROPERTIES PARENT_UNIQUE_NAME , KEY0 ON 1 FROM "+r.cubeName};$.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/select",contentType:"application/json; charset=utf-8",data:JSON.stringify(C)}).done(function(e){var t=0;for(var i in e.columns.members)e.columns.members.hasOwnProperty(i)&&(""===e.columns.members[i].memberProperties[0].value&&""===e.columns.members[i].memberProperties[1].value&&(u=!1),t++);if(u){for(var n=0;!c&&n<t;)e.columns.members[n].memberProperties[0].value?c=v.Controls.Extensions.MapDataHelper.getCountryCode(e.columns.members[n].memberProperties[0].value):n++;c?c.done(function(e){r._$elementVectorMap.data("ranetVectorMap").clearError(),p!==e.iso&&(p=e.iso);var t=v.Controls.Extensions.MapDataHelper.parseDataForDetailedMap(o,a,s,p);r._$elementVectorMap.data("ranetVectorMap").option("data",t);var i=v.Controls.Extensions.MapDataHelper.generateGroups(t);r._$elementVectorMap.data("ranetVectorMap").option("groups",i),r._$elementVectorMap.data("ranetVectorMap").option("paletteId",parseInt(a)),r._$elementVectorMap.data("ranetVectorMap").option("customPalette",l),p&&r._$elementVectorMap.data("ranetVectorMap").drawDetails(p)}):r._$elementVectorMap.data("ranetVectorMap").error(v.Localization.localize("VectorMapMessage_NotDisplayed"))}else v.Controls.Extensions.MapDataHelper.parseDataForMap(o,a,s).done(function(e){p&&r._$elementVectorMap.data("ranetVectorMap").closeDetails(),r._$elementVectorMap.data("ranetVectorMap").option("data",e.data);var t=v.Controls.Extensions.MapDataHelper.generateGroups(e.data);r._$elementVectorMap.data("ranetVectorMap").option("groups",t),r._$elementVectorMap.data("ranetVectorMap").option("paletteId",parseInt(a)),r._$elementVectorMap.data("ranetVectorMap").option("customPalette",l)})}).fail(function(e){r.visibleBusyIndicator=!1,v.UserMessageService.showServerError(e),v.LogService.error(e)})}else this._$elementVectorMap.data("ranetVectorMap").hide()}.call(this,e)};function k(e,t){var r=this;this._$currentPanel=$("<div/>"),this._$parentPanel=$(e),this._$parentPanel.append(this._$currentPanel),this._additionalCalculations={configuredCalculations:[],defaultCalculationType:0};(function(e){this._rotateAxes=!1,this._showMetadataAndQueryDesigner=!0,this._isVisibleActiveFilters=!1,this.connection=e.connection,this.cubeName=e.cubeName,this.autoExecuteMdxQuery=e.autoExecuteMdxQuery,this.layout=e.layout,this._customCalculatedItems=o(e.customCalculatedItems),this._queryDesignerSetting=e.queryDesignerSetting,this._isVisibleActiveFilters=e.isVisibleActiveFilters,this._initialQuery=e.initialQuery,this._initialSourceType=e.initialSourceType,this._customCellsConditions=e.customCellsConditions,this._extensionOptions=e.extensionOptions||{},void 0!==e.showMetadataAndQueryDesigner&&(this._showMetadataAndQueryDesigner=e.showMetadataAndQueryDesigner),this._placementLayoutModeQueryDesigner=e.placementLayoutModeQueryDesigner,this._placementLayoutModeDataViewer=e.placementLayoutModeDataViewer,this.loadStateFromHistory=e.loadStateFromHistory,this._selectedMeasureGroupName=void 0===e.selectedMeasureGroupName?null:e.selectedMeasureGroupName,e.onHistoryChanged&&(this._onHistoryChangedCallback=e.onHistoryChanged),this.useCustomUpdateScriptTemplate=void 0!==e.useCustomUpdateScriptTemplate&&e.useCustomUpdateScriptTemplate,this.useChangesCache=void 0!==e.useChangesCache&&e.useChangesCache,this._isEnabledWhatIfAnalysis=void 0!==e.isEnabledWhatIfAnalysis&&e.isEnabledWhatIfAnalysis,this.currentUpdateScriptTemplate=e.currentUpdateScriptTemplate,this.sortingRowsOptions=void 0===e.sortingRowsOptions?null:e.sortingRowsOptions,this.sortingColumnsOptions=void 0===e.sortingColumnsOptions?null:e.sortingColumnsOptions,this.isShownExtensionPanel=!!e.showExtensionPanel,void 0!==e.isVisibleExtensionPanel?this.isVisibleExtensionPanel=e.isVisibleExtensionPanel:this.isVisibleExtensionPanel=!1,this.headerText=e.headerText,this.footerText=e.footerText,this._availableSlicers=e.availableSlicers,this._options=e}).call(this,t),this._historyManager=new i(function(e,t){void 0!==r.onHistoryChangedCallback&&r.onHistoryChangedCallback(r,e),t!==n.Add&&m.call(r)},function(e,t){if(r._$elementPivotTable.data("pivotTable").resetScrolls(),e.type===c.State){var i=e.point;(o=(n=i).queryDesignerSetting).hideEmptyRows!==r.queryDesignerSetting.hideEmptyRows&&(r.queryDesignerSetting.hideEmptyRows=o.hideEmptyRows),o.hideEmptyColumns!==r.queryDesignerSetting.hideEmptyColumns&&(r.queryDesignerSetting.hideEmptyColumns=o.hideEmptyColumns),n.rotateAxes!==r.rotateAxes&&(r._rotateAxes=n.rotateAxes),r._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:n}),w.call(r,i,t)}else{if(e.type!==c.Query)throw new Error("InvalidOperationException");S.call(r,e.point,t)}var n,o});this._contexId=v.Utility.Guid.newGuid(),this._updatedCellsStorage=new v.Controls.UpdatedCellsStorage(function(e,t){r.onStateUpdateStorageChangedCallback&&r.onStateUpdateStorageChangedCallback(e,t)})}function V(){var e=this.currentDataSource.filterMembers,t=v.Controls.UpdateScriptBuilder.build(this.cubeName,this.currentUpdateScriptTemplate,this._updatedCellsStorage.entries,e),i=this;this.visibleBusyIndicator=!0,this.messageBusyIndicator=v.Localization.localize("LoadPanel_ExecuteUpdateScript");var n={connection:this.connection,contextId:this._contexId,updateScript:t};return $.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/update",contentType:"application/json; charset=utf-8",data:JSON.stringify(n)}).done(function(){i._updatedCellsStorage.setStateAfterRecalculate(),i._$elementPivotTable.data("pivotTable").clearLocalChanges(),i.visibleBusyIndicator=!1}).fail(function(e){i.visibleBusyIndicator=!1,v.UserMessageService.showServerError(e),v.LogService.error(e)})}function z(){this.visibleBusyIndicator=!0,this.messageBusyIndicator=v.Localization.localize("LoadPanel_ExecuteUpdateScript");var t=this,e={connection:this.connection,contextId:this._contexId};return $.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/save",contentType:"application/json; charset=utf-8",data:JSON.stringify(e)}).done(function(){t._updatedCellsStorage.setStateAfterSave()}).fail(function(e){t.visibleBusyIndicator=!1,v.UserMessageService.showServerError(e),v.LogService.error(e)})}function q(){this._$elementPivotTable.data("pivotTable").clearLocalChanges(),this._updatedCellsStorage.clearLocalChanges()}return Object.defineProperty(k.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible=e,this._isVisible?(this._$currentPanel.show(),p.call(this)):this._$currentPanel.hide()},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"customPropertiesRows",{get:function(){return void 0===this._customPropertiesRows&&(this._customPropertiesRows={}),this._customPropertiesRows},set:function(e){this._customPropertiesRows=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"customPropertiesColumns",{get:function(){return void 0===this._customPropertiesColumns&&(this._customPropertiesColumns={}),this._customPropertiesColumns},set:function(e){this._customPropertiesColumns=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"showMetadataAndQueryDesigner",{get:function(){return this._showMetadataAndQueryDesigner},set:function(e){if(this._showMetadataAndQueryDesigner=e,this._showMetadataAndQueryDesigner){switch(this.placementLayoutModeQueryDesigner){case 0:this._$elementCubeExplorer.show(),this._$elementQueryDesigner.show();break;case 1:this._$queryDesignerAndCubeExplorerPanel.show();break;case 2:this._$elementCubeExplorer.show();break;case 4:case 3:this._$elementQueryDesigner.show()}r.call(this)}else{switch(this.placementLayoutModeQueryDesigner){case 0:this._$elementCubeExplorer.hide(),this._$elementQueryDesigner.hide();break;case 1:this._$queryDesignerAndCubeExplorerPanel.hide();break;case 2:this._$elementCubeExplorer.hide();break;case 4:case 3:this._$elementQueryDesigner.hide()}this._$viewPanel.css("width","99%"),p.call(this)}},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"isVisibleActiveFilters",{get:function(){return this._isVisibleActiveFilters},set:function(e){this._isVisibleActiveFilters=e,h.call(this),this._$elementActiveFilters.data("ranetActiveFilters").isVisible=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"descriptionActiveFilters",{get:function(){return this._$elementActiveFilters.data("ranetActiveFilters").descriptionActiveFilters},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"placementLayoutModeQueryDesigner",{get:function(){return this._placementLayoutModeQueryDesigner},set:function(e){this._placementLayoutModeQueryDesigner!==e&&(this._placementLayoutModeQueryDesigner=e,d.call(this))},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"placementLayoutModeDataViewer",{get:function(){return this._placementLayoutModeDataViewer},set:function(e){var t=this._placementLayoutModeDataViewer;this._placementLayoutModeDataViewer!==e&&(this._placementLayoutModeDataViewer=e,_.call(this),p.call(this),0!==t&&0===e||B.call(this))},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"autoExecuteMdxQuery",{get:function(){return this._autoExecuteMdxQuery},set:function(e){this._autoExecuteMdxQuery=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"rotateAxes",{get:function(){return this._rotateAxes},set:function(e){!0!==e||this.initialSourceType!==c.Query&&!this.isEnabledWhatIfAnalysis?(this._rotateAxes=e,this.updateData()):v.UserMessageService.showInfo(v.Localization.localize("InfoMessage_QueryIsNotRotated"))},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"historyManager",{get:function(){return this._historyManager},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"connection",{get:function(){return this._connection},set:function(e){e!==this._connection&&(this._connection=e)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"loadStateFromHistory",{get:function(){return this._loadStateFromHistory},set:function(e){this._loadStateFromHistory=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"currentMdxQuery",{get:function(){return this._currentMdxQuery},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"cubeName",{get:function(){return this._cubeName},set:function(e){e!==this._cubeName&&(this._cubeName=e)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"messageBusyIndicator",{get:function(){return this._busyIndicatorMessage},set:function(e){this._busyIndicatorMessage=e,this._$elementLoadPanel.data("ranetLoadPanel").option({message:this._busyIndicatorMessage})},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"visibleBusyIndicator",{get:function(){return this._visibleBusyIndicator},set:function(e){this._visibleBusyIndicator=e,this._$elementLoadPanel.data("ranetLoadPanel").option({visible:this._visibleBusyIndicator})},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"layout",{get:function(){var e=this._$elementQueryDesigner.data("ranetQueryDesigner");if(e){var t=e.getLayout();void 0!==t&&(this._layout=t)}return this._layout},set:function(e){e!==this._layout&&(this._layout=e)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"integrityDataManager",{get:function(){return this._$elementQueryDesigner.data("ranetQueryDesigner").integrityDataManager()}}),Object.defineProperty(k.prototype,"customCalculatedItems",{get:function(){return this._customCalculatedItems},set:function(e){this._customCalculatedItems=o(e),function(){(function(){if(this._$elementCubeExplorer.data("ranetCubeExplorer")){this._$elementCubeExplorer.data("ranetCubeExplorer").option({calculatedMembers:this.customCalculatedItems.calculatedMembers,calculatedNamedSets:this.customCalculatedItems.calculatedNamedSets});var e=this._$elementCubeExplorer.data("ranetCubeExplorer").getMapIdToMetadata();this._$elementQueryDesigner.data("ranetQueryDesigner").option({dataSource:e})}}).call(this)}.call(this)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"queryDesignerSetting",{get:function(){return this._queryDesignerSetting},set:function(e){var t=this._queryDesignerSetting;if(this._queryDesignerSetting=e,t.hideEmptyRows!==this._queryDesignerSetting.hideEmptyRows||t.hideEmptyColumns!==this._queryDesignerSetting.hideEmptyColumns){var i=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();x.call(this,i,this.historyManager.getAllActions())}else this.autoExecuteMdxQuery&&this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"cubeMetaData",{get:function(){var e=this._$elementCubeExplorer.data("ranetCubeExplorer").getCopyOriginalDataSource();return{measureGroups:e.measureGroups,treeMetadata:e.treeMetadata}},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"currentFocusedCell",{get:function(){var e=this._$elementPivotTable.data("pivotTable");if(e)return e.getInfoFocusedCell()},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"onHistoryChangedCallback",{get:function(){return this._onHistoryChangedCallback},set:function(e){this._onHistoryChangedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"extensionSettings",{get:function(){if(this._$elementChart.data("ranetChart")){this._extensionOptions.chartOptions||(this._extensionOptions.chartOptions={});var e=this._extensionOptions.chartOptions.seriesOptions;this._extensionOptions.chartOptions=$.extend({},this._$elementChart.data("ranetChart").options(),this._extensionOptions.chartOptions),this._extensionOptions.chartOptions.seriesOptions=e,this._extensionOptions.chartOptions.extensionType=this._extensionOptions.extensionType}return this._$elementVectorMap.data("ranetVectorMap")&&(this._extensionOptions.vectorMapSettings||(this._extensionOptions.vectorMapSettings={}),this._extensionOptions.vectorMapSettings.mapOptions=this._$elementVectorMap.data("ranetVectorMap").options()),this._extensionOptions||(this._extensionOptions={}),this._extensionOptions},set:function(e){void 0===e.chartOptions.defaultDiagramType&&(e.chartOptions.defaultDiagramType=2),this._extensionOptions=e;var t=$.extend({},this._extensionOptions);e.extensionType!==v.Controls.Extensions.ExtensionTypes.Chart&&e.extensionType!==v.Controls.Extensions.ExtensionTypes.Pie||(t.chartOptions.dataSource=[]),g.call(this),B.call(this)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"currentDataSource",{get:function(){return this._$elementPivotTable.data("pivotTable").currentDataSource},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"customCellsConditions",{get:function(){return this._customCellsConditions||(this._customCellsConditions=[]),this._customCellsConditions},set:function(e){this._customCellsConditions=e,this._$elementPivotTable.data("pivotTable").option({cellConditions:this._customCellsConditions}),this._$elementPivotTable.data("pivotTable").reDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"isVisibleExtensionPanel",{get:function(){return this._isVisibleExtensionPanel},set:function(e){this._isVisibleExtensionPanel=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"headerText",{get:function(){return void 0!==this._rightExtensionView&&(this._headerText=this._rightExtensionView.headerText),this._headerText},set:function(e){this._headerText=e,void 0!==this._rightExtensionView&&(this._rightExtensionView.headerText=this._headerText)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"footerText",{get:function(){return void 0!==this._rightExtensionView&&(this._footerText=this._rightExtensionView.footerText),this._footerText},set:function(e){this._footerText=e,void 0!==this._rightExtensionView&&(this._rightExtensionView.footerText=this._footerText)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"initialSourceType",{get:function(){return this._initialSourceType},set:function(e){switch(this._initialSourceType=e,this._initialSourceType){case c.Query:this._rotateAxes=!1,this._$elementQueryDesigner.data("ranetQueryDesigner").option({isEnabled:!1}),this._$elementActiveFilters.data("ranetActiveFilters").isEnabled=!1;break;case c.State:this._$elementQueryDesigner.data("ranetQueryDesigner").option({isEnabled:!0}),this._$elementActiveFilters.data("ranetActiveFilters").isEnabled=!0;break;default:throw new Error("NotImplementedException")}},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"initialQuery",{get:function(){return this._initialQuery},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"selectedMeasureGroupName",{get:function(){return this._selectedMeasureGroupName},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"onStateUpdateStorageChangedCallback",{get:function(){return this._onStateUpdateStorageChangedCallback},set:function(e){this._onStateUpdateStorageChangedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"isEnabledWhatIfAnalysis",{get:function(){return this._isEnabledWhatIfAnalysis},set:function(e){this._isEnabledWhatIfAnalysis=e,!0===this._isEnabledWhatIfAnalysis?(this._rotateAxes=!1,this._$elementQueryDesigner.data("ranetQueryDesigner").option({isEnabled:!1}),this._$elementActiveFilters.data("ranetActiveFilters").isEnabled=!1):this.initialSourceType===c.State&&(this._$elementQueryDesigner.data("ranetQueryDesigner").option({isEnabled:!0}),this._$elementActiveFilters.data("ranetActiveFilters").isEnabled=!0);var t=this;!1===this._isEnabledWhatIfAnalysis?this._updatedCellsStorage.hasServerChanges?this.rollback.call(this).done(function(){t._$elementPivotTable.data("pivotTable").clearLocalChanges(),t._updatedCellsStorage.clearAllChanges(),t.updateData()}):this._updatedCellsStorage.hasLocalChanges?q.call(this):this.updateData():this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"useCustomUpdateScriptTemplate",{get:function(){return this._useCustomUpdateScriptTemplate},set:function(e){this._useCustomUpdateScriptTemplate=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"useChangesCache",{get:function(){return this._useChangesCache},set:function(e){this._useChangesCache=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"currentUpdateScriptTemplate",{get:function(){if(!1===this.useCustomUpdateScriptTemplate){var e=this._$elementPivotTable.data("pivotTable").getAllHierarchies().map(function(e){return e.uniqueName});this._currentUpdateScriptTemplate=v.Controls.UpdateScriptBuilder.getDefaultUpdateScriptTemplate(e)}return this._currentUpdateScriptTemplate},set:function(e){this._currentUpdateScriptTemplate=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"sortingRowsOptions",{get:function(){return this._sortingRowsOptions},set:function(e){this._sortingRowsOptions=e,this._$elementQueryDesigner&&this._$elementQueryDesigner.data("ranetQueryDesigner").option({sortingRowsOptions:this._sortingRowsOptions})},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"sortingColumnsOptions",{get:function(){return this._sortingColumnsOptions},set:function(e){this._sortingColumnsOptions=e,this._$elementQueryDesigner&&this._$elementQueryDesigner.data("ranetQueryDesigner").option({sortingColumnsOptions:this._sortingColumnsOptions})},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"availableSlicers",{get:function(){return this._availableSlicers=this._$elementQueryDesigner.data("ranetQueryDesigner").getAvailableSlicers(),this._availableSlicers},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"showExtensionPanel",{get:function(){return this._showExtensionPanel},set:function(e){this._showExtensionPanel=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"additionalCalculations",{get:function(){return this._additionalCalculations},set:function(e){this._additionalCalculations=e},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"extensionPanelVisibility",{get:function(){return this.isShownExtensionPanel},set:function(e){this.isShownExtensionPanel=e,this.isShownExtensionPanel?this._$rightExtensionPanel.show():this._$rightExtensionPanel.hide()},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"showQueryDesignerToolbar",{set:function(e){return this._$elementQueryDesigner.data("ranetQueryDesigner").option({showToolbar:e})}}),k.prototype.reset=function(){this.initialSourceType=c.State,this.historyManager.clear();var e=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();e.rows={},e.columns={},e.filters={},e.data={},this.headerText="",this.footerText="",this.customCalculatedItems=null,this.customCellsConditions=null,this._$elementQueryDesigner.data("ranetQueryDesigner").option({layout:e}),x.call(this,e,this.historyManager.getAllActions()),m.call(this)},k.prototype.removeAllActions=function(){if(this.initialSourceType===c.State){var e=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();x.call(this,e,[])}else{if(this.initialSourceType!==c.Query)throw new Error("NotImplementationException");D.call(this,this.initialQuery,[])}},k.prototype.init=function(){if(this.isInit)throw new Error("PageDynamicPivotGrid has initialized.");this.isInit=!0,y.call(this),L.call(this),d.call(this),h.call(this),_.call(this),g.call(this),function(){var n=this._$rightExtensionPanel,o=this._$viewContainer,r=this;n.resizable({helper:"resizable-helper",handles:"w",stop:function(e,t){var i=Math.round(n.percWidth());n.css("width",i+"%"),n.css("height",""),n.css("left",""),o.css("width",100-i+"%"),p.call(r)}}),!1===this.isVisibleExtensionPanel&&n.resizable("option","disabled",!0)}.call(this),A.call(this)},k.prototype.updateData=function(){var e=this.historyManager.getAllActions();if(this.initialSourceType===c.State){var t=this._$elementQueryDesigner.data("ranetQueryDesigner").getLayout();C.call(this,t),w.call(this,t,e)}else{if(this.initialSourceType!==c.Query)throw new Error("NotImplementationException");S.call(this,this.currentMdxQuery,e)}},k.prototype.destroy=function(){var e=this._$elementPivotTable.data("pivotTable"),t=this._$elementChart.data("ranetChart"),i=this._$elementLoadPanel.data("ranetLoadPanel");if(!e||!t||!i)throw new Error("Destroy");e.destroy(),t.destroy(),i.destroy(),this._$currentPanel.remove()},k.prototype.setUpInitialQuery=function(e){v.UserActionsTracker.track("Layout -> custom query",{query:e}),this.initialSourceType=c.Query,this.historyManager.clear(),this._$elementPivotTable.data("pivotTable").resetScrolls(),D.call(this,e,[])},k.prototype.setUpInitialCurrentState=function(){v.UserActionsTracker.track("Custom query -> current layout"),this.initialSourceType=c.State,this.historyManager.clear(),x.call(this,this.layout,[])},k.prototype.recalculate=function(){var e=this;V.call(this).done(function(){q.call(e),e.updateData()})},k.prototype.save=function(){var e=this;this._updatedCellsStorage.hasLocalChanges?V.call(this).done(function(){z.call(e).done(function(){e.updateData()})}):z.call(this).done(function(){e.updateData()})},k.prototype.rollback=function(){var e=this;(function(){this.visibleBusyIndicator=!0,this.messageBusyIndicator=v.Localization.localize("LoadPanel_RollbackCommand");var t=this,e={connection:this.connection,contextId:this._contexId};return $.ajax({type:"POST",url:v.PathManager.applicationUrl+"api/olap/rollback",contentType:"application/json; charset=utf-8",data:JSON.stringify(e)}).done(function(){t._updatedCellsStorage.setStateAfterRollback()}).fail(function(e){t.visibleBusyIndicator=!1,v.UserMessageService.showServerError(e),v.LogService.error(e)})}).call(this).done(function(){q.call(e),e.updateData()})},k.prototype.clearLocalChanges=function(){q.call(this),this.updateData()},k}(Ranet),dynamicPivotGrid=function(l){var c={placementLayoutModeQueryDesigner:0,placementLayoutModeDataViewer:0,initialSourceType:0,autoExecuteMdxQuery:!0,isVisibleActiveFilters:!1,showQueryDesignerToolbar:!0,showExtensionPanel:!0};function e(e){this._$panel=$(e)}function o(e){var t=this._descriptionCurrentPage;this._descriptionCurrentPage=e,this.onPageChangedCallback&&this.onPageChangedCallback(t,e)}Object.defineProperty(e.prototype,"descriptionCurrentPage",{get:function(){if(this._descriptionCurrentPage&&(this._descriptionCurrentPage.page.layout=this._descriptionCurrentPage.view.layout,this._descriptionCurrentPage.page.calculatedNamedSets=this._descriptionCurrentPage.view.customCalculatedItems.calculatedNamedSets,this._descriptionCurrentPage.page.calculatedMembers=this._descriptionCurrentPage.view.customCalculatedItems.calculatedMembers,this._descriptionCurrentPage.page.queryDesignerSetting=this._descriptionCurrentPage.view.queryDesignerSetting,this._descriptionCurrentPage.page.loadStateFromHistory=this._descriptionCurrentPage.view.loadStateFromHistory,this._descriptionCurrentPage.page.placementLayoutModeDataViewer=this._descriptionCurrentPage.view.placementLayoutModeDataViewer,this._descriptionCurrentPage.page.placementLayoutModeQueryDesigner=this._descriptionCurrentPage.view.placementLayoutModeQueryDesigner,this._descriptionCurrentPage.page.isVisibleActiveFilters=this._descriptionCurrentPage.view.isVisibleActiveFilters,this._descriptionCurrentPage.page.customCellsConditions=this._descriptionCurrentPage.view.customCellsConditions,this._descriptionCurrentPage.page.selectedMeasureGroupName=this._descriptionCurrentPage.view.selectedMeasureGroupName,this._descriptionCurrentPage.page.isVisibleExtensionPanel=this._descriptionCurrentPage.view.isVisibleExtensionPanel,this._descriptionCurrentPage.page.headerText=this._descriptionCurrentPage.view.headerText,this._descriptionCurrentPage.page.footerText=this._descriptionCurrentPage.view.footerText,this._descriptionCurrentPage.page.showMetadataAndQueryDesigner=this._descriptionCurrentPage.view.showMetadataAndQueryDesigner,this._descriptionCurrentPage.page.extensionSettings=this._descriptionCurrentPage.view.extensionSettings,this._descriptionCurrentPage.view.loadStateFromHistory)){var e=this._descriptionCurrentPage.view.historyManager.getAllActions();this._descriptionCurrentPage.page.actions=e}return this._descriptionCurrentPage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onPageChangedCallback",{get:function(){return this._onPageChangedCallback},set:function(e){this._onPageChangedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"report",{get:function(){for(var e=this._mapPages,t=this._currentReport,i=0;i<t.pages.length;i++){var n=t.pages[i];if(delete n.actions,e[n.id]){var o=e[n.id].view;if(n.layout=o.layout,n.calculatedNamedSets=o.customCalculatedItems.calculatedNamedSets,n.calculatedMembers=o.customCalculatedItems.calculatedMembers,n.queryDesignerSetting=o.queryDesignerSetting,n.loadStateFromHistory=o.loadStateFromHistory,n.extensionSettings=o.extensionSettings,n.placementLayoutModeDataViewer=o.placementLayoutModeDataViewer,n.placementLayoutModeQueryDesigner=o.placementLayoutModeQueryDesigner,n.isVisibleActiveFilters=o.isVisibleActiveFilters,n.customCellsConditions=o.customCellsConditions,n.selectedMeasureGroupName=o.selectedMeasureGroupName,n.initialSourceType=o.initialSourceType,n.autoExecuteMdxQuery=o.autoExecuteMdxQuery,n.isEnabledWhatIfAnalysis=o.isEnabledWhatIfAnalysis,n.useCustomUpdateScriptTemplate=o.useCustomUpdateScriptTemplate,n.useChangesCache=o.useChangesCache,n.currentUpdateScriptTemplate=o.currentUpdateScriptTemplate,n.showMetadataAndQueryDesigner=o.showMetadataAndQueryDesigner,n.sortingColumnsOptions=o.sortingColumnsOptions,n.sortingRowsOptions=o.sortingRowsOptions,n.isVisibleExtensionPanel=o.isVisibleExtensionPanel,n.headerText=o.headerText,n.footerText=o.footerText,n.availableSlicers=o.availableSlicers,1===n.initialSourceType&&(!0===n.loadStateFromHistory?n.initialQuery=o.currentMdxQuery:n.initialQuery=o.initialQuery),0===n.initialSourceType&&!0===o.loadStateFromHistory){var r=o.historyManager.getAllActions();n.actions=r}}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return c},set:function(e){for(var t in e)e.hasOwnProperty(t)&&void 0!==e[t]&&(c[t]=e[t])},enumerable:!0,configurable:!0});return e.prototype.init=function(e,t){this._currentReport=e,this._connection=t},e.prototype.setPage=function(t){this._mapPages||(this._mapPages={});var e=this._currentReport.pages.filter(function(e){if(e.id===t)return e})[0];if(!e)throw new Error("ArgumentException");var i=this._mapPages[e.id];if(i)this.descriptionCurrentPage.view.isVisible=!1,i.view.isVisible=!0,o.call(this,i);else{this.descriptionCurrentPage&&(this.descriptionCurrentPage.view.isVisible=!1);var n={view:function(e,t,i){var n,o={dataSource:[],seriesOptions:[],autogenerate:!0,defaultDiagramType:2,legend:{visible:!0,position:Ranet.Controls.Extensions.LegendPosition.Top},tooltip:{enabled:!0},showArgumentLabels:!0,extensionType:0},r={connection:t.connection||i,cubeName:(n=t.cubeName,"["===n[0]&&"]"===n[n.length-1]?n:"["+n+"]"),autoExecuteMdxQuery:void 0!==t.autoExecuteMdxQuery?t.autoExecuteMdxQuery:c.autoExecuteMdxQuery,queryDesignerSetting:t.queryDesignerSetting,placementLayoutModeQueryDesigner:t.placementLayoutModeQueryDesigner||c.placementLayoutModeQueryDesigner,selectedMeasureGroupName:t.selectedMeasureGroupName,actions:t.actions,initialSourceType:t.initialSourceType?t.initialSourceType:c.initialSourceType,initialQuery:t.initialQuery,loadStateFromHistory:t.loadStateFromHistory,extensionOptions:{},placementLayoutModeDataViewer:t.placementLayoutModeDataViewer||c.placementLayoutModeDataViewer,isVisibleActiveFilters:void 0!==t.isVisibleActiveFilters?t.isVisibleActiveFilters:c.isVisibleActiveFilters,customCellsConditions:t.customCellsConditions,useCustomUpdateScriptTemplate:t.useCustomUpdateScriptTemplate,useChangesCache:t.useChangesCache,isEnabledWhatIfAnalysis:t.isEnabledWhatIfAnalysis,currentUpdateScriptTemplate:t.currentUpdateScriptTemplate,showMetadataAndQueryDesigner:t.showMetadataAndQueryDesigner,sortingRowsOptions:t.sortingRowsOptions,sortingColumnsOptions:t.sortingColumnsOptions,isVisibleExtensionPanel:t.isVisibleExtensionPanel,headerText:t.headerText,footerText:t.footerText,availableSlicers:t.availableSlicers,showExtensionPanel:c.showExtensionPanel};if(t.queryDesignerSetting&&(t.queryDesignerSetting.showToolbar=void 0!==t.queryDesignerSetting.showToolbar?t.queryDesignerSetting.showToolbar:c.showQueryDesignerToolbar),t.extensionSettings?(r.extensionOptions.chartOptions=t.extensionSettings.chartOptions||o,r.extensionOptions.extensionType=t.extensionSettings.extensionType||0,r.extensionOptions.vectorMapSettings=t.extensionSettings.vectorMapSettings||{dataSettings:{col:0,row:void 0}}):(r.extensionOptions.chartOptions=o,r.extensionOptions.extensionType=0,r.extensionOptions.vectorMapSettings={dataSettings:{col:0,row:void 0}}),r.extensionOptions.chartOptions.pie||(r.extensionOptions.chartOptions.pie={header:{title:{text:"",fontSize:24,font:"open sans"}},size:{canvasHeight:400,canvasWidth:400,pieInnerRadius:"0%",pieOuterRadius:"70%"},data:{content:[]},labels:{outer:{format:"value-percentage1",pieDistance:15,color:"#000000"},inner:{format:"none",hideWhenLessThanPercentage:3},mainLabel:{color:"#fff",fontSize:11},percentage:{color:"#fff",fontSize:9,decimalPlaces:0},value:{color:"#fff",fontSize:11},lines:{enabled:!0},truncation:{enabled:!0,truncateLength:27}},tooltips:{enabled:!0},effects:{load:{effect:"none"},pullOutSegmentOnClick:{effect:"linear",speed:400,size:8}},legend:{visible:!0},callbacks:{},minHeight:200}),r.extensionOptions.chartOptions.dataSource=[],void 0!==t.layout){var a=jQuery.extend(!0,{},t.layout);r.layout=a}else r.layout=void 0;r.customCalculatedItems={calculatedMembers:t.calculatedMembers,calculatedNamedSets:t.calculatedNamedSets};var s=new l(e,r);return s.init(),s}(this._$panel,e,this._connection),page:e};this._mapPages[e.id]=n,o.call(this,n)}},e.prototype.deletePage=function(e){var t=this._mapPages[e.id];if(t&&(t.view.destroy(),delete this._mapPages[e.id]),Ranet.Utility.ArrayUtility.removeItem(this._currentReport.pages,e),0!==this._currentReport.pages.length){if(this.descriptionCurrentPage.page===e){var i=this._currentReport.pages[this._currentReport.pages.length-1];this.setPage(i.id)}}else o.call(this,void 0)},e.prototype.destroy=function(){(function(){var e=this._mapPages;if(e)for(var t in e)e.hasOwnProperty(t)&&e[t].view.destroy();this._mapPages=void 0,this._$panel.empty()}).call(this)},e}(pageDynamicPivotGrid);!function(e,u,p){e&&e.module("ranet",[]).directive("ranetDynamicPivotgrid",["$parse","appConfig",function(l,c){return{restrict:"A",link:function(e,t,i){var n=l(i.oncreaterefcontrol),o=i.pathresource,r=i.applicationurl,a=c.defaultCountLoadedMembers;p.PathManager.resourcePath=o,p.PathManager.applicationUrl=r,p.Controls.MemberChoice.QueryManager.step=Number(a);var s=new u(t);s.config={placementLayoutModeQueryDesigner:c.placementLayoutModeQueryDesigner,showQueryDesignerToolbar:c.showQueryDesignerToolbar,showExtensionPanel:c.showExtensionPanel},n(e,{referenceControl:s})}}}])}(window.angular,dynamicPivotGrid,Ranet),function(u,p,h){u.ranetPivotMdxDesigner=function(n,o){var r,a={locale:"en",applicationUrl:"",templatesPath:"assets/templates/",autoExecuteQuery:!0,placementLayoutModeDataViewer:0,placementLayoutModeQueryDesigner:0,autoExecuteMdxQuery:!0,loadStateFromHistory:!1,showMetadataAndQueryDesigner:!0,isVisibleActiveFilters:!1,initialSourceType:0},s={rows:[],columns:[],data:[],filters:[]},l={generateCustomCalculated:!1,hideEmptyColumns:!0,hideEmptyRows:!0,includeAllMembers:!1,includeCustomCalculationsInDrillDown:!1,subsetCount:0,useVisualTotals:!0},c=this;c.settings={},Object.defineProperty(c,"currentMdxQuery",{get:function(){return r.currentMdxQuery},enumerable:!0,configurable:!0}),Object.defineProperty(c,"currentFocusedCell",{get:function(){return r.currentFocusedCell},enumerable:!0,configurable:!0}),Object.defineProperty(c,"historyManager",{get:function(){return r.historyManager},enumerable:!0,configurable:!0}),Object.defineProperty(c,"showMetadataAndQueryDesigner",{get:function(){return r.showMetadataAndQueryDesigner},set:function(e){r.showMetadataAndQueryDesigner=e},enumerable:!0,configurable:!0}),Object.defineProperty(c,"placementLayoutModeQueryDesigner",{get:function(){return r.placementLayoutModeQueryDesigner},set:function(e){r.placementLayoutModeQueryDesigner=e},enumerable:!0,configurable:!0}),this.updateData=function(){r&&r.updateData()};!function(){c.settings=u.extend({},a,o);var e=u.extend({},s,o.layout);c.settings.layout=e;var t=u.extend({},l,o.queryDesignerSetting);if(c.settings.queryDesignerSetting=t,h.PathManager.applicationUrl=c.settings.applicationUrl,h.PathManager.resourcePath=c.settings.resourcePath,h.Localization.isInit)(r=new p(n,c.settings)).init();else{var i=new h.Controls.LoadPanel(n,{visible:!0,position:{of:window}});h.Localization.init(c.settings.applicationUrl,c.settings.resourcePath,c.settings.locale).done(function(){(r=new p(n,c.settings)).init()}).always(function(){i.visible=!1})}}()},u.fn.ranetPivotMdxDesigner=function(t){return this.each(function(){if(null==u(this).data("ranetPivotMdxDesigner")){var e=new u.ranetPivotMdxDesigner(this,t);u(this).data("ranetPivotMdxDesigner",e)}})}}(jQuery,pageDynamicPivotGrid,Ranet),function(f,g,_){f.ranetDynamicPivotGrid=function(a,s){var l,c={locale:"en",applicationUrl:"",resourcePath:"assets/templates/"},u={autoExecuteQuery:!0,placementLayoutModeDataViewer:0,placementLayoutModeQueryDesigner:0,autoExecuteMdxQuery:!0,loadStateFromHistory:!1,showMetadataAndQueryDesigner:!0},p={rows:[],columns:[],data:[],filters:[]},h={generateCustomCalculated:!1,hideEmptyColumns:!0,hideEmptyRows:!0,includeAllMembers:!1,includeCustomCalculationsInDrillDown:!1,subsetCount:0,useVisualTotals:!0},d={chartOptions:{dataSource:[],seriesOptions:[],autogenerate:!1,defaultDiagramType:2,legend:{visible:!0,position:_.Controls.Extensions.LegendPosition.Bottom},tooltip:{enabled:!0,font:{family:"Courier New"},customizeTooltip:function(){var e="<span style='color:"+this.point.color+";font-size:18px;'>&#9632;</span> ";return e+=this.point.name+"  "+this.point.displayValue}},styling:{paddingLeft:60,paddingRight:0,paddingTop:10,paddingBottom:25},showArgumentLabels:!0},vectorMapOptions:{data:{},groups:[]}},m=this;m.settings={},this.setPage=function(e){l.setPage(e)};!function(){if(!s.pages)throw new Error("Not found pages of report");if(!s.idDefaultPage)throw new Error("Not found ID default page");console.log(s),console.log(m),m.settings=f.extend({},c,s);for(var e=0;e<s.pages.length;e++){var t=s.pages[e];t.calculatedMembers&&(s.pages[e].calculatedMembers=t.calculatedMembers),t.calculatedNamedSets&&(s.pages[e].calculatedNamedSets=t.calculatedNamedSets),s.pages[e]=f.extend({},u,t),s.pages[e].layout=f.extend({},p,t.layout),s.pages[e].queryDesignerSetting=f.extend({},h,t.queryDesignerSetting),s.pages[e].extensionSettings=f.extend({},d,t.extensionSettings)}var i=m.settings.connectionString,n=m.settings.locale,o=m.settings.applicationUrl;if(_.PathManager.applicationUrl=o,_.PathManager.resourcePath=m.settings.resourcePath,delete m.settings.connectionString,delete m.settings.locale,!_.Localization.isInit){var r=new _.Controls.LoadPanel(a,{visible:!0,position:{of:window}});return console.log("Localization is inited with path:",m.settings.resourcePath),_.Localization.init(o,m.settings.resourcePath,n).done(function(){(l=new g(a)).init(m.settings,i),l.setPage(s.idDefaultPage)}).always(function(){r.visible=!1})}(l=new g(a)).init(m.settings,i),l.setPage(s.idDefaultPage)}()},f.fn.ranetDynamicPivotGrid=function(t){return console.log(t),this.each(function(){if(null==f(this).data("ranetDynamicPivotGrid")){var e=new f.ranetDynamicPivotGrid(this,t);f(this).data("ranetDynamicPivotGrid",e)}})}}(jQuery,dynamicPivotGrid,Ranet);